<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222"/>


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"/>

<link rel="stylesheet" href="/css/main.css?v=7.0.1"/>


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="computer, finance, some recording">
<meta property="og:type" content="website">
<meta property="og:title" content="Eden">
<meta property="og:url" content="http://blog.sevenpan.com/index.html">
<meta property="og:site_name" content="Eden">
<meta property="og:description" content="computer, finance, some recording">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Eden">
<meta name="twitter:description" content="computer, finance, some recording">






  <link rel="canonical" href="http://blog.sevenpan.com/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Eden</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=UA-135755004-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-135755004-1');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Eden</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br/>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2019/03/26/JavaScript/React 环境搭建/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/26/JavaScript/React 环境搭建/" class="post-title-link" itemprop="url">React学习笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-26 00:00:00" itemprop="dateCreated datePublished" datetime="2019-03-26T00:00:00+08:00">2019-03-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-27 12:12:45" itemprop="dateModified" datetime="2019-03-27T12:12:45+08:00">2019-03-27</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="React-环境搭建"><a href="#React-环境搭建" class="headerlink" title="React 环境搭建"></a>React 环境搭建</h2><p>在cmd中查看自己的nodejs版本以及npm的版本：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure>
<p>创建全局的react，在cmd中输入以下命令行：</p>
<pre><code>npm install -g create-react-app
</code></pre><p>之后就是进入想要创建工程的目录，创建工程名：</p>
<pre><code>create-react-app basicProject
</code></pre><p>这样就会构建一个基本工程。</p>
<h3 id="项目文件结构解析"><a href="#项目文件结构解析" class="headerlink" title="项目文件结构解析"></a>项目文件结构解析</h3><p>ref：<a href="https://my.oschina.net/korabear/blog/1815170" target="_blank" rel="noopener">React 项目文件结构解析</a>  </p>
<p>项目结构如下：<br><img src="../../images/js/nodejsProjectStruct.png" alt="nodejsProjectStruct.png"> </p>
<h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>管理下载的依赖包，然后可以允许的npm的命令也在这里。比如，<code>npm start</code>/<code>npm build</code>          </p>
<h3 id="public-文件夹"><a href="#public-文件夹" class="headerlink" title="public 文件夹"></a>public 文件夹</h3><h4 id="favicon-ico"><a href="#favicon-ico" class="headerlink" title="favicon.ico"></a>favicon.ico</h4><p>浏览器tab上的图标，这个项目的标志logo。可替换</p>
<h3 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h3><p><code>&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</code>是项目的总容器，所有的内容存储在这个容器中。这个容器有且只能有一个。</p>
<h3 id="src文件夹"><a href="#src文件夹" class="headerlink" title="src文件夹"></a>src文件夹</h3><h4 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h4><p>初始化出来的项目中，该文件为空。</p>
<h4 id="App-js"><a href="#App-js" class="headerlink" title="App.js"></a>App.js</h4><p>初始化后文件内容如下:  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'./logo.svg'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">        &lt;header className=<span class="string">"App-header"</span>&gt;</span><br><span class="line">          &lt;img src=&#123;logo&#125; className=<span class="string">"App-logo"</span> alt=<span class="string">"logo"</span> /&gt;</span><br><span class="line">          &lt;p&gt;</span><br><span class="line">            Edit &lt;code&gt;src/App.js&lt;<span class="regexp">/code&gt; and save to reload.</span></span><br><span class="line"><span class="regexp">          &lt;/</span>p&gt;</span><br><span class="line">          &lt;a</span><br><span class="line">            className=<span class="string">"App-link"</span></span><br><span class="line">            href=<span class="string">"https://reactjs.org"</span></span><br><span class="line">            target=<span class="string">"_blank"</span></span><br><span class="line">            rel=<span class="string">"noopener noreferrer"</span></span><br><span class="line">          &gt;</span><br><span class="line">            Learn React</span><br><span class="line">          &lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>header&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure>
<p>App.js 继承了component，需要使用render进行渲染。return的内容为类似html结构的内容，也就是jsx。在这个文件中，只可以用一个div容器，如果在div同级目录中添加别的内容，便会报错。   </p>
<p>className=”App”，是引用App.css的样式。内容样式是就近原则，首先用App.css样式，index.css是全局的样式。  </p>
<h2 id="从空白的工程开始构建"><a href="#从空白的工程开始构建" class="headerlink" title="从空白的工程开始构建"></a>从空白的工程开始构建</h2><p>上面用了create-react-app命令构建出来的项目，直接开始可以看到一个react的hello界面，但是我自己从零开始，还想希望可以一点点弄清楚里面的文件都是干啥的。所以又参考了另外一个连接，对这个工程进行调整。<br>ref：<a href="https://reactjs.org/tutorial/tutorial.html" target="_blank" rel="noopener">Tutorial: Intro to React</a>  </p>
<p>将工程中的src目录清空，并且添加文件如下：<br>index.css</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">	<span class="selector-tag">body</span> &#123;</span><br><span class="line">	  <span class="attribute">font</span>: <span class="number">14px</span> <span class="string">"Century Gothic"</span>, Futura, sans-serif;</span><br><span class="line">	  <span class="attribute">margin</span>: <span class="number">20px</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="selector-tag">ol</span>, <span class="selector-tag">ul</span> &#123;</span><br><span class="line">	  <span class="attribute">padding-left</span>: <span class="number">30px</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="selector-class">.board-row</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">	  <span class="attribute">clear</span>: both;</span><br><span class="line">	  <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">	  <span class="attribute">display</span>: table;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="selector-class">.status</span> &#123;</span><br><span class="line">	  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="selector-class">.square</span> &#123;</span><br><span class="line">	  <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">	  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#999</span>;</span><br><span class="line">	  <span class="attribute">float</span>: left;</span><br><span class="line">	  <span class="attribute">font-size</span>: <span class="number">24px</span>;</span><br><span class="line">	  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">	  <span class="attribute">line-height</span>: <span class="number">34px</span>;</span><br><span class="line">	  <span class="attribute">height</span>: <span class="number">34px</span>;</span><br><span class="line">	  <span class="attribute">margin-right</span>: -<span class="number">1px</span>;</span><br><span class="line">	  <span class="attribute">margin-top</span>: -<span class="number">1px</span>;</span><br><span class="line">	  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">	  <span class="attribute">text-align</span>: center;</span><br><span class="line">	  <span class="attribute">width</span>: <span class="number">34px</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="selector-class">.square</span><span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">	  <span class="attribute">outline</span>: none;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="selector-class">.kbd-navigation</span> <span class="selector-class">.square</span><span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">	  <span class="attribute">background</span>: <span class="number">#ddd</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="selector-class">.game</span> &#123;</span><br><span class="line">	  <span class="attribute">display</span>: flex;</span><br><span class="line">	  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="selector-class">.game-info</span> &#123;</span><br><span class="line">	  <span class="attribute">margin-left</span>: <span class="number">20px</span>;</span><br><span class="line">	&#125;</span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">index</span><span class="selector-class">.js</span></span><br><span class="line"></span><br><span class="line">```<span class="selector-tag">js</span></span><br><span class="line"><span class="selector-tag">class</span> <span class="selector-tag">Square</span> <span class="selector-tag">extends</span> <span class="selector-tag">React</span><span class="selector-class">.Component</span> &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="selector-tag">return</span> (</span><br><span class="line">      &lt;button className="square"&gt;</span><br><span class="line">        &#123;<span class="comment">/* TODO */</span>&#125;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">class</span> <span class="selector-tag">Board</span> <span class="selector-tag">extends</span> <span class="selector-tag">React</span><span class="selector-class">.Component</span> &#123;</span><br><span class="line">  renderSquare(i) &#123;</span><br><span class="line">    return &lt;Square /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">render</span>() &#123;</span><br><span class="line">    const status = 'Next player: X';</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">return</span> (</span><br><span class="line">      &lt;<span class="selector-tag">div</span>&gt;</span><br><span class="line">        &lt;div className="status"&gt;&#123;status&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div className="board-row"&gt;</span><br><span class="line">          &#123;this.renderSquare(0)&#125;</span><br><span class="line">          &#123;this.renderSquare(1)&#125;</span><br><span class="line">          &#123;this.renderSquare(2)&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className="board-row"&gt;</span><br><span class="line">          &#123;this.renderSquare(3)&#125;</span><br><span class="line">          &#123;this.renderSquare(4)&#125;</span><br><span class="line">          &#123;this.renderSquare(5)&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className="board-row"&gt;</span><br><span class="line">          &#123;this.renderSquare(6)&#125;</span><br><span class="line">          &#123;this.renderSquare(7)&#125;</span><br><span class="line">          &#123;this.renderSquare(8)&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">class</span> <span class="selector-tag">Game</span> <span class="selector-tag">extends</span> <span class="selector-tag">React</span><span class="selector-class">.Component</span> &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="selector-tag">return</span> (</span><br><span class="line">      &lt;div className="game"&gt;</span><br><span class="line">        &lt;div className="game-board"&gt;</span><br><span class="line">          &lt;Board /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className="game-info"&gt;</span><br><span class="line">          &lt;div&gt;&#123;/* status */&#125;&lt;/div&gt;</span><br><span class="line">          &lt;ol&gt;&#123;/* TODO */&#125;&lt;/ol&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ========================================</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ReactDOM</span><span class="selector-class">.render</span>(</span><br><span class="line">  &lt;Game /&gt;,</span><br><span class="line">  document.getElementById('root')</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>效果如下：  </p>
<p><img src="../../images/js/init1.png" alt="init1.png"></p>
<p>ok，这上面 就是一个tutorial的棋盘了，但是我的目标是<strong>一个输入框和提交后台的button</strong>。所以对它们进行裁剪和添加吧。<br>修改后的文件如下，index.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./index.css'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">const</span> status = <span class="string">'Next player: X'</span>;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;div className=<span class="string">"status"</span>&gt;&#123;status&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className="board-row"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;p&gt;hello&lt;/</span>p&gt;</span><br><span class="line">            &lt;ol&gt;&#123;<span class="comment">/* TODO */</span>&#125;&lt;<span class="regexp">/ol&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">  class App extends React.Component &#123;</span></span><br><span class="line"><span class="regexp">    render() &#123;</span></span><br><span class="line"><span class="regexp">      return (</span></span><br><span class="line"><span class="regexp">        &lt;div className="app"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className="app-board"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Board /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className="app-info"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;div&gt;&#123;/</span>* status *<span class="regexp">/&#125;&lt;/</span>div&gt;</span><br><span class="line">            &lt;ol&gt;&#123;<span class="comment">/* TODO */</span>&#125;&lt;<span class="regexp">/ol&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ ========================================</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">  ReactDOM.render(</span></span><br><span class="line"><span class="regexp">    &lt;App /</span>&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</span><br><span class="line">  );</span><br></pre></td></tr></table></figure>
<p>index.html文件</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">font</span>: <span class="number">14px</span> <span class="string">"Century Gothic"</span>, Futura, sans-serif;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ol</span>, <span class="selector-tag">ul</span> &#123;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.board-row</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">clear</span>: both;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">  <span class="attribute">display</span>: table;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.status</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.kbd-navigation</span> <span class="selector-class">.square</span><span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ddd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.app</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.app-info</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>展示如下：</p>
<p><img src="../../images/js/init2.png" alt="init2"></p>
<p>对index.js中的Board进行修改可以获得如下button：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;<span class="attr">isToggleOn</span>: <span class="literal">true</span>&#125;;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// This binding is necessary to make `this` work in the callback</span></span><br><span class="line">        <span class="keyword">this</span>.handleClick = <span class="keyword">this</span>.handleClick.bind(<span class="keyword">this</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">    handleClick() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">        isToggleOn: !prevState.isToggleOn</span><br><span class="line">    &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">const</span> status = <span class="string">'Next player: X'</span>;</span><br><span class="line">    </span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;div className=<span class="string">"status"</span>&gt;&#123;status&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className="board-row"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;p&gt;hello&lt;/</span>p&gt;</span><br><span class="line">            &lt;button onClick=&#123;<span class="keyword">this</span>.handleClick&#125;&gt;</span><br><span class="line">                &#123;<span class="keyword">this</span>.state.isToggleOn ? <span class="string">'ON'</span> : <span class="string">'OFF'</span>&#125;</span><br><span class="line">            &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br></pre></td></tr></table></figure>
<p><img src="../../images/js/init3.png" alt="init3.png"><br>接下来参考<a href="https://react.docschina.org/docs/forms.html" target="_blank" rel="noopener">https://react.docschina.org/docs/forms.html</a>  </p>
<p>当然上面那个是button怎么调用对应的函数，如果只要最简单的input和button样式存在，那么index.js代码改成：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;div className=<span class="string">"board-row"</span>&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;form&gt;</span><br><span class="line">                &lt;label&gt;</span><br><span class="line">                    IP:</span><br><span class="line">                    &lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span> /&gt;</span><br><span class="line">                &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">                &lt;input type="submit" value="Submit" /</span>&gt;</span><br><span class="line">                &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>就可以获得：<br><img src="../../images/js/init4.png" alt="init4"></p>
<p>在对Board进行修改后：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;<span class="attr">value</span>: <span class="string">''</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.handleChange = <span class="keyword">this</span>.handleChange.bind(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.handleSubmit = <span class="keyword">this</span>.handleSubmit.bind(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleChange(event)&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">value</span>: event.target.value&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleSubmit(event)&#123;</span><br><span class="line">        alert(<span class="string">'A name was submitted: '</span> + <span class="keyword">this</span>.state.value);</span><br><span class="line">        event.preventDefault();</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;div className=<span class="string">"board-row"</span>&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;form onSubmit=&#123;<span class="keyword">this</span>.handleSubmit&#125;&gt;</span><br><span class="line">                &lt;label&gt;</span><br><span class="line">                    IP:</span><br><span class="line">                    &lt;input type=<span class="string">"text"</span> value=&#123;<span class="keyword">this</span>.state.value&#125; onChange=&#123;<span class="keyword">this</span>.handleChange&#125; /&gt;</span><br><span class="line">                &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">                &lt;input type="submit" value="Submit" /</span>&gt;</span><br><span class="line">                &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>表现可以如下了：<br><img src="../../images/js/init5.png" alt="init5"></p>
<p>some references:<br><a href="https://reactjs.org/docs/hello-world.html" target="_blank" rel="noopener">Hello World
</a><br><a href="https://reactjs.org/docs/react-api.html?#createelement" target="_blank" rel="noopener">React Top-Level API</a><br><a href="https://reactjs.org/docs/react-without-jsx.html" target="_blank" rel="noopener">React Without JSX</a>  </p>
<h3 id="Ajax请求后台的接口"><a href="#Ajax请求后台的接口" class="headerlink" title="Ajax请求后台的接口"></a>Ajax请求后台的接口</h3><p>ref:<a href="http://api.jquery.com/jquery.ajax/" target="_blank" rel="noopener">http://api.jquery.com/jquery.ajax/</a>  </p>
<p>将index.js中Board.class 代码改成：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;<span class="attr">value</span>: <span class="string">''</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.handleChange = <span class="keyword">this</span>.handleChange.bind(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.handleSubmit = <span class="keyword">this</span>.handleSubmit.bind(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.get = <span class="keyword">this</span>.get.bind(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleChange(event)&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">value</span>: event.target.value&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleSubmit(event)&#123;</span><br><span class="line">        alert(<span class="string">'A name was submitted: '</span> + <span class="keyword">this</span>.state.value);</span><br><span class="line">        event.preventDefault();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get(event)&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type:<span class="string">'get'</span>,</span><br><span class="line">            url:<span class="string">'http://127.0.0.1:8080/ipTrans/'</span> + <span class="keyword">this</span>.state.value,</span><br><span class="line">            success:<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(res);</span><br><span class="line">            &#125;,</span><br><span class="line">            error:<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(res);</span><br><span class="line">            &#125;,</span><br><span class="line">            complete: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"just prove"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).done(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            alert( <span class="string">"success"</span> );</span><br><span class="line">          &#125;)</span><br><span class="line">          .fail(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            alert( <span class="string">"error"</span> );</span><br><span class="line">          &#125;)</span><br><span class="line">          .always(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            alert( <span class="string">"complete"</span> );</span><br><span class="line">          &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;div className=<span class="string">"board-row"</span>&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;form onSubmit=&#123;<span class="keyword">this</span>.get&#125;&gt;</span><br><span class="line">                &lt;label&gt;</span><br><span class="line">                    IP:</span><br><span class="line">                    &lt;input type=<span class="string">"text"</span> value=&#123;<span class="keyword">this</span>.state.value&#125; onChange=&#123;<span class="keyword">this</span>.handleChange&#125; /&gt;</span><br><span class="line">                &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">                &lt;input type="submit" value="Submit" /</span>&gt;</span><br><span class="line">            &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>并且对这个工程运行：<code>yarn build</code>，工程将会产生一个build文件，将该目录都移到另外一个我以及弄好的springboot项目中，将其直接放到src/main/resources/static中即可访问。  </p>
<p><strong>碰到了一个报错，粗看以为比较麻烦的跨域问题，再一细看报错，其实是我访问地址为: http:localhost:8080,而点完请求以后，自动请求的是http:127.0.0.1:8080，就被浏览器判断为跨域了，所以，修改下请求地址就没有这个问题。</strong></p>
<p>我修改了以后，发现可以把请求传到后端了，但是怎么将结果展示到input是另外一个问题；目前的修改代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./index.css'</span>;</span><br><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;<span class="attr">value</span>: <span class="string">''</span>, <span class="attr">result</span>: <span class="string">''</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.handleChange = <span class="keyword">this</span>.handleChange.bind(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.get = <span class="keyword">this</span>.get.bind(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleChange(event)&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">value</span>: event.target.value&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get(event)&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type:<span class="string">'get'</span>,</span><br><span class="line">            url:<span class="string">'ipTrans/'</span> + <span class="keyword">this</span>.state.value,</span><br><span class="line">        &#125;).done(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.state.result = res;</span><br><span class="line">            alert( <span class="string">"result"</span> + <span class="keyword">this</span>.state.result);</span><br><span class="line">          &#125;)</span><br><span class="line">          .fail(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            alert( <span class="string">"error"</span> );</span><br><span class="line">          &#125;)</span><br><span class="line">          .always(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            alert( <span class="string">"complete"</span> );</span><br><span class="line">          &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;div className=<span class="string">"board-row"</span>&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;form onSubmit=&#123;<span class="keyword">this</span>.get&#125;&gt;</span><br><span class="line">                &lt;label&gt;</span><br><span class="line">                    IP:</span><br><span class="line">                    &lt;input type=<span class="string">"text"</span> value=&#123;<span class="keyword">this</span>.state.value&#125; onChange=&#123;<span class="keyword">this</span>.handleChange&#125; /&gt;</span><br><span class="line">                &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">                &lt;input type="submit" value="Submit" /</span>&gt;</span><br><span class="line">                &lt;label&gt;</span><br><span class="line">                    result: </span><br><span class="line">                    &lt;input type=<span class="string">"text"</span> value=&#123;<span class="keyword">this</span>.state.result&#125; /&gt;</span><br><span class="line">                &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>form&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;div className=<span class="string">"app"</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">"app-board"</span>&gt;</span><br><span class="line">            &lt;Board /&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className="app-info"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;div&gt;&#123;/</span>* status *<span class="regexp">/&#125;&lt;/</span>div&gt;</span><br><span class="line">            &lt;ol&gt;&#123;<span class="comment">/* TODO */</span>&#125;&lt;<span class="regexp">/ol&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">  ReactDOM.render(</span></span><br><span class="line"><span class="regexp">    &lt;App /</span>&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</span><br><span class="line">  );</span><br></pre></td></tr></table></figure>
<p><strong>可以成功请求了，但是获得的结果之后会重新刷新页面，获得的结果会很快的刷掉了，我要看看能不能另外解决。</strong></p>
<h3 id="webpack打包"><a href="#webpack打包" class="headerlink" title="webpack打包"></a>webpack打包</h3><p>由于有指定要用webpack打包，先学习下这个。ref:<a href="https://www.valentinog.com/blog/react-webpack-babel/" target="_blank" rel="noopener">How to set up React, webpack, and Babel</a>  </p>
<p>webpack吸取React的组件产生可以被几乎任何浏览器理解的JavaScript的代码。<br>安装并且运行webpack:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack --save-dev</span><br><span class="line">npm i webpack-cli --save-dev</span><br></pre></td></tr></table></figure>
<p>并且在工程的<code>package.json</code>中添加如下代码：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "build": "webpack --<span class="built_in">mode</span> production"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>目前不需要给webpack写一行配置文件。老的webpack版本会自动的查找一个配置文件，但是在版本4之后，你可以直接开始开发。</p>
<h4 id="Babel"><a href="#Babel" class="headerlink" title="Babel"></a>Babel</h4><p>React 组件大部分是在JS ES6中编写的。 但是ES6不能被很多老的浏览器所理解。比如<strong>class</strong>关键词。有状态的React组件被声明为classes。为了让ES6可以在老的浏览器中工作，我们需要一种转换。<br>这个转换叫做<strong>transpiling</strong>。Webpack不知道怎么转换ES6到ES5，但是它有一个观念叫做loaders：可以被当成转换器。<br>babel-loader是Webpack loader用于将ES6代码并且使它们可以被选择浏览器所理解。<br>明显的babel-loader利用了Babel。并且Babel需要预先配置以下：</p>
<ol>
<li>babel preset env用于编译ES6到ES5（babel-preset-es2015已经过期了）</li>
<li>babel preset react 用来编译JSX和其他的为JS。</li>
</ol>
<p>安装依赖如下：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @babel/core babel-loader @babel/preset-env @babel/preset-react --save-dev</span><br></pre></td></tr></table></figure>
<p>并且在project中创建一个.babelrc文件：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "presets": ["@babel/preset-env", "@babel/preset-react"]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个阶段，我们需要定义一个最小的webpack 配置文件, webpack.config.js：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line"><span class="function">  module: &#123;</span></span><br><span class="line"><span class="function">    <span class="title">rules</span>: [</span></span><br><span class="line"><span class="function">      &#123;</span></span><br><span class="line"><span class="function">        <span class="title">test</span>: /\.(<span class="title">js</span>|<span class="title">jsx</span>)$/,</span></span><br><span class="line"><span class="function">        <span class="title">exclude</span>: /<span class="title">node_modules</span>/,</span></span><br><span class="line"><span class="function">        <span class="title">use</span>: &#123;</span></span><br><span class="line"><span class="function">          <span class="title">loader</span>: "<span class="title">babel</span>-<span class="title">loader</span>"</span></span><br><span class="line"><span class="function">        &#125;</span></span><br><span class="line"><span class="function">      &#125;</span></span><br><span class="line"><span class="function">    ]</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function">&#125;;</span></span><br></pre></td></tr></table></figure>
<p>这个配置很简单，就是对任何一个js/jsx的文件，webpack通过babel-loader将ES6转为ES5.</p>
<h4 id="writing-React-components"><a href="#writing-React-components" class="headerlink" title="writing React components"></a>writing React components</h4><p>文中根据Container/Presentation principle创造两个React 组件。<br><strong>container Component</strong>是遵循函数是为了处理状态变化的逻辑，内部的组件状态等等的原则。<strong>presentation</strong>只是用来展示内部的标记。 Presentational 组件是纯js函数用来接受从container组件比如props的数据。<br>我们的第一个presentational React组件将是一个<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/text" target="_blank" rel="noopener">text input</a>.一个<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/text" target="_blank" rel="noopener">HTML input</a>将会有以下的属性：</p>
<ul>
<li>type 类型</li>
<li>class 类</li>
<li>id </li>
<li>value 值</li>
<li>required </li>
</ul>
<p>这些属性会变成props然后那些容器组件将会将它传给presentational child。  </p>
<h4 id="the-HTML-webpack-plugin"><a href="#the-HTML-webpack-plugin" class="headerlink" title="the HTML webpack plugin"></a>the HTML webpack plugin</h4><p>为了展示React form，我们需要告诉Webpack来产生一个html页面。这个结果生成的包将放在脚本标记内。<br>Webpacks需要另外两个组件来处理HTML：html-webpack-plugin和html-loader。<br>安装这两个依赖：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i html-webpack-plugin html-loader --save-dev</span><br></pre></td></tr></table></figure>
<p>并且更新webpack配置文件：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">const HtmlWebPackPlugin = require("html-webpack-plugin");</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.(js|jsx)$/,</span><br><span class="line">        exclude: /node_modules/,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: "babel-loader"</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.html$/,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: "html-loader"</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    new HtmlWebPackPlugin(&#123;</span><br><span class="line">      template: "./src/index.html",</span><br><span class="line">      filename: "./index.html"</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后创造html到src中。并且运行<code>npm run build</code>之后可以在dist中看到html文件。<br>使用webpack你不需要在你的html文件包含JS文件：这个bundle将会自动注入到页面。  </p>
<h4 id="我项目的更改"><a href="#我项目的更改" class="headerlink" title="我项目的更改"></a>我项目的更改</h4><p>根据上面的描述，使用webpack，增加了一个<code>webpack.config.js</code>,内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/\.(js|jsx)$/</span>,</span><br><span class="line">          exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">"babel-loader"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            loader: <span class="string">"style-loader!css-loader"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p>增加一个<code>.babelrc</code>文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"presets"</span>: [<span class="string">"@babel/preset-env"</span>, <span class="string">"@babel/preset-react"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并且修改了package.json文件中的script：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"build": "webpack --mode production",</span><br></pre></td></tr></table></figure>
<p>在这之后，运行<code>npm run build</code>可以看到新产生一个dist目录，并且产生了main.js文件。将该文件放到后端文件就可以了。另外这个ref的文章里面的例子也有实现，在我自己的git 上的webpackSample分支上。  </p>
<h3 id="redux"><a href="#redux" class="headerlink" title="redux"></a>redux</h3><p>ref:<a href="https://www.valentinog.com/blog/redux/" target="_blank" rel="noopener">React Redux tutorial</a><br>嗯，为了使用redux，又找了一个指南，关于redux的，希望看完以后，可以知道怎么结合这两使用。</p>
<h4 id="What-is-State"><a href="#What-is-State" class="headerlink" title="What is State"></a>What is State</h4><p>一个<strong>stateful React compoment</strong>是一个JSES6类(虽然，可能会被React Hooks替换掉)。<br>每一个stateful React compoment有自己的状态。<br>在一个React组件中，state持有数据，并且这个组件将会将这个数据渲染给用户。<br>这个state将会随着action和event进行改变，在React中，你可以使用setState更新本地的组件状态。<br>什么是state。state不仅仅是在React中，JS应用也有state，比如：  </p>
<blockquote>
<p>这个用户点击了一个按钮<br>然后一个模块展现了<br>接下来的交互我们需要state来处理 </p>
</blockquote>
<p>比如最开始的状态我们使用一个JS对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> state = &#123;</span><br><span class="line">  buttonClicked: <span class="string">'no'</span>,</span><br><span class="line">  modalOpen: <span class="string">'no'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后随着用户点击按钮，我们有：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> state = &#123;</span><br><span class="line">  buttonClicked: <span class="string">'yes'</span>,</span><br><span class="line">  modalOpen: <span class="string">'yes'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>除了将state存储在一个对象中，你还能怎么追踪这些东西？有没有包可以帮助我们追踪这些state？  </p>
<h4 id="what-problem-does-Redux-solve"><a href="#what-problem-does-Redux-solve" class="headerlink" title="what problem does Redux solve?"></a>what problem does Redux solve?</h4><p>通常JS应用有很多的state，比如：</p>
<ul>
<li>用户看见了什么</li>
<li>我们获取到的数据</li>
<li>我们需要给用户展示的链接</li>
<li>页面中被选中的对象</li>
<li>应用中是否有错误，这个也是state。</li>
</ul>
<p>State在JS中到处都是，但是你可以想象一个React应用中有多少的state么？<br>有时我们也许想要有一个一致的方法来追踪状态的改变。但是前端永远不应该考虑业务逻辑。<br>所以对于React组件来说，Redux是一个选择来管理state。<br><strong>Redux解决了在一开始并不清楚的一个问题：</strong>它帮助给每一个React组件所需要的准确的状态。<br>Redux单独定位持有这个状态。<br>通过使用Redux，获取并且管理状态的逻辑独立于React之外。</p>
<h4 id="why-should-I-learn-Redux"><a href="#why-should-I-learn-Redux" class="headerlink" title="why should I learn Redux?"></a>why should I learn Redux?</h4><p>Redux并不难。只是要有激情去学它(看起来像句废话)。<br>State在JS中是普遍的并且难的，所以在JS中，state的管理仍然是一个问题。<br>另外一个事实是：真实世界的JS项目都会使用一个状态管理包。  </p>
<h4 id="should-I-use-Redux"><a href="#should-I-use-Redux" class="headerlink" title="should I use Redux?"></a>should I use Redux?</h4><p>是否使用Redux或者Flux(或者Mobx)取决于你。它们会增加另外一层抽象在你的应用中。<br>但是还是可以把Redux当成一种投资而不是消耗。在采取Redux之前，可以尝试另外一种模式，特别是React的state和props。<a href="https://daveceddia.com/context-api-vs-redux/" target="_blank" rel="noopener">children props as an alternative before reaching for Redux.</a>  可以看一看。<br>很多。。。就是说在大的应用里面用上redux比较有用，不过我这是学习，继续往下了。</p>
<h4 id="Getting-to-know-the-Redux-store"><a href="#Getting-to-know-the-Redux-store" class="headerlink" title="Getting to know the Redux store"></a>Getting to know the Redux store</h4><p><strong>store编排Redux中所有移动的部分</strong>。在Redux中，store就像是人类的大脑。这个Redux store是基础：整个应用的状态都生存在store中。<br>所以为了开始使用Redux我们应该创造一个store来存储state。</p>
<p>创造代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/store/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">"../reducers/index"</span>;</span><br><span class="line"><span class="keyword">const</span> store = createStore(rootReducer);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<p>就如你所见到的，store是createStore的结果，也就是redux包的一个函数。createStore接受一个reducer作为第一个参数，并且在我们的例子中，我们传递rootReducer。<br>你也可以传递一个初始状态给createStore，这对于服务器端渲染很有帮助。<br>最重要的观点是：redux中的state是从reducers获取的。更清楚一些的说：reducers产生你应用的状态。<br>有这些知识以后，让我们开始我们的第一个Redux reducer。  </p>
<h4 id="Getting-to-know-Redux-reducers"><a href="#Getting-to-know-Redux-reducers" class="headerlink" title="Getting to know Redux reducers"></a>Getting to know Redux reducers</h4><p>一个初始话的状态对于客户端渲染是很有用的，在Redux中，这个状态必须是完全从reducers中返回的，但是，什么是reducers？<br><strong>一个reducer只是一个js的函数。</strong>一个reducer有两个参数：当前的状态和一个action。(state and action).<br>在一个标准的React组件中，本地的状态变化是随着setState改变的。在Redux中，你不能这样做。Redux的第三个原则是状态是不可变的，不能就地更改。<br>这就是为什么reduer需要是纯净的。一个纯函数是如果给定了输入，那么输出也是一定的。<br>创造一个reducer并不那么困难。它是一个有两个参数的JS函数。<br>在我们的例子中，我们将会创造一个简单的reducer以初始状态作为第一个参数，第二个参数是一个提供的action。<br>reducer代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/reducers/index.js</span></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  articles: []</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rootReducer</span>(<span class="params">state = initialState, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure>
<p>这个reducer会直接返回state而不做任何的处理。<br>在接下来我们会添加action来让事情变的更加有趣。  </p>
<h4 id="Getting-to-know-Redux-actions"><a href="#Getting-to-know-Redux-actions" class="headerlink" title="Getting to know Redux actions"></a>Getting to know Redux actions</h4><p>Redux的reducers毫无疑问是redux中最重要的观点。Reducers产生这个应用的状态。<br>但是一个reducer是怎么知道应该产生下一个状态了？<br>第二个Redux的原则是：为了改变状态的方法是发送一个信号给store。这个信号就是一个action。“分发一个action”就是发送这个信号的过程。<br>但是你还是不知道如何修改一个不可变的状态。这个结果的状态就是当前的状态加上新的数据。这里包含了很多东西…<br>不过，Redux actions也只是一个JS对象。这是一个action看起来的样子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  type: <span class="string">'ADD_ARTICLE'</span>,</span><br><span class="line">  payload: &#123; <span class="attr">title</span>: <span class="string">'React Redux Tutorial'</span>, <span class="attr">id</span>: <span class="number">1</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每一个action需要一个类型属性来描述这个state应该怎么修改。你也可以指定一个payload，比如在上面的例子中，payload是一个新的文章。Reducer稍后将会添加这个文章到当前的状态中。<br>最好的操作时将每一个action都包含进一个函数中。这样这个函数就是一个action的创造者。<br>action的代码如下：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/actions/index.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addArticle</span>(<span class="params">payload</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">type</span>: <span class="string">"ADD_ARTICLE"</span>, payload &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这样这个type类型只是一个string。<br>这个reducer将会使用这个string来决定怎么计算接下来的状态。<br>由于Strings容易被打错和复制，更好的是将action类型声明为常量。<br>这个方法可以避免难以debug的错误。<br>创造新的文件如下：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/constants/action-types.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_ARTICLE = <span class="string">"ADD_ARTICLE"</span>;</span><br></pre></td></tr></table></figure>
<p>并更新<code>src/js/actions/index.js</code>的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/actions/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; ADD_ARTICLE &#125; <span class="keyword">from</span> <span class="string">"../constants/action-types"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addArticle</span>(<span class="params">payload</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">type</span>: ADD_ARTICLE, payload &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Refactoring-the-reducer"><a href="#Refactoring-the-reducer" class="headerlink" title="Refactoring the reducer"></a>Refactoring the reducer</h4><p>继续之前，总结下Redux的主要观点：</p>
<ul>
<li>Redux store 就像是大脑：它负责编排所有移动的部分</li>
<li>应用的state是一个单独的不可改变的对象在store中。</li>
<li>只要store收到一个action，它将会触发一个reducer</li>
<li>这个reducer返回下一个阶段。</li>
</ul>
<p>Redux 的reducer是由什么组成的？<br>它是一个JS函数有两个参数：state和action。一个Reducer函数也许使用一个<strong>switch statement</strong>来处理每一个action的类型。<br>这个reducer基于当前的action的类型来计算下一个阶段的state。如果没有action类型复合，那么最少应该返回一个初始话的状态。<br>当action类型满足一个合法的条款，这个reducer将会计算下一个状态并且返回一个新的对象。<br>现在我们修改之前的reducer：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/reducers/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; ADD_ARTICLE &#125; <span class="keyword">from</span> <span class="string">"../constants/action-types"</span>;</span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  articles: []</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rootReducer</span>(<span class="params">state = initialState, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (action.type === ADD_ARTICLE) &#123;</span><br><span class="line">    state.articles.push(action.payload);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure>
<p><strong>但是这上面的代码破坏了Redux主要的原则：不可变。</strong><br>Array.prototype.push是一个impure函数，它改变了原来的数组。所以代码进行了改变：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ADD_ARTICLE &#125; <span class="keyword">from</span> <span class="string">"../constants/action-types"</span>;</span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  articles: []</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rootReducer</span>(<span class="params">state = initialState, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (action.type === ADD_ARTICLE) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class="line">      articles: state.articles.concat(action.payload)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure>
<p>这样初始的状态就不会改变了。初始的文章数组也没有修改。返回的结果是初始状态的副本。为了避免Redux进行修改，需要关注两个点：</p>
<ul>
<li>对于arrays使用<a href="https://egghead.io/lessons/react-redux-avoiding-array-mutations-with-concat-slice-and-spread" target="_blank" rel="noopener">Using concat()，slice()and …spread</a></li>
<li>对于对象使用<a href="https://egghead.io/lessons/react-redux-avoiding-object-mutations-with-object-assign-and-spread" target="_blank" rel="noopener">Using Object.assign() and …spread</a></li>
</ul>
<h4 id="Redux-store-methods"><a href="#Redux-store-methods" class="headerlink" title="Redux store methods"></a>Redux store methods</h4><p>Redux是一个很小的包(2KB).Redux有一个简单的API来管理state。最重要的方法如下：</p>
<ul>
<li>getState 来获取当前的应用状态</li>
<li>dispatch 来分发action</li>
<li>subscribe 来监听状态的改变</li>
</ul>
<p>我们将会在控制台中看到上面的方法。<br>我们需要将store和action导出全局变量。创建一个文件：src/js/index.js，并且文件内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"../js/store/index"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; addArticle &#125; <span class="keyword">from</span> <span class="string">"../js/actions/index"</span>;</span><br><span class="line"><span class="built_in">window</span>.store = store;</span><br><span class="line"><span class="built_in">window</span>.addArticle = addArticle;</span><br></pre></td></tr></table></figure>
<p>并且更新src/index.js文件为如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> index <span class="keyword">from</span> <span class="string">"./js/index"</span></span><br></pre></td></tr></table></figure>
<p>这之后运行</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm <span class="built_in">start</span></span><br></pre></td></tr></table></figure>
<p>来运行这个项目，并且在浏览器中打开console(F12),输入如下的代码：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">store.getState()</span><br><span class="line">&#123;articles: Array(<span class="number">0</span>)&#125;</span><br><span class="line"># 订阅回掉函数</span><br><span class="line">store.subscribe(() =&gt; console.log('Look ma, Redux!!'))</span><br><span class="line"># 不过这里我会报错。</span><br><span class="line">store.dispatch( addArticle(&#123; <span class="built_in">title</span>: 'React Redux Tutorial <span class="keyword">for</span> Beginners', id: <span class="number">1</span> &#125;) )</span><br><span class="line"># 会输出 ：Look ma, Redux!!</span><br><span class="line">store.getState()</span><br><span class="line"># 输出： &#123;articles: Array(<span class="number">1</span>)&#125;</span><br></pre></td></tr></table></figure>
<p><em>上述代码可以在redux分支的”put pure simple redux”commit处看到</em></p>
<h4 id="Connecting-React-with-Redux"><a href="#Connecting-React-with-Redux" class="headerlink" title="Connecting React with Redux"></a>Connecting React with Redux</h4><p>在上面的学习之后，我知道了redux并不复杂，我知道怎么通过getstate来访问当前的状态。怎么使用dispathc分发一个action以及怎么使用subscribe来监听当前状态的改变。<br>但是怎么将react和redux联合起来了？<br>Redux有自己的框架，你可以只是使用js来使用它。但是也可以和你喜欢的框架一起使用。<br>对于react，是<strong>react-redux</strong>。<br>运行<code>npm i react-redux --save-dev</code>来安装react-redux。为了演示React和Redux是怎么一起工作的，我们将会构建一个很简单的应用，这个应用有以下组件：</p>
<ul>
<li>一个App component</li>
<li>一个List component来展示文章</li>
<li>一个Form component来添加新文章</li>
</ul>
<h4 id="what-is-react-redux"><a href="#what-is-react-redux" class="headerlink" title="what is react-redux?"></a>what is react-redux?</h4><p>react-redux是一个Redux连接器React。它是一个很小的包用于连接Redux和React。<br>其中最重要的方法是connect。<br><strong>connect</strong>就是连接React组件和Redux的store的。<br>你也需会使用2到3个参数来连接。基础的需要知道的事情是：</p>
<ul>
<li>mapStateToProps 函数：连接Redux的state到React的组件的props。这样一个连接的React组件将可以访问它所需要的store。</li>
<li>mapDispatchToProps 函数：连接Redux的actions到React的props。这样连接的组件将可以分发actions。</li>
</ul>
<h4 id="App-component-and-Redux-store"><a href="#App-component-and-Redux-store" class="headerlink" title="App component and Redux store"></a>App component and Redux store</h4><p>为了开始连接Redux和React，我们需要使用Provider。<br>Provider是react-redux的高层级的组件。<br>Provider包装你的React 应用，并且让它察觉整个Redux的store。<br>为什么如此？我们看到在Redux中，store管理一切，React必须和store交流来获取state并且分发actions。<br>更改src/index.js 文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"./store/index"</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./components/App.jsx"</span>;</span><br><span class="line"><span class="comment">// if you're in create-react-app import the files as:</span></span><br><span class="line"><span class="comment">// import store from "./js/store/index";</span></span><br><span class="line"><span class="comment">// import App from "./js/components/App.jsx";</span></span><br><span class="line">render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Provider&gt;,</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ The target element might be either root or app,</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ depending on your development environment</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ document.getElementById("app")</span></span><br><span class="line"><span class="regexp">  document.getElementById("root")</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<p>可以看到，Provider包含你的全部React应用，并且获得store作为属性。<br>现在让我们创造App组件。这个组件需要引入一个list并且渲染它。<br>创建App.jsx文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/components/App.jsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> List <span class="keyword">from</span> <span class="string">"./List"</span>;</span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;div className=<span class="string">"row mt-5"</span>&gt;</span><br><span class="line">    &lt;div className=<span class="string">"col-md-4 offset-md-1"</span>&gt;</span><br><span class="line">    &lt;h2&gt;Articles&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">      &lt;List /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>接下来我们需要创建List。</p>
<h4 id="List-component-and-Redux-state"><a href="#List-component-and-Redux-state" class="headerlink" title="List component and Redux state"></a>List component and Redux state</h4><p>我们新组件List，将会和Redux store交互。重复一遍：Redux和React连接的组件是<a href="https://github.com/reactjs/react-redux/blob/master/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options" target="_blank" rel="noopener">connect</a>。<br>connect最少有一个参数。由于我们想要List来获取一个文章的列表，这就是将state.article和组件相连，我们需要使用<strong> mapStateToProps</strong>。<br>添加如下代码文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/components/List.jsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">articles</span>: state.articles &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> ConnectedList = <span class="function">(<span class="params">&#123; articles &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;ul className=<span class="string">"list-group list-group-flush"</span>&gt;</span><br><span class="line">    &#123;articles.map(<span class="function"><span class="params">el</span> =&gt;</span> (</span><br><span class="line">      &lt;li className=<span class="string">"list-group-item"</span> key=&#123;el.id&#125;&gt;</span><br><span class="line">        &#123;el.title&#125;</span><br><span class="line">      &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">    ))&#125;</span></span><br><span class="line"><span class="regexp">  &lt;/u</span>l&gt;</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> List = connect(mapStateToProps)(ConnectedList);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> List;</span><br></pre></td></tr></table></figure>
<p>List组件将会接受我们看到的Redux状态中的articles 数组的副本作为articles的属性。在reducer中，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  articles: []</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rootReducer</span>(<span class="params">state = initialState, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (action.type === ADD_ARTICLE) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class="line">      articles: state.articles.concat(action.payload)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要记住，redux中的状态是从reducers来的。然后就是使用这个prop来产生一个文章列表了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;articles.map(<span class="function"><span class="params">el</span> =&gt;</span> (</span><br><span class="line">  &lt;li className=<span class="string">"list-group-item"</span> key=&#123;el.id&#125;&gt;</span><br><span class="line">    &#123;el.title&#125;</span><br><span class="line">  &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">))&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="Form-component-and-Redux-actions"><a href="#Form-component-and-Redux-actions" class="headerlink" title="Form component and Redux actions"></a>Form component and Redux actions</h4><p>Form组件更佳复杂，它用来添加新的items到应用中。同时它也是一个stateful 组件。<br>React中一个stateful组件就是它自己携带有本身的state。<br>甚至当我们使用Redux的时候，有stateful组件也是可以的。不是所有的状态都要去Redux。<br>它也可以接受一个Redux action。它可以通过dispatching addArticle action来更新全局状态。<br>代码添加如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/components/Form.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> uuidv1 <span class="keyword">from</span> <span class="string">"uuid"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; addArticle &#125; <span class="keyword">from</span> <span class="string">"../actions/index"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    addArticle: <span class="function"><span class="params">article</span> =&gt;</span> dispatch(addArticle(article))</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConnectedForm</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      title: <span class="string">""</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.handleChange = <span class="keyword">this</span>.handleChange.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.handleSubmit = <span class="keyword">this</span>.handleSubmit.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  handleChange(event) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; [event.target.id]: event.target.value &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  handleSubmit(event) &#123;</span><br><span class="line">    event.preventDefault();</span><br><span class="line">    <span class="keyword">const</span> &#123; title &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> id = uuidv1();</span><br><span class="line">    <span class="keyword">this</span>.props.addArticle(&#123; title, id &#125;);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">title</span>: <span class="string">""</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; title &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;form onSubmit=&#123;<span class="keyword">this</span>.handleSubmit&#125;&gt;</span><br><span class="line">        &lt;div className=<span class="string">"form-group"</span>&gt;</span><br><span class="line">          &lt;label htmlFor=<span class="string">"title"</span>&gt;Title&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">          &lt;input</span></span><br><span class="line"><span class="regexp">            type="text"</span></span><br><span class="line"><span class="regexp">            className="form-control"</span></span><br><span class="line"><span class="regexp">            id="title"</span></span><br><span class="line"><span class="regexp">            value=&#123;title&#125;</span></span><br><span class="line"><span class="regexp">            onChange=&#123;this.handleChange&#125;</span></span><br><span class="line"><span class="regexp">          /</span>&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button type="submit" className="btn btn-success btn-lg"&gt;</span></span><br><span class="line"><span class="regexp">          SAVE</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">const Form = connect(null, mapDispatchToProps)(ConnectedForm);</span></span><br><span class="line"><span class="regexp">export default Form;</span></span><br></pre></td></tr></table></figure>
<p>并且更新App代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> List <span class="keyword">from</span> <span class="string">"./List.jsx"</span>;</span><br><span class="line"><span class="keyword">import</span> Form <span class="keyword">from</span> <span class="string">"./Form.jsx"</span>;</span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;div className=<span class="string">"row mt-5"</span>&gt;</span><br><span class="line">    &lt;div className=<span class="string">"col-md-4 offset-md-1"</span>&gt;</span><br><span class="line">      &lt;h2&gt;Articles&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">      &lt;List /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div className="col-md-4 offset-md-1"&gt;</span></span><br><span class="line"><span class="regexp">      &lt;h2&gt;Add a new article&lt;/</span>h2&gt;</span><br><span class="line">      &lt;Form /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>安装uuid：<code>npm i uuid --save-dev</code>,然后运行：<code>npm start</code>就可以看到效果了，每次增加以后，list都可以看到增加的内容。  </p>
<p><strong>我想要的基本效果有了，我准备停在这里改改我自己的代码了。文章后面的部分等我完成了自己需要做的再回来看吧。</strong><br><em>代码可以看分支redux(commit:a react and redux app–simple:’Form component and Redux actions’)</em></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2019/03/21/JavaScript/JS的再次介绍/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/21/JavaScript/JS的再次介绍/" class="post-title-link" itemprop="url">A Re-Introduction to JavaScript (JS Tutorial)</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-21 16:12:30 / Modified: 19:48:51" itemprop="dateCreated datePublished" datetime="2019-03-21T16:12:30+08:00">2019-03-21</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>From: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/A_re-introduction_to_JavaScript" target="_blank" rel="noopener">A re-introduction to JavaScript (JS tutorial)
</a></p>
<p>为啥是re-introduction？因为JavaScript已经变成了<a href="http://crockford.com/javascript/javascript.html" target="_blank" rel="noopener">世界上最难懂的编程语言了</a>（这个吐槽js的文章写的还挺有意思的）。但是JavaScript现在被用在很多应用中，非常的重要了。  </p>
<p>JavaScript在1995年被Brendan Eich发明。本来叫做LiveScript，但是为了追潮流，就改名叫JavaScript了，开始了它的迷惑之路。  </p>
<p>网景将JavaScript提交到Ecma 国际，一个欧洲标准组织，之后，1999年有了<a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm" target="_blank" rel="noopener">ECMAScript edition 3</a>，第四版被废弃，而第四版的很多部分组成了ECMAScript第五版，（2009.12）,第六版在2015年六月发布。<br>JavaScript没有输入或者输出的概念。它被设计用来作为一个脚本语言运行在一个主机环境，并且它根据主机环境来提供和外界沟通的机制。同时JavaScript解释器也可以在很多其他地方找到，比如Nodejs，NoSQL DB等。  </p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>JavaScript是一个多范式，动态语言，有类型，操作符，标准内建对象以及方法。它的语法是基于Java和C的。它也通过object prototypes来支持面向对象编程。JavaScript也支持函数化编程，因为它们是对象，函数可以被存在变量中，并且被传递给另外的对象。  </p>
<p>让我们从基本数据类型开始，JavaScript有以下类型：</p>
<ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number" target="_blank" rel="noopener">Number</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noopener">String</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank" rel="noopener">Boolean</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noopener">Function</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noopener">Object</a><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noopener">Function</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank" rel="noopener">Array</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" rel="noopener">Date</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp" target="_blank" rel="noopener">RegExp</a></li>
</ul>
</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol" target="_blank" rel="noopener">Symbol</a>（2015年新定义的）</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined" target="_blank" rel="noopener">undefined</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/null" target="_blank" rel="noopener">null</a></li>
</ol>
<h2 id="数字Numbers"><a href="#数字Numbers" class="headerlink" title="数字Numbers"></a>数字Numbers</h2><p>Js中数字是”双精度64字节格式IEEE 754Value”。在JS中没有整数，所以需要小心如下的事情：</p>
<pre><code>0.1 + 0.2 == 0.30000000000000004;
</code></pre><p>在实践中，整数被作为32字节整数对待，有些实现甚至是这样存储知道它被要求是一个数字而不是在32-bit 整数时。<br>标准的算术操作是被支持的，包括加法，减法，模运算。这里同样也有内建对象<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math" target="_blank" rel="noopener">Math</a>来提供高级的数学函数和常量：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.sin(<span class="number">3.5</span>);</span><br><span class="line"><span class="keyword">var</span> circumference = <span class="number">2</span> * <span class="built_in">Math</span>.PI * r;</span><br></pre></td></tr></table></figure>
<p>你可以使用parseInt函数将一个字符串转换为string。这个函数的第二参数是可选的用于表示进制：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">parseInt</span>(<span class="string">'123'</span>, <span class="number">10</span>); <span class="comment">// 123</span></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="string">'010'</span>, <span class="number">10</span>); <span class="comment">// 10</span></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="string">'010'</span>);  <span class="comment">//  8</span></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="string">'0x10'</span>); <span class="comment">// 16</span></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="string">'hello'</span>, <span class="number">10</span>); <span class="comment">// NaN</span></span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如果不是数字就会返回NaN(Not a Number)。NaN是可以传递的，如果你对NaN进行任何一个算术操作，返回的结果仍然是NaN。</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	NaN + 5; // NaN</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 字符串 Strings</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Strings在JS中是一串[Unicode 字符](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Values,_variables,_and_literals#Unicode)。更准确来说，它们是UTF-16字节码组合；每一个code unit是被一个16-bit数字所代表。每一个Unicode字符串是被1到2个code unit所表示。  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">一些操作：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="string">'hello'</span>.length; <span class="comment">// 5</span></span><br><span class="line"><span class="string">'hello'</span>.charAt(<span class="number">0</span>); <span class="comment">// "h"</span></span><br><span class="line"><span class="string">'hello, world'</span>.replace(<span class="string">'world'</span>, <span class="string">'mars'</span>); <span class="comment">// "hello, mars"</span></span><br><span class="line"><span class="string">'hello'</span>.toUpperCase(); <span class="comment">// "HELLO"</span></span><br></pre></td></tr></table></figure>
<h2 id="其他类型"><a href="#其他类型" class="headerlink" title="其他类型"></a>其他类型</h2><p>JS区分null和undifined。null是故意的没有值，而undefined是没有初始化的值。如果你定义了一个变量而没有对它赋值，那这个变量的类型就是<code>undefined</code>. <code>undefined</code>实际上是一个变量。  </p>
<p>JS有布尔类型，而且任何值都可以转成boolean，根据以下的规则：</p>
<ol>
<li><code>false</code>, <code>0</code>,<code>&quot;&quot;</code>, <code>NaN</code>, <code>undefined</code> ,<code>null</code>都为<code>false</code></li>
<li>其他的是<code>true</code>.</li>
</ol>
<p>如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Boolean</span>(<span class="string">''</span>);  <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="number">234</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>JS使用三个关键字来声明变量：<code>let</code>, <code>const</code>或者 <code>var</code>。  </p>
<p><code>let</code>允许你代码段内声明变量：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// myLetVariable is *not* visible out here</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> myLetVariable = <span class="number">0</span>; myLetVariable &lt; <span class="number">5</span>; myLetVariable++) &#123;</span><br><span class="line">  <span class="comment">// myLetVariable is only visible in here</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// myLetVariable is *not* visible out here</span></span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="keyword">const</span><span class="string">`用于声明常量。  </span></span><br><span class="line"><span class="string">`</span><span class="keyword">var</span><span class="string">`是最普通的声明方式，它没有其他两种方式的限制。因为它是JavaScript最传统的声明变量的方式。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="comment">// myVarVariable *is* visible out here </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> myVarVariable = <span class="number">0</span>; myVarVariable &lt; <span class="number">5</span>; myVarVariable++) &#123; </span><br><span class="line">  <span class="comment">// myVarVariable is visible to the whole function </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// myVarVariable *is* visible out here</span></span><br></pre></td></tr></table></figure>
<p>JavaScript和其他语言的一个很大差别是代码块是没有范围的，只有函数有范围。所以如果一个变量是通过<code>var</code>来定义的，比如在一个if结构里面，它也会在整个函数中可见。然而，从ECMAScript2015开始，let和const声明允许你创造代码段范围的变量。  </p>
<h2 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h2><p>JS的数字操作符是+，-，*，／以及%。变量通过=赋值。并且也支持复合操作符，比如<code>+=</code>,<code>-=</code>,<code>++</code>和<code>--</code>。+操作符还可以做字符串连接。如下的例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'hello'</span> + <span class="string">' world'</span>; <span class="comment">// "hello world"</span></span><br><span class="line"><span class="string">'3'</span> + <span class="number">4</span> + <span class="number">5</span>;  <span class="comment">// "345"</span></span><br><span class="line"> <span class="number">3</span> + <span class="number">4</span> + <span class="string">'5'</span>; <span class="comment">// "75"</span></span><br></pre></td></tr></table></figure>
<p>JS也可以使用<code>&gt;</code>,<code>&lt;</code>, <code>&gt;=</code>和<code>&lt;=</code>来比较。等于有一点点不直接，比如下面会有类型转换，导致有有趣的结果,避免类型自动转换，可以使用三个等于号：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">123</span> == <span class="string">'123'</span>; <span class="comment">// true</span></span><br><span class="line"><span class="number">1</span> == <span class="literal">true</span>; <span class="comment">// true</span></span><br><span class="line"><span class="number">123</span> === <span class="string">'123'</span>; <span class="comment">// false</span></span><br><span class="line"><span class="number">1</span> === <span class="literal">true</span>;    <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h3 id="控制结构"><a href="#控制结构" class="headerlink" title="控制结构"></a>控制结构</h3><p>JS有和C语言家族相同的控制集合。条件语句是if和else。同样也有 while 和do-while循环。以及for语句。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//if</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">'kittens'</span>;</span><br><span class="line"><span class="keyword">if</span> (name == <span class="string">'puppies'</span>) &#123;</span><br><span class="line">  name += <span class="string">' woof'</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (name == <span class="string">'kittens'</span>) &#123;</span><br><span class="line">  name += <span class="string">' meow'</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  name += <span class="string">'!'</span>;</span><br><span class="line">&#125;</span><br><span class="line">name == <span class="string">'kittens meow'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//while</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="comment">// an infinite loop!</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> input;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  input = get_input();</span><br><span class="line">&#125; <span class="keyword">while</span> (inputIsNotValid(input));</span><br><span class="line"></span><br><span class="line"><span class="comment">//for loop</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  <span class="comment">// Will execute 5 times</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//for...of</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> array) &#123;</span><br><span class="line">  <span class="comment">// do something with value</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//for...in</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> property <span class="keyword">in</span> object) &#123;</span><br><span class="line">  <span class="comment">// do something with object property</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&amp;&amp;和||使用短线路逻辑，第二个条件是否执行取决于第一个逻辑。<br>switch()将会一直往下走，如果没有break的话。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (action) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'draw'</span>:</span><br><span class="line">    drawIt();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'eat'</span>:</span><br><span class="line">    eatIt();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    doNothing();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (a) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// fallthrough</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    eatIt();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    doNothing();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><p>JS的对象可以被想成某些简单的名字-址对的集合。比如它和：</p>
<ul>
<li>Python中的字典</li>
<li>Perl和Ruby中的Hashes</li>
<li>C/C++的Hash Table</li>
<li>Java中的HashMaps</li>
<li>PHP中的Associative arrays</li>
</ul>
<p>名字部分是一个JavaScript的字符串而值可以是任何JavaScript的值包括很多对象。这允许你构建任意复杂度的数据结构。<br>下面有两种方式来构建一个空对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br></pre></td></tr></table></figure>
<p>对象字面语法可以用来完全的初始化一个对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'Carrot'</span>,</span><br><span class="line">  <span class="keyword">for</span>: <span class="string">'Max'</span>, <span class="comment">// 'for' is a reserved word, use '_for' instead.</span></span><br><span class="line">  details: &#123;</span><br><span class="line">    color: <span class="string">'orange'</span>,</span><br><span class="line">    size: <span class="number">12</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>属性可以被串在一起：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">obj.details.color; <span class="comment">// orange</span></span><br><span class="line">obj[<span class="string">'details'</span>][<span class="string">'size'</span>]; <span class="comment">// 12</span></span><br></pre></td></tr></table></figure>
<p>接下来的例子创建了一个对象原型，Person以及这个原型的实例 you。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define an object</span></span><br><span class="line"><span class="keyword">var</span> you = <span class="keyword">new</span> Person(<span class="string">'You'</span>, <span class="number">24</span>); </span><br><span class="line"><span class="comment">// We are creating a new person named "You" aged 24.</span></span><br></pre></td></tr></table></figure>
<p>一旦创建，一个对象的属性可以被再次访问：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dot notation</span></span><br><span class="line">obj.name = <span class="string">'Simon'</span>;</span><br><span class="line"><span class="keyword">var</span> name = obj.name;</span><br><span class="line"><span class="comment">// bracket notation</span></span><br><span class="line">obj[<span class="string">'name'</span>] = <span class="string">'Simon'</span>;</span><br><span class="line"><span class="keyword">var</span> name = obj[<span class="string">'name'</span>];</span><br><span class="line"><span class="comment">// can use a variable to define a key</span></span><br><span class="line"><span class="keyword">var</span> user = prompt(<span class="string">'what is your key?'</span>)</span><br><span class="line">obj[user] = prompt(<span class="string">'what is its value?'</span>)</span><br><span class="line">obj.for = <span class="string">'Simon'</span>; <span class="comment">// Syntax error, because 'for' is a reserved word</span></span><br><span class="line">obj[<span class="string">'for'</span>] = <span class="string">'Simon'</span>; <span class="comment">// works fine</span></span><br></pre></td></tr></table></figure>
<p><strong>从ECMAScript2015开始，对象keys可以通过变量定义通过使用方括号。{[phoneType]: 12345}可以用来替换代：var userPhone = {}; userPhone[phoneType] = 12345.</strong></p>
<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>JS中数组是一个特殊的对象，它们和普通的对象十分像，但是它们有一个神奇的属性<code>&quot;length&quot;</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">a[<span class="number">0</span>] = <span class="string">'dog'</span>;</span><br><span class="line">a[<span class="number">1</span>] = <span class="string">'cat'</span>;</span><br><span class="line">a[<span class="number">2</span>] = <span class="string">'hen'</span>;</span><br><span class="line">a.length; <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = [<span class="string">'dog'</span>, <span class="string">'cat'</span>, <span class="string">'hen'</span>];</span><br><span class="line">a.length; <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>需要注意的是，数组的长度是最大的索引加一：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="string">'dog'</span>, <span class="string">'cat'</span>, <span class="string">'hen'</span>];</span><br><span class="line">a[<span class="number">100</span>] = <span class="string">'fox'</span>;</span><br><span class="line">a.length; <span class="comment">// 101</span></span><br><span class="line"><span class="keyword">typeof</span> a[<span class="number">90</span>]; <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>除了对象，函数是理解JS的一个重要部分。最基础的函数如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> total = x + y;</span><br><span class="line">  <span class="keyword">return</span> total;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(); <span class="comment">// NaN</span></span><br><span class="line"><span class="comment">// You can't perform addition on undefined</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>); <span class="comment">// 5</span></span><br><span class="line"><span class="comment">// added the first two; 4 was ignored</span></span><br></pre></td></tr></table></figure>
<p>函数可以接受0到多个参数，并且可以在函数中定义任意多的便利。return可以用来返回一个值，中终结这个函数。如果没有return，JS会返回<code>undefined</code>.<br>同时函数可以在它们函数体内访问另外的参数，通过<code>arguments</code>，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, j = <span class="built_in">arguments</span>.length; i &lt; j; i++) &#123;</span><br><span class="line">    sum += <span class="built_in">arguments</span>[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>); <span class="comment">// 14</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">avg</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, j = <span class="built_in">arguments</span>.length; i &lt; j; i++) &#123;</span><br><span class="line">    sum += <span class="built_in">arguments</span>[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum / <span class="built_in">arguments</span>.length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">avg(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>); <span class="comment">// 3.5</span></span><br></pre></td></tr></table></figure>
<p>同时我们可以使用<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/rest_parameters" target="_blank" rel="noopener">Rest parameter syntax</a>来进行多参数的使用。代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">avg</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> args) &#123;</span><br><span class="line">    sum += value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum / args.length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">avg(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>); <span class="comment">// 3.5</span></span><br></pre></td></tr></table></figure>
<p><strong>如果你将…args放到后面，那么第一个参数就会被赋值给第一个参数，比如：avg(firstValue, …args)第一个参数传递给firstValue而其他的放进args。</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">avgArray</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, j = arr.length; i &lt; j; i++) &#123;</span><br><span class="line">    sum += arr[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum / arr.length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">avgArray([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]); <span class="comment">// 3.5</span></span><br></pre></td></tr></table></figure>
<p>如果你想要对函数传递array参数，可以使用apply方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">avg.apply(<span class="literal">null</span>, [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]); <span class="comment">// 3.5</span></span><br></pre></td></tr></table></figure>
<p>JS允许你创建匿名方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> avg = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, j = <span class="built_in">arguments</span>.length; i &lt; j; i++) &#123;</span><br><span class="line">    sum += <span class="built_in">arguments</span>[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum / <span class="built_in">arguments</span>.length;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这个语法上和function avg()相同。它允许你放置一个完全的函数定义在任何可能你只是放置表达式的地方。比如隐藏一些本地变量：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="number">3</span>;</span><br><span class="line">  a += b;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">a; <span class="comment">// 4</span></span><br><span class="line">b; <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>JavaScript允许你递归调用函数，这在处理树结构的时候特别有用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">countChars</span>(<span class="params">elm</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (elm.nodeType == <span class="number">3</span>) &#123; <span class="comment">// TEXT_NODE</span></span><br><span class="line">    <span class="keyword">return</span> elm.nodeValue.length;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, child; child = elm.childNodes[i]; i++) &#123;</span><br><span class="line">    count += countChars(child);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果是匿名函数你应该怎么调用了，JS可以让你在这个情况下对函数命名：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> charsInBody = (<span class="function"><span class="keyword">function</span> <span class="title">counter</span>(<span class="params">elm</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (elm.nodeType == <span class="number">3</span>) &#123; <span class="comment">// TEXT_NODE</span></span><br><span class="line">    <span class="keyword">return</span> elm.nodeValue.length;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, child; child = elm.childNodes[i]; i++) &#123;</span><br><span class="line">    count += counter(child);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> count;</span><br><span class="line">&#125;)(<span class="built_in">document</span>.body);</span><br></pre></td></tr></table></figure>
<p>这个函数的名字只是在这个函数范围内有效。这样可以允许引擎做更多的优化并且使代码的可读性更好。<br>需要注意的是，JS的函数也是对象，就像其他的任何事物一样，你可以增加或者修改它们的属性。  </p>
<h2 id="自定义对象"><a href="#自定义对象" class="headerlink" title="自定义对象"></a>自定义对象</h2><p>对于js是不是面向对象的语言，可以参考<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Introduction_to_Object-Oriented_JavaScript" target="_blank" rel="noopener">Introduction to Object-Oriented JavaScript</a>.<br>JS 是一个基于原型的语言(prototype-based)，不包含类声明。JS使用函数作为类。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makePerson</span>(<span class="params">first, last</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    first: first,</span><br><span class="line">    last: last</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">personFullName</span>(<span class="params">person</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> person.first + <span class="string">' '</span> + person.last;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">personFullNameReversed</span>(<span class="params">person</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> person.last + <span class="string">', '</span> + person.first;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s = makePerson(<span class="string">'Simon'</span>, <span class="string">'Willison'</span>);</span><br><span class="line">personFullName(s); <span class="comment">// "Simon Willison"</span></span><br><span class="line">personFullNameReversed(s); <span class="comment">// "Willison, Simon"</span></span><br></pre></td></tr></table></figure>
<p>这个可以工作，但是太丑了，在你的全局空间中有太多的函数。我们真正需要的是将函数附在一个对象上。由于函数就是对象，这就很简单：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makePerson</span>(<span class="params">first, last</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    first: first,</span><br><span class="line">    last: last,</span><br><span class="line">    fullName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.first + <span class="string">' '</span> + <span class="keyword">this</span>.last;</span><br><span class="line">    &#125;,</span><br><span class="line">    fullNameReversed: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.last + <span class="string">', '</span> + <span class="keyword">this</span>.first;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s = makePerson(<span class="string">'Simon'</span>, <span class="string">'Willison'</span>);</span><br><span class="line">s.fullName(); <span class="comment">// "Simon Willison"</span></span><br><span class="line">s.fullNameReversed(); <span class="comment">// "Willison, Simon"</span></span><br></pre></td></tr></table></figure>
<p>这里有我们之前没有见到的关键字：this。在函数内使用，它代表的是当前的对象。比如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = makePerson(<span class="string">'Simon'</span>, <span class="string">'Willison'</span>);</span><br><span class="line"><span class="keyword">var</span> fullName = s.fullName;</span><br><span class="line">fullName(); <span class="comment">// undefined undefined</span></span><br></pre></td></tr></table></figure>
<p>然后我们可以提高代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">first, last</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.first = first;</span><br><span class="line">  <span class="keyword">this</span>.last = last;</span><br><span class="line">  <span class="keyword">this</span>.fullName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.first + <span class="string">' '</span> + <span class="keyword">this</span>.last;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.fullNameReversed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.last + <span class="string">', '</span> + <span class="keyword">this</span>.first;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> Person(<span class="string">'Simon'</span>, <span class="string">'Willison'</span>);</span><br></pre></td></tr></table></figure>
<p><code>new</code>关键词和this很相关。它创建一个全新的空对象，然后调用指定的函数，并将此设置为该新对象。但是上面的代码每次我们创造一个新对象的时候，我们也要创造两个新的函数对象，改进如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">personFullName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.first + <span class="string">' '</span> + <span class="keyword">this</span>.last;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">personFullNameReversed</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.last + <span class="string">', '</span> + <span class="keyword">this</span>.first;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">first, last</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.first = first;</span><br><span class="line">  <span class="keyword">this</span>.last = last;</span><br><span class="line">  <span class="keyword">this</span>.fullName = personFullName;</span><br><span class="line">  <span class="keyword">this</span>.fullNameReversed = personFullNameReversed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更好一点？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">first, last</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.first = first;</span><br><span class="line">  <span class="keyword">this</span>.last = last;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.fullName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.first + <span class="string">' '</span> + <span class="keyword">this</span>.last;</span><br><span class="line">&#125;;</span><br><span class="line">Person.prototype.fullNameReversed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.last + <span class="string">', '</span> + <span class="keyword">this</span>.first;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>Person.prototype</code>是一个对象被所有的Person实例所共享。它形成了一个查找链，每当你想要访问一个Person不存在的属性时，JS将会检查它们是否存在在Person.prototype中。所以，任何被赋值给Person.prototype的属性将会对这个对象所有实例可见。<br>你也可以修改JS的内建对象，比如String：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> Person(<span class="string">'Simon'</span>, <span class="string">'Willison'</span>);</span><br><span class="line">s.firstNameCaps(); <span class="comment">// TypeError on line 1: s.firstNameCaps is not a function</span></span><br><span class="line"></span><br><span class="line">Person.prototype.firstNameCaps = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.first.toUpperCase();</span><br><span class="line">&#125;;</span><br><span class="line">s.firstNameCaps(); <span class="comment">// "SIMON"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s = <span class="string">'Simon'</span>;</span><br><span class="line">s.reversed(); <span class="comment">// TypeError on line 1: s.reversed is not a function</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">String</span>.prototype.reversed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> r = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="keyword">this</span>.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    r += <span class="keyword">this</span>[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> r;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">s.reversed(); <span class="comment">// nomiS</span></span><br></pre></td></tr></table></figure>
<p><strong>Not Finished</strong></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2019/03/21/JavaScript/WhyBuildReact/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/21/JavaScript/WhyBuildReact/" class="post-title-link" itemprop="url">WhyBuildReact</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-21 15:55:33" itemprop="dateCreated datePublished" datetime="2019-03-21T15:55:33+08:00">2019-03-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-25 12:17:02" itemprop="dateModified" datetime="2019-03-25T12:17:02+08:00">2019-03-25</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Why-react"><a href="#Why-react" class="headerlink" title="Why-react"></a>Why-react</h2><p>From <a href="https://react-cn.github.io/react/blog/2013/06/05/why-react.html" target="_blank" rel="noopener">https://react-cn.github.io/react/blog/2013/06/05/why-react.html</a></p>
<h3 id="React-不是一个MVC框架"><a href="#React-不是一个MVC框架" class="headerlink" title="React 不是一个MVC框架"></a>React 不是一个MVC框架</h3><p>React是一个用来构建用户界面的库。它鼓励创造可复用的UI组件来随着时间的改变来展示数据。</p>
<h3 id="React并不使用模板"><a href="#React并不使用模板" class="headerlink" title="React并不使用模板"></a>React并不使用模板</h3><p>通常我们是直接通过模版或者HTML来直接构造web应用。这些模版决定了你可以用来构建你的UI的完整抽象集合。<br>React使用了完全不同的方式，通过将用户界面分为组件然后来构建它们。这意味着React使用一个真实的完全的编程语言来渲染界面，这在我们看来是一个相对于模版的优势，原因如下：</p>
<ol>
<li>JavaScript是一个灵活，有用的编程语言，可以用来构建抽象。对于大型的软件来说，这个很重要。</li>
<li>通过统一标记和视图逻辑，React通常可以让视图更加容易维护和扩展。</li>
<li>通过将对标记和内容的理解融入JavaScript中，这里没有手工的字符串连接，并且更少有XSS漏洞。</li>
</ol>
<p>同样我们也会创造JSX，一个可选择的语法扩展，如果你更偏向于HTML的可读性。  </p>
<h3 id="Reactive-升级很简单"><a href="#Reactive-升级很简单" class="headerlink" title="Reactive 升级很简单"></a>Reactive 升级很简单</h3><p>当你的数据会随着时间变化的时候，React真的很好用。<br>在一个传统的JavaScript应用中，你需要知道数据哪里变化了并且即时将改变同步到DOM中。即使是Augular Js，通过命令(directive)和数据绑定提供了一个声明式的接口也需要一个连接函数来人工的更新DOM节点。  </p>
<p>React使用另外一种方式。  </p>
<p>当你的组件被初始化的时候，render方法将会被调用，生成一个你的视图的轻量级的表示。从那个表示开始，一个字符串的标记会被产生，并且注入到document中。当你的数据改变的时候，这个render方法将会再次调用。为了快速的更新，我们将render返回的新旧值进行比较，并且生成一个最小改变集合来应用到DOM中。  </p>
<p><strong>render返回的数据既不是一个字符串也不是一个DOM节点，它是一个轻量级的描述DOM应该看起来像什么的描述符</strong></p>
<p>我们将这个过程称为<strong>协调reconciliation</strong>。  </p>
<h3 id="HTML只是开始"><a href="#HTML只是开始" class="headerlink" title="HTML只是开始"></a>HTML只是开始</h3><p>由于React有自己对文档轻量级的表示，我们可以做很多事情：</p>
<ol>
<li>Facebook有动态的图表来渲染，而不是HTML。</li>
<li>Instagram是一个单页面的网站应用全部通过React和Backbone.Router来构建。设计师通过JSX来使用React。</li>
<li>我们通过构建内部原型来运行React应用并且使用React来操作原生的iOS视图通过一个Object-c的bridge。</li>
<li>你可以在服务器上进行代码开发，分享。</li>
</ol>
<h2 id="React-Tutorial学习"><a href="#React-Tutorial学习" class="headerlink" title="React Tutorial学习"></a>React Tutorial学习</h2><p>from：<a href="https://reactjs.org/tutorial/tutorial.html" target="_blank" rel="noopener">https://reactjs.org/tutorial/tutorial.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2019/03/11/java/build-openJDK8/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/11/java/build-openJDK8/" class="post-title-link" itemprop="url">buld_openJDK8</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-11 10:22:08 / Modified: 13:42:01" itemprop="dateCreated datePublished" datetime="2019-03-11T10:22:08+08:00">2019-03-11</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h2><p>在linux(centos7)上进行的JDK8 的编译。具体步骤进行记录。</p>
<h2 id="Mercurial安装"><a href="#Mercurial安装" class="headerlink" title="Mercurial安装"></a>Mercurial安装</h2><p>增加repo文件：/etc/yum.repos.d/mercurial.selenic.com.repo </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[mercurial.selenic.com]</span><br><span class="line">name=mercurial.selenic.com</span><br><span class="line">baseurl=https://www.mercurial-scm.org/release/centos$releasever</span><br><span class="line">enabled=1</span><br><span class="line"># Temporary until we get a serious signing scheme in place,</span><br><span class="line"># check https://www.mercurial-scm.org/wiki/Download again</span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></table></figure>
<p>之后运行：<code>yum install mercurial</code>即可安装。  </p>
<h2 id="获取源码"><a href="#获取源码" class="headerlink" title="获取源码"></a>获取源码</h2><p>在本机运行以下命令来获取OpenJDK源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hg clone http://hg.openjdk.java.net/jdk8/jdk8 YourOpenJDK </span><br><span class="line">cd YourOpenJDK </span><br><span class="line">bash ./get_source.sh</span><br></pre></td></tr></table></figure>
<p>之后就会开始下载源码，只是有的时候网络可能不太好，如果不能成功下载完成，需要多试几次。  </p>
<p>下载的仓库如下：</p>
<table>
<thead>
<tr>
<th>仓库</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>. (root)</td>
<td>普通配置以及makefile 逻辑</td>
</tr>
<tr>
<td>hotspot</td>
<td>OpenJDK Hotspot 虚拟机的源码以及makefile</td>
</tr>
<tr>
<td>langtools</td>
<td>OpenJDK的Javac和语言工具(?)的源码</td>
</tr>
<tr>
<td>jdk</td>
<td>OpenJDK的运行时库的源码和makefile以及Misc 文件</td>
</tr>
<tr>
<td>jaxp</td>
<td>OpenJDK JAXP功能的源码</td>
</tr>
<tr>
<td>jaxws</td>
<td>OpenJDK JAX-WS功能的源码</td>
</tr>
<tr>
<td>corba</td>
<td>OpenJDK Corba的源码</td>
</tr>
<tr>
<td>nashorn</td>
<td>OpenJDK的JavaScript实现的源码</td>
</tr>
</tbody>
</table>
<h2 id="构建-building"><a href="#构建-building" class="headerlink" title="构建 building"></a>构建 building</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash ./configure</span><br><span class="line">make all</span><br></pre></td></tr></table></figure>
<p>bash ./configure会检查环境是否满足JDK的安装，并且进行提示。  </p>
<h3 id="下载jdk7作为bootstrap-JDK"><a href="#下载jdk7作为bootstrap-JDK" class="headerlink" title="下载jdk7作为bootstrap JDK"></a>下载jdk7作为bootstrap JDK</h3><p>根据<a href="https://openjdk.java.net/install/" target="_blank" rel="noopener">https://openjdk.java.net/install/</a>运行：<code>su -c &quot;yum install java-1.7.0-openjdk-devel&quot;</code>安装了1.7的sdk，并且由于本机以及安装了1.8的sdk，需要切换sdk，使用命令：<code>sudo update-alternatives --config java</code>进行切换。本机java包的位置为：<code>/usr/lib/jvm</code>.  </p>
<p>使用<code>sh configure --with-boot-jdk=/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.211-2.6.17.1.el7_6.x86_64</code>来指定下载的bootstrap JDK的位置。  </p>
<h3 id="运行make"><a href="#运行make" class="headerlink" title="运行make"></a>运行make</h3><p>使用<code>make clean</code>     清除目录，然后运行<code>make all</code>编译源码。然后就是等待了。。<br>大概四十分钟，我的就全部构建完毕了。在build目录中，文件大小约3G。  </p>
<h3 id="检验build成功"><a href="#检验build成功" class="headerlink" title="检验build成功"></a>检验build成功</h3><p>进入：build/linux-x86_64-normal-server-release/jdk/bin中运行 <code>./java -version</code>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openjdk version &quot;1.8.0-internal&quot;</span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0-internal-eden_2019_03_11_12_47-b00)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.0-b70, mixed mode)</span><br></pre></td></tr></table></figure>
<h2 id="相关参考"><a href="#相关参考" class="headerlink" title="相关参考"></a>相关参考</h2><p><a href="http://hg.openjdk.java.net/jdk8/jdk8/raw-file/tip/README-builds.html" target="_blank" rel="noopener">OpenJDK Build README</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2019/03/08/JavaScript/NodeJs入门-何时，如何以及为何使用Nodejs作为你的后端/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/08/JavaScript/NodeJs入门-何时，如何以及为何使用Nodejs作为你的后端/" class="post-title-link" itemprop="url">NodeJs入门:何时，如何以及为何使用Nodejs作为你的后端</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-08 00:00:00 / Modified: 15:39:16" itemprop="dateCreated datePublished" datetime="2019-03-08T00:00:00+08:00">2019-03-08</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>From <a href="https://www.netguru.com/blog/use-node-js-backend" target="_blank" rel="noopener">When, How And Why Use Node.js as Your Backend</a></p>
<h2 id="什么是Node-js"><a href="#什么是Node-js" class="headerlink" title="什么是Node.js"></a>什么是Node.js</h2><p>Node.js是一个应用运行环境，允许你使用javaScript来编写服务端代码。由于它独特的I/O模型，它擅长于扩展和实时的场景。同时它是轻量级，高效的，以及前后端都适用JavaScript为开发提供了另外一种形式。</p>
<h2 id="Node-js和JavaScript的不同"><a href="#Node-js和JavaScript的不同" class="headerlink" title="Node.js和JavaScript的不同"></a>Node.js和JavaScript的不同</h2><p>Node.js和JavaScript之间在语言的使用上并没有什么不同。JavaScript是用在浏览器而Node.js也几乎相同。只不过Node.js使用的是不同的API集合。在浏览器中，你可以有一系列的DOM/Web API来帮助你和UI进行交互，而在Node.js中也有很多API用于后端的开发，例如对文件系统的支持，http请求，流，子流程等。浏览器也提供一些基本的对文件系统和http请求的的支持，但基于安全的考虑，十分有限。  </p>
<h2 id="为什么值得在你的项目中使用Node-js"><a href="#为什么值得在你的项目中使用Node-js" class="headerlink" title="为什么值得在你的项目中使用Node.js"></a>为什么值得在你的项目中使用Node.js</h2><p>首先，使用Node.js作为服务端技术意味着你的前后端的代码都是一致的，这样可以给你的团队很大促进作用。这意味着你的团队会更加高效和跨功能性。另外，JavaScript是最流行的编程语言，所以你的应用代码将会更加容易被其他的工程师理解。同时前后端的代码也可以有一部分的复用，从而加速开发的进程。除此以外，Node.js社区在快速的发展，所以这门技术的知识基础是被广泛传播的。整个Node.js的技术栈是开源并且免费的。最后，Node 提供一个很好的包管理，npm，并且在npm注册中心可用的开源工具是很多的，并且还在快速增长。这些只是你应该考虑使用Node.js的众多优点的一小部分。。。  </p>
<h2 id="好的使用案例"><a href="#好的使用案例" class="headerlink" title="好的使用案例"></a>好的使用案例</h2><h3 id="实时应用系统"><a href="#实时应用系统" class="headerlink" title="实时应用系统"></a>实时应用系统</h3><p>Node.js对于一个需要处理大量短消息并且要低延时的应用是一个好的请求。这一类的系统被称为Real-time application(RTAs)，并且她们可以很容易的使用Node.js进行开发。Node.js对于实时合作/编辑文件的apps会是一个很好的选择，这样你可以观看到文本被其他的人实时编辑(比如 Trello, Dropbox Paper或者Google Docs)。<br>RTAs可以被node.js很容易的开发的列表有很多。最流行的比如实时对话或者及时消息应用。(live-chat and instant-messaging).如果你想要创建一个视屏会议app，只要有合适的硬件设备或者VoIP就可以了。另外，你也许会考虑Node.js作为在线游戏应用或者电商交易软件，那些在线数据很重要。<br>Node.js对于实时应用非常有效，它可以方便的处理很多客户端请求，允许分享和复用共享库的代码，并且客户端和服务端的同步也很快。  </p>
<h3 id="快速和扩展的环境"><a href="#快速和扩展的环境" class="headerlink" title="快速和扩展的环境"></a>快速和扩展的环境</h3><p>如果你有很多的请求，Ruby on Rails对于速度也需不那么足够。 Node.js将会比Rails更加快速和可扩展。Node可以在很短的响应时间里处理很多的请求，同时也可以在服务器和客户端之间共享如校验代码的能力让它很适合与需要在客户端进行很多处理的应用。基于上面的理由，Node.js是一个很流行的选择来建立“单页应用”网站，这样所有的渲染都是由客户端完成，而服务端只用提供JSON API。<br>Node.js 同样在你想要处理高容量IO请求的时候也很容易上手。如果需要很多的CPU来处理请求，可能就不会那么高效。但是如果只是将数据四处移动，它会很高效。</p>
<h2 id="什么时候使用Node-js不是一个好的选择"><a href="#什么时候使用Node-js不是一个好的选择" class="headerlink" title="什么时候使用Node.js不是一个好的选择"></a>什么时候使用Node.js不是一个好的选择</h2><p>即使Node.js在大部分的时候都是很好，但是在下面的情况下，使用它不是一个明智的选择。  </p>
<h3 id="CPU-Heavy-jobs"><a href="#CPU-Heavy-jobs" class="headerlink" title="CPU-Heavy jobs"></a>CPU-Heavy jobs</h3><p>第一就是CPU密集的任务。Node.js是一个事件驱动，非阻塞的I/O模型，并且只使用一个单一CPU。重CPU操作将会阻塞进来的请求，将Node.js最大的优点变得无用。如果你考虑构建一个重CPU计算的任务，请尝试一个其他的，更佳合适的技术。  </p>
<h3 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h3><p>最后，对于简单的HTML或者CRUD应用使用Node.js将会是多余，在这个情况下，你不需要一个单独的api，所有的数据都是直接从服务端提供。如果使用Node.js你的应用可能只能提高一点扩展性，但不能期待可以承受过多的请求。在这个情况下，你应该继续使用可靠的框架比如Ruby。</p>
<h3 id="包质量"><a href="#包质量" class="headerlink" title="包质量"></a>包质量</h3><p>在开始使用Node.js之前，还有很多东西需要考虑。很多Node.js应用的包都可以在npm上找到。这个社区是有活力的，技术也越来越成熟，并且npm是目前最大的仓库。然而不同的包有不同的质量。</p>
<h2 id="从哪开始"><a href="#从哪开始" class="headerlink" title="从哪开始"></a>从哪开始</h2><p>首先，去Node.js的官网(<a href="https://nodejs.org" target="_blank" rel="noopener">nodejs.org</a>)并且下载这个Node.js的包。接下来我们需要安装Node.js包管理从而安装和管理我们的依赖。然后我们就可以开始写代码了。<br>最好开始Node.js的地方就是官方文档，这里你可以学到很多Node.js的核心观点。在<a href="https://nodejs.org/en/docs/guides/getting-started-guide/" target="_blank" rel="noopener">Node.js guide</a>中，你可以找到最重要的问题的答案，怎么建立一个简单的Node.js的服务器？<br>然后你可以看一些重要的Nodejs的框架比如 express.js，来学习JavaScript依赖是怎么使用的。(<a href="https://expressjs.com/" target="_blank" rel="noopener">expressjs.com</a>)Express.js 允许你构建一个高性能的，可扩展且易维护的应用。最好的学习路径是去express官网上，并且学习它最重要的功能，比如 routing，template engines和debugging。<br>在那之后，你已经准备好构建你自己的应用了。  </p>
<h2 id="知识基础"><a href="#知识基础" class="headerlink" title="知识基础"></a>知识基础</h2><h3 id="学习材料和资源"><a href="#学习材料和资源" class="headerlink" title="学习材料和资源"></a>学习材料和资源</h3><ol>
<li><a href="http://node.green/" target="_blank" rel="noopener">Node.js ES2015/ES6, ES2016 and ES2017 support</a></li>
<li><a href="https://github.com/sindresorhus/awesome-nodejs#resources" target="_blank" rel="noopener">awesome-nodejs resources</a></li>
<li><a href="https://github.com/workshopper/learnyounode" target="_blank" rel="noopener">learnyounode</a></li>
</ol>
<h3 id="Twitter上follow的人"><a href="#Twitter上follow的人" class="headerlink" title="Twitter上follow的人"></a>Twitter上follow的人</h3><p>略过。。。</p>
<h3 id="Node-js-订阅"><a href="#Node-js-订阅" class="headerlink" title="Node.js 订阅"></a>Node.js 订阅</h3><ol>
<li>Node Weekly</li>
<li>JavaScript Weekly</li>
<li>Awesome Node.js Newsletter</li>
<li>Node Everywhere</li>
</ol>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ol>
<li><a href="https://www.netguru.com/blog/10-node.js-podcasts" target="_blank" rel="noopener">10 Node.js Podcasts</a></li>
<li><a href="https://www.netguru.com/blog/10-nodejs-books" target="_blank" rel="noopener">10 Node.js Books</a></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2019/03/06/java/CoreJava/Java8 并发指南：原子变量和并发Map Atomic Variables and ConcurrentMap/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/06/java/CoreJava/Java8 并发指南：原子变量和并发Map Atomic Variables and ConcurrentMap/" class="post-title-link" itemprop="url">Java8 并发指南：原子变量和并发Map(Atomic Variables and ConcurrentMap)</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-06 10:15:11 / Modified: 23:39:52" itemprop="dateCreated datePublished" datetime="2019-03-06T10:15:11+08:00">2019-03-06</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Java8-并发指南：原子变量和并发Map-Atomic-Variables-and-ConcurrentMap"><a href="#Java8-并发指南：原子变量和并发Map-Atomic-Variables-and-ConcurrentMap" class="headerlink" title="Java8 并发指南：原子变量和并发Map Atomic Variables and ConcurrentMap"></a>Java8 并发指南：原子变量和并发Map Atomic Variables and ConcurrentMap</h1><p>from:<a href="https://winterbe.com/posts/2015/05/22/java8-concurrency-tutorial-atomic-concurrent-map-examples/" target="_blank" rel="noopener">https://winterbe.com/posts/2015/05/22/java8-concurrency-tutorial-atomic-concurrent-map-examples/</a></p>
<h2 id="原子类-AtomicInteger"><a href="#原子类-AtomicInteger" class="headerlink" title="原子类 AtomicInteger"></a>原子类 AtomicInteger</h2><p>java.concurrent.atomic包中包含很多有用的类来运行原子操作。操作的原子性是指你可以安全的在多个线程中进行并发操作而不需要使用synchronized关键字。<br>在内部，原子类依赖于Compare-and-swap(CAS)，一个原子指令操作直接被多个现代CPU所支持。这些指令通常比使用锁同步要快很多。所以建议是如果你需要并发改变一个可变变量时，更加偏向于使用原子类而不是锁。<br>下面使用一个原子类作为例子：AtomicInteger</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">AtomicInteger atomicInt = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">IntStream.range(<span class="number">0</span>, <span class="number">1000</span>)</span><br><span class="line">    .forEach(i -&gt; executor.submit(atomicInt::incrementAndGet));</span><br><span class="line"></span><br><span class="line">stop(executor);</span><br><span class="line"></span><br><span class="line">System.out.println(atomicInt.get());    <span class="comment">// =&gt; 1000</span></span><br></pre></td></tr></table></figure>
<p>使用ActomicInteger来替换Integer，我们可以并发的增加这个数字而不需要使用同步锁来访问这个变量。incrementAndGet()方法是一个原子操作这样我们可以安全的多线程调用这个方法。<br>AtomicInteger支持多种原子操作。<strong>updateAndGet()</strong>可以接受一个lambda表达式从而来执行任何的算术操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">AtomicInteger atomicInt = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">IntStream.range(<span class="number">0</span>, <span class="number">1000</span>)</span><br><span class="line">    .forEach(i -&gt; &#123;</span><br><span class="line">        Runnable task = () -&gt;</span><br><span class="line">            atomicInt.updateAndGet(n -&gt; n + <span class="number">2</span>);</span><br><span class="line">        executor.submit(task);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">stop(executor);</span><br><span class="line"></span><br><span class="line">System.out.println(atomicInt.get());    <span class="comment">// =&gt; 2000</span></span><br></pre></td></tr></table></figure>
<p><strong>accumulateAndGet()</strong>接受另外一种IntBinaryOperator类型的lambda表达式。我们使用这个方法来将0到1000所有数字加起来。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">AtomicInteger atomicInt = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">IntStream.range(<span class="number">0</span>, <span class="number">1000</span>)</span><br><span class="line">    .forEach(i -&gt; &#123;</span><br><span class="line">        Runnable task = () -&gt;</span><br><span class="line">            atomicInt.accumulateAndGet(i, (n, m) -&gt; n + m);</span><br><span class="line">        executor.submit(task);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">stop(executor);</span><br><span class="line"></span><br><span class="line">System.out.println(atomicInt.get());    <span class="comment">// =&gt; 499500</span></span><br></pre></td></tr></table></figure>
<p>还有一些原子类，比如：<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicBoolean.html" target="_blank" rel="noopener">AtomicBoolean</a>,<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicLong.html" target="_blank" rel="noopener">AtomicLong</a>,<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicReference.html" target="_blank" rel="noopener">AtomicReference</a>.  </p>
<h2 id="LongAdder"><a href="#LongAdder" class="headerlink" title="LongAdder"></a>LongAdder</h2><p>LongAdder是用于连续的加值到一个数字上除了AtomicLong的另外一种选择。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">IntStream.range(<span class="number">0</span>, <span class="number">1000</span>)</span><br><span class="line">    .forEach(i -&gt; executor.submit(adder::increment));</span><br><span class="line"></span><br><span class="line">stop(executor);</span><br><span class="line"></span><br><span class="line">System.out.println(adder.sumThenReset());   <span class="comment">// =&gt; 1000</span></span><br></pre></td></tr></table></figure>
<p>LongAdder 和atomic number一样提供add()和increment()的方法，并且也是线程安全的。不同于只是将单个结果累加起来，这个类维护了一系列的内部变量用来减少线程的竞争.<em>怎么减少的？？</em>实际的结果可以通过sum()或sumThenReset()来获取。<br>当从多个线程中更新的次数多于读的次数时，这个类常常是比原子类更好的选择。比如当你想要获取统计数据的时候，比如你想要获取服务器一共服务了多少的请求。LongAdder的弊端是高内存消耗，因为它有一系列的变量在内存中。</p>
<h2 id="LongAccumulator"><a href="#LongAccumulator" class="headerlink" title="LongAccumulator"></a>LongAccumulator</h2><p>LongAccumulator是LongAdder的一个更加常见的版本。不仅仅是处理一个简单的加操作，LongAccumulator是基于类型为LongBinaryOperator的lambda表达式来构建的。代码sample如下：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">LongBinaryOperator op = (x, y) -&gt; <span class="number">2</span> * x + y;</span><br><span class="line">LongAccumulator accumulator = <span class="keyword">new</span> LongAccumulator(op, <span class="number">1L</span>);</span><br><span class="line"></span><br><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">IntStream.range(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">    .forEach(i -&gt; executor.submit(() -&gt; accumulator.accumulate(i)));</span><br><span class="line"></span><br><span class="line">stop(executor);</span><br><span class="line"></span><br><span class="line">System.out.println(accumulator.getThenReset());     <span class="comment">// =&gt; 2539</span></span><br></pre></td></tr></table></figure>
<p>我们通过函数<code>2 * x + y</code>和一个初始值来构造一个LongAccumulator。每次调用<code>accumulate(i)</code>时，当前的结果和值i将会被传进lambda表达式中。<br>LongAccumulator也和LongAdder一样维护了一系列的内部变量来减少线程间的竞争。  </p>
<h2 id="ConcurrentMap"><a href="#ConcurrentMap" class="headerlink" title="ConcurrentMap"></a>ConcurrentMap</h2><p>接口ConcurrentMap扩展了map接口并且定义了最有用的并发集合类型。Java 8 通过增加新的方法到这个接口中来引入函数编程。<br>下面的代码用于展示这些新的方法：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ConcurrentMap&lt;String, String&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">"foo"</span>, <span class="string">"bar"</span>);</span><br><span class="line">map.put(<span class="string">"han"</span>, <span class="string">"solo"</span>);</span><br><span class="line">map.put(<span class="string">"r2"</span>, <span class="string">"d2"</span>);</span><br><span class="line">map.put(<span class="string">"c3"</span>, <span class="string">"p0"</span>);</span><br></pre></td></tr></table></figure>
<p>forEach()方法接受一个Biconsumer的lambda表达式将map的key和value作为参数进行传递。这个可以作为替代for-each循环来迭代获取所有的concurrent map。这个迭代会被当前线程顺序执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map.forEach((key, value) -&gt; System.out.printf(<span class="string">"%s = %s\n"</span>, key, value));</span><br></pre></td></tr></table></figure>
<p>方法putIfAbsent()将新的值放到map中如果这个key没有值。最少在ConcurrentHashMap中这个方法是线程安全的就像put()方法，所以你不要再不同的线程中使用同步。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String value = map.putIfAbsent(<span class="string">"c3"</span>, <span class="string">"p1"</span>);</span><br><span class="line">System.out.println(value);    <span class="comment">// p0</span></span><br></pre></td></tr></table></figure>
<p>方法getOrDefault()返回key对应的value。如果这个key不存在就会返回默认值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String value = map.getOrDefault(<span class="string">"hi"</span>, <span class="string">"there"</span>);</span><br><span class="line">System.out.println(value);    <span class="comment">// there</span></span><br></pre></td></tr></table></figure>
<p>方法replaceAll()接受一个BiFunction的lambda表达式。BiFunction接受两个参数并且返回一个值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">map.replaceAll((key, value) -&gt; <span class="string">"r2"</span>.equals(key) ? <span class="string">"d3"</span> : value);</span><br><span class="line">System.out.println(map.get(<span class="string">"r2"</span>));    <span class="comment">// d3</span></span><br></pre></td></tr></table></figure>
<p>compute方法可以让我们改变一个单独的条目。这个方法接受需要修改的键以及一个bi-function来指定修改这个值的方法。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">map.compute(<span class="string">"foo"</span>, (key, value) -&gt; value + value);</span><br><span class="line">System.out.println(map.get(<span class="string">"foo"</span>));   <span class="comment">// barbar</span></span><br></pre></td></tr></table></figure>
<p>除了compute()，还有两种变体：computeIfAbsent(), computeIfPresent()。这个函数化参数只在key不存在或者存在的时候才会调用。<br>最后，merge()方法可以统一一个新值基于已经存在的值的基础上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">map.merge(<span class="string">"foo"</span>, <span class="string">"boo"</span>, (oldVal, newVal) -&gt; newVal + <span class="string">" was "</span> + oldVal);</span><br><span class="line">System.out.println(map.get(<span class="string">"foo"</span>));   <span class="comment">// boo was foo</span></span><br></pre></td></tr></table></figure>
<h2 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h2><p>上面的方法都是ConcurrentMap接口的一部分，所以所有实现了这个接口的类都可以使用。另外其中一个重要的实现：ConcurrentHashMap也被增强了加上了一些新的方法来在map上进行并发操作。<br>就像并发流(parallel streams)，这些方法使用一个特殊的通过ForkJoinPool.commonPool()来获取ForkJoinPool。这个池使用一个预先设定的并发值依赖于当前可用CPU的值。四核CPU返回的值如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(ForkJoinPool.getCommonPoolParallelism());  <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>这个值可以通过修改JVM参数来更改：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Djava.util.concurrent.ForkJoinPool.common.parallelism=<span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>我们通过和上一节一样的例子来展示，只是这次我们工作在具体的实现ConcurrentHashMap而不是在接口上，这样我们可以调用这个类的所有public方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ConcurrentHashMap&lt;String, String&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">"foo"</span>, <span class="string">"bar"</span>);</span><br><span class="line">map.put(<span class="string">"han"</span>, <span class="string">"solo"</span>);</span><br><span class="line">map.put(<span class="string">"r2"</span>, <span class="string">"d2"</span>);</span><br><span class="line">map.put(<span class="string">"c3"</span>, <span class="string">"p0"</span>);</span><br></pre></td></tr></table></figure>
<p>Java8介绍了三种并发操作：forEach, search和 reduce。每一个操作都可以接受函数keys,values,entries和key-value对参数。<br>这些方法都有一个共同的第一个参数：parallelismThreshold。这个阀值指定了当操作应该并发的时候最小的集合大小。比如如果阀值是500，而你传递了实际map大小是499，这个时候这个操作会在单个线程顺序执行。</p>
<h3 id="ForEach"><a href="#ForEach" class="headerlink" title="ForEach"></a>ForEach</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">map.forEach(<span class="number">1</span>, (key, value) -&gt;</span><br><span class="line">    System.out.printf(<span class="string">"key: %s; value: %s; thread: %s\n"</span>,</span><br><span class="line">        key, value, Thread.currentThread().getName()));</span><br><span class="line"></span><br><span class="line"><span class="comment">// key: r2; value: d2; thread: main</span></span><br><span class="line"><span class="comment">// key: foo; value: bar; thread: ForkJoinPool.commonPool-worker-1</span></span><br><span class="line"><span class="comment">// key: han; value: solo; thread: ForkJoinPool.commonPool-worker-2</span></span><br><span class="line"><span class="comment">// key: c3; value: p0; thread: main</span></span><br></pre></td></tr></table></figure>
<h3 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h3><p>Search方法接受一个Bifunction，并且为当前的键值对返回一个非空结果或者null如果当前的迭代没有满足要求。只要一个非空结果返回后，更近一步的搜索操作将会停止。记住ConcurrentHashMap是无序的。这个搜索方法不应该依赖于map之前的顺序。如果有多个值都符合搜索结果，那么返回的结果是不定的。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">String result = map.search(<span class="number">1</span>, (key, value) -&gt; &#123;</span><br><span class="line">    System.out.println(Thread.currentThread().getName());</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"foo"</span>.equals(key)) &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(<span class="string">"Result: "</span> + result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ForkJoinPool.commonPool-worker-2</span></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line"><span class="comment">// ForkJoinPool.commonPool-worker-3</span></span><br><span class="line"><span class="comment">// Result: bar</span></span><br></pre></td></tr></table></figure>
<h3 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h3><p>方法reduce可以接受两个类型为Bifunction的lambda表达式。第一个函数用于转换每个key-value键值为一个值。第二个函数用于将所转换的值变为一个值，忽略掉所有可能为空的值。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">String result = map.reduce(<span class="number">1</span>,</span><br><span class="line">    (key, value) -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">"Transform: "</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">return</span> key + <span class="string">"="</span> + value;</span><br><span class="line">    &#125;,</span><br><span class="line">    (s1, s2) -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">"Reduce: "</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">return</span> s1 + <span class="string">", "</span> + s2;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"Result: "</span> + result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Transform: ForkJoinPool.commonPool-worker-2</span></span><br><span class="line"><span class="comment">// Transform: main</span></span><br><span class="line"><span class="comment">// Transform: ForkJoinPool.commonPool-worker-3</span></span><br><span class="line"><span class="comment">// Reduce: ForkJoinPool.commonPool-worker-3</span></span><br><span class="line"><span class="comment">// Transform: main</span></span><br><span class="line"><span class="comment">// Reduce: main</span></span><br><span class="line"><span class="comment">// Reduce: main</span></span><br><span class="line"><span class="comment">// Result: r2=d2, c3=p0, han=solo, foo=bar</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2019/03/05/java/CoreJava/Java8 并发指南：同步和锁 Synchronization and Locks/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/05/java/CoreJava/Java8 并发指南：同步和锁 Synchronization and Locks/" class="post-title-link" itemprop="url">Java8 并发指南：同步和锁 Synchronization and Locks</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-05 10:44:55" itemprop="dateCreated datePublished" datetime="2019-03-05T10:44:55+08:00">2019-03-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-06 17:37:30" itemprop="dateModified" datetime="2019-03-06T17:37:30+08:00">2019-03-06</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Java8-并发指南：同步和锁-Synchronization-and-Locks"><a href="#Java8-并发指南：同步和锁-Synchronization-and-Locks" class="headerlink" title="Java8 并发指南：同步和锁 Synchronization and Locks"></a>Java8 并发指南：同步和锁 Synchronization and Locks</h1><p>from：<a href="https://winterbe.com/posts/2015/04/30/java8-concurrency-tutorial-synchronized-locks-examples/" target="_blank" rel="noopener">https://winterbe.com/posts/2015/04/30/java8-concurrency-tutorial-synchronized-locks-examples/</a><br>这是java8 并发指南的第二部分。在这个部分，你将会学习如何同步访问可变共享变量通过synchronized关键字，lock锁和信号semaphores。  </p>
<h2 id="synchronized同步"><a href="#synchronized同步" class="headerlink" title="synchronized同步"></a>synchronized同步</h2><p>在上一篇文章中，我们学习了如何并发执行代码通过executor服务。在编写多线程代码时，你需要格外注意多线程是如何访问可变共享变量的。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    count = count + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">IntStream.range(<span class="number">0</span>, <span class="number">10000</span>)</span><br><span class="line">    .forEach(i -&gt; executor.submit(<span class="keyword">this</span>::increment));</span><br><span class="line"></span><br><span class="line">stop(executor);</span><br><span class="line"></span><br><span class="line">System.out.println(count);  <span class="comment">// 9965</span></span><br></pre></td></tr></table></figure>
<p>因为我们共享了一个可变变量在不同的线程中而不加同步锁。结果是一个竞赛条件race condition(结果依赖于环境，不可固定。)。<br>为了增加数字有三个步骤：1.获取当前值。2.在这个值基础上加一。3.写入新的值到变量中。如果两个线程同时操作，并且都同时操作第一步，那么可能最后的值会比预想的值要小。<br>这个问题可以用java同步读synchronized关键字来解决。<br>内部java会使用一个监视器或者也被称为监视锁或者固有锁来管理同步。这个锁是和对象绑定的，比如当使用一个同步方法的时候，每一个方法共享相同的对象监视器。<br>所有的内部监视器实现了可重入的特性。可重入意味着锁和当前的线程绑定了。一个现场可以安全的多次获取相同的锁而不会进入死锁状态。</p>
<h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><p>除了通过synchronized来使用内部锁，并发API也支持多种实现了Lock接口的显示锁。相对于内在监视器，Locks支持多种方法来细粒度控制。<br>在标准JDK中有多种锁的实现是可用的并将会在以下展示。</p>
<h3 id="ReentrantLock-可重入锁"><a href="#ReentrantLock-可重入锁" class="headerlink" title="ReentrantLock 可重入锁"></a>ReentrantLock 可重入锁</h3><p>ReentrantLock 可重入锁是一个相互排斥的锁和内部监视器有着相同的基本行为但是有着其他扩展的能力。从名字可以看出，这个锁也是可以重入的。<br>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>锁是通过lock()来获取的，unlock()来释放的。将你的代码使用一个try/finally来包含起来很重要。这个方法就是线程安全的。  </p>
<h3 id="ReadWriteLock-读写锁"><a href="#ReadWriteLock-读写锁" class="headerlink" title="ReadWriteLock 读写锁"></a>ReadWriteLock 读写锁</h3><p>ReadWriteLock接口指定了锁的另外一种类型来维护一对锁用于读和写访问。在读写锁的背后的想法是多个线程来读通常是安全的，只要同时没有线程在对锁进行写。所以读锁可以被同时多个线程所拥有制药没有线程有写锁。这个可以提升性能因为读会比写要更加频繁一些。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">ReadWriteLock lock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"></span><br><span class="line">executor.submit(() -&gt; &#123;</span><br><span class="line">    lock.writeLock().lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        map.put(<span class="string">"foo"</span>, <span class="string">"bar"</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.writeLock().unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Runnable readTask = () -&gt; &#123;</span><br><span class="line">    lock.readLock().lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(map.get(<span class="string">"foo"</span>));</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.readLock().unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">executor.submit(readTask);</span><br><span class="line">executor.submit(readTask);</span><br><span class="line"></span><br><span class="line">stop(executor);</span><br></pre></td></tr></table></figure>
<p>当你执行代码片段时，你将会注意到所有读任务都需要等待一秒直到写任务完成。写任务完成之后，读任务会并发运行并且同时输出。  </p>
<h3 id="StampedLock"><a href="#StampedLock" class="headerlink" title="StampedLock"></a>StampedLock</h3><p>Java8有一个新的锁叫做StampedLocked同样和上一个锁一样也支持读和写。不同于读写锁的是，这个StampedLock方法会返回一个戳的整形值。你可以使用这些戳来释放一个锁或者检查这个锁是否仍然合法。另外stamped locks 支持一种锁的模式叫做optimistic locking。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">StampedLock lock = <span class="keyword">new</span> StampedLock();</span><br><span class="line"></span><br><span class="line">executor.submit(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">long</span> stamp = lock.writeLock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        map.put(<span class="string">"foo"</span>, <span class="string">"bar"</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlockWrite(stamp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Runnable readTask = () -&gt; &#123;</span><br><span class="line">    <span class="keyword">long</span> stamp = lock.readLock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(map.get(<span class="string">"foo"</span>));</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlockRead(stamp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">executor.submit(readTask);</span><br><span class="line">executor.submit(readTask);</span><br><span class="line"></span><br><span class="line">stop(executor);</span><br></pre></td></tr></table></figure>
<p>通过readLock()，writeLock()来返回一个stamp并且之后用这个stamp来释放锁。需要记住的是，stamped Locks没有实现可重入的特性。每次调用锁都会返回一个新的stamp并且如果没有锁将会阻塞即使在同一个线程中已经持有锁了。所以你特别需要注意不要死锁。<br>就和前文所说的ReawriteLock例子一样，所有的读任务都要等待写任务完成，而读任务可以并发。<br>下面这个例子展示了乐观锁：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">StampedLock lock = <span class="keyword">new</span> StampedLock();</span><br><span class="line"></span><br><span class="line">executor.submit(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">long</span> stamp = lock.tryOptimisticRead();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"Optimistic Lock Valid: "</span> + lock.validate(stamp));</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">"Optimistic Lock Valid: "</span> + lock.validate(stamp));</span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">"Optimistic Lock Valid: "</span> + lock.validate(stamp));</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock(stamp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">executor.submit(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">long</span> stamp = lock.writeLock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"Write Lock acquired"</span>);</span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock(stamp);</span><br><span class="line">        System.out.println(<span class="string">"Write done"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">stop(executor);</span><br></pre></td></tr></table></figure>
<p>和一般的读锁不同的是乐观锁并不阻止其他线程来即刻获取写锁。在第一个线程sleep后第二个线程获取了写锁而不需要等待乐观锁的释放。从这一刻开始，乐观锁将不再合法，即使是写锁已经被释放了以后。<em>所以当你使用乐观锁的是，你每次读完可变变量后都需要校验读锁是否合法</em>。<br>有时将一个读锁转换为写锁而无需使用unlocking和locking是很方便的事情。StampedLock提供tryConvertToWriteLock()的方法来达到这个目的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">StampedLock lock = <span class="keyword">new</span> StampedLock();</span><br><span class="line"></span><br><span class="line">executor.submit(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">long</span> stamp = lock.readLock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">            stamp = lock.tryConvertToWriteLock(stamp);</span><br><span class="line">            <span class="keyword">if</span> (stamp == <span class="number">0L</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"Could not convert to write lock"</span>);</span><br><span class="line">                stamp = lock.writeLock();</span><br><span class="line">            &#125;</span><br><span class="line">            count = <span class="number">23</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(count);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock(stamp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">stop(executor);</span><br></pre></td></tr></table></figure>
<p>调用tryConvertToWriteLock()就不会阻塞，但是可能返回0代表现在没有写锁可用，这个时候代码需要使用writeLock()来阻塞当前的线程直到有写锁可用。  </p>
<h2 id="Semaphores-信号"><a href="#Semaphores-信号" class="headerlink" title="Semaphores 信号"></a>Semaphores 信号</h2><p>除了锁，并发API也支持计数信号。锁事用来获取高端的变量或者资源的访问而信号是用来维护一套权限的。当你需要限制当前的并发访问的时候很有用。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">Runnable longRunningTask = () -&gt; &#123;</span><br><span class="line">    <span class="keyword">boolean</span> permit = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        permit = semaphore.tryAcquire(<span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">if</span> (permit) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Semaphore acquired"</span>);</span><br><span class="line">            sleep(<span class="number">5</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"Could not acquire semaphore"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (permit) &#123;</span><br><span class="line">            semaphore.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">IntStream.range(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">    .forEach(i -&gt; executor.submit(longRunningTask));</span><br><span class="line"></span><br><span class="line">stop(executor);</span><br></pre></td></tr></table></figure>
<p>这个executor可以同时运行10个任务但是我们使用大小为5的信号量来限制并发数量为5.特别重要的是要使用try/finally来合适的释放信号如果有异常发生的时候。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2019/03/04/java/CoreJava/Java8 并发指南：线程和执行者 Threads and Executors/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/04/java/CoreJava/Java8 并发指南：线程和执行者 Threads and Executors/" class="post-title-link" itemprop="url">Java8 并发指南：线程和执行者 Threads and Executors</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-04 15:12:25" itemprop="dateCreated datePublished" datetime="2019-03-04T15:12:25+08:00">2019-03-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-06 17:28:07" itemprop="dateModified" datetime="2019-03-06T17:28:07+08:00">2019-03-06</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Java8-并发指南：线程和执行者-Threads-and-Executors"><a href="#Java8-并发指南：线程和执行者-Threads-and-Executors" class="headerlink" title="Java8 并发指南：线程和执行者 Threads and Executors"></a>Java8 并发指南：线程和执行者 Threads and Executors</h1><p>from： <a href="https://winterbe.com/posts/2015/04/07/java8-concurrency-tutorial-thread-executor-examples/" target="_blank" rel="noopener">https://winterbe.com/posts/2015/04/07/java8-concurrency-tutorial-thread-executor-examples/</a><br>这个指南主要是教你理解Java8并发编程。一共有三个部分：  </p>
<ol>
<li>线程和执行(Threads and Executors)</li>
<li>同步和锁(Synchronization and Locks)</li>
<li>原子变量和并发map(Atomic Variables and ConcurrentMap)<br>并发编程的API最开始是在JAVA5中被介绍的，之后就不断的逐渐被增强。本文中的主要观点也可以在老java版本中工作。不过代码主要集中在Java8并且使用了lambda表达和其他的一些新特性。如果对lambda不太熟悉可以先阅读<a href="https://winterbe.com/posts/2014/03/16/java-8-tutorial/" target="_blank" rel="noopener">https://winterbe.com/posts/2014/03/16/java-8-tutorial/</a>这篇文章。  </li>
</ol>
<h2 id="Threads-和-Runables"><a href="#Threads-和-Runables" class="headerlink" title="Threads 和 Runables"></a>Threads 和 Runables</h2><p>所有的现代操作系统都是通过线程和进程来支持高并发的。进程是程序的实例通常是独立运行的。而线程是用来并发执行程序的，这样我们可以最大程度的利用CPU。<br>Java从JDK1.0开始支持线程。</p>
<h2 id="Executors"><a href="#Executors" class="headerlink" title="Executors"></a>Executors</h2><p>并发的API介绍了一个ExecutorService的概念作为一个高层级的替代来和Threads直接进行工作。Executors可以运行匿名方法和管理一个线程池，所以我们无须手动创造线程。在线程池中的所有线程将会被通过钩子函数来复用，所以我们可以运行任意多的并发任务在我们的应用的生命周期中通过一个executor服务。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executor = Executors.newSingleThreadExecutor();</span><br><span class="line">executor.submit(() -&gt; &#123;</span><br><span class="line">    String threadName = Thread.currentThread().getName();</span><br><span class="line">    System.out.println(<span class="string">"Hello "</span> + threadName);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>看起来运行的和之前的Threads和Runables结果差不多，但是在这个例子中，这个Java进程从来不会停止。Executors需要被显示的停止，否则她们将会继续监听新的线程。<br>一个ExecutorService提供两个方法来关闭：shutdown()等待当前任务执行结束，然后停止。shutdownNow()终止所有运行的任务，并且立刻停止executor。<br>通常用来停止线程池的方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">"attempt to shutdown executor"</span>);</span><br><span class="line">    executor.shutdown();</span><br><span class="line">    executor.awaitTermination(<span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    System.err.println(<span class="string">"tasks interrupted"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!executor.isTerminated()) &#123;</span><br><span class="line">        System.err.println(<span class="string">"cancel non-finished tasks"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    executor.shutdownNow();</span><br><span class="line">    System.out.println(<span class="string">"shutdown finished"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Callables-和-Futures"><a href="#Callables-和-Futures" class="headerlink" title="Callables 和 Futures"></a>Callables 和 Futures</h2><p>除了Runnable，executors也支持另外一种类型任务：Callable。Callable是和Runnable一样的函数接口，但是函数返回值不是空值。<br>Callable可以提交给线程池就像是Runnable一样。但是submit()并不会等待任务的完成，executor并不能直接返回callable的结果。Future替换了executor来获取真实的返回值在之后的时间点。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">1</span>);</span><br><span class="line">Future&lt;Integer&gt; future = executor.submit(task);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"future done? "</span> + future.isDone());</span><br><span class="line"></span><br><span class="line">Integer result = future.get();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"future done? "</span> + future.isDone());</span><br><span class="line">System.out.print(<span class="string">"result: "</span> + result);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">future done? false</span><br><span class="line">future done? true</span><br><span class="line">result: 123</span><br></pre></td></tr></table></figure>
<p>Futures和底层的线程池服务是耦合的。如果在future还没运行完毕的时候，你关闭了线程池，将会有异常抛出。  </p>
<h2 id="Timeouts"><a href="#Timeouts" class="headerlink" title="Timeouts"></a>Timeouts</h2><p>调用future.get()时，会阻塞线程直到返回，也可以在get上加timeout的参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">Future&lt;Integer&gt; future = executor.submit(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"task interrupted"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">future.get(<span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line">## InvokeAll</span><br><span class="line">Executor支持一次批量提交多个callables通过invokeAll()。这个方法接受了一个callable的集合并且放回futures的list。  </span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">ExecutorService executor = Executors.newWorkStealingPool();</span><br><span class="line"></span><br><span class="line">List&lt;Callable&lt;String&gt;&gt; callables = Arrays.asList(</span><br><span class="line">        () -&gt; <span class="string">"task1"</span>,</span><br><span class="line">        () -&gt; <span class="string">"task2"</span>,</span><br><span class="line">        () -&gt; <span class="string">"task3"</span>);</span><br><span class="line"></span><br><span class="line">executor.invokeAll(callables)</span><br><span class="line">    .stream()</span><br><span class="line">    .map(future -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> future.get();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<h2 id="InvokeAny"><a href="#InvokeAny" class="headerlink" title="InvokeAny"></a>InvokeAny</h2><p>另外一种批量提交callable的方式是invokeAny()，工作的方式和invokeAll有所不同。不同于返回future对象，这个方法在第一次调用终止前会阻塞并且放回callable的结果。<br>为了测试这个行为，代码如下，这个方法在返回值之前会睡眠一段时间，然后我们使用一系列的不同返回时间的callable并且通过invokeAny()进行调用。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Callable&lt;String&gt; <span class="title">callable</span><span class="params">(String result, <span class="keyword">long</span> sleepSeconds)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> () -&gt; &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(sleepSeconds);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ExecutorService executor = Executors.newWorkStealingPool();</span><br><span class="line"></span><br><span class="line">List&lt;Callable&lt;String&gt;&gt; callables = Arrays.asList(</span><br><span class="line">    callable(<span class="string">"task1"</span>, <span class="number">2</span>),</span><br><span class="line">    callable(<span class="string">"task2"</span>, <span class="number">1</span>),</span><br><span class="line">    callable(<span class="string">"task3"</span>, <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">String result = executor.invokeAny(callables);</span><br><span class="line">System.out.println(result);</span><br></pre></td></tr></table></figure>
<p>上述代码中使用了另外一种executor叫做newWorkStealingPool，这个工厂方法是Java8中的一种，并且返回一种ForkJoinPool的executor。不同于使用的是固定大小的线程池，ForkJoinPools被创建给一个和当前hostsCPU数量相同的数量的线程池。  </p>
<h2 id="Scheduled-Executors"><a href="#Scheduled-Executors" class="headerlink" title="Scheduled Executors"></a>Scheduled Executors</h2><p>在学会了如何通过executor一次提交并且运行任务，为了可以周期性的多次运行任务，我们可以利用计划的线程池。<br>一个ScheduledExecutorService是一种可以计划任务来运行不管是周期性的还是只是运行一次。  </p>
<p>如下代码是在三秒延迟之后运行任务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ScheduledExecutorService executor = Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">Runnable task = () -&gt; System.out.println(<span class="string">"Scheduling: "</span> + System.nanoTime());</span><br><span class="line">ScheduledFuture&lt;?&gt; future = executor.schedule(task, <span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">TimeUnit.MILLISECONDS.sleep(<span class="number">1337</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> remainingDelay = future.getDelay(TimeUnit.MILLISECONDS);</span><br><span class="line">System.out.printf(<span class="string">"Remaining Delay: %sms"</span>, remainingDelay);</span><br></pre></td></tr></table></figure>
<p>ScheduledFuture有一个方法getDelay()来获取剩下的延迟时间。直到延迟结束，这个任务将会被并发。<br>为了让任务可以周期性执行，executors提供了两个方法：scheduleAtFixedRate(), scheduleWithFixedDelay()。FixedRate是不考虑任务运行时间的，比如如果间隔是1s而任务要运行2s那么这个任务会很快不断运行。而FixedDelay则是考虑的是任务结束和下一个任务开始之间的间隔的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ScheduledExecutorService executor = Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">Runnable task = () -&gt; System.out.println(<span class="string">"Scheduling: "</span> + System.nanoTime());</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> initialDelay = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> period = <span class="number">1</span>;</span><br><span class="line">executor.scheduleAtFixedRate(task, initialDelay, period, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">ScheduledExecutorService executor = Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">Runnable task = () -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">"Scheduling: "</span> + System.nanoTime());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        System.err.println(<span class="string">"task interrupted"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">executor.scheduleWithFixedDelay(task, <span class="number">0</span>, <span class="number">1</span>, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2019/03/03/java/Spring/Spring 学习-- IOC容器和Dependency Injection 模式/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/03/java/Spring/Spring 学习-- IOC容器和Dependency Injection 模式/" class="post-title-link" itemprop="url">Spring 学习-- IOC容器和Dependency Injection 模式</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-03 22:41:46" itemprop="dateCreated datePublished" datetime="2019-03-03T22:41:46+08:00">2019-03-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-06 18:01:16" itemprop="dateModified" datetime="2019-03-06T18:01:16+08:00">2019-03-06</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring-学习–-IOC容器和Dependency-Injection-模式"><a href="#Spring-学习–-IOC容器和Dependency-Injection-模式" class="headerlink" title="Spring 学习– IOC容器和Dependency Injection 模式"></a>Spring 学习– IOC容器和Dependency Injection 模式</h1><p>from:<a href="http://insights.thoughtworkers.org/injection/" target="_blank" rel="noopener">http://insights.thoughtworkers.org/injection/</a></p>
<h2 id="组件和服务"><a href="#组件和服务" class="headerlink" title="组件和服务"></a>组件和服务</h2><p>服务(service)：可以看作是需要通过远程接口来远程调用的(例如web Service，消息系统，RPC或者socket)。<br>组件（component）：本地使用的（例如JAR文件，程序集，DLL或者源码导入）。  </p>
<h2 id="一个例子"><a href="#一个例子" class="headerlink" title="一个例子"></a>一个例子</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieLister</span>...</span></span><br><span class="line"><span class="class"></span></span><br><span class="line">    public Movie[] moviesDirectedBy(String arg)</span><br><span class="line">    &#123;</span><br><span class="line">        List allMovies = finder.findAll();</span><br><span class="line">        <span class="keyword">for</span> (Iterator it = allMovies.iterator(); it.hasNext();)</span><br><span class="line">        &#123;</span><br><span class="line">            Movie movie = (Movie) it.next();</span><br><span class="line">            <span class="keyword">if</span> (!movie.getDirector().equals(arg))</span><br><span class="line">            &#123;</span><br><span class="line">                it.remove();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (Movie[]) allMovies.toArray(<span class="keyword">new</span> Movie[allMovies.size()]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在MovieLister中有一个finder对象，用于搜寻全部的电影。目的是上面的moviesDirectedBy方法不依赖于电影的存储方式而可以运行。比如定义了接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MovieFinder</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function">List <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和一个具体的实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieLister</span>...</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">MovieFinder</span> <span class="title">finder</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MovieLister</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        finder = <span class="keyword">new</span> ColonDelimitedMovieFinder(<span class="string">"movies1.txt"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>上面这个实现类就是从一个存储着电影名字的文件中来获取电影。但是如果其他的人也想要使用这个程序，但是存储电影的形式并不是在文件中，而是在SQL，XML文件或者web Service中，应该怎么办？<br>我们希望MovieLister可以和MovieFinder的任何实现类一起配合工作，并且允许在运行期插入具体的实现类。而这里用到的就是<strong>控制反转(Inversion of Control)</strong>。  </p>
<h2 id="控制反转"><a href="#控制反转" class="headerlink" title="控制反转"></a>控制反转</h2><p>反转了哪方面的控制？比如有的是针对用户界面的主控权。早期的用户界面是由应用程序来控制的。而后来界面环境下，UI框架负责执行一个主循环，应用程序只需要为屏幕的各个区域提供事件处理函数就可以了。这里<strong>控制权从应用程序移到了框架</strong>。<br>而这些新生的容器框架，反转的是如何定位插件的具体实现。在前面例子中，MovieLister负责定位MovieFinder的具体实现– 它直接实例化后者的一个子类。这样MovieFinder没法作为一个插件，因为它并不是在运行期插入程序的。而轻量级容器提供了更加灵活的方式，只要遵循一定的规则，一个独立的组装模块就可以将插件的具体实现注射到应用程序中。这种模式称为“依赖注入Dependency Injection”。  </p>
<h2 id="依赖注入的几种形式"><a href="#依赖注入的几种形式" class="headerlink" title="依赖注入的几种形式"></a>依赖注入的几种形式</h2><p>基本思想：用一个单独的装配器来获取对应的合适的实现，并将其实例赋给MovieLister类的一个字段。<br>依赖注入有三种形式：1.构造函数注入(Constructor Injection) 2. 设值方法注入(Setter Injection) 3.接口注入(Interface Injection)<br>这三种分别就是 指注入的形式，</p>
<h3 id="构造函数注入"><a href="#构造函数注入" class="headerlink" title="构造函数注入"></a>构造函数注入</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieLister</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">MovieLister</span>(<span class="title">MovieFinder</span> <span class="title">finder</span>)</span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.finder = finder;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>构造函数中将实现注入。 </p>
<h3 id="设值方法注入"><a href="#设值方法注入" class="headerlink" title="设值方法注入"></a>设值方法注入</h3><p>就是用专门的set方法来注入实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieLister</span>...</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">MovieFinder</span> <span class="title">finder</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFinder</span><span class="params">(MovieFinder finder)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.finder = finder;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ColonMovieFinder</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">setFilename</span>(<span class="title">String</span> <span class="title">filename</span>)</span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.filename = filename;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>然后在配置文件中具体指出配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"MovieLister"</span> <span class="attr">class</span>=<span class="string">"spring.MovieLister"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"finder"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">local</span>=<span class="string">"MovieFinder"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"MovieFinder"</span> <span class="attr">class</span>=<span class="string">"spring.ColonMovieFinder"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filename"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>movies1.txt<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="接口注入"><a href="#接口注入" class="headerlink" title="接口注入"></a>接口注入</h3><p>先定义一个接口，然后组件通过这个接口进行注入。比如，下面代码中，接口InjectFinder的用途就是将一个MovieFinder实例注入继承该接口的对象。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InjectFinder</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">injectFinder</span><span class="params">(MovieFinder finder)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个接口由提供MovieFinder接口的人一并提供，任何想要实现MovieFinder实例的类，如MovieLister类都必须实现这个接口。这样以来就必须在运行时指定具体实现类了。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieLister</span> <span class="keyword">implements</span> <span class="title">InjectFinder</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">injectFinder</span>(<span class="title">MovieFinder</span> <span class="title">finder</span>)</span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.finder = finder;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>然后使用类似的方法将文件名注入MovieFinder的实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InjectFilename</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">injectFilename</span> <span class="params">(String filename)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ColonMovieFinder</span> <span class="keyword">implements</span> <span class="title">MovieFinder</span>, <span class="title">InjectFilename</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">injectFilename</span>(<span class="title">String</span> <span class="title">filename</span>)</span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.filename = filename;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>最后，对所有组件进行装配：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IfaceTester</span>...</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">MovieLister</span> <span class="title">lister</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">configureLister</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ColonMovieFinder finder = <span class="keyword">new</span> ColonMovieFinder();</span><br><span class="line">        finder.injectFilename(<span class="string">"movies1.txt"</span>);</span><br><span class="line">        lister = <span class="keyword">new</span> MovieLister();</span><br><span class="line">        lister.injectFinder(finder);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>比如这上面，configureLister()就将具体实现通过这个接口进行了注入。  </p>
<h2 id="使用Service-Locator-服务定位？"><a href="#使用Service-Locator-服务定位？" class="headerlink" title="使用Service Locator(服务定位？)"></a>使用Service Locator(服务定位？)</h2><p>依赖注入最大的好处在于：它消除了MovieLister类对具体MovieFinder实现类的依赖。这样不同的环境可以插入合适的MovieFinder实现。而Service Locator也可以打破这层依赖。<br>Service Locator背后的思想是：有一个对象(服务定位器)可以知道如何获取一个应用程序所需的所有服务。</p>
<p><img src="DI_injection-image-3.gif" alt="DI_injection-image-3.gif"></p>
<p>将ServiceLocator实现为一个Singleton的注册表，MovieLister就可以在实例化时通过ServiceLocator获得一个MovieFinder的实例。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieLister</span>...</span></span><br><span class="line"><span class="class">    <span class="title">MovieFinder</span> <span class="title">finder</span> </span>= ServiceLocator.movieFinder();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServiceLocator</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">static</span> <span class="title">MovieFinder</span> <span class="title">movieFinder</span>()</span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> soleInstance.movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ServiceLocator soleInstance;</span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br></pre></td></tr></table></figure>
<p>配置的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tester</span>...</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">void</span> <span class="title">configure</span>()</span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        ServiceLocator.load(<span class="keyword">new</span> ServiceLocator(</span><br><span class="line">        newColonMovieFinder(<span class="string">"movies1.txt"</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServiceLocator</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">static</span> <span class="title">void</span> <span class="title">load</span>(<span class="title">ServiceLocator</span> <span class="title">arg</span>)</span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        soleInstance = arg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ServiceLocator</span><span class="params">(MovieFinder movieFinder)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="为定位器提供分离的接口"><a href="#为定位器提供分离的接口" class="headerlink" title="为定位器提供分离的接口"></a>为定位器提供分离的接口</h2>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2019/02/05/FoundationAndDevops/Jenkins 学习记录/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/05/FoundationAndDevops/Jenkins 学习记录/" class="post-title-link" itemprop="url">Jenkins 学习记录</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-05 16:20:00" itemprop="dateCreated datePublished" datetime="2019-02-05T16:20:00+08:00">2019-02-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-27 12:23:25" itemprop="dateModified" datetime="2019-03-27T12:23:25+08:00">2019-03-27</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Jenkins-学习记录"><a href="#Jenkins-学习记录" class="headerlink" title="Jenkins 学习记录"></a>Jenkins 学习记录</h2><p><a href="https://jenkins.io/doc/" target="_blank" rel="noopener">https://jenkins.io/doc/</a></p>
<h3 id="guidetour"><a href="#guidetour" class="headerlink" title="guidetour"></a>guidetour</h3><p><a href="https://jenkins.io/doc/pipeline/tour/getting-started/" target="_blank" rel="noopener">https://jenkins.io/doc/pipeline/tour/getting-started/</a><br>这个指南介绍了Jenkis最基本的使用和它主要的特点，Jenkins pipeline。 这个指南使用了”standalone”模式，只是运行在你自己的机器上。<br>按照步骤安装好了以后，ip:8080/jenkins上就可以看到对应的管理界面了。  </p>
<h3 id="Creating-your-first-Pipeline"><a href="#Creating-your-first-Pipeline" class="headerlink" title="Creating your first Pipeline"></a>Creating your first Pipeline</h3><p><a href="https://jenkins.io/doc/pipeline/tour/hello-world/" target="_blank" rel="noopener">https://jenkins.io/doc/pipeline/tour/hello-world/</a><br>Jenkins Pipeline 是一组Jenkins中支持和实现集成持续交付的流水线的插件。<br>持续交付流水线是一个你的进程的自动化的表达表示从版本控制中获取软件到交付到你的用户和客户手上。<br>Jenkins Pipeline通常被写在文件里，并被提交到一个项目的源代码控制仓库中。  </p>
<p><a href="https://jenkins.io/doc/tutorials/build-a-python-app-with-pyinstaller/" target="_blank" rel="noopener">https://jenkins.io/doc/tutorials/build-a-python-app-with-pyinstaller/</a></p>
<h3 id="在Linux上运行Jenkins"><a href="#在Linux上运行Jenkins" class="headerlink" title="在Linux上运行Jenkins"></a>在Linux上运行Jenkins</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">  --rm \</span><br><span class="line">  -u root \</span><br><span class="line">  -p <span class="number">8080</span>:<span class="number">8080</span> \</span><br><span class="line">  -v jenkins-data:/var/jenkins_home \ </span><br><span class="line">  -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">  -v "$HOME":/home \ </span><br><span class="line">  jenkinsci/blueocean</span><br></pre></td></tr></table></figure>
<p>或者无换行：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -u root -p <span class="number">8080</span>:<span class="number">8080</span> -v jenkins-data:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock -v "$HOME":/home  jenkinsci/blueocean</span><br></pre></td></tr></table></figure>
<p>设置好以后，进行基本的设置就可以使用了。如果想要停止Jenkins直接停止这个container就好，由于数据已经映射出来了，所以即使删掉了这个image，也是可以读取回来之前的设置的。(如果想要删掉没有用到的Volume，可以用这个命令：docker system prune –volumes)  </p>
<h4 id="对一个项目构造pipeline"><a href="#对一个项目构造pipeline" class="headerlink" title="对一个项目构造pipeline"></a>对一个项目构造pipeline</h4><p>有一个simple 项目：<a href="https://github.com/jenkins-docs/simple-python-pyinstaller-app" target="_blank" rel="noopener">simple-python-pyinstaller-app</a>    可以fork到自己的github下并且clone到本地。然后：  </p>
<ol>
<li>回到Jenkins，点击”create new jobs”或者“New Item” </li>
<li>输入名称，如simple-python-pyinstaller-app</li>
<li>点击 Pipeline，然后点 OK。</li>
<li>在下一页可以输入描述用于描述你的流水线。</li>
<li>点击Pipeline tab滑动到Pipeline节</li>
<li>在 Definition 区域，选择  Pipeline script from SCM 。</li>
<li>从SCM中选择Git。</li>
<li>在Repository URL字段，指定你的代码仓库路径。</li>
<li>点击保存。保存你的新项目，你现在可以开始创建你的Jenkinsfile。</li>
</ol>
<h4 id="创造你初始化Pipeline做为Jenkinsfile"><a href="#创造你初始化Pipeline做为Jenkinsfile" class="headerlink" title="创造你初始化Pipeline做为Jenkinsfile"></a>创造你初始化Pipeline做为Jenkinsfile</h4><p>现在你准备好创造你自己的Pipeline来自动化构建你的Python 应用使用PyInstaller在Jenkins中。你的流水线将会被创造为一个Jenkinsfile，将会提交到你本地克隆仓库。<br>这是”Pipeline-as-Code”的基础，将持续交付流水线作为这个应用的一部分同样也被用来版本和review。<a href="https://jenkins.io/doc/book/pipeline" target="_blank" rel="noopener">pipeline</a> 和<a href="https://jenkins.io/doc/book/pipeline/jenkinsfile" target="_blank" rel="noopener">Using a Jenkisfile</a>对Pipeline和Jenkinsfile有更详细的介绍。<br>首先，创建一个初始化的Pipeline在”Build”阶段来执行所有产品流程的第一部分。这个“build”阶段下载了一个Python Docker 镜像并且将它运行为一个Docker 容器，用来编译你的简单Python应用为字节码。  </p>
<ol>
<li>在你的代码仓库创建并且保存一个文件Jenkinsfile</li>
<li>在Jenkinsfile中添加如下流水线代码：</li>
</ol>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none </span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123; </span><br><span class="line">            agent &#123;</span><br><span class="line">                docker &#123;</span><br><span class="line">                    image 'python:<span class="number">2</span>-alpine' </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'python -m py_compile sources/add2vals.py sources/calc.py' </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>保存Jenkinsfile 并且使用git提交文件。</li>
<li>回到Jenkins并且点击 打开Blue Ocean 按钮来访问Jenkins Blue Ocean界面。</li>
<li>在 “This job has not been run”的消息框中点击运行， 然后点击对应的行来查看详情</li>
<li>回到主要的Blue Ocean 界面。</li>
</ol>
<h4 id="在你的流水线中增加一个测试环节"><a href="#在你的流水线中增加一个测试环节" class="headerlink" title="在你的流水线中增加一个测试环节"></a>在你的流水线中增加一个测试环节</h4><ol>
<li>打开你的Jenkinsfile文件</li>
<li>在文件build环节下增加下面一段：</li>
</ol>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> stage('Test') &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        docker &#123;</span><br><span class="line">            image 'qnib/pytest'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    steps &#123;</span><br><span class="line">        sh 'py.test --verbose --junit-xml test-reports/results.xml sources/test_calc.py'</span><br><span class="line">    &#125;</span><br><span class="line">    post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            junit 'test-reports/results.xml'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```        </span><br><span class="line"><span class="number">3</span>. git提交修改的文件</span><br><span class="line"><span class="number">4</span>. 回到Jenkins上进入Blue Ocean界面点击左侧的运行按钮。</span><br><span class="line"></span><br><span class="line">#### 在流水线中增加一个发布过程</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. 打开你的Jenkinsfile文件</span><br><span class="line"><span class="number">2</span>. 在文件test环节下增加下面一段：</span><br></pre></td></tr></table></figure>
<p>stage(‘Deliver’) {<br>    agent {<br>        docker {<br>            image ‘cdrx/pyinstaller-linux:python2’<br>        }<br>    }<br>    steps {<br>        sh ‘pyinstaller –onefile sources/add2vals.py’<br>    }<br>    post {<br>        success {<br>            archiveArtifacts ‘dist/add2vals’<br>        }<br>    }<br>}<br><code>`</code>                </p>
<ol start="3">
<li>git 提交你的修改</li>
<li>回到Jenkins上进入Blue Ocean界面点击左侧的运行按钮。</li>
</ol>
<p><a href="https://jenkins.io/doc/tutorials/create-a-pipeline-in-blue-ocean/" target="_blank" rel="noopener">https://jenkins.io/doc/tutorials/create-a-pipeline-in-blue-ocean/</a></p>
<h4 id="在Blue-Ocean中创建你的Pipeline"><a href="#在Blue-Ocean中创建你的Pipeline" class="headerlink" title="在Blue Ocean中创建你的Pipeline"></a>在Blue Ocean中创建你的Pipeline</h4><ol>
<li>登录Jenkins并且打开 Blue Ocean界面</li>
<li>点击 Create a new Pipeline 来开始创建Pipeline</li>
<li>选择GitHub，并且点击创建一个访问key，github中的设置选择默认就好了，并且将该key复制到blue Ocean上。</li>
<li>在Blue Ocean上选择对应的github账户，并且选择之前fork的仓库代码(<a href="https://github.com/jenkins-docs/creating-a-pipeline-in-blue-ocean" target="_blank" rel="noopener">https://github.com/jenkins-docs/creating-a-pipeline-in-blue-ocean</a>)</li>
<li>点击  Create Pipeline。<br> Blue Ocean检测到这个仓库的master 分支的root级别上没有Jenkinsfile，将会帮助你创建一个。<br> 一个Pipeline项目被通过Blue Ocean 创建通常是”multibranch Pipeline”。所以，Jenkins会在你的每一个分支中查找最少一个Jenkinsfile。</li>
</ol>
<h4 id="创建你自己的初始化Pipeline"><a href="#创建你自己的初始化Pipeline" class="headerlink" title="创建你自己的初始化Pipeline"></a>创建你自己的初始化Pipeline</h4><ol>
<li>在页面右侧代理选择 docker，然后image填写node:6-alpine,参数填写：-p 3000:3000</li>
<li>回到主Pipeline编辑器，点击+号，从而打开一个新的stage在右侧。</li>
<li>在这个面板输入名字为build，然后点击 Add Step按钮，选择Shell Script，然后在打开的Build/Shell Script面板中输入“npm install”    </li>
<li>点击保存来保存你的当前的Pipeline</li>
<li>在Save Pipeline对话框中，填写描述（ Add initial Pipeline (Jenkinsfile)）。选择Commit to master.然后点击 Save&amp;Run。</li>
</ol>
<h3 id="构建一个多分支的Pipeline项目"><a href="#构建一个多分支的Pipeline项目" class="headerlink" title="构建一个多分支的Pipeline项目"></a>构建一个多分支的Pipeline项目</h3><p><a href="https://jenkins.io/doc/tutorials/build-a-multibranch-pipeline-project/" target="_blank" rel="noopener">https://jenkins.io/doc/tutorials/build-a-multibranch-pipeline-project/</a> </p>
<ol>
<li>将<a href="https://github.com/jenkins-docs/building-a-multibranch-pipeline-project" target="_blank" rel="noopener">building-a-multibranch-pipeline-project</a>项目fork到自己仓库来。并将代码clone到本地。  </li>
<li><p>输入’git branch development’和 ‘git branch production’ 创建两个分支。<br><em>运行npm install的时候总会碰到exit code:137然后退出运行，经查可能是内存不足，无法运行，准备杀掉些进程，或者增加swap。<a href="https://www.thegeekstuff.com/2010/08/how-to-add-swap-space/" target="_blank" rel="noopener">增加swap</a></em></p>
</li>
<li></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Pan</p>
              <div class="site-description motion-element" itemprop="description">computer, finance, some recording</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">24</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Pan</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="Symbols count total"></span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="Reading time total"></span>
  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.0.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.1"></script>



  

  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
