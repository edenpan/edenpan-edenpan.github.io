<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Eden</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="computer, finance, some recording">
<meta property="og:type" content="website">
<meta property="og:title" content="Eden">
<meta property="og:url" content="http://blog.sevenpan.com/index.html">
<meta property="og:site_name" content="Eden">
<meta property="og:description" content="computer, finance, some recording">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Eden">
<meta name="twitter:description" content="computer, finance, some recording">
  
    <link rel="alternate" href="/atom.xml" title="Eden" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Eden</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.sevenpan.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Somethings About Pyalgotrade" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/17/Somethings About Pyalgotrade/" class="article-date">
  <time datetime="2018-10-17T05:27:39.000Z" itemprop="datePublished">2018-10-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/17/Somethings About Pyalgotrade/">Somethings About Pyalgotrade  - the Optimizing</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Somethings-About-Pyalgotrade-The-optimizing"><a href="#Somethings-About-Pyalgotrade-The-optimizing" class="headerlink" title="Somethings About Pyalgotrade  - The optimizing"></a>Somethings About Pyalgotrade  - The optimizing</h1><p><a href="http://gbeced.github.io/pyalgotrade/docs/v0.20/html/tutorial.html#optimizing" target="_blank" rel="noopener">http://gbeced.github.io/pyalgotrade/docs/v0.20/html/tutorial.html#optimizing</a></p>
<h2 id="The-optimizing"><a href="#The-optimizing" class="headerlink" title="The optimizing"></a>The optimizing</h2><p>ä¼˜åŒ–ï¼ŒğŸ’¡å¾ˆç®€å•ï¼š</p>
<pre><code>ä¸€å°serverç”¨äºï¼š
    1. æä¾›barsç”¨æ¥è¿è¡Œç­–ç•¥
    2. æä¾›å‚æ•°ç”¨æ¥è¿è¡Œç­–ç•¥
    3. è®°å½•æ¯ä¸€ä¸ªworkerçš„è¿è¡Œç­–ç•¥çš„ç»“æœ
å¾ˆå¤šworkerç”¨æ¥ï¼š
    ä½¿ç”¨serveræä¾›çš„å‚æ•°å’Œæ•°æ®æ¥è¿è¡Œç­–ç•¥
</code></pre><p>ä¸ºäº†å±•ç¤ºè¿™ä¸ªï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨ä¸€ä¸ªç§°ä¸ºRSI2çš„ç­–ç•¥ï¼Œè¯¥ç­–ç•¥éœ€è¦ä»¥ä¸‹çš„å‚æ•°ï¼š</p>
<pre><code>ä¸€ä¸ªSMAæ—¶é—´æ®µç”¨äºåŒºåˆ†è¶‹åŠ¿ã€‚æˆ‘ä»¬å°†ä¼šå°†è¿™ä¸ªå‚æ•°ç§°ä¸ºentrySMAï¼Œå¹¶ä¸”èŒƒå›´é€‰å–åœ¨150å’Œ250ä¹‹é—´ã€‚  
ä¸€ä¸ªå°ä¸€äº›çš„SMAæ—¶é—´æ®µç”¨äºé€€å‡ºå‚æ•°ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºexitSMAï¼ŒèŒƒå›´åœ¨5åˆ°15ä¹‹é—´ã€‚  
ä¸€ä¸ªRSIæ—¶é—´æ®µç”¨äºè¿›å…¥ä¹°æˆ–è€…å–ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºrsiPeriodï¼ŒèŒƒå›´åœ¨2åˆ°10ä¹‹é—´ã€‚  
ä¸€ä¸ªRSIè¶…å–é˜€å€¼ç”¨äºè¿›å…¥ä¹°å…¥ç‚¹ä½ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºoverSoldThresholdï¼Œå¹¶ä¸”èŒƒå›´åœ¨5å’Œ25ä¹‹é—´ã€‚  
ä¸€ä¸ªRSIè¶…ä¹°é˜€å€¼ç”¨äºè¿›å…¥å–å‡ºç‚¹ä½ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºoverBoughtThresholdï¼ŒèŒƒå›´å°†åœ¨75å’Œ95ä¹‹é—´ã€‚
</code></pre><p><b>æ‰€ä»¥è¿™é‡Œä¸€å…±æœ‰ï¼š101 <em> 11 </em> 9 <em> 21 </em> 21 = 4409559</b><br>å¦‚æœä¸€ä¸ªç­–ç•¥éœ€è¦è¿è¡Œ0.16ç§’ï¼Œé‚£ä¹ˆä¸€å…±éœ€è¦8.5å¤©æ‰èƒ½ç®—å‡ºæ‰€æœ‰çš„ç­–ç•¥ã€‚(4409559 <em> 0.16/3600/24 ï½ 8.16 Days)<br>å¦‚æœæ˜¯åˆ©ç”¨ä¸Šäº†10å°å…«æ ¸çš„æœºå™¨ï¼Œæ—¶é—´å°†ä¼šç¼©çŸ­åˆ°2.5ä¸ªå°æ—¶ã€‚ï¼ˆ4409559 </em> 0.16/3600/24/8/10 * 24(h) ~ 2.44 h) æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¹¶å‘ã€‚  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">from pyalgotrade import strategy</span><br><span class="line">from pyalgotrade.technical import ma</span><br><span class="line">from pyalgotrade.technical import rsi</span><br><span class="line">from pyalgotrade.technical import cross</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class RSI2(strategy.BacktestingStrategy):</span><br><span class="line">    def __init__(self, feed, instrument, entrySMA, exitSMA, rsiPeriod, overBoughtThreshold, overSoldThreshold):</span><br><span class="line">        super(RSI2, self).__init__(feed)</span><br><span class="line">        self.__instrument = instrument</span><br><span class="line">        # We&apos;ll use adjusted close values, if available, instead of regular close values.</span><br><span class="line">        if feed.barsHaveAdjClose():</span><br><span class="line">            self.setUseAdjustedValues(True)</span><br><span class="line">        self.__priceDS = feed[instrument].getPriceDataSeries()</span><br><span class="line">        self.__entrySMA = ma.SMA(self.__priceDS, entrySMA)</span><br><span class="line">        self.__exitSMA = ma.SMA(self.__priceDS, exitSMA)</span><br><span class="line">        self.__rsi = rsi.RSI(self.__priceDS, rsiPeriod)</span><br><span class="line">        self.__overBoughtThreshold = overBoughtThreshold</span><br><span class="line">        self.__overSoldThreshold = overSoldThreshold</span><br><span class="line">        self.__longPos = None</span><br><span class="line">        self.__shortPos = None</span><br><span class="line"></span><br><span class="line">    def getEntrySMA(self):</span><br><span class="line">        return self.__entrySMA</span><br><span class="line"></span><br><span class="line">    def getExitSMA(self):</span><br><span class="line">        return self.__exitSMA</span><br><span class="line"></span><br><span class="line">    def getRSI(self):</span><br><span class="line">        return self.__rsi</span><br><span class="line"></span><br><span class="line">    def onEnterCanceled(self, position):</span><br><span class="line">        if self.__longPos == position:</span><br><span class="line">            self.__longPos = None</span><br><span class="line">        elif self.__shortPos == position:</span><br><span class="line">            self.__shortPos = None</span><br><span class="line">        else:</span><br><span class="line">            assert(False)</span><br><span class="line"></span><br><span class="line">    def onExitOk(self, position):</span><br><span class="line">        if self.__longPos == position:</span><br><span class="line">            self.__longPos = None</span><br><span class="line">        elif self.__shortPos == position:</span><br><span class="line">            self.__shortPos = None</span><br><span class="line">        else:</span><br><span class="line">            assert(False)</span><br><span class="line"></span><br><span class="line">    def onExitCanceled(self, position):</span><br><span class="line">        # If the exit was canceled, re-submit it.</span><br><span class="line">        position.exitMarket()</span><br><span class="line"></span><br><span class="line">    def onBars(self, bars):</span><br><span class="line">        # Wait for enough bars to be available to calculate SMA and RSI.</span><br><span class="line">        if self.__exitSMA[-1] is None or self.__entrySMA[-1] is None or self.__rsi[-1] is None:</span><br><span class="line">            return</span><br><span class="line"></span><br><span class="line">        bar = bars[self.__instrument]</span><br><span class="line">        if self.__longPos is not None:</span><br><span class="line">            if self.exitLongSignal():</span><br><span class="line">                self.__longPos.exitMarket()</span><br><span class="line">        elif self.__shortPos is not None:</span><br><span class="line">            if self.exitShortSignal():</span><br><span class="line">                self.__shortPos.exitMarket()</span><br><span class="line">        else:</span><br><span class="line">            if self.enterLongSignal(bar):</span><br><span class="line">                shares = int(self.getBroker().getCash() * 0.9 / bars[self.__instrument].getPrice())</span><br><span class="line">                self.__longPos = self.enterLong(self.__instrument, shares, True)</span><br><span class="line">            elif self.enterShortSignal(bar):</span><br><span class="line">                shares = int(self.getBroker().getCash() * 0.9 / bars[self.__instrument].getPrice())</span><br><span class="line">                self.__shortPos = self.enterShort(self.__instrument, shares, True)</span><br><span class="line"></span><br><span class="line">    def enterLongSignal(self, bar):</span><br><span class="line">        return bar.getPrice() &gt; self.__entrySMA[-1] and self.__rsi[-1] &lt;= self.__overSoldThreshold</span><br><span class="line"></span><br><span class="line">    def exitLongSignal(self):</span><br><span class="line">        return cross.cross_above(self.__priceDS, self.__exitSMA) and not self.__longPos.exitActive()</span><br><span class="line"></span><br><span class="line">    def enterShortSignal(self, bar):</span><br><span class="line">        return bar.getPrice() &lt; self.__entrySMA[-1] and self.__rsi[-1] &gt;= self.__overBoughtThreshold</span><br><span class="line"></span><br><span class="line">    def exitShortSignal(self):</span><br><span class="line">        return cross.cross_below(self.__priceDS, self.__exitSMA) and not self.__shortPos.exitActive()</span><br></pre></td></tr></table></figure>
<p>æœ‰ä»¥ä¸‹çš„å‡½æ•°è¢«å®šä¹‰ï¼š</p>
<pre><code>#è·å–è¿›å…¥SMAçš„å€¼ï¼Œrangeä»150åˆ°250
getEntrySMA(self)
#è·å–é€€å‡ºSMAçš„å€¼ï¼Œrangeä»5åˆ°16
getExitSMA(self)
#è·å–rsi æ—¶æ®µçš„å€¼ï¼Œrangeä»2åˆ°10
getRSI(self)
#å–æ¶ˆå»ºä»“é€»è¾‘ --- è¿™é‡Œä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆè¦å¢åŠ 
onEnterCanceled(self, position)
#å¹³ä»“é€»è¾‘ --- è¿™é‡Œä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆè¦å¢åŠ     
onExitOk(self, position)
#å¹³ä»“å–æ¶ˆé€»è¾‘ --- è¿™é‡Œä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆè¦å¢åŠ     
onExitCanceled(self, position)
#ç­–ç•¥æ‰§è¡Œé€»è¾‘
onBars(self, bars)
#åšå¤šä¿¡å·
enterLongSignal(self, bar)
#é€€å‡ºåšå¤šä¿¡å·
exitLongSignal(self)
#åšç©ºä¿¡å·
enterShortSignal(self, bar)
#é€€å‡ºåšç©ºä¿¡å·
exitShortSignal(self)
</code></pre><p>å…¶ä¸­ï¼ŒonBars(self, bars)å‡½æ•°ç”¨äºæ‰§è¡Œç­–ç•¥é€»è¾‘ï¼Œåœ¨onBarsä¸­ï¼Œå¦‚æœç›®å‰æœ‰ä»“ä½ï¼Œè°ƒç”¨äº†exitLongSignal() å’Œ exitShortSignal ç”¨äºåˆ¤æ–­æ˜¯éè¦æ‰§è¡Œå¹³ä»“æ“ä½œã€‚å¦‚æœç›®å‰ç©ºä»“ï¼Œåˆ™è°ƒç”¨äº†enterLongSignal()å’ŒenterShortSignal()æ¥å†³å®šæ˜¯å¦å»ºä»“ã€‚å…¶ä¸­ï¼ŒgetBroker().getCash()å¯ä»¥è·å–å½“å‰çš„ç°é‡‘ï¼Œ0.9åº”è¯¥æ˜¯ä¼°ç®—äº†äº¤æ˜“è´¹ç”¨ã€‚è€Œå…¶ä¸­çš„enterShort()å’ŒenterLong()å‡½æ•°åº”è¯¥æ˜¯BacktestingStrategyç±»æ‰€å«æœ‰çš„å‡½æ•°ã€‚  </p>
<p>ä»ä¸Šé¢ä¸€æ®µå‡½æ•°åŸºæœ¬é€»è¾‘å¯ä»¥åˆ†æå‡ºï¼ŒPyalgotrade æœ‰ä¸¤ä¸ªåŸºæœ¬çš„ç±»ï¼Œæˆ‘éœ€è¦å…³æ³¨ï¼š</p>
<pre><code>from pyalgotrade import strategy
strategy.BacktestingStrategy
position
pyalgotrade.technical
</code></pre><p>ç„¶åè¿˜æœ‰æ—æä½†æ˜¯ä¸ç”¨å¤ªè¿‡å…³å¿ƒçš„ç±»ï¼š</p>
<pre><code>feed
from pyalgotrade.barfeed import quandlfeed
feed = quandlfeed.Feed()
</code></pre><p>å›åˆ°ä¼˜åŒ–è¿™ä¸ªä¸»é¢˜ä¸Šæ¥ï¼Œserverçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import itertools</span><br><span class="line">from pyalgotrade.optimizer import server</span><br><span class="line">from pyalgotrade.barfeed import quandlfeed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def parameters_generator():</span><br><span class="line">    instrument = [&quot;ibm&quot;]</span><br><span class="line">    entrySMA = range(150, 251)</span><br><span class="line">    exitSMA = range(5, 16)</span><br><span class="line">    rsiPeriod = range(2, 11)</span><br><span class="line">    overBoughtThreshold = range(75, 96)</span><br><span class="line">    overSoldThreshold = range(5, 26)</span><br><span class="line">    return itertools.product(instrument, entrySMA, exitSMA, rsiPeriod, overBoughtThreshold, overSoldThreshold)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># The if __name__ == &apos;__main__&apos; part is necessary if running on Windows.</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    # Load the bar feed from the CSV files.</span><br><span class="line">    feed = quandlfeed.Feed()</span><br><span class="line">    feed.addBarsFromCSV(&quot;ibm&quot;, &quot;WIKI-IBM-2009-quandl.csv&quot;)</span><br><span class="line">    feed.addBarsFromCSV(&quot;ibm&quot;, &quot;WIKI-IBM-2010-quandl.csv&quot;)</span><br><span class="line">    feed.addBarsFromCSV(&quot;ibm&quot;, &quot;WIKI-IBM-2011-quandl.csv&quot;)</span><br><span class="line"></span><br><span class="line">    # Run the server.</span><br><span class="line">    server.serve(feed, parameters_generator(), &quot;localhost&quot;, 5000)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä»£ç å¤„ç†äº†ä¸‰ä¸ªäº‹æƒ…ï¼š</p>
<ol>
<li>å£°æ˜äº†ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°æ ¹æ®èŒƒå›´äº§ç”Ÿä¸åŒçš„å‚æ•°ã€‚</li>
<li>åŠ è½½csvæ–‡ä»¶åˆ°feedä¸­ã€‚</li>
<li>è¿è¡Œserverç›‘å¬5000ç«¯å£æ¥è·å–åˆ°æ¥çš„é“¾æ¥ã€‚</li>
</ol>
<p>worker è„šæœ¬ä½¿ç”¨äº† <code>pyalgotrade.optimizer.worker</code> æ¨¡å—æ¥å¹¶è¡Œè¿è¡Œç­–ç•¥ï¼Œå¹¶ä¸”ä½¿ç”¨äº†serveræä¾›çš„æ•°æ®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from pyalgotrade.optimizer import worker</span><br><span class="line">import rsi2</span><br><span class="line"></span><br><span class="line"># The if __name__ == &apos;__main__&apos; part is necessary if running on Windows.</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    worker.run(rsi2.RSI2, &quot;localhost&quot;, 5000, workerName=&quot;localworker&quot;)</span><br></pre></td></tr></table></figure>
<p><b>æ³¨æ„ä½ åº”è¯¥åœ¨ä¸€å°serverå’Œå¤§äºç­‰äºä¸€ä¸ªworkerçš„æƒ…å†µä¸‹è¿è¡Œ</b><br>å¦‚æœä½ åªæ˜¯æƒ³è¦åœ¨ä½ çš„å°å¼æœºä¸Šå¹¶å‘è¿è¡Œç­–ç•¥ï¼Œé‚£ä¹ˆå¯ä»¥åˆ©ç”¨<code>pyalgotrade.optimizer.local</code>æ¨¡å—æ¥å¤„ç†å¦‚ä¸‹ï¼š  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import itertools</span><br><span class="line">from pyalgotrade.optimizer import local</span><br><span class="line">from pyalgotrade.barfeed import quandlfeed</span><br><span class="line">import rsi2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def parameters_generator():</span><br><span class="line">    instrument = [&quot;ibm&quot;]</span><br><span class="line">    entrySMA = range(150, 251)</span><br><span class="line">    exitSMA = range(5, 16)</span><br><span class="line">    rsiPeriod = range(2, 11)</span><br><span class="line">    overBoughtThreshold = range(75, 96)</span><br><span class="line">    overSoldThreshold = range(5, 26)</span><br><span class="line">    return itertools.product(instrument, entrySMA, exitSMA, rsiPeriod, overBoughtThreshold, overSoldThreshold)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># The if __name__ == &apos;__main__&apos; part is necessary if running on Windows.</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    # Load the bar feed from the CSV files.</span><br><span class="line">    feed = quandlfeed.Feed()</span><br><span class="line">    feed.addBarsFromCSV(&quot;ibm&quot;, &quot;WIKI-IBM-2009-quandl.csv&quot;)</span><br><span class="line">    feed.addBarsFromCSV(&quot;ibm&quot;, &quot;WIKI-IBM-2010-quandl.csv&quot;)</span><br><span class="line">    feed.addBarsFromCSV(&quot;ibm&quot;, &quot;WIKI-IBM-2011-quandl.csv&quot;)</span><br><span class="line"></span><br><span class="line">    local.run(rsi2.RSI2, feed, parameters_generator())</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç åšäº†3ä»¶äº‹æƒ…ï¼š</p>
<ol>
<li>å£°æ˜äº†ä¸€ä¸ªç”Ÿæˆå‡½æ•°ç”¨æ¥äº§å‡ºä¸åŒçš„å‚æ•°ç»„åˆ</li>
<li>ä»csvä¸­åŠ è½½åˆ°feedä¸­</li>
<li>ä½¿ç”¨<code>pyalgotrade.optimizer.local</code>æ¥å¹¶å‘è¿è¡Œç­–ç•¥ï¼Œå¹¶ä¸”æ‰¾åˆ°æœ€å¥½çš„ç»„åˆã€‚  </li>
</ol>
<p>ä¸Šé¢ä¸€æ®µå¹¶å‘çš„æ¼”ç¤ºè¯´æ˜å¦‚æœæˆ‘æƒ³è¦å¹¶å‘è¿è¡Œï¼Œä¹Ÿè®¸æˆ‘éœ€è¦çœ‹çœ‹ï¼š  </p>
<pre><code>#å•æœºæœ¬åœ°å¹¶å‘ä»£ç 
from pyalgotrade.optimizer import local
local.run(rsi2.RSI2, feed, parameters_generator())
#å¤šå°æœºå™¨å¹¶å‘çš„ä»£ç 
from pyalgotrade.optimizer import worker
worker.run(rsi2.RSI2, &quot;localhost&quot;, 5000, workerName=&quot;localworker&quot;)
</code></pre><p><b>ä»¥åŠè¯´æ˜pyalgotradeçš„ä¼˜åŒ–éƒ¨åˆ†åº”è¯¥æ˜¯åˆ©ç”¨äº†å¹¶å‘æ¥åŠ é€Ÿã€‚</b><br>å¯¹äºæˆ‘è‡ªå·±çš„å¤„ç†ï¼Œå¯ä»¥è€ƒè™‘åŠ å…¥PSO ä¼˜åŒ–ç”¨äºå¤„ç†ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.sevenpan.com/2018/10/17/Somethings About Pyalgotrade/" data-id="cjnctr01p0007tirry0n8wtgs" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Algotrading-pyalgotrade/">Algotrading, pyalgotrade</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hexoWithGit" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/13/hexoWithGit/" class="article-date">
  <time datetime="2018-10-13T14:18:38.000Z" itemprop="datePublished">2018-10-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/13/hexoWithGit/">Hexo With Git</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="server"><a href="#server" class="headerlink" title="server"></a>server</h2><p>ç¯å¢ƒï¼š  </p>
<pre><code>ubuntu 16.01LTS
</code></pre><p><b>nginx:</b><br>å®‰è£… nginxï¼š</p>
<pre><code>sudo apt-get update
sudo apt-get install nginx
</code></pre><p>é…ç½®ï¼š  </p>
<pre><code>/etc/nginx/nginx.conf
....
server {
          listen       80 default_server;
          listen       [::]:80 default_server;
          server_name  blog.example.com; # å¡«å†™ä¸ªäººåŸŸå
          root         /home/where/your/blog/hexo;
  }    
  .....
</code></pre><p>/etc/nginx/sites-enabled ä¸­æœ‰ä¸€ä¸ªdefaultæ–‡ä»¶ï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥åˆ é™¤ï¼Œå¦åˆ™å¯åŠ¨nginxçš„æ—¶å€™ä¼šæŠ¥ç«¯å£å†²çªã€‚<br>å¯åŠ¨nginxï¼š</p>
<pre><code>sudo nginx -t
sudo systemctl reload nginx.service
</code></pre><p><b>git:</b><br>    æœ¬éƒ¨åˆ†ä¸€å¤§æ®µæ¥è‡ªï¼š<a href="https://www.jianshu.com/p/e03e363713f9" target="_blank" rel="noopener">https://www.jianshu.com/p/e03e363713f9</a><br>    å®‰è£… gitï¼š</p>
<pre><code>sudo apt-get install git-core
mkdir -p /home/git/blog/hexo.git #Gitä»“åº“ï¼Œä¸å­˜å‚¨ç½‘ç«™æ–‡ä»¶
mkdir /home/git/blog/hexo #å®é™…å­˜å‚¨ç½‘ç«™æ–‡ä»¶ç›®å½•
</code></pre><p>åˆå§‹åŒ–ç©ºçš„Gitä»“åº“ï¼š</p>
<pre><code>git init --bare /home/git/blog/hexo.git
</code></pre><p>è¿›å…¥è¯¥ä»“åº“ï¼Œé…ç½®post-update hooksï¼ˆæœ‰çš„å¯èƒ½æ˜¯post-receiveï¼‰ï¼š</p>
<pre><code>cd /home/git/blog/hexo.git/hooks
sudo nano /home/git/blog/hexo.git/hooks/post-update.sample        
git --work-tree=/home/git/blog/hexo --git-dir=/home/git/blog/hexo.git checkout -f
chmod +x post-update
</code></pre><h2 id="local"><a href="#local" class="headerlink" title="local"></a>local</h2><p>æœ¬æœºè®¾ç½®<br>å®‰è£…hexoç›¸å…³ï¼š</p>
<pre><code>npm install hexo-cli hexo-server hexo-deployer-git -g
</code></pre><p>å®‰è£…å®Œæˆåï¼Œåˆå§‹åŒ–ï¼š</p>
<pre><code>hexo init ~/myBlog
</code></pre><p>ä¿®æ”¹hexoçš„é…ç½®å¯ä»¥å‚è€ƒï¼š<a href="https://hexo.io/docs/configuration" target="_blank" rel="noopener">https://hexo.io/docs/configuration</a><br>å…¶ä¸­ deployéƒ¨åˆ†éœ€è¦ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<pre><code>deploy:     //å‘å¸ƒå¯¹åº”çš„githubè´¦å·
type: git
repo: user@remoteServer:/home/git/blog/hexo  //ç”¨æˆ·å@åŸŸåæˆ– IP åœ°å€:/home/git/blog/hexo
branch: master
</code></pre><p>ç„¶åè¿˜æœ‰ä¸€ç‚¹ï¼Œéœ€è¦ssh-copy-key å°†è‡ªå·±çš„å…¬é’¥æ‹·è´åˆ°è¿œç¨‹æœºå™¨ä¸Šï¼Œè¿™æ ·å¯ä»¥æ— éœ€å¯†ç è®¿é—®ï¼Œå…·ä½“è¯·è‡ªè¡Œæœç´¢ä¸‹ã€‚</p>
<p>å®Œæˆä»¥ä¸Šä¹‹åï¼Œéƒ¨ç½²ä¸‰æ¡å‘½ä»¤ï¼š</p>
<pre><code>hexo clean
hexo generate
hexo deploy
</code></pre><h2 id="åŸŸåè½¬æ¢"><a href="#åŸŸåè½¬æ¢" class="headerlink" title="åŸŸåè½¬æ¢"></a>åŸŸåè½¬æ¢</h2><p>å¦‚æœæœ‰è‡ªå·±çš„åŸŸåï¼Œå¯ä»¥åœ¨è‡ªå·±çš„åŸŸåæœåŠ¡å•†ä¸Šè¿›è¡Œè®¾ç½®ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥è®¿é—®åŸŸåäº†ã€‚<br>æ¯”å¦‚æˆ‘è¿™ä¸ªæ˜¯åœ¨name    ä¸Šï¼Œè¿›å…¥<a href="https://www.name.com/zh-cn/account/domain/details/sevenpan.com#dns" target="_blank" rel="noopener">DNS</a>è®¾ç½®è‡ªå·±çš„ipå°±å¯ä»¥è¿›è¡Œè½¬å‘äº†ã€‚</p>
<h2 id="Reference-Link"><a href="#Reference-Link" class="headerlink" title="Reference Link"></a>Reference Link</h2><p>Hexo: <a href="https://hexo.io/docs/" target="_blank" rel="noopener">https://hexo.io/docs/</a><br>nginx install :    <a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-16-04" target="_blank" rel="noopener">https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-16-04</a><br><a href="https://websiteforstudents.com/migrate-nginx-root-directory-on-ubuntu-17-04-17-10/" target="_blank" rel="noopener">https://websiteforstudents.com/migrate-nginx-root-directory-on-ubuntu-17-04-17-10/</a><br>name.com åŸŸåè§£æï¼š<a href="http://www.webgou.info/content/netusage/453/" target="_blank" rel="noopener">http://www.webgou.info/content/netusage/453/</a><br>ä¸»è¦å‚è€ƒçš„ä¸¤ä¸ªç½‘é¡µï¼š<br><a href="https://segmentfault.com/a/1190000010680022" target="_blank" rel="noopener">https://segmentfault.com/a/1190000010680022</a><br><a href="https://www.jianshu.com/p/e03e363713f9" target="_blank" rel="noopener">https://www.jianshu.com/p/e03e363713f9</a>  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.sevenpan.com/2018/10/13/hexoWithGit/" data-id="cjnctr01l0005tirrs2mmps93" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo-git-nginx/">hexo,git,nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Shuffle_ç¿»è¯‘è‡ªspark_programming_guideline" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/23/Shuffle_ç¿»è¯‘è‡ªspark_programming_guideline/" class="article-date">
  <time datetime="2018-04-23T10:17:04.000Z" itemprop="datePublished">2018-04-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/23/Shuffle_ç¿»è¯‘è‡ªspark_programming_guideline/">Spark Programming--- Shuffle Operations ç¿»è¯‘</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Spark-Programmingâ€”-Shuffle-operations"><a href="#Spark-Programmingâ€”-Shuffle-operations" class="headerlink" title="Spark Programmingâ€” Shuffle operations"></a>Spark Programmingâ€” Shuffle operations</h1><p>original: <a href="http://spark.apache.org/docs/latest/rdd-programming-guide.html#shuffle-operations" target="_blank" rel="noopener">http://spark.apache.org/docs/latest/rdd-programming-guide.html#shuffle-operations</a></p>
<p>ä¸€äº›sparkçš„ç‰¹å®šæ“ä½œå°†ä¼šè§¦å‘è¢«ç§°ä¸ºshuffleçš„äº‹ä»¶ã€‚Shuffleæ˜¯Sparkç”¨äºé‡æ–°åˆ†å¸ƒæ•°æ®çš„æœºåˆ¶ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸åŒçš„åˆ†åŒºæ¥åˆ†ç»„ã€‚è¿™é€šå¸¸æ¶‰åŠåˆ°åœ¨executorå’Œæœºå™¨ä¹‹é—´è¿›è¡Œæ‹·è´æ•°æ®ï¼Œæ‰€ä»¥shuffleæ˜¯ä¸€ä¸ªå¾ˆå¤æ‚å¹¶ä¸”æ¶ˆè€—é«˜çš„æ“ä½œã€‚  </p>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¸ºäº†äº†è§£shuffleæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘reduceByKeyæ“ä½œä½œä¸ºä¾‹å­ã€‚reduceByKeyæ“ä½œç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„RDDé€šè¿‡æ‰€æœ‰çš„å•ä¸ªé”®å€¼ç»„åˆä¸ºä¸€ä¸ªå…ƒç»„-å…³é”®å­—å’Œé’ˆå¯¹ä¸è¯¥å…³é”®å­—ç›¸å…³çš„æ‰€æœ‰å€¼æ‰§è¡Œreduceå‡½æ•°çš„ç»“æœã€‚è¿™é‡Œçš„æŒ‘æˆ˜ä¸æ˜¯æ‰€æœ‰çš„å€¼å¯¹ä¸€ä¸ªå•ç‹¬çš„é”®éƒ½åœ¨åŒä¸€ä¸ªåˆ†åŒºä¸Šæˆ–è€…ç”šè‡³è¯´åœ¨ä¸€å°æœºå™¨ä¸Šï¼Œè€Œæ˜¯å®ƒä»¬å¿…é¡»è¢«é‡æ–°åˆ†å¸ƒæ¥è®¡ç®—ç»“æœã€‚<br>åœ¨Sparkï¼Œæ•°æ®é€šå¸¸ä¸ä¼šè·¨åˆ†åŒºåˆ†å¸ƒåˆ°ç‰¹å®šæ“ä½œçš„å¿…è¦ä½ç½®ã€‚åœ¨è®¡ç®—ä¸­ï¼Œä¸€ä¸ªå•ç‹¬çš„ä»»åŠ¡å°†ä¼šåœ¨ä¸€ä¸ªå•ç‹¬çš„åˆ†åŒºä¸Šæ“ä½œ-ç„¶è€Œä¸ºäº†ç»„ç»‡æ‰€æœ‰çš„æ•°æ®æ¥è¢«ä¸€ä¸ªçš„å•ç‹¬reduceByKey çš„reduceä»»åŠ¡æ¥æ‰§è¡Œï¼ŒSparkéœ€è¦æ¥æ‰§è¡Œä¸€ä¸ªall-to-allæ“ä½œã€‚å®ƒå¿…é¡»è¯»å–æ‰€æœ‰åˆ†åŒºæ¥æ‰¾åˆ°æ‰€æœ‰é”®çš„å€¼ï¼Œç„¶åå°†å®ƒä»¬å¸¦åˆ°ä¸€èµ·è·¨åˆ†åŒºæ¥ä¸ºæ¯ä¸€ä¸ªé”®è®¡ç®—æœ€ç»ˆçš„ç»“æœâ€”è¿™ä¸ªè¢«ç§°ä¸ºshuffleã€‚<br>å°½ç®¡åœ¨æ¯ä¸€ä¸ªåˆ†åŒºä¸­çš„æ–°çš„shuffledæ•°æ®çš„å…ƒç´ é›†æ˜¯å¾ˆé‡è¦çš„ï¼ŒåŒæ ·åˆ†åŒºè‡ªå·±çš„é¡ºåºä¹Ÿå¾ˆé‡è¦ï¼Œè€Œå…ƒç´ ä¹‹é—´çš„é¡ºåºå°±ä¸æ˜¯äº†ã€‚å¦‚æœä¸€ä¸ªæƒ³è¦é¢„æµ‹shuffleä¸­çš„é¡ºåºæ•°æ®é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ï¼š  </p>
<ol>
<li>mapPartitions æ¥æ’åºæ¯ä¸€ä¸ªåˆ†åŒºï¼Œæ¯”å¦‚ï¼Œ.sorted</li>
<li>repartitionAndSortWithinPartitions æ¥æœ‰æ•ˆåˆ†åŒºåŒæ—¶åŒæ­¥é‡æ–°åˆ†åŒºã€‚  </li>
<li>sortBy åˆ›é€ ä¸€ä¸ªå…¨å±€çš„æ’åºçš„RDD</li>
</ol>
<p>å¯ä»¥å¼•èµ·ä¸€ä¸ªshuffle çš„æ“ä½œåŒ…æ‹¬ï¼šrepartition å’Œ coalesce,ByKeyçš„æ“ä½œï¼Œé™¤äº†countingä¹‹å¤–çš„æ¯”å¦‚ï¼šgroupByKey å’ŒreduceByKey,ä»¥åŠjoinæ“ä½œæ¯”å¦‚cogroup å’Œ joinã€‚</p>
<h2 id="æ€§èƒ½å½±å“"><a href="#æ€§èƒ½å½±å“" class="headerlink" title="æ€§èƒ½å½±å“"></a>æ€§èƒ½å½±å“</h2><p>Shuffleæ˜¯ä¸€ä¸ªæ˜‚è´µçš„æ“ä½œå› ä¸ºå®ƒæ¶‰åŠåˆ°ç£ç›˜I/Oï¼Œæ•°æ®åºåˆ—åŒ–å’Œç½‘ç»œI/Oã€‚ä¸ºäº†ç»™shuffleç»„ç»‡æ•°æ®ï¼Œsparkç”Ÿæˆä¸€ç³»åˆ—ä»»åŠ¡-mapsç”¨äºç»„ç»‡æ•°æ®ï¼Œä»¥åŠä¸€ç³»åˆ—reduceä»»åŠ¡æ¥èšé›†å®ƒã€‚è¿™ä¸ªå‘½åç³»ç»Ÿæ¥è‡ªäºMapReduceè€Œä¸”å¹¶ä¸ç›´æ¥å’ŒSparKçš„mapï¼Œreduceæ“ä½œæœ‰å…³ã€‚<br>åœ¨å†…éƒ¨ï¼Œå•ç‹¬çš„mapä»»åŠ¡çš„ç»“æœä¼šè¢«ä¿å­˜åœ¨å†…å­˜ä¸­ç›´åˆ°å®ƒä»¬ä¸é€‚ç”¨ã€‚ç„¶åè¿™äº›ç»“æœä¼šè¢«æ ¹æ®ç›®æ ‡åˆ†åŒºæ’åºå¹¶ä¸”å†™å‘å•ä¸€çš„æ–‡ä»¶ã€‚åœ¨reduceæ–¹é¢ï¼Œä»»åŠ¡è¯»å–ç›¸å…³çš„æ’åºå—ã€‚<br>ä¸€å®šçš„shuffleæ“ä½œä¼šæ¶ˆè€—æ˜æ˜¾çš„æ•°é‡çš„å †å†…å­˜å› ä¸ºå®ƒä»¬ä½¿ç”¨çš„æ˜¯åœ¨å†…å­˜ä¸­çš„æ•°æ®ç»“æ„æ¥ç»„ç»‡è®°å½•åœ¨ä¼ è¾“ä¹‹å‰æˆ–è€…ä¹‹åã€‚æ˜æ˜¾çš„ï¼ŒreduceByKeyå’ŒAggregateByKeyåˆ›é€ äº†è¿™äº›ç»“æ„åœ¨mapé˜¶æ®µï¼Œä»¥åŠ â€˜Bykeyçš„æ“ä½œç”Ÿæˆäº†å®ƒä»¬åœ¨reduceé˜¶æ®µã€‚å½“æ•°æ®ä¸èƒ½æ”¾è¿›å†…å­˜ä¸­æ—¶ï¼ŒSparkå°†ä¼šå°†è¿™äº›è¡¨æ•£è½åˆ°ç¡¬ç›˜ä¸­ï¼Œä¼šå¼•èµ·è€Œå¤–çš„ç£ç›˜I/Oå’Œå¢åŠ åƒåœ¾å›æ”¶æ¬¡æ•°ã€‚<br>ShuffleåŒæ ·ä¼šç”Ÿæˆå¤§é‡çš„ä¸­é—´æ–‡ä»¶åœ¨ç£ç›˜ä¸­ã€‚ä»Spark1.3å¼€å§‹ï¼Œè¿™äº›æ–‡ä»¶è¢«ä¿å­˜ç›´åˆ°å¯¹åº”çš„RDDsä¸å†è¢«ä½¿ç”¨ä»¥åŠå·²ç»è¢«åƒåœ¾å›æ”¶äº†ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†shuffleæ–‡ä»¶ä¸éœ€è¦è¢«é‡æ–°åˆ›é€ å¦‚æœlineageè¢«é‡æ–°è®¡ç®—æ—¶ã€‚åƒåœ¾å›æ”¶ä¹Ÿè®¸ä¼šå‘ç”Ÿåªæœ‰åœ¨ä¸€æ®µå¾ˆé•¿æ—¶é—´ï¼Œå¦‚æœè¿™ä¸ªåº”ç”¨ä¿ç•™äº†å¯¹RDDçš„å¼•ç”¨æˆ–è€…å¦‚æœGCæ²¡æœ‰é¢‘ç¹çš„å‘ç”Ÿã€‚è¿™æ„å‘³ç€é•¿æœŸè¿è¡Œçš„sparkä»»åŠ¡ä¹Ÿè®¸ä¼šæ¶ˆè€—å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚è¿™ä¸ªé›¶æ—¶çš„ç£ç›˜ç›®å½•ä¼šè¢«spark.local.dirå‚æ•°æ‰€æŒ‡å®šã€‚<br>Shuffleè¡Œä¸ºå¯ä»¥è¢«è°ƒæ•´é€šè¿‡ä¸€ç³»åˆ—çš„å‚æ•°ã€‚å¯ä»¥å‚è€ƒ<a href="http://spark.apache.org/docs/latest/configuration.html#shuffle-behavior" target="_blank" rel="noopener"> Spark Configuration Guide.</a>â€˜Shuffle Behaviorâ€™ç« èŠ‚ã€‚</p>
<h2 id="Shuffle-Behavior"><a href="#Shuffle-Behavior" class="headerlink" title="Shuffle Behavior"></a>Shuffle Behavior</h2><table>
<thead>
<tr>
<th>å±æ€§åç§°Property Name</th>
<th>é»˜è®¤å€¼Default</th>
<th>å«ä¹‰Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>spark.reducer.maxSizeInFlight</td>
<td>48m</td>
<td>ä»æ¯ä¸€ä¸ªreduceä»»åŠ¡ä¸­åŒæ­¥è·å–çš„mapè¾“å‡ºçš„æœ€å¤§å€¼ã€‚ç”±äºæ¯ä¸€ä¸ªè¾“å‡ºéœ€è¦æˆ‘ä»¬åˆ›é€ ä¸€ä¸ªç¼“å­˜æ¥æ¥å—å®ƒï¼Œè¿™ä¸ªä»£è¡¨äº†æ¯ä¸ªä»»åŠ¡çš„å›ºå®šçš„å†…å­˜å¼€é”€ï¼Œæ‰€ä»¥å°½é‡ä¿è¯å®ƒè¾ƒå°é™¤éä½ æœ‰å¾ˆå¤šå†…å­˜ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.reducer.maxReqsInFlight</td>
<td>Int.MaxValue</td>
<td>è¿™ä¸ªé…ç½®é™åˆ¶äº†ä»»æ„ç»™å®šç‚¹è¿œç¨‹è¯·æ±‚è·å–å—æ•°ã€‚å½“é›†ç¾¤ä¸­çš„ä¸»æœºæ•°é‡å¢åŠ çš„æ—¶å€™ï¼Œå®ƒä¹Ÿè®¸ä¼šå¯¼è‡´ä¸€ä¸ªéå¸¸å¤§æ•°é‡çš„å†…éƒ¨è¿æ¥åˆ°ä¸€åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œå¼•èµ·workeråœ¨è´Ÿè½½ä¸‹å¤±è´¥ã€‚é€šè¿‡å…è®¸å®ƒæ¥é™åˆ¶è·å–è¯·æ±‚çš„æ•°é‡ï¼Œè¿™ä¸ªæƒ…å†µä¹Ÿè®¸ä¼šç¼“è§£</td>
<td></td>
</tr>
<tr>
<td>spark.reducer.maxBlocksInFlightPerAddress</td>
<td>Int.MaxValue</td>
<td>è¿™ä¸ªé…ç½®é™åˆ¶äº†æ¯ä¸€ä¸ªä»ç»™å®šç«¯å£é‡Œçš„çš„reduceä»»åŠ¡å¯ä»¥è·å–çš„è¿œç¨‹ç«¯å£æ•°é‡ã€‚å½“ä¸€ä¸ªå¤§é‡çš„blockè¢«ä¸€ä¸ªç»™å®šçš„åœ°å€åœ¨ä¸€æ¬¡å•ç‹¬è·å–æˆ–è€…åŒæ­¥è·å–æ‰€è¯·æ±‚æ—¶ï¼Œå¯èƒ½ä¼šå†²å®æœåŠ¡çš„executoræˆ–è€…Node Managerã€‚è¿™ä¸ªé…ç½®å¯¹äºå‡å°‘Node Managerçš„è´Ÿè½½å°¤ä¸ºæœ‰ç”¨å½“å¤–éƒ¨çš„shuffleæ˜¯è¢«å…è®¸çš„ã€‚ä½ å¯ä»¥é€šè¿‡è®¾å®šä¸€ä¸ªè¾ƒä½å€¼æ¥å‡è½»è¿™ä¸ªæƒ…å†µã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.maxRemoteBlockSizeFetchToMem</td>
<td>Long.MaxValue</td>
<td>è¿œç¨‹çš„å—å°†ä¼šè¢«è·å–åˆ°ç£ç›˜ä¸­ï¼Œå½“è¿™ä¸ªå—çš„å¤§å°è¶…è¿‡äº†è¿™ä¸ªé…ç½®çš„å€¼åœ¨byteå•ä½ä¸Šã€‚è¿™ä¸ªç”¨äºé¿å…ä¸€ä¸ªå·¨å¤§çš„è¯·æ±‚å æ®äº†å¤ªå¤šçš„å†…å­˜ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªé…ç½®ä¸ºä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼ˆæ¯”å¦‚ï¼Œ200Mï¼‰ã€‚æ³¨æ„åˆ°è¿™ä¸ªé…ç½®å°†ä¼šå½±å“åˆ°shuffleçš„è·å–ä»¥åŠè¿œç¨‹å—è·å–çš„å—ç®¡ç†ã€‚å¯¹äºå…è®¸äº†å¤–éƒ¨shuffleæœåŠ¡çš„ç”¨æˆ·ï¼Œè¿™ä¸ªç‰¹æ€§åªä¼šåœ¨å¤–éƒ¨shuffleæœåŠ¡ç‰ˆæœ¬é«˜äºSpark2ã€‚2æ—¶æœ‰æ•ˆã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.compress</td>
<td>true</td>
<td>æ˜¯å¦å‹ç¼©mapçš„è¾“å‡ºæ–‡ä»¶ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå¥½æƒ³æ³•ã€‚å‹ç¼©å°†ä¼šä½¿ç”¨spark.io.compression.codec.</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.file.buffer</td>
<td>32k</td>
<td>å¯¹æ¯ä¸€ä¸ªshuffleæ–‡ä»¶è¾“å‡ºæµçš„åœ¨å†…å­˜ä¸­çš„ç¼“å­˜å¤§å°ï¼Œå•ä½æ˜¯KiBé™¤éæœ‰å…¶ä»–çš„ç‰¹åˆ«æŒ‡å®šã€‚è¿™äº›ç¼“å­˜å‡å°‘äº†ç¡¬ç›˜æŸ¥æ‰¾å’Œç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸­é—´shuffleæ–‡ä»¶çš„è¿‡ç¨‹ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.io.maxRetries</td>
<td>3</td>
<td>(Netty only)æœ€å¤§è‡ªåŠ¨é‡å¤å°è¯•çš„æ¬¡æ•°å¦‚æœè¿™ä¸ªå€¼æ²¡æœ‰è¢«è®¾ç½®ä¸º0.è¿™ä¸ªé‡è¯•é€»è¾‘æœ‰åŠ©äºç¨³å®šå¤§å‹çš„shuffleåœ¨é•¿æ—¶é—´çš„GCæš‚åœæˆ–è€…æš‚æ—¶çš„ç½‘ç»œè¿æ¥é—®é¢˜ä¸Šã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.io.numConnectionsPerPeer</td>
<td>1</td>
<td>(Netty only) èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥çš„é‡å¤ä½¿ç”¨ä¸ºäº†å‡å°‘å¤§å‹é›†ç¾¤ä¸­é‡å¤å»ºç«‹è¿æ¥çš„æƒ…å†µã€‚å¯¹äºæœ‰å¾ˆå¤šç¡¬ç›˜å’Œå¾ˆå°‘ä¸»æœºçš„é›†ç¾¤ï¼Œè¿™ä¸ªå°†ä¼šå¯¼è‡´å¹¶å‘è¡Œä¸è¶³ä»¥é¥±å’Œæ‰€æœ‰ç¡¬ç›˜ï¼Œå› æ­¤ç”¨æˆ·å¯èƒ½ä¼šè€ƒè™‘å¢åŠ è¿™ä¸ªå€¼ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.io.preferDirectBufs</td>
<td>true</td>
<td>(Netty only) å †å¤–ç¼“å†²åŒºåœ¨shuffleå’Œç¼“å­˜å—è½¬ç§»æœŸé—´è¢«ç”¨äºå‡å°‘åƒåœ¾å›æ”¶ã€‚å¯¹äºå¯¹å¤–ç¼“å­˜å†…å­˜æ•°é‡æœ‰é™çš„ç¯å¢ƒï¼Œç”¨æˆ·ä¹Ÿè®¸æƒ³è¦å…³æ‰è¿™ä¸ªæ¥å¼ºè¿«æ‰€æœ‰çš„æ¥è‡ªäºNettyçš„åˆ†é…éƒ½æ˜¯åœ¨å †ä¸Šã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.io.retryWait</td>
<td>5s</td>
<td>(Netty only) åœ¨æ¯ä¸€æ¬¡é‡è¯•ç›´æ¥éœ€è¦ç­‰å¾…å¤šä¹…ã€‚æœ€å¤§çš„å»¶è¿Ÿæ—¶é—´é»˜è®¤æ˜¯15ç§’ï¼ŒmaxRetries * retryWait.</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.service.enabled</td>
<td>false</td>
<td>å…è®¸å¤–éƒ¨shuffleæœåŠ¡ã€‚è¿™ä¸ªæœåŠ¡ä¿å­˜äº†é€šè¿‡executoræ‰€å†™çš„shuffleæ–‡ä»¶ï¼Œè¿™æ ·è¿™ä¸ªexecutorå¯ä»¥å®‰å…¨çš„è¢«ç§»é™¤ã€‚è¿™ä¸ªé…ç½®å¿…é¡»è¢«å…è®¸å¦‚æœspark.dynamicAllocation.enabledæ˜¯â€œtrueâ€ã€‚è¿™ä¸ªå¤–éƒ¨çš„shuffleæœåŠ¡å¿…é¡»è¢«å¯åŠ¨ã€‚æŸ¥çœ‹<a href="http://spark.apache.org/docs/latest/job-scheduling.html#configuration-and-setup" target="_blank" rel="noopener">dynamic allocation configuration and setup documentation </a>æ¥è·å¾—æ›´å¤šä¿¡æ¯ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.service.port</td>
<td>7337</td>
<td>å¤–éƒ¨shuffleæœåŠ¡å°†ä¼šè¿è¡Œçš„ç«¯å£ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.service.index.cache.size</td>
<td>100m</td>
<td>ç¼“å­˜æ¡ç›®é™åˆ¶åœ¨æŒ‡å®šçš„å†…å­˜å ç”¨ç©ºé—´ä¸­ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.maxChunksBeingTransferred</td>
<td>Long.MAX_VALUE</td>
<td>åœ¨shuffleæœåŠ¡ä¸­åŒä¸€æ—¶é—´æœ€å¤§å…è®¸ä¼ è¾“çš„å—æ•°é‡ã€‚æ³¨æ„åˆ°æ–°æ¥çš„è¿æ¥å°†ä¼šè¢«å…³é—­å¦‚æœè¾¾åˆ°äº†æœ€å¤§æ•°é‡ã€‚è¿™ä¸ªå®¢æˆ·ç«¯å°†ä¼šå°è¯•é‡æ–°è¿æ¥æ ¹æ®shuffleçš„é‡è¯•é…ç½®ï¼ˆsee spark.shuffle.io.maxRetries and spark.shuffle.io.retryWaitï¼‰ï¼Œå¦‚æœè¿™ä¸ªé™åˆ¶ä¹Ÿè¢«è¾¾åˆ°äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡å°†ä¼šå¤±è´¥ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.sort.bypassMergeThreshold</td>
<td>200</td>
<td>(Advanced)åœ¨åŸºäºæ’åºçš„shuffleç®¡ç†ä¸­ï¼Œé¿å…åˆå¹¶æ’åºæ•°æ®å¦‚æœè¿™é‡Œæ²¡æœ‰map-sideçš„èšåˆå’Œè¿™é‡Œæœ€å¤šæœ‰é…ç½®çš„è¿™ä¹ˆå¤šçš„reduceåˆ†åŒºã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.spill.compress</td>
<td>true</td>
<td>æ˜¯å¦å‹ç¼©æº¢å‡ºçš„æ•°æ®åœ¨shuffleæœŸé—´</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.accurateBlockThreshold</td>
<td>100 <em> 1024 </em> 1024</td>
<td>é˜€å€¼æ˜¯ä»¥bytesä¸ºå•ä½ï¼Œé«˜äºæ­¤å€¼å°†å‡†ç¡®è®°å½•HighlyCompressedMapStatusä¸­çš„shuffleå—çš„å¤§å°ã€‚è¿™ä¸ªç”¨äºå¸®åŠ©é˜»æ­¢OOMé€šè¿‡é¿å…é”™è¯¯ä¼°è®¡äº†shuffleå—å¤§å°å½“è·å–äº†shuffleå—æ—¶ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.registration.timeout</td>
<td>5000</td>
<td>æ³¨å†Œå¤–éƒ¨shuffleæœåŠ¡çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.registration.maxAttempts</td>
<td>3</td>
<td>å½“æ³¨å†Œå¤–éƒ¨shuffleæœåŠ¡å¤±è´¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šé‡å¤å°è¯•çš„æœ€å¤§æ¬¡æ•°</td>
<td></td>
</tr>
<tr>
<td>spark.io.encryption.enabled</td>
<td>false</td>
<td>å…è®¸IOç¼–ç ã€‚ç›®å‰æ”¯æŒæ‰€æœ‰çš„æ¨¡å¼é™¤äº†Mesosã€‚å½“ä½¿ç”¨è¿™ä¸ªç‰¹æ€§çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ¨èRPCç¼–ç ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.io.encryption.keySizeBits</td>
<td>128</td>
<td>IOç¼–ç çš„å€¼å¤§å°å•ä½ä¸ºbitã€‚æ”¯æŒçš„å€¼æœ‰128ï¼Œ192å’Œ256.</td>
<td></td>
</tr>
<tr>
<td>spark.io.encryption.keygen.algorithm</td>
<td>HmacSHA1</td>
<td>å½“ç”Ÿæˆä¸€ä¸ªIOç¼–ç é”®å€¼æ—¶ä½¿ç”¨çš„ç®—æ³•ã€‚è¢«æ”¯æŒçš„ç®—æ³•åœ¨Java Cryptography Architecture Standard Algorithm Name æ–‡æ¡£çš„KeyGeneratorç« èŠ‚ä¸­è¢«æè¿°ã€‚</td>
<td></td>
</tr>
</tbody>
</table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.sevenpan.com/2018/04/23/Shuffle_ç¿»è¯‘è‡ªspark_programming_guideline/" data-id="cjnctr01f0003tirr0o0g5h5i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Distributed Training- Gradients Sharing" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/20/Distributed Training- Gradients Sharing/" class="article-date">
  <time datetime="2018-04-20T06:30:54.000Z" itemprop="datePublished">2018-04-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/20/Distributed Training- Gradients Sharing/">Distributed Training_Gradients Sharing ç¿»è¯‘</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Distributed-Training-Gradients-Sharing"><a href="#Distributed-Training-Gradients-Sharing" class="headerlink" title="Distributed Training: Gradients Sharing"></a>Distributed Training: Gradients Sharing</h1><p>from:<a href="https://deeplearning4j.org/distributed" target="_blank" rel="noopener">https://deeplearning4j.org/distributed</a></p>
<p>ä»0.9.1å¼€å§‹ï¼ŒDeeplearning4jæ”¯æŒåœ¨Apache Sparkç¯å¢ƒä¸­çš„åˆ†å¸ƒå¼è®­ç»ƒï¼Œä»¥åŠAeronä½œä¸ºsparkä¹‹å¤–çš„é«˜æ€§èƒ½å†…éƒ¨èŠ‚ç‚¹é€šè®¯ã€‚<br>è¿™ä¸ªæƒ³æ³•å¾ˆç®€å•ï¼šç‹¬ç«‹çš„workeråœ¨ä»–ä»¬çš„æ•°æ®é›†ä¸Šè®¡ç®—æ¢¯åº¦ã€‚<br>åœ¨æ¢¯åº¦è¢«ä½¿ç”¨åˆ°ç½‘ç»œæƒé‡ä¸Šçš„æ—¶å€™ï¼Œå®ƒä»¬åœ¨ä¸€ä¸ªä¸­é—´å­˜å‚¨æœºåˆ¶ä¸Šè¢«èšé›†ï¼ˆä¸€ä¸ªæœºå™¨ä¸€ä¸ªï¼‰ã€‚<br>åœ¨èšé›†ä¹‹åï¼Œåœ¨ä¸€äº›é…ç½®çš„é˜€å€¼åŸºç¡€ä¸Šæ›´æ–°å€¼å¹¶åœ¨ç½‘ç»œä¸Šä¼ æ’­ä½œä¸ºä¸€ä¸ªç¨€ç–äºŒè¿›åˆ¶æ•°ç»„ã€‚<br>åœ¨é˜€å€¼ä¸€ä¸‹çš„å€¼è¢«å­˜å‚¨å¹¶ä¸”æ·»åŠ å·²å¤‡æœªæ¥æ›´æ–°ï¼Œæ‰€ä»¥å®ƒä»¬æ²¡æœ‰ä¸¢å¤±ï¼Œä½†æ˜¯å¾ˆå°‘åœ¨é€šè®¯ä¸­å»¶è¿Ÿã€‚<br>è¿™ä¸ªé˜€å€¼çš„æ–¹æ³•å‡å°‘äº†ç½‘ç»œé€šè®¯éœ€æ±‚ç›¸æ¯”äºä¹‹å‰éœ€è¦å‘é€æ•´ä¸ªå¯†åº¦æ›´æ–°æˆ–è€…å‚æ•°å‘é‡çš„æ–¹æ³•ã€‚<br>è¯¦ç»†çš„å¯ä»¥å‚è€ƒï¼š<br><a href="http://nikkostrom.com/publications/interspeech2015/strom_interspeech2015.pdf" target="_blank" rel="noopener">Strom, 2015 - Scalable Distributed DNN Training using Commodity GPU Cloud Computing</a><br><a href="https://blog.skymind.ai/" target="_blank" rel="noopener"> Distributed Deep Learning, Part 1: An Introduction to Distributed Training of Neural Networks.</a><br>ç›¸æ¯”äºä¹‹å‰ Nikko Stromæåˆ°çš„ç®—æ³•è¿™é‡Œæœ‰å¾ˆä¸€äº›æ–°çš„ä¼˜ç‚¹è¢«æ·»åŠ äº†ï¼š  </p>
<ol>
<li>å˜é‡é˜€å€¼ï¼šå¦‚æœæ›´æ–°çš„æ•°é‡è¿­ä»£æ¬¡æ•°å¤ªä½ï¼Œè¿™ä¸ªé˜€å€¼ä¼šè‡ªåŠ¨çš„å‡å°‘é€šè¿‡ä¸€ä¸ªé…ç½®çš„step valueã€‚</li>
<li>å¯†åº¦ä½å›¾ç¼–ç ï¼šå¦‚æœè¿™ä¸ªæ•°å­—æ›´æ–°å¤ªé«˜ï¼Œå¦å¤–ä¸€ç§ç¼–ç ç­–ç•¥ä¼šè¢«ä½¿ç”¨ï¼Œå°†ä¼šæä¾›ä¿è¯â€œæœ€å¤§æ•°é‡å­—èŠ‚æ•°â€ä¼ è¾“ä»»ä½•æ›´æ–°ä¿¡æ¯ã€‚  </li>
<li>å‘¨æœŸæ€§çš„ï¼Œæˆ‘ä»¬å‘é€â€œæŠ–åŠ¨â€ä¿¡æ¯ï¼Œç¼–ç ä¸€ä¸ªæ˜æ˜¾æ›´å°çš„å‘å±•ï¼Œæ¥åˆ†äº«ç›®å‰é˜€å€¼æ— æ³•è¢«å…±äº«çš„å»¶è¿Ÿæƒé‡ã€‚  </li>
</ol>
<p><img src="https://deeplearning4j.org/img/distributed.png" alt=""><br>æ³¨æ„ä½¿ç”¨sparkéœ€è¦å¼€é”€ï¼Œä¸ºäº†ç¡®å®šsparkæ˜¯å¦ä¼šå¸®åŠ©ä½ ï¼Œè€ƒè™‘ä½¿ç”¨ Performance Listenerå¹¶ä¸”æŸ¥çœ‹è¿­ä»£æ¯«ç§’çº§çš„æ—¶é—´ã€‚å¦‚æœå°äºç­‰äº150Msï¼Œsparkä¹Ÿè®¸ä¸å€¼å¾—ä½¿ç”¨ã€‚  </p>
<h2 id="é…ç½®ä½ çš„é›†ç¾¤"><a href="#é…ç½®ä½ çš„é›†ç¾¤" class="headerlink" title="é…ç½®ä½ çš„é›†ç¾¤"></a>é…ç½®ä½ çš„é›†ç¾¤</h2><p>æ‰€æœ‰ä½ éœ€è¦åšçš„å°±æ˜¯ä¸€ä¸ªspark1.Xï¼2.Xçš„é›†ç¾¤ï¼Œå¹¶ä¸”æœ€å°‘ä¸€ä¸ªå¼€æ”¾çš„UDPç«¯å£ï¼ˆå†…éƒ¨ç»‘å®šå’Œå¤–éƒ¨ç»‘å®šéƒ½éœ€è¦ï¼‰  </p>
<h3 id="é›†ç¾¤è®¾ç½®"><a href="#é›†ç¾¤è®¾ç½®" class="headerlink" title="é›†ç¾¤è®¾ç½®"></a>é›†ç¾¤è®¾ç½®</h3><p>å¦‚åŒä¸Šé¢æåˆ°çš„ï¼ŒDeepLearning4jæ”¯æŒSpark1.xå’ŒSpark2.xé›†ç¾¤ã€‚åŒæ ·ä¹Ÿéœ€è¦java 8+æ¥è¿è¡Œã€‚</p>
<h3 id="ç½‘ç»œé…ç½®"><a href="#ç½‘ç»œé…ç½®" class="headerlink" title="ç½‘ç»œé…ç½®"></a>ç½‘ç»œé…ç½®</h3><p>Masterå’ŒslaveèŠ‚ç‚¹ä¹‹é—´çš„é€šè®¯åˆ†äº«Gradienté‡åº¦ä¾èµ–UDPåè®®ã€‚å¦‚æœæ˜¯è¿è¡Œåœ¨AWSæˆ–è€…Azureä¸Šï¼Œä½ éœ€è¦å…è®¸ä¸€ä¸ªUDPç«¯å£ç”¨æ¥ä½œä¸ºå†…éƒ¨å¤–éƒ¨çš„è¿æ¥ï¼Œç„¶åä½ éœ€è¦æŒ‡å®šå¯¹åº”çš„ç«¯å£åœ¨VoidConfiguration.unicastPort(int)ä»è€Œä¼ é€’åˆ°SharedTrainingMasteræ„é€ å™¨ä¸­ã€‚<br>å¦å¤–ä¸€ä¸ªéœ€è¦è®°ä½çš„æ˜¯ï¼šå¦‚æœä½ åœ¨ä½¿ç”¨YARNï¼Œä½ éœ€è¦æŒ‡å®šç½‘ç»œæ©ç ç”¨æ¥ä½œä¸ºUDPé€šè®¯ã€‚è¿™ä¸ªå¯ä»¥ç”¨æ¥å®Œæˆé€šè¿‡ä½¿ç”¨åƒï¼šVoidConfiguration.setNetworkMask(â€œ10.1.1.0/24â€)çš„è¯­å¥ã€‚<br>ä¸€ä¸ªå¯¹äºIPåœ°å€é€‰æ‹©çš„æ‹›æ•°æ˜¯DL4J_VOID_IPç¯å¢ƒå˜é‡ã€‚åœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹è®¾ç½®è¿™ä¸ªå˜é‡ï¼ŒåŒæ—¶ä½¿ç”¨ä¸€ä¸ªæœ¬åœ°åœ°å€ç”¨äºé€šè®¯ã€‚  </p>
<h3 id="ç½‘ç»œæ©ç "><a href="#ç½‘ç»œæ©ç " class="headerlink" title="ç½‘ç»œæ©ç "></a>ç½‘ç»œæ©ç </h3><p>ç½‘ç»œæ©ç æ˜¯ä¸€ä¸ªCIDRæ¦‚å¿µï¼Œåªæ˜¯ç”¨æ¥å‘Šè¯‰è½¯ä»¶å“ªä¸€ä¸ªç½‘ç»œæ¥å£éœ€è¦ç”¨æ¥é€šè®¯ã€‚æ¯”å¦‚å¦‚æœä½ çš„é›†ç¾¤æœ‰ä¸‰ä¸ªIPåœ°å€ï¼š192.168.1.23, 192.168.1.78, 192.168.2.133ï¼Œå®ƒä»¬ç›¸åŒçš„éƒ¨åˆ†æ˜¯192.168.*ï¼Œæ‰€ä»¥ç½‘ç»œæ©ç æ˜¯ï¼š192.168.0.0/16ã€‚ä½ å¯ä»¥ä»ï¼š<a href="https://en.wikipedia.org/wiki/Subnetwork" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Subnetwork</a>è·å¾—è¯¦ç»†ä¿¡æ¯ã€‚<br>æˆ‘ä»¬åœ¨sparkè¿è¡Œåœ¨Hadoopä¸Šæ—¶ä½¿ç”¨æˆ–è€…å…¶ä»–æ²¡æœ‰å‡è®¾Spark IPåœ°å€è¢«é€šçŸ¥çš„ç¯å¢ƒã€‚åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œåˆæ³•çš„ç½‘ç»œæ©ç åº”è¯¥åœ¨VoidConfigurationä¸­æä¾›ï¼ŒåŒæ—¶è¢«ç”¨æ¥é€‰æ‹©æ¥å£ä½œä¸ºSparkå¤–é¢çš„é€šè®¯ã€‚  </p>
<h3 id="Effective-Scalability"><a href="#Effective-Scalability" class="headerlink" title="Effective Scalability"></a>Effective Scalability</h3><p>The longer the original iteration time, the less relative impact will come from sharing, and the better hypothetical scalability you will get.</p>
<p>åŸå§‹è¿­ä»£æ—¶é—´è¶Šé•¿ï¼Œå…±äº«äº§ç”Ÿçš„ç›¸å¯¹å½±å“å°±è¶Šå°ï¼Œå¹¶ä¸”æ‚¨å°†è·å¾—æ›´å¥½çš„å‡è®¾å¯ä¼¸ç¼©æ€§ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.sevenpan.com/2018/04/20/Distributed Training- Gradients Sharing/" data-id="cjnctr0180000tirr69vmexvn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Deep Learning on Apache Spark" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/15/Deep Learning on Apache Spark/" class="article-date">
  <time datetime="2018-04-15T04:41:12.000Z" itemprop="datePublished">2018-04-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/15/Deep Learning on Apache Spark/">Deep Learning on Apache Spark ç¿»è¯‘</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Deep-Learning-on-Apache-Spark"><a href="#Deep-Learning-on-Apache-Spark" class="headerlink" title="Deep Learning on Apache Spark"></a>Deep Learning on Apache Spark</h1><p>ç¿»è¯‘è‡ªï¼š<a href="https://deeplearning4j.org/spark#locality" target="_blank" rel="noopener">https://deeplearning4j.org/spark#locality</a><br>Deep learning æ˜¯è®¡ç®—å¯†é›†çš„ï¼Œæ‰€ä»¥æœ‰éå¸¸å¤§çš„æ•°æ®ï¼Œè®¡ç®—é€Ÿåº¦ã€‚ä½ å¯ä»¥å¤„ç†è¿™ä¸ªé—®é¢˜ä½¿ç”¨å¾ˆå¿«çš„ç¡¬ä»¶ï¼Œé€šå¸¸æ˜¯GPU,ä¼˜åŒ–ä»£ç å’Œä¸€äº›å½¢å¼çš„å¹¶è¡Œã€‚<br>æ•°æ®å¹¶è¡Œæ€§ä½¿å¤§å‹æ•°æ®é›†ç§°ä¸ºç¢ç‰‡å¹¶æŠŠè¿™äº›ç¢ç‰‡äº¤ç»™ç¥ç»ç½‘ç»œåˆ†ç¦»ï¼Œæ¯”å¦‚æ¯ä¸ªç¥ç»ç½‘ç»œéƒ½åœ¨è‡ªå·±çš„æ ¸å¿ƒä¸Šã€‚Deeplearning4jä¾é sparkæ¥å¤„ç†è¿™äº›ï¼Œå¹¶å‘è®­ç»ƒæ¨¡å‹å¹¶ä¸”è¿­ä»£å¹³å‡å®ƒä»¬åœ¨ä¸­å¿ƒæ¨¡å‹æ‰€äº§ç”Ÿçš„å‚æ•°ã€‚ï¼ˆæ¨¡å‹å¹¶å‘ï¼Œåœ¨<a href="https://static.googleusercontent.com/media/research.google.com/en//archive/large_deep_networks_nips2012.pdf" target="_blank" rel="noopener">here</a>è¢«è®¨è®ºäº†ï¼Œå…è®¸ä½¿ç”¨æ¨¡å‹åœ¨ä¸åŒçš„å¤§æ•°æ®é›†ä¸Šä½¿ç”¨è€Œæ— éœ€è¢«å¹³å‡ï¼‰<br>æ³¨æ„å¦‚æœä½ éœ€è¦ä¸€ä¸ªå‚æ•°æœåŠ¡å™¨åŸºç¡€çš„æ–¹æ³•ï¼ˆéœ€è¦æ›´å¤šçš„æ­¥éª¤ï¼‰ï¼Œå¯ä»¥æŸ¥çœ‹<a href="https://deeplearning4j.org/distributed" target="_blank" rel="noopener">åˆ†å‘é¡µé¢</a>.</p>
<h2 id="Overview-æ¦‚è¿°"><a href="#Overview-æ¦‚è¿°" class="headerlink" title="Overview æ¦‚è¿°"></a>Overview æ¦‚è¿°</h2><p>Deeplearning4jæ”¯æŒåœ¨Sparké›†ç¾¤ä¸Šè®­ç»ƒç¥ç»ç½‘ç»œï¼Œä¸ºäº†åŠ é€Ÿç½‘ç»œè®­ç»ƒã€‚<br>å’ŒDL4Jçš„MultiLayerNetworkå’ŒComputationGraphç±»ç›¸åŒï¼ŒDL4Jå®šä¹‰äº†ä¸¤ä¸ªç±»ç”¨äºåœ¨Sparkä¸Šè®­ç»ƒç¥ç»ç½‘ç»œã€‚  </p>
<ol>
<li>SparkDl4jMultiLayer ä¸€ä¸ªå›´ç»•MultiLayerNetworkçš„åŒ…è£…ç±»</li>
<li>SparkComputationGraph ä¸€ä¸ªå›´ç»•ComputationGraphçš„åŒ…è£…ç±»</li>
</ol>
<p>ç”±äºè¿™ä¸¤ä¸ªç±»æ—¶å›´ç»•æ ‡å‡†çš„å•æœºç±»åŒ…è£…çš„ï¼Œè¿™ä¸ªç½‘ç»œé…ç½®è¿‡ç¨‹å¯¹äºæ ‡å‡†çš„å’Œåˆ†å¸ƒå¼çš„è®­ç»ƒéƒ½æ˜¯ç›¸åŒçš„ã€‚åœ¨Sparkä¸Šåˆ†å¸ƒå¼è®­ç»ƒå’Œæœ¬åœ°è®­ç»ƒæœ‰ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹ï¼Œ1.æ•°æ®æ˜¯å¦‚ä½•åŠ è½½çš„ï¼Œå’Œè®­ç»ƒæ˜¯å¦‚ä½•å¯åŠ¨çš„ï¼ˆéœ€è¦ä¸€äº›é¢å¤–çš„é›†ç¾¤é…ç½®ï¼‰ã€‚<br>ä¸€ä¸ªæ ‡å‡†çš„åœ¨Sparké›†ç¾¤ä¸Šè®­ç»ƒç½‘ç»œçš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š  </p>
<ol>
<li><p>åˆ›é€ ä½ è‡ªå·±çš„ç¥ç»ç½‘ç»œè®­ç»ƒç±»ã€‚é€šå¸¸æ¥è¯´ï¼ŒåŒ…å«ä¸ºä»¥ä¸‹å·¥ä½œæ‰€åšçš„ä»£ç ï¼š<br> æŒ‡å®šä½ è‡ªå·±çš„ç¥ç»ç½‘ç»œé…ç½®ï¼ˆMultiLayerConfigurationæˆ–è€…ComputationGraphConfigurationï¼‰ï¼Œå’Œä½ ä¸ºå•æœºè®­ç»ƒæ‰€é…ç½®çš„é‚£æ ·ã€‚<br> åˆ›é€ ä¸€ä¸ªTrainingMasterçš„å®ä¾‹ï¼šè¿™ä¸ªæŒ‡å®šäº†åˆ†å¸ƒå¼è®­ç»ƒä¼šå¦‚ä½•åœ¨å®é™…ä¸­è¿›è¡Œã€‚<br> åŠ è½½ä½ è‡ªå·±çš„è®­ç»ƒæ•°æ®ã€‚è¿™é‡Œæœ‰å¾ˆå¤šæ–¹æ³•æ¥åŠ è½½æ•°æ®ï¼Œæœ‰ä¸åŒçš„æƒè¡¡ï¼›æ›´å¤šçš„ç»†èŠ‚å°†ä¼šåœ¨ä¹‹åçš„æ–‡æ¡£ä¸­è®¨è®ºã€‚<br> è°ƒç”¨åˆé€‚çš„fitæ–¹æ³•åœ¨SparkDl4jMultiLayeræˆ–è€…SparkComputationGraphå®ä¾‹ä¸­ã€‚<br> ä¿å­˜æˆ–è€…ä½¿ç”¨è®­ç»ƒçš„ç½‘ç»œï¼ˆè¿™ä¸ªè®­ç»ƒçš„MultiLayerNetworkæˆ–è€…ComputationGraphå®ä¾‹ï¼‰  </p>
</li>
<li><p>å°†ä½ çš„jaræ‰“åŒ…ç­‰å€™sparkæäº¤ã€‚<br> å¦‚æœä½¿ç”¨mavenï¼Œè¿è¡Œâ€œmvn package -DskipTestsâ€æ˜¯ä¸€ä¸ªæ–¹æ³•</p>
</li>
<li><p>è°ƒç”¨Sparkæäº¤ï¼Œå¹¶ä¸”å¯åŠ¨ä½ é›†ç¾¤ä½¿ç”¨åˆé€‚çš„é…ç½®ã€‚</p>
</li>
</ol>
<p>æ³¨æ„å¯¹ä¸€ä¸ªå•ç‹¬æœºå™¨çš„è®­ç»ƒï¼ŒSpark locakå¯ä»¥åœ¨DL4Jä¸Šä½¿ç”¨ï¼Œå°½ç®¡è¿™ä¸æ¨èï¼ˆå› ä¸ºåŒæ­¥åŒ–å’Œåºåˆ—åŒ–åœ¨sparkä¸Šçš„è¿‡åº¦ä½¿ç”¨ï¼‰ã€‚æ›¿ä»£çš„ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä»¥ä¸‹ï¼š  </p>
<ol>
<li>å¯¹äºä¸€ä¸ªå•æœºCPU/GPUç³»ç»Ÿï¼Œä½¿ç”¨æ ‡å‡†çš„MultiLayerNetworkæˆ–è€…ComputationGraphè®­ç»ƒã€‚  </li>
<li>å¯¹äºå¤šä¸ªCPUï¼GPUç³»ç»Ÿï¼Œä½¿ç”¨ParallelWrapper. è¿™ä¸ªåŠŸèƒ½ä¸Šç­‰äºè¿è¡Œsparkåœ¨æœ¬åœ°æ¨¡å¼ï¼Œå°½ç®¡æœ‰æ›´ä½çš„å¼€é”€ï¼ˆä»è€Œæœ‰æ›´å¥½çš„è®­ç»ƒè¡¨ç°ï¼‰ã€‚</li>
</ol>
<h2 id="How-Distributed-Network-Training-Occurs-with-DL4J-on-Spark"><a href="#How-Distributed-Network-Training-Occurs-with-DL4J-on-Spark" class="headerlink" title="How Distributed Network Training Occurs with DL4J on Spark"></a>How Distributed Network Training Occurs with DL4J on Spark</h2><p>åˆ†å¸ƒå¼ç¥ç»ç½‘ç»œæ˜¯å¦‚ä½•åœ¨DL4Jä¸Šè®­ç»ƒçš„<br>å½“å‰çš„DL4Jç‰ˆæœ¬ä½¿ç”¨çš„å‚æ•°å¹³å‡çš„è¿‡ç¨‹åœ¨è®­ç»ƒä¸€ä¸ªç½‘ç»œçš„æ—¶å€™ã€‚æœªæ¥çš„ç‰ˆæœ¬å¯èƒ½ä¼šåŠ å…¥å…¶ä»–åˆ†å¸ƒå¼ç½‘ç»œè®­ç»ƒæ–¹æ³•ã€‚<br>The process of training a network using parameter averaging is conceptually quite simple:<br>è®­ç»ƒä¸€ä¸ªç½‘ç»œä½¿ç”¨å‚æ•°å¹³å‡çš„è¿‡ç¨‹åœ¨æ¦‚å¿µä¸Šå¾ˆç®€å•ï¼š </p>
<ol>
<li>Masterï¼ˆspark drivenï¼‰å¼€å§‹ä¸€ä¸ªåˆå§‹åŒ–çš„ç½‘ç»œé…ç½®å’Œå‚æ•°</li>
<li>æ•°æ®è¢«åˆ‡åˆ†ä¸ºå¾ˆå¤šå­é›†ï¼ŒåŸºäºTrainingMasterçš„é…ç½®</li>
<li>åœ¨è¿™äº›æ•°æ®åˆ‡ç‰‡ä¸Šè¿­ä»£ã€‚å¯¹æ¯ä¸€ä¸ªè®­ç»ƒæ•°æ®çš„åˆ‡ç‰‡ï¼š<br> å°†å‚æ•°ï¼Œé…ç½®ï¼ˆå¦‚æœé€‚å½“çš„ï¼Œå¯¹äºmomentum/rmsprop/adagradçš„ç½‘ç»œæ›´æ–°çŠ¶æ€ï¼‰ä»masterç»™åˆ°æ¯ä¸€ä¸ªworkerä¸­ã€‚<br> åœ¨æ¯ä¸€ä¸ªåˆ‡ç‰‡çš„ä¸€éƒ¨åˆ†é€‚é…æ¯ä¸€ä¸ªworker<br> å¹³å‡å‚æ•°ï¼ˆå¦‚æœå¯èƒ½ï¼Œæ›´æ–°çŠ¶æ€ï¼‰å¹¶ä¸”è¿”å›è¯„ä»·ç»“æœåˆ°materä¸­ã€‚</li>
<li>è®­ç»ƒç»“æŸï¼Œmasteræœ‰ä¸€ä¸ªå·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹ç½‘ç»œã€‚  </li>
</ol>
<p>æ¯”å¦‚ï¼Œä¸‹å›¾å±•ç¤ºäº†5ä¸ªworkerå‚æ•°å¹³å‡çš„è¿‡ç¨‹ä¸€ä¸ªæ¯ä¸€ä¸ªå‚æ•°å‡è¡¡é¢‘ç‡æ˜¯1.å°±åƒä¸€ä¸ªç¦»çº¿çš„è®­ç»ƒï¼Œä¸€ä¸ªè®­ç»ƒæ•°æ®é›†è¢«åˆ‡å‰²ä¸ºä¸€ç³»åˆ—çš„æ•°æ®å­é›†ï¼ˆé€šå¸¸è¢«è®¤ä¸ºæ˜¯minibatchï¼Œåœ¨éåˆ†å¸ƒå¼è®¾ç½®ä¸­ï¼‰ï¼›åœ¨æ¯ä¸€ä¸ªsplitä¸­è®­ç»ƒè¿‡ç¨‹ï¼Œæ¯ä¸€ä¸ªworkerè·å¾—è¿™ä¸ªåˆ‡ç‰‡çš„ä¸€ä¸ªå­é›†ã€‚åœ¨å®é™…ä¸­ï¼Œè¿™ä¸ªåˆ‡ç‰‡çš„ä¸ªæ•°æ˜¯è¢«è‡ªåŠ¨å†³å®šçš„ï¼ŒåŸºäºè®­ç»ƒé…ç½®ï¼ˆåŸºäºworkerçš„æ•°é‡ï¼Œå¹³å‡çš„é¢‘ç‡å’Œworker minibatch Sizeï¼‰ã€‚<br><a href="https://deeplearning4j.org/img/parameter_averaging.png" target="_blank" rel="noopener"></a></p>
<h2 id="A-Minimal-Example"><a href="#A-Minimal-Example" class="headerlink" title="A Minimal Example"></a>A Minimal Example</h2><p>æœ¬èŠ‚å±•ç¤ºäº†ä½ éœ€è¦åœ¨sparkä¸Šè®­ç»ƒçš„è¦ç´ çš„æœ€å°éƒ¨åˆ†ã€‚å…³äºåŠ è½½æ•°æ®çš„å„ç§æ–¹æ³•éšåå°±æ¥ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">JavaSparkContext sc = ...;</span><br><span class="line">JavaRDD&lt;DataSet&gt; trainingData = ...;</span><br><span class="line">MultiLayerConfiguration networkConfig = ...;</span><br><span class="line"></span><br><span class="line">//Create the TrainingMaster instance</span><br><span class="line">int examplesPerDataSetObject = 1;</span><br><span class="line">TrainingMaster trainingMaster = new ParameterAveragingTrainingMaster.Builder(examplesPerDataSetObject)</span><br><span class="line">        .(other configuration options)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">//Create the SparkDl4jMultiLayer instance</span><br><span class="line">SparkDl4jMultiLayer sparkNetwork = new SparkDl4jMultiLayer(sc, networkConfig, trainingMaster);</span><br><span class="line"></span><br><span class="line">//Fit the network using the training data:</span><br><span class="line">sparkNetwork.fit(trainingData);</span><br></pre></td></tr></table></figure></p>
<p>##Using the output from SparkDl4jMultiLayer/ComputationGraph<br>ç”±äºsparkç½‘ç»œä½œä¸ºä¸€ä¸ªwrapperå›´ç»•multi layer ç½‘ç»œå’Œcomputation graph apisï¼Œä½ éœ€è¦æœ€ç»ˆéœ€è¦ä»sparkç¥ç»ç½‘ç»œä¸­è·å–networkåœ¨è®­ç»ƒç»“æŸä¹‹åã€‚å…¶åŸå› æ˜¯ç”±äºæ•°æ®å¹³è¡Œè®­ç»ƒå®é™…ä¸Šæ˜¯åœ¨è®­ç»ƒæœŸé—´ä¸€æ¬¡å¯¹å¤šä¸ªç½‘ç»œè¿›è¡Œå¹³å‡ã€‚è¿™æ„å‘³ç€è¿™é‡Œæ²¡æœ‰ä¸€ä¸ªç½‘ç»œç›´åˆ°ä½ è·å¾—äº†æœ€åçš„å¹³å‡å‚æ•°åœ¨å¤šä¸ªworkerä¸Šç§¯ç´¯çš„é›†åˆçš„è¾“å‡ºã€‚<br>äº†è§£äº†è¿™äº›ï¼Œæˆ‘ä»¬åº”è¯¥è·å–åº•å±‚çš„å¼•ç”¨ä¸è®ºåœ¨SparkComputationGraphå’ŒSparkDl4jMultiLayerä¸Šéƒ½ä½¿ç”¨getNetworkæ–¹æ³•ã€‚<br>ä½ å°†ä¼šæ³¨æ„åˆ°åˆé€‚çš„è¾“å‡ºå°†ä¼šç›´æ¥è¿”å›ç›¸åŒçš„åº•å±‚çš„ç½‘ç»œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">JavaSparkContext sc = ...;</span><br><span class="line">JavaRDD&lt;DataSet&gt; trainingData = ...;</span><br><span class="line">MultiLayerConfiguration networkConfig = ...;</span><br><span class="line"></span><br><span class="line">//Create the TrainingMaster instance</span><br><span class="line">int examplesPerDataSetObject = 1;</span><br><span class="line">TrainingMaster trainingMaster = new ParameterAveragingTrainingMaster.Builder(examplesPerDataSetObject)</span><br><span class="line">        .(other configuration options)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">//Create the SparkDl4jMultiLayer instance</span><br><span class="line">SparkDl4jMultiLayer sparkNetwork = new SparkDl4jMultiLayer(sc, networkConfig, trainingMaster);</span><br><span class="line"></span><br><span class="line">//Fit the network using the training data:</span><br><span class="line">MultiLayerNetwork outputNetwork = sparkNetwork.fit(trainingData);</span><br></pre></td></tr></table></figure></p>
<h2 id="Configuring-the-TrainingMaster"><a href="#Configuring-the-TrainingMaster" class="headerlink" title="Configuring the TrainingMaster"></a>Configuring the TrainingMaster</h2><p>ä¸€ä¸ªåœ¨DL4Jä¸­çš„TrainingMasteræ˜¯ä¸€ä¸ªæ¥å£å…è®¸å¤šä¸ªä¸åŒçš„è®­ç»ƒå®ç°åœ¨SparkDl4jMultiLayerå’ŒSparkComputationGraphä½¿ç”¨ã€‚<br>ç›®å‰DL4Jæœ‰ä¸€ä¸ªå®ç°ï¼ŒParameterAveragingTrainingMasterã€‚è¿™ä¸ªå‚æ•°å¹³å‡çš„è¿‡ç¨‹åœ¨ä¸Šé¢å›¾ç‰‡ä¸­å±•ç¤ºäº†ã€‚ä¸ºäº†åˆ›é€ ä¸€ä¸ªï¼Œä½¿ç”¨ä»¥ä¸‹çš„æ„å»ºæ¨¡å¼ï¼š  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TrainingMaster tm = new ParameterAveragingTrainingMaster.Builder(int dataSetObjectSize)</span><br><span class="line">            ... (your configuration here)</span><br><span class="line">            .build();</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªParameterAveragingTrainingMasterå®šä¹‰äº†å¾ˆå¤šçš„å‚æ•°é€‰é¡¹ç”¨äºæ§åˆ¶è®­ç»ƒçš„æ‰§è¡Œï¼š  </p>
<p><em>dataSetObjectSizeï¼š</em>å¿…é¡»å€¼ã€‚è¿™ä¸ªåœ¨buildæ„é€ å‡½æ•°ä¸­çŸ¥åã€‚è¿™ä¸ªå€¼æŒ‡æ˜äº†æœ‰å¤šå°‘çš„åˆ—å­åœ¨æ¯ä¸€ä¸ªæ•°æ®é›†å¯¹è±¡ä¸­ã€‚ä½œä¸ºä¸€ä¸ªé€šç”¨çš„è§„åˆ™ï¼š<br>    å¦‚æœä½ åœ¨è®­ç»ƒä¸€ä¸ªé¢„å¤„ç†è¿‡çš„æ•°æ®é›†å¯¹è±¡ï¼Œè¿™ä¸ªå°†ä¼šæ˜¯è¿™ä¸ªé¢„å¤„ç†çš„æ•°æ®é›†çš„å¤§å°<br>    å¦‚æœä½ æ˜¯ç›´æ¥ä»stringä¸­è¿›è¡Œè®­ç»ƒï¼Œæ¯”å¦‚CSVæ•°æ®ç»è¿‡ä¸€å®šçš„æ­¥éª¤ååˆ°ä¸€ä¸ªRDD<dataset>é‚£ä¹ˆè¿™ä¸ªå°†ä¼šæ˜¯1.<br><em>batchSizePerWorkerï¼š</em>è¿™ä¸ªæ§åˆ¶äº†æ¯ä¸€ä¸ªworkerçš„minibatch å¤§å°ã€‚è¿™ä¸ªå’Œæ·¡å­£è®­ç»ƒçš„æ—¶å€™ä½¿ç”¨minibatch sizeæœ‰äº›ç±»å‹ã€‚æ¢ä¸€ç§æ–¹å¼æ¥è¯´ï¼šè¿™ä¸ªæ˜¯å¯¹æ¯ä¸€ä¸ªå‚æ•°è¿›è¡Œæ›´æ–°æ‰€éœ€è¦çš„ä¾‹å­æ•°é‡åœ¨æ¯ä¸€ä¸ªworkerä¸­ã€‚<br><em>averagingFrequencyï¼š</em>è¿™ä¸ªæ§åˆ¶äº†å‚æ•°å¹³å‡å’Œé‡æ–°åˆ†å‘çš„é¢‘ç‡ï¼Œæ ¹æ®å¤§å°ä¸ºbatchSizePerWorkerçš„minibatchesæ•°é‡è®¡ç®—ï¼Œé€šå¸¸ï¼š<br>    ä½å¹³å‡å‘¨æœŸï¼ˆæ¯”å¦‚ï¼ŒaveragingFrequency = 1ï¼‰ä¹Ÿè®¸ä¸å¤ªæœ‰æ•ˆç‡ï¼ˆå¤ªå¤šçš„ç½‘ç»œé€šä¿¡å’Œåˆå§‹åŒ–å¼€é”€ï¼Œç›¸å¯¹äºè®¡ç®—æ¥è¯´ã€‚ï¼‰<br>    å¤§å¹³å‡å‘¨æœŸï¼ˆæ¯”å¦‚ï¼ŒaveragingFrequency = 200ï¼‰å¯èƒ½ä¼šå¯¼è‡´ä½æ€§èƒ½ï¼ˆä¸åŒçš„workerå®ä¾‹ä¸­çš„å‚æ•°ä¹Ÿè®¸ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼‰<br>    Averaging periods åœ¨5-10ä¸ªminibatchesä¹Ÿè®¸æ˜¯ä¸€ä¸ªå®‰å…¨çš„é€‰æ‹©ã€‚</dataset></p>
<p><em>workerPrefetchNumBatchesï¼š</em>Spark workerå¯ä»¥å¼‚æ­¥è·å–ä¸€å®šæ•°ç›®çš„minibatchesï¼Œä¸ºäº†é¿å…ç­‰å¾…æ•°æ®çš„åŠ è½½ã€‚<br>    è®¾å®šè¿™ä¸ªå€¼ä¸º0æ¥å…³æ‰æå‰è·å–ã€‚<br>    å€¼è®¾å®šä¸º2é€šå¸¸æ˜¯ä¸€ä¸ªä¸é”™çš„é»˜è®¤å€¼ã€‚å¤ªå¤§çš„å€¼åœ¨å¾ˆå¤šæƒ…å†µä¸‹å¹¶æ²¡æœ‰å¸®åŠ©ï¼ˆä½†æ˜¯ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ï¼‰ã€‚<br><em>rddTrainingApproachï¼š</em>ä»ç‰ˆæœ¬0.60å¼€å§‹ï¼ŒDL4Jæä¾›ä¸¤ç§æ–¹æ³•æ¥è®­ç»ƒä»RDD<dataset>æˆ–è€…RDD<multidataset>.åˆ†åˆ«æ˜¯ï¼šRDDTrainingApproach.Exportå’ŒRDDTrainingApproach.Directæ–¹æ³•ã€‚<br>        Export:ï¼ˆDefaultï¼‰è¿™ä¸ªé¦–å…ˆä¿å­˜RDD<dataset>åˆ°ç£ç›˜ä¸­ï¼Œä½¿ç”¨æ‰¹é‡å’Œåºåˆ—åŒ–çš„å½¢å¼ã€‚è¿™ä¸ªexecutorç„¶åå¼‚æ­¥åŠ è½½DataSetå¯¹è±¡ï¼ŒæŒ‰ç…§éœ€æ±‚ã€‚è¿™ä¸ªæ–¹æ³•å¯¹äºå¤§æ•°æ®é›†å’Œå¤šä¸ªepochsæ¥è¯´æ¯”Directæ–¹æ³•è¡¨ç°è¦å¥½ä¸€äº›ã€‚å®ƒé¿å…äº†Directæ–¹æ³•é‡Œé¢åˆ‡åˆ†å’Œé‡æ–°åˆ†åŒºçš„å¼€é”€ï¼ŒåŒæ ·åªéœ€è¦æ›´å°‘çš„å†…å­˜ã€‚ä¸´æ—¶æ–‡ä»¶ä¼šè¢«åˆ é™¤ä½¿ç”¨TrainingMaster.deleteTempFiles()ã€‚<br>        Directï¼šè¿™æ˜¯DL4Jæ—©æœŸä½¿ç”¨çš„ç‰ˆæœ¬ã€‚å®ƒæä¾›äº†æ›´å¥½çš„æ€§èƒ½å¯¹äºå°æ•°æ®é›†æ¥è¯´å› ä¸ºå°†ä¼šå…¨éƒ¨æ”¾è¿›å†…å­˜ä¸­ã€‚<br><em>exportDirectory</em>ï¼šåªè¢« Export training approach ä½¿ç”¨ã€‚è¿™ä¸ªæ§åˆ¶äº†ä¸´æ—¶æ–‡ä»¶åº”è¯¥è¢«ä¿å­˜åœ¨å“ªã€‚é»˜è®¤æ˜¯ä½¿ç”¨ï¼š{hadoop.tmp.dir}/dl4j/ç›®å½•ï¼Œè€Œ{hadoop.tmp.dir}æ˜¯Hadoopä¸´æ—¶ç›®å½•æ€§è´¨çš„å€¼ã€‚<br><em>storageLevelStreams</em>ï¼šåªæœ‰åœ¨ä½¿ç”¨fitPaths(RDD<string>)æ–¹æ³•çš„æ—¶å€™ä½¿ç”¨ã€‚è¿™æ˜¯DL4Jå°†ä¼šç”¨æ¥ä¿å­˜RDD<string>çš„å­˜å‚¨çº§åˆ«ã€‚<br>é»˜è®¤ï¼šStorageLevel.MEMORY_ONLY.è¿™ä¸ªé»˜è®¤å€¼ç›®å‰å‡ ä¹åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½å¯ä»¥ã€‚<br><em>repartitionï¼š</em>é…ç½®ä½•æ—¶æ•°æ®åº”è¯¥è¢«é‡æ–°åˆ†åŒºã€‚ParameterAveragingTrainingMasterå°†ä¼šè¿›è¡Œä¸€ä¸ªmapParititonsçš„æ“ä½œï¼›ç›¸åº”çš„ï¼Œåˆ†åŒºçš„æ•°é‡ï¼ˆä»¥åŠæ¯ä¸€ä¸ªåˆ†åŒºçš„å€¼ï¼‰å’Œåˆ†åŒºçš„åˆ©ç”¨æœ‰å¾ˆå¤§çš„å…³ç³»ã€‚ç„¶è€Œï¼Œé‡æ–°åˆ†åŒºä¸æ˜¯ä¸€ä¸ªè‡ªç”±çš„æ“ä½œï¼Œæœ‰äº›æ•°æ®å¿…é¡»é€šè¿‡ç½‘ç»œè¿›è¡Œå¤åˆ¶ï¼Œä»¥ä¸‹çš„æ“ä½œæ˜¯å¯ä»¥çš„ï¼š<br>    Alwaysï¼šé»˜è®¤æ“ä½œï¼Œé‡æ–°åˆ†åŒºæ•°æ®æ¥ä¿è¯åˆ†åŒºçš„æ­£ç¡®æ•°é‡ã€‚æ¨èçš„ï¼Œç‰¹åˆ«ä½¿ç”¨RDDTrainingApproach.Exportï¼ˆé»˜è®¤æ˜¯0.6ï¼‰æˆ–è€…fitPaths(RDD<string>)ã€‚<br>    Neverï¼šä»ä¸é‡æ–°åˆ†åŒºæ•°æ®ï¼Œæ— è®ºè¿™ä¸ªåˆ†åŒºæœ‰å¤šä¸å¹³è¡¡ã€‚<br>    NumPartitionsWorkersDiffersï¼šåªæœ‰å½“åˆ†åŒºçš„æ•°é‡å’Œworkerçš„æ•°é‡ä¸ä¸€è‡´çš„æ—¶å€™æ‰åˆ†åŒºã€‚æ³¨æ„åˆ°å³ä½¿åˆ†åŒºçš„æ•°é‡å’Œæ€»å…±å†…æ ¸çš„æ•°é‡ç›¸åŒï¼Œè¿™ä¹Ÿä¸ä¿è¯æ­£ç¡®çš„æ•°æ®é›†å¯¹è±¡çš„å°±åœ¨æ¯ä¸€ä¸ªåˆ†åŒºï¼šæœ‰çš„åˆ†åŒºä¹Ÿè®¸æœ‰å¤šçš„æ•°æ®æœ‰çš„æ˜¯å°‘çš„æ•°æ®ã€‚<br><em>repartitionStrategy:</em>å“ªä¸€ä¸ªé‡æ–°åˆ†é…çš„ç­–ç•¥åº”è¯¥è¢«å®Œæˆã€‚<br>    Balancedï¼šï¼ˆé»˜è®¤ï¼‰è¿™ä¸ªæ˜¯DL4Jé»˜è®¤çš„é‡æ–°åˆ†åŒºçš„ç­–ç•¥ã€‚å®ƒè¯•å›¾ç¡®ä¿æ¯ä¸€ä¸ªåˆ†åŒºéƒ½æ˜¯å‡è¡¡çš„å¯¹æ¯”SparkDefaulté€‰é¡¹æ¥è¯´ã€‚ç„¶è€Œï¼Œåœ¨å®é™…ä¸­ï¼Œè¿™ä¸ªéœ€è¦é¢å¤–çš„count æ“ä½œæ¥æ‰§è¡Œï¼›åœ¨æœ‰äº›æƒ…å†µï¼ˆä¸»è¦æ˜¯åœ¨å°å‹çš„ç½‘ç»œé‡Œï¼Œæˆ–è€…é‚£äº›å°æ•°é‡çš„è®¡ç®—åœ¨æ¯ä¸€ä¸ªminibatchï¼‰ï¼Œè¿™ä¸ªå¥½å¤„ä¹Ÿè®¸æ¯”ä¸ä¸Šé¢å¤–çš„æ‰§è¡Œå¼€é”€ã€‚æ¨èçš„ï¼Œç‰¹åˆ«åœ¨ä½¿ç”¨RDDTrainingApproach.Export æˆ–è€…fitPathsï¼ˆRDD<string>ï¼‰<br>    SparkDefault:    è¿™ä¸ªæ˜¯Sparkçš„æ ‡å‡†åˆ†åŒºç­–ç•¥ã€‚æœ¬è´¨ä¸Šï¼Œæ¯ä¸€ä¸ªåœ¨åˆå§‹åŒ–RDDä¸­çš„å¯¹è±¡è¢«éšæœºæ˜ å°„åˆ°Nä¸ªä¸­RDDä¸­çš„ä¸€ä¸ªã€‚å› æ­¤ï¼Œè¿™ä¸ªåˆ†åŒºä¹Ÿè®¸ä¸æ˜¯æœ€å¥½çš„å¹³è¡¡ï¼Œåœ¨å°å‹çš„RDDçš„æ—¶å€™ç‰¹åˆ«ä¼šæœ‰é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å½“å®ƒä»¬ä½¿ç”¨é¢„å¤„ç†æ•°æ®é›†å¯¹è±¡å¹¶ä¸”é¢‘ç¹å‡è¡¡æ—¶æœŸï¼ˆç®€å•å› ä¸ºéšæœºé‡‡æ ·å˜åŒ–ï¼‰ã€‚</string></string></string></string></dataset></multidataset></dataset></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.sevenpan.com/2018/04/15/Deep Learning on Apache Spark/" data-id="cjnctr01e0002tirrcmdiltoq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/deeplearning4j-spark/">deeplearning4j; spark</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-RDDSpark" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/04/RDDSpark/" class="article-date">
  <time datetime="2018-04-04T06:31:10.000Z" itemprop="datePublished">2018-04-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/04/RDDSpark/">RDD Programming Guide ç¿»è¯‘</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="RDD-Programming-Guide"><a href="#RDD-Programming-Guide" class="headerlink" title="RDD Programming Guide"></a>RDD Programming Guide</h1><p>from <a href="http://spark.apache.org/docs/latest/rdd-programming-guide.html" target="_blank" rel="noopener">http://spark.apache.org/docs/latest/rdd-programming-guide.html</a></p>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>åœ¨ä¸€ä¸ªè¾ƒé«˜çš„å±‚çº§ï¼Œæ¯ä¸€ä¸ªSpark åº”ç”¨åŒ…å«äº†ä¸€ä¸ªdrivenç¨‹åºè¿è¡Œç”¨æˆ·çš„mainå‡½æ•°ä»¥åŠè¿è¡Œä¸åŒçš„å¹¶è¡Œæ“ä½œåœ¨ä¸€ä¸ªé›†ç¾¤ä¸Šã€‚<br>Sparkä¸»è¦æä¾›çš„æŠ½è±¡æ˜¯ä¸€ä¸ªå¼¹æ€§åˆ†å¸ƒè¯•æ•°æ®é›†ï¼ˆRDDï¼‰ï¼Œæ˜¯ä¸€ä¸ªå…ƒç´ é›†åˆ†å¸ƒåœ¨ä¸åŒçš„é›†ç¾¤èŠ‚ç‚¹å¯ä»¥è¢«å¹¶è¡Œæ“ä½œçš„ã€‚RDDsåœ¨Hadoopæ–‡ä»¶ç³»ç»Ÿä¸­ç”±ä¸€ä¸ªæ–‡ä»¶å¼€å§‹åˆ›é€ çš„ã€‚æˆ–è€…ä¸€ä¸ªåœ¨é©±åŠ¨ç¨‹åºä¸­å­˜åœ¨çš„Scalaé›†åˆå¹¶ä¸”æ”¹å˜å®ƒã€‚ç”¨æˆ·ä¹Ÿè®¸ä¼šè¯·æ±‚Sparkæ¥æ°¸ä¹…å­˜å‚¨ä¸€ä¸ªRDDåœ¨å†…å­˜ä¸­ï¼Œç„¶åå¯ä»¥æœ‰æ•ˆçš„åœ¨å¹¶è¡Œæ“ä½œä¸­å†æ¬¡è®¿é—®ã€‚æœ€ç»ˆï¼ŒRDDsè‡ªåŠ¨ä»èŠ‚ç‚¹å¤±è´¥ä¸­æ¢å¤ã€‚<br>Sparkæä¾›çš„ç¬¬äºŒä¸ªæŠ½è±¡æ˜¯å…±äº«å˜é‡ï¼Œå¯ä»¥åœ¨å¹¶è¡Œæ“ä½œä¸­ä½¿ç”¨ã€‚é»˜è®¤çš„ï¼Œå½“Sparkå¹¶è¡Œè¿è¡Œä¸€ä¸ªå‡½æ•°ä½œä¸ºä¸€ç³»åˆ—çš„ä»»åŠ¡åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸­ï¼Œå®ƒå°†æ¯ä¸€ä¸ªå‡½æ•°ä¸­çš„å˜é‡ä¼ è¾“åˆ°æ¯ä¸€ä¸ªèŠ‚ç‚¹ç„¶åç»™åˆ°æ¯ä¸€ä¸ªä»»åŠ¡ã€‚æœ‰æ—¶ï¼Œä¸€ä¸ªå˜é‡éœ€è¦åœ¨ä¸åŒçš„ä»»åŠ¡ç›´æ¥å…±äº«æˆ–è€…éœ€è¦åœ¨ä»»åŠ¡å’Œdriven ç¨‹åºç›´æ¥å…±äº«ã€‚Sparkæä¾›ä¸¤ç§ç±»å‹çš„å…±äº«å˜é‡ï¼š<b>broadcast</b> å˜é‡ï¼Œå¯ä»¥ç”¨æ¥ç¼“å­˜å€¼åœ¨æ‰€æœ‰çš„èŠ‚ç‚¹ä¸­ã€‚ <b> accumulators</b>,å˜é‡åªæ˜¯ç”¨äºâ€œaddedâ€ï¼Œæ¯”å¦‚counterå’Œsumsã€‚  </p>
<h2 id="Initializing-Sparkï¼ˆJavaï¼‰"><a href="#Initializing-Sparkï¼ˆJavaï¼‰" class="headerlink" title="Initializing Sparkï¼ˆJavaï¼‰"></a>Initializing Sparkï¼ˆJavaï¼‰</h2><p>sparkç¨‹åºé¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªJavaSparkContextå¯¹è±¡ï¼Œå‘Šè¯‰Sparkå¦‚ä½•è®¿é—®ä¸€ä¸ªé›†ç¾¤ã€‚ä¸ºäº†åˆ›å»ºä¸€ä¸ªSparkContextä½ é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªSparkConfå¯¹è±¡ï¼ŒåŒ…å«ä½ åº”ç”¨çš„ä¿¡æ¯ã€‚  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SparkConf conf = new SparkConf().setAppName(appName).setMaster(master);</span><br><span class="line">JavaSparkContext sc = new JavaSparkContext(conf);</span><br></pre></td></tr></table></figure>
<p>appName å‚æ•°æ˜¯ä½ çš„åº”ç”¨åå­—å°†ä¼šå±•ç¤ºåœ¨é›†ç¾¤UIä¸Šã€‚ masterå¯èƒ½æ˜¯ä¸€ä¸ªsparkï¼ŒMesosæˆ–è€…YARNé›†ç¾¤URLï¼Œæˆ–è€…ä¸€ä¸ªç‰¹æ®Šçš„â€œlocalâ€œ æ¥æœ¬åœ°è¿è¡Œã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå½“åœ¨é›†ç¾¤ä¸­è¿è¡Œæ—¶ï¼Œä½ ä¸ä¼šæƒ³è¦hardcode masteråœ¨ç¨‹åºä¸­ï¼Œè€Œæ˜¯å¯åŠ¨åº”ç”¨ä½¿ç”¨ spark-submit å¹¶ä¸”æ¥å—å®ƒã€‚åœ¨æœ¬åœ°æµ‹è¯•å’Œå•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œä½ å¯ä»¥ä¼ é€’â€localâ€œå¹¶ä¸”è¿è¡Œspark  </p>
<h2 id="Resilient-Distributed-Datasetsï¼ˆRDDsï¼‰å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†"><a href="#Resilient-Distributed-Datasetsï¼ˆRDDsï¼‰å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†" class="headerlink" title="Resilient Distributed Datasetsï¼ˆRDDsï¼‰å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†"></a>Resilient Distributed Datasetsï¼ˆRDDsï¼‰å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†</h2><p>Sparkæ˜¯ä»¥RDDè§‚å¿µä¸ºä¸­å¿ƒçš„ï¼Œæ˜¯ä¸€ä¸ªå®¹é”™çš„å…ƒç´ é›†å¯ä»¥å¹¶è¡Œè¿›è¡Œæ“ä½œã€‚è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼æ¥åˆ›é€ RDDsï¼šåœ¨driverç¨‹åºä¸­å¹¶è¡ŒåŒ–ä¸€ä¸ªå·²å­˜åœ¨çš„é›†åˆï¼Œæˆ–è€…å¼•ç”¨ä¸€ä¸ªæ•°æ®é›†åœ¨ä¸€ä¸ªå¤–éƒ¨å­˜å‚¨ç³»ç»Ÿï¼Œæ¯”å¦‚ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ŒHDFSï¼ŒHBaseæˆ–è€…ä»»ä½•å…¶ä»–çš„æä¾›ä¸€ä¸ªHadoopè¾“å…¥æ ¼å¼çš„æ•°æ®æºã€‚  </p>
<h3 id="å¹¶è¡ŒåŒ–é›†åˆ"><a href="#å¹¶è¡ŒåŒ–é›†åˆ" class="headerlink" title="å¹¶è¡ŒåŒ–é›†åˆ"></a>å¹¶è¡ŒåŒ–é›†åˆ</h3><p>å¹¶è¡ŒåŒ–é›†åˆæ˜¯è°ƒç”¨JavaSparkContextçš„parallelizeæ–¹æ³•æ¥åˆ›é€ çš„ã€‚è¿™ä¸ªå…ƒç´ çš„é›†åˆä¼šè¢«å¤åˆ¶ç§°ä¸ºä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®é›†ï¼Œç„¶åå¯ä»¥ç”¨æ¥å¹¶è¡ŒåŒ–æ“ä½œã€‚æ¯”å¦‚ï¼Œè¿™æ˜¯å¦‚ä½•åˆ›é€ ä¸€ä¸ªå¹¶è¡ŒåŒ–é›†åˆæ¥å­˜å‚¨æ•°å­—1åˆ°5:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; data = Arrays.asList(1, 2, 3, 4, 5);</span><br><span class="line">JavaRDD&lt;Integer&gt; distData = sc.parallelize(data);</span><br></pre></td></tr></table></figure>
<p>ä¸€æ—¦åˆ›é€ äº†ï¼Œè¿™ä¸ªåˆ†å¸ƒå¼æ•°æ®é›†ï¼ˆdistDataï¼‰å¯ä»¥è¢«ç”¨æ¥å¹¶è¡Œæ“ä½œã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ä¹Ÿè®¸ä¼šè°ƒç”¨distData.reduce((a,b) -&gt; a + b) æ¥è®¡ç®—å…ƒç´ çš„åˆ—è¡¨çš„å’Œã€‚<br>ä¸€ä¸ªé‡è¦çš„å‚æ•°æ¥å¹¶è¡ŒåŒ–å‡ ä¸ªæ˜¯å°†è¿™ä¸ªæ•°æ®é›†æ‹†åˆ†ä¸ºå‡ ä¸ªpartitionsçš„ä¸ªæ•°ã€‚Sparkå°†ä¼šåœ¨æ¯ä¸€ä¸ªé›†ç¾¤çš„partitionè¿è¡Œä¸€ä¸ªä»»åŠ¡ã€‚ä¸€èˆ¬çš„ä½ æƒ³è¦ä¸€ä¸ªCPUæœ‰2-4ä¸ªpartitionåœ¨ä½ çš„é›†ç¾¤ä¸­ã€‚é€šå¸¸ï¼ŒSparkå°è¯•è‡ªåŠ¨è®¾ç½®partitionsåŸºäºä½ çš„é›†ç¾¤ã€‚åŒæ—¶ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨çš„è®¾ç½®é€šè¿‡ä¼ é€’ä¸€ä¸ªç§’å‚æ•°åˆ°parallelizeï¼ˆæ¯”å¦‚ï¼šsc.parallelize(data,10)ï¼‰.</p>
<h2 id="RDD-æ“ä½œ"><a href="#RDD-æ“ä½œ" class="headerlink" title="RDD æ“ä½œ"></a>RDD æ“ä½œ</h2><p>RDDsæ”¯æŒä¸¤ç§ç±»å‹çš„æ“ä½œï¼šå˜åŒ–ï¼Œä»å·²çŸ¥çš„æ•°æ®é›†ä¸­åˆ›é€ ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œå¹¶ä¸”actionsï¼ˆæ‰§è¡Œï¼‰ï¼Œå°†ä¼šè¿”å›ä¸€ä¸ªå€¼ç»™driver programåœ¨datasetè¿è¡Œäº†è®¡ç®—ä»¥åã€‚æ¯”å¦‚ï¼Œmapæ˜¯ä¸€ä¸ªå˜åŒ–ï¼Œå°†æ•°æ®é›†ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½è¿è¡Œä¸€éå‡½æ•°ï¼Œç„¶åè¿”å›æ–°çš„RDDæ¥ä»£è¡¨ç»“æœã€‚åœ¨å¦ä¸€æ–¹é¢ï¼Œreduceä¹Ÿæ˜¯ä¸€ä¸ªactionèšåˆæ‰€æœ‰çš„RDDå…ƒç´ ä½¿ç”¨æŸä¸ªå‡½æ•°ç„¶åè¿”å›æœ€ç»ˆçš„ç»“æœåˆ°driver programï¼ˆå°½ç®¡è¿™ä»ç„¶æœ‰ä¸€ä¸ªå¹¶è¡Œçš„ reduceByKeyè¿”å›ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®é›†ï¼‰ã€‚<br>Sparkä¸­æ‰€æœ‰çš„å˜åŒ–éƒ½æ˜¯lazyçš„ï¼Œå®ƒä»¬ä¸ä¼šç«‹åˆ»çš„è®¡ç®—ç»“æœã€‚åè€Œï¼Œå®ƒä»¬åªæ˜¯è®°ä½äº†æœ‰äº›åŸºæœ¬çš„æ•°æ®é›†éœ€è¦æ‰§è¡Œä¸€äº›transformationsã€‚è¿™äº›transformationsåªä¼šåœ¨æœ€åéœ€è¦ä¸€ä¸ªç»“æœè¿”å›ç»™driver programæ—¶æ‰ä¼šæ‰§è¡Œã€‚è¿™ä¸ªè®¾è®¡ä¿è¯äº†Sparkå¯ä»¥æœ‰æ•ˆç‡çš„è¿è¡Œã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è®¤è¯†åˆ°ä¸€ä¸ªåˆ›é€ äº†mapçš„æ•°æ®é›†å°†ä¼šåœ¨reduceä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”åªè¿”å›reduceçš„ç»“æœåˆ°driverä¸­ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåºå¤§çš„mappedæ•°æ®é›†ã€‚<br>é»˜è®¤çš„ï¼Œè¿™æ ·çš„å˜åŒ–çš„RDDæ¯æ¬¡ä½ è¿è¡Œä¸€ä¸ªactionåœ¨ä¸Šé¢çš„æ—¶å€™éƒ½ä¼šéœ€è¦é‡æ–°è®¡ç®—ã€‚ä½ ä¹Ÿå¯ä»¥æŒä¹…åŒ–ä¸€ä¸ªRDDåœ¨å†…å­˜ä¸­ä½¿ç”¨persistæˆ–è€…cacheæ–¹æ³•ï¼ŒSparkå°†ä¼šä¿å­˜å…ƒç´ åœ¨é›†ç¾¤ä¸­ä»¥ä¾¿å¿«é€Ÿè®¿é—®ã€‚å®ƒä¹Ÿæ”¯æŒæŒä¹…åŒ–RDDsåˆ°ç¡¬ç›˜ä¸­ï¼Œæˆ–è€…åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œå¤åˆ¶ã€‚  </p>
<h3 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h3><p>å±•ç¤ºRDDçš„åŸºç¡€ï¼Œè€ƒè™‘ä»¥ä¸‹è¿™ä¸ªç®€å•çš„ç¨‹åºï¼š  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JavaRDD&lt;String&gt; lines = sc.textFile(&quot;data.txt&quot;);</span><br><span class="line">JavaRDD&lt;Integer&gt; lineLengths = lines.map(s -&gt; s.length());</span><br><span class="line">int totalLength = lineLengths.reduce((a, b) -&gt; a + b);</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€è¡Œå®šä¹‰äº†ä¸€ä¸ªåŸºç¡€çš„RDDä»å¤–éƒ¨æ–‡ä»¶ä¸­è·å–çš„ã€‚è¿™ä¸ªæ•°æ®é›†æ²¡æœ‰åŠ è½½åˆ°å†…å­˜ä¸­æˆ–è€…é‡‡å–äº†è¡ŒåŠ¨ï¼šlinesåªæ˜¯ä¸€ä¸ªæŒ‡å‘æ–‡ä»¶çš„æŒ‡é’ˆã€‚ç¬¬äºŒè¡Œå®šä¹‰äº†lineLengthsä½œä¸ºä¸€ä¸ªmapå˜åŒ–çš„ç»“æœã€‚åŒæ ·lineLengthsä¹Ÿä¸èƒ½ç«‹å³çš„è®¡ç®—ï¼Œåº”ä¸ºlazinessã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬è¿è¡Œreduceï¼Œæ˜¯ä¸€ä¸ªactionã€‚åœ¨è¿™ä¸ªç‚¹ï¼Œsparkå°†è®¡ç®—åˆ†ä¸ºå¤šä¸ªä»»åŠ¡å¹¶ä¸”åœ¨ä¸åŒçš„ç‹¬ç«‹æœºå™¨ä¸­è¿è¡Œï¼Œæ¯ä¸€ä¸ªè¿è¡Œè‡ªå·±éƒ¨åˆ†çš„mapå’Œä¸€ä¸ªæœ¬åœ°çš„reductionï¼Œç„¶åè¿™ä¸ªç»“æœåˆ°driver programã€‚<br>å¦‚æœæˆ‘ä»¬ä»ç„¶æƒ³è¦ä½¿ç”¨lineLengthsï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lineLengths.persist(StorageLevel.MEMORY_ONLY());</span><br></pre></td></tr></table></figure>
<h3 id="ä¼ é€’å‚æ•°åˆ°Spark"><a href="#ä¼ é€’å‚æ•°åˆ°Spark" class="headerlink" title="ä¼ é€’å‚æ•°åˆ°Spark"></a>ä¼ é€’å‚æ•°åˆ°Spark</h3><p>Sparkçš„APIä¸¥é‡ä¾èµ–åœ¨driver programä¸­ä¼ é€’å‡½æ•°æ¥è¿è¡Œé›†ç¾¤ã€‚åœ¨Javaï¼Œfunctionsè¢«å®ç°äº†org.apache.spark.api.java.function packageä¸­çš„æ¥å£çš„classæ‰€ä»£è¡¨ã€‚è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼æ¥åˆ›é€ å‡½æ•°ï¼š  </p>
<ol>
<li>åœ¨ä½ è‡ªå·±çš„ç±»ä¸­å®ç°å‡½æ•°æ¥å£ï¼Œä¸ç®¡æ˜¯åŒ¿åç±»æˆ–è€…æœ‰åå­—çš„ï¼Œå¹¶ä¸”ä¼ é€’ä¸€ä¸ªå®ä¾‹åˆ°sparkã€‚</li>
<li>ä½¿ç”¨lambda expressionæ¥ç®€æ´çš„å®šä¹‰ä¸€ä¸ªå®ç°ã€‚  </li>
</ol>
<p>æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å®šä¹‰å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">JavaRDD&lt;String&gt; lines = sc.textFile(&quot;data.txt&quot;);</span><br><span class="line">JavaRDD&lt;Integer&gt; lineLengths = lines.map(new Function&lt;String, Integer&gt;() &#123;</span><br><span class="line">  public Integer call(String s) &#123; return s.length(); &#125;</span><br><span class="line">&#125;);</span><br><span class="line">int totalLength = lineLengths.reduce(new Function2&lt;Integer, Integer, Integer&gt;() &#123;</span><br><span class="line">  public Integer call(Integer a, Integer b) &#123; return a + b; &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…å†™å‡½æ•°æ˜¯ç¬¨é‡çš„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class GetLength implements Function&lt;String, Integer&gt; &#123;</span><br><span class="line">  public Integer call(String s) &#123; return s.length(); &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Sum implements Function2&lt;Integer, Integer, Integer&gt; &#123;</span><br><span class="line">  public Integer call(Integer a, Integer b) &#123; return a + b; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">JavaRDD&lt;String&gt; lines = sc.textFile(&quot;data.txt&quot;);</span><br><span class="line">JavaRDD&lt;Integer&gt; lineLengths = lines.map(new GetLength());</span><br><span class="line">int totalLength = lineLengths.reduce(new Sum());</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„åˆ°javaçš„åŒ¿åå‡½æ•°åŒæ ·ä¹Ÿå¯ä»¥è®¿é—®å˜é‡åœ¨enclosingèŒƒå›´å†…ï¼Œåªè¦å®ƒä»¬è¢«æ ‡è®°ä¸ºfinalã€‚Sparkå°†ä¼šä¼ è¾“è¿™äº›å˜é‡åˆ°å·¥ä½œèŠ‚ç‚¹å°±åƒå®ƒä¼šç»™å…¶ä»–çš„è¯­è¨€æ‰€åšçš„é‚£æ ·ã€‚  </p>
<h3 id="äº†è§£closures"><a href="#äº†è§£closures" class="headerlink" title="äº†è§£closures"></a>äº†è§£closures</h3><p>Sparkè¾ƒä¸ºå›°éš¾çš„ä¸€ä»¶äº‹æƒ…æ˜¯ç†è§£èŒƒå›´å’Œå˜é‡å’Œæ–¹æ³•çš„ç”Ÿå‘½å‘¨æœŸå½“ä»£ç åœ¨é›†ç¾¤ä¸­è¿è¡Œçš„æ—¶å€™ã€‚RDDæ“ä½œæ”¹å˜äº†å˜é‡çš„å¤–éƒ¨èŒƒå›´å¸¸å¸¸å®¹æ˜“è®©äººå›°æƒ‘ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä½¿ç”¨foreach()æ¥å¢åŠ ä¸€ä¸ªcounterï¼Œä½†æ˜¯åŒæ ·çš„é—®é¢˜ä¹Ÿä¼šåœ¨å…¶ä»–çš„æ“ä½œä¸­å‘ç”Ÿã€‚  </p>
<h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><p>è€ƒè™‘åŸç”Ÿçš„RDDå…ƒç´ å’Œï¼Œå°†ä¼šæ ¹æ®æ˜¯å¦åœ¨ç›¸åŒçš„JVMä¸Šè¿è¡Œä¼šæœ‰ä¸åŒçš„ç»“æœã€‚ä¸€ä¸ªæ™®é€šçš„ä¾‹å­æ˜¯æ‰§è¡Œsparkåœ¨localæ¨¡å¼ï¼ˆâ€“master = local[n]ï¼‰å¯¹æ¯”éƒ¨ç½²ä¸€ä¸ªsparkåˆ°ä¸€ä¸ªé›†ç¾¤ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int counter = 0;</span><br><span class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(data);</span><br><span class="line"></span><br><span class="line">// Wrong: Don&apos;t do this!!</span><br><span class="line">rdd.foreach(x -&gt; counter += x);</span><br><span class="line"></span><br><span class="line">println(&quot;Counter value: &quot; + counter);</span><br></pre></td></tr></table></figure>
<h4 id="Local-VS-cluster-modes"><a href="#Local-VS-cluster-modes" class="headerlink" title="Local VS. cluster modes"></a>Local VS. cluster modes</h4><p>ä¸Šé¢çš„ä»£ç çš„è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ï¼Œè€Œä¸”å¯èƒ½è¿è¡Œå¹¶ä¸åƒæ‰€é¢„æœŸçš„ã€‚ä¸ºäº†æ‰§è¡Œjobï¼Œsparkå°†RDDæ“ä½œåˆ‡æˆå¤šä¸ªä»»åŠ¡ï¼Œæ¯ä¸€ä¸ªåœ¨ä¸€ä¸ªexecutorä¸­æ‰§è¡Œã€‚åœ¨æ‰§è¡Œä¹‹å‰ï¼ŒSparkä¼šè®¡ç®—è¿™ä¸ªä»»åŠ¡çš„closureã€‚Closureæ˜¯å“ªäº›å˜é‡å’Œæ–¹æ³•å¿…é¡»å¯¹è¿™ä¸ªexecutorå¯è§æ¥æ‰§è¡Œå¯¹RDDçš„è®¡ç®—ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­foreach()ï¼‰ã€‚è¿™ä¸ªclosureæ˜¯åºåˆ—åŒ–çš„å¹¶ä¸”è¢«å‘ç»™æ¯ä¸€ä¸ªexecutorã€‚<br>è¢«å‘ç»™æ¯ä¸€ä¸ªexecutorçš„è¿™ä¸ªclosureçš„å˜é‡ä¼šè¢«å¤åˆ¶å¹¶ä¸”ç„¶åå½“counteråœ¨è¿™ä¸ªforeachå‡½æ•°ä¸­è¢«å¼•ç”¨æ—¶ï¼Œå®ƒä¸å†æ˜¯åœ¨driverèŠ‚ç‚¹ä¸Šçš„counterã€‚è¿™é‡Œä»ç„¶æœ‰ä¸€ä¸ªcounteråœ¨driverèŠ‚ç‚¹çš„å†…å­˜ä¸­ï¼Œä½†æ˜¯ä¸åœ¨å¯¹executorå¯è§äº†ã€‚executorsåªèƒ½çœ‹åˆ°åºåˆ—åŒ–çš„closureçš„å‰¯æœ¬ã€‚è¿™æ ·æœ€ç»ˆçš„counterä»ç„¶å°†ä¼šæ˜¯0å› ä¸ºæ‰€æœ‰åœ¨counteræ“ä½œéƒ½æ˜¯å¯¹åºåˆ—åŒ–closureä¸Šçš„å€¼çš„æ“ä½œã€‚<br>åœ¨æœ¬åœ°æ¨¡å¼ï¼Œæœ‰æ—¶ï¼Œforeachå‡½æ•°å°†ä¼šå®é™…åœ¨å’Œdriveä¸Šçš„åŒä¸€ä¸ªjvmä¸­æ‰§è¡Œï¼ŒåŒæ—¶ä¼šå¼•ç”¨åŸæ¥çš„counterï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šæ›´æ–°å®ƒã€‚<br>ä¸ºäº†ä¿è¯è¿™ç§æƒ…å†µçš„å¯æ§æ€§ï¼Œåº”è¯¥ä½¿ç”¨ä¸€ä¸ª Accumulatorã€‚Accumulatorsåœ¨sparkä¸­é€šå¸¸ç”¨æ¥æä¾›ä¸€ä¸ªæœºåˆ¶æ¥å®‰å…¨çš„æ›´æ–°ä¸€ä¸ªå˜é‡ï¼Œå½“æ‰§è¡Œè¢«åˆ‡åˆ†åˆ°ä¸åŒçš„workerèŠ‚ç‚¹ä¸­æ—¶ã€‚è¿™ä¸ªAccumulatorsåœ¨åç»­è¿˜ä¼šè¢«è®¨è®ºã€‚<br>é€šå¸¸è¯´æ¥ï¼Œ closures - constructså–œæ¬¢å¾ªç¯æ´»ç€æœ¬åœ°å®šä¹‰æ–¹æ³•ï¼Œä¸åº”è¯¥è¢«ç”¨æ¥æ”¹å˜ä¸€äº›å…¨å±€çš„çŠ¶æ€ã€‚Sparkä¸èƒ½å®šä¹‰æˆ–è€…ä¿è¯å¯¹å¯¹è±¡çš„æ”¹å˜ã€‚ä¸€äº›ä»£ç ä¹Ÿè®¸ä¼šåœ¨æœ¬åœ°æ¨¡å¼å…¶æ•ˆæœï¼Œä½†æ˜¯ä¹Ÿåªæ˜¯å¶ç„¶ï¼ŒåŒæ—¶åœ¨åˆ†å¸ƒå¼æ¨¡å¼ä¹Ÿä¸èƒ½å’ŒæœŸæœ›ä¸€æ ·è¿è¡Œã€‚ä½¿ç”¨ä¸€ä¸ªAccumulatorsæ¥å–ä»£ä¸€äº›å…¨å±€å˜é‡çš„èšåˆæ˜¯å¿…è¦çš„ã€‚  </p>
<h4 id="æ‰“å°ä¸€ä¸ªRDDçš„å…ƒç´ "><a href="#æ‰“å°ä¸€ä¸ªRDDçš„å…ƒç´ " class="headerlink" title="æ‰“å°ä¸€ä¸ªRDDçš„å…ƒç´ "></a>æ‰“å°ä¸€ä¸ªRDDçš„å…ƒç´ </h4><p>å¦å¤–ä¸€ä¸ªå¸¸è§çš„è¡Œä¸ºæ˜¯è¯•å›¾ä½¿ç”¨rdd.foreach(println)æˆ–rdd.map(println)æ‰“å°ä¸€ä¸ªRDDå…ƒç´ ã€‚åœ¨å•æœºæƒ…å†µä¸‹ï¼Œè¿™ä¸ªå°†ä¼šè¾“å‡ºæœŸæœ›å¹¶ä¸”æ‰“å‡ºæ‰€æœ‰çš„RDDå…ƒç´ ã€‚ç„¶è€Œåœ¨é›†ç¾¤çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªstdoutçš„è¾“å‡ºåªä¼šè¢«executoræ‰€è°ƒç”¨å¹¶ä¸”å†™åˆ°executorçš„stdoutä¸­ï¼Œè€Œä¸æ˜¯åœ¨driver nodeä¸Šï¼Œæ‰€ä»¥driverä¸Šå¹¶ä¸ä¼šè¾“å‡ºè¿™äº›å†…å®¹ã€‚ä¸ºäº†æ‰“å‡ºæ‰€æœ‰åœ¨driverä¸Šçš„å…ƒç´ ï¼Œä¸€ä¸ªå¯ä»¥ä½¿ç”¨collect()æ–¹æ³•æ¥å°†RDDæ”¾åˆ°driverä¸Šï¼šrdd.collect().foreach(println)ã€‚è¿™ä¸ªä¼šå¼•èµ·driverå†…å­˜æº¢å‡ºï¼Œå› ä¸ºcollect()å°†å…¨éƒ¨çš„RDDæ”¾åˆ°ä¸€å°æœºå™¨ä¸Šï¼Œå¦‚æœä½ åªéœ€è¦æ‰“å‡ºRDDä¸­çš„éƒ¨åˆ†å…ƒç´ ï¼Œä¸€ä¸ªå®‰å…¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨take():<br>rdd.take(100).foreach(println).  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.sevenpan.com/2018/04/04/RDDSpark/" data-id="cjnctr01n0006tirrjrm99rlf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-sparkLearningNote" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/02/sparkLearningNote/" class="article-date">
  <time datetime="2018-04-02T13:57:35.000Z" itemprop="datePublished">2018-04-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/02/sparkLearningNote/">Sparks çš„ä¸€äº›åè¯</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Some-terms-with-Spark"><a href="#Some-terms-with-Spark" class="headerlink" title="Some terms with Spark"></a>Some terms with Spark</h1><p><a href="https://spark.apache.org/docs/latest/cluster-overview.html" target="_blank" rel="noopener">https://spark.apache.org/docs/latest/cluster-overview.html</a></p>
<h3 id="excutor"><a href="#excutor" class="headerlink" title="excutor"></a>excutor</h3><p>A process launched for an application on a worker node, that runs tasks and keeps data in memory or disk storage across them. Each application has its own executors.<br>åœ¨ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹è¿è¡Œçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œç”¨æ¥è¿è¡Œä»»åŠ¡ï¼Œä¿å­˜æ•°æ®åœ¨å†…å­˜æˆ–è€…ç¡¬ç›˜ä¸­ã€‚æ¯ä¸€ä¸ªåº”ç”¨æœ‰è‡ªå·±çš„executorsã€‚</p>
<h3 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h3><p>User program built on Spark. Consists of a driver program and executors on the cluster.<br>åœ¨Sparkä¸Šçš„ç”¨æˆ·ç¨‹åºã€‚æœ‰ä¸€ä¸ªé©±åŠ¨ç¨‹åºå’Œexecutoråœ¨é›†ç¾¤ä¸­ç»„æˆã€‚  </p>
<h3 id="Application-jar"><a href="#Application-jar" class="headerlink" title="Application jar"></a>Application jar</h3><p>A jar containing the userâ€™s Spark application. In some cases users will want to create an â€œuber jarâ€ containing their application along with its dependencies. The userâ€™s jar should never include Hadoop or Spark libraries, however, these will be added at runtime.  </p>
<p><b>ä¸€ä¸ªåŒ…å«äº†ç”¨æˆ·sparkåº”ç”¨çš„ç¨‹åºã€‚åœ¨æœ‰çš„åœ°æ–¹ç”¨æˆ·å°†ä¼šåˆ›é€ ä¸€ä¸ªâ€œæ··åˆjarâ€å°†å¥¹ä»¬çš„åº”ç”¨å’Œä¾èµ–ä¸€èµ·åŒ…å«ã€‚è¿™ä¸ªç”¨æˆ·çš„jarä¸åº”è¯¥åŒ…å«hadoopæˆ–è€…sparkçš„åŒ…ï¼Œå®ƒä»¬å°†ä¼šåœ¨è¿è¡Œæ—¶è¢«æ·»åŠ ã€‚ ï¼Ÿï¼Ÿï¼Ÿ è¿™æ®µæ²¡çœ‹æ‡‚</b></p>
<h3 id="Driver-program"><a href="#Driver-program" class="headerlink" title="Driver program"></a>Driver program</h3><p>The process running the main() function of the application and creating the SparkContext<br>åˆ›é€ åº”ç”¨çš„main()å‡½æ•°å¹¶ä¸”åˆ›é€ SparkContext</p>
<h3 id="Cluster-manager"><a href="#Cluster-manager" class="headerlink" title="Cluster manager"></a>Cluster manager</h3><p>An external service for acquiring resources on the cluster (e.g. standalone manager, Mesos, YARN)<br>ä¸€ä¸ªå¤–éƒ¨çš„æœåŠ¡ç”¨äºè·å–é›†ç¾¤çš„èµ„æºã€‚ï¼ˆæ¯”å¦‚standalone managerï¼ŒMesosï¼Œ YARNï¼‰</p>
<h3 id="Deploy-mode"><a href="#Deploy-mode" class="headerlink" title="Deploy mode"></a>Deploy mode</h3><p>Distinguishes where the driver process runs. In â€œclusterâ€ mode, the framework launches the driver inside of the cluster. In â€œclientâ€ mode, the submitter launches the driver outside of the cluster.<br>åŒºåˆ†é©±åŠ¨è¿›ç¨‹åœ¨å“ªè¿è¡Œã€‚åœ¨â€œclusterâ€æ¨¡å¼ä¸‹ï¼Œè¿™ä¸ªæ¡†æ¶å¯åŠ¨é©±åŠ¨åœ¨é›†ç¾¤å†…éƒ¨ã€‚åœ¨â€œclientâ€æ¨¡å¼ä¸‹ï¼Œsubmitteråœ¨é›†ç¾¤å¤–å¯åŠ¨è¿›ç¨‹ã€‚  </p>
<h3 id="Worker-node"><a href="#Worker-node" class="headerlink" title="Worker node"></a>Worker node</h3><p>Any node that can run application code in the cluster<br>åœ¨é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹å¯ä»¥è¿è¡Œåº”ç”¨ä»£ç ã€‚</p>
<h3 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h3><p>A unit of work that will be sent to one executor<br>ä¸€ç»„ä¼šè¢«å‘é€åˆ°ä¸€ä¸ªexecutorçš„å·¥ä½œã€‚</p>
<h3 id="Job"><a href="#Job" class="headerlink" title="Job"></a>Job</h3><p>A parallel computation consisting of multiple tasks that gets spawned in response to a Spark action (e.g. save, collect); youâ€™ll see this term used in the driverâ€™s logs.<br>ä¸€ä¸ªåŒ…å«äº†å¤šä¸ªä»»åŠ¡çš„å¹¶è¡Œè®¡ç®—ç”¨æ¥å“åº”ä¸€ä¸ªSpark actionã€‚</p>
<h3 id="Stage"><a href="#Stage" class="headerlink" title="Stage"></a>Stage</h3><p>Each job gets divided into smaller sets of tasks called stages that depend on each other (similar to the map and reduce stages in MapReduce); youâ€™ll see this term used in the driverâ€™s logs.<br>æ¯ä¸€ä¸ªå·¥ä½œè¢«åˆ†ä¸ºå¾ˆå°çš„ä»»åŠ¡é›†è¢«ç§°ä¸ºstagesï¼›ä½ å¯ä»¥åœ¨driverçš„æ—¥å¿—ä¸­çœ‹åˆ°å®ƒä»¬ã€‚</p>
<h2 id="ç»„æˆéƒ¨åˆ†"><a href="#ç»„æˆéƒ¨åˆ†" class="headerlink" title="ç»„æˆéƒ¨åˆ†"></a>ç»„æˆéƒ¨åˆ†</h2><p>Spark applicationæ˜¯ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹é›†åˆåœ¨é›†ç¾¤ä¸Šè¿è¡Œï¼Œé€šè¿‡ä½ çš„ä¸»ç¨‹åºï¼ˆç§°ä¸ºdriver programï¼‰ä¸­çš„SparkContextæ¥åè°ƒå·¥ä½œã€‚<br>ç‰¹åˆ«çš„ï¼Œåœ¨é›†ç¾¤ä¸Šè¿è¡Œï¼ŒSparkContextå¯ä»¥é“¾æ¥ä¸åŒçš„é›†ç¾¤ç®¡ç†ï¼ˆeither Sparkâ€™s own standalone cluster manager, Mesos or YARNï¼‰ï¼Œç”¨æ¥åœ¨åº”ç”¨ä¸­åˆ†é…èµ„æºã€‚ä¸€æ—¦è¿æ¥ï¼ŒSparkè·å–é›†ç¾¤ä¸­èŠ‚ç‚¹ä¸Šçš„executorsï¼Œæ˜¯ä½ åº”ç”¨ä¸­çš„è¿›ç¨‹ç”¨äºè®¡ç®—å’Œå­˜å‚¨æ•°æ®ã€‚ä¸‹ä¸€æ­¥å®ƒä¼šå‘é€ä½ çš„åº”ç”¨ç¨‹åºï¼ˆé€šè¿‡JARæˆ–è€…Pythonæ–‡ä»¶å®šä¹‰çš„ä¼ é€’ç»™SparkContextï¼‰åˆ°executorsã€‚æœ€ç»ˆï¼ŒSparkContextå‘é€ä»»åŠ¡åˆ°exexutoræ¥è¿è¡Œã€‚<br>åœ¨è¿™ä¸ªæ¶æ„ä¸­æœ‰ä»¥ä¸‹ä¸€äº›äº‹æƒ…éœ€è¦æ³¨æ„ï¼š  </p>
<ol>
<li>æ¯ä¸€ä¸ªåº”ç”¨è·å–å®ƒè‡ªå·±çš„executorè¿›ç¨‹ï¼Œé‚£äº›è¿›ç¨‹ä¼šåœ¨æ•´ä¸ªåº”ç”¨ä¸­å¯åŠ¨ï¼Œå¹¶ä¸”è¿è¡Œä»»åŠ¡åœ¨å¤šä¸ªçº¿ç¨‹é‡Œã€‚<br> è¿™æœ‰åˆ©äºå¯¹æ¯ä¸€ä¸ªåº”ç”¨è¿›è¡Œéš”ç¦»ï¼Œåœ¨è°ƒåº¦æ–¹é¢ï¼ˆæ¯ä¸€ä¸ªé©±åŠ¨è°ƒåº¦è‡ªå·±çš„ä»»åŠ¡ï¼‰å’Œæ‰§è¡Œæ–¹é¢ï¼ˆä¸åŒçš„åº”ç”¨åœ¨ä¸åŒçš„JVMä¸­è¿è¡Œï¼‰ã€‚è¿™ä¹Ÿæ„å‘³ç€æ•°æ®ä¸èƒ½åœ¨ä¸åŒçš„Spart åº”ç”¨ä¸­å…±äº«ï¼ˆSparkContextçš„å®ä¾‹ï¼‰é™¤éå°†å®ƒä»¬å†™åˆ°ä¸€ä¸ªå¦å¤–çš„å­˜å‚¨ç³»ç»Ÿä¸­ã€‚</li>
<li>Sparkå¯¹äºåº•å±‚çš„é›†ç¾¤ç®¡ç†æ˜¯ä¸å¯çŸ¥çš„ã€‚åªè¦å®ƒå¯ä»¥è·å–åˆ°å¤„ç†å™¨çš„è¿›ç¨‹ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„é€šè®¯ï¼Œå®ƒå¯ä»¥å¾ˆå®¹æ˜“çš„åœ¨æ”¯æŒå…¶ä»–çš„åº”ç”¨çš„é›†ç¾¤ç®¡ç†å™¨ä¸Šè¿è¡Œã€‚  </li>
<li>Driverç¨‹åºåœ¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»ç›‘å¬å¹¶ä¸”ä»å®ƒçš„executorä¸­æ¥å—ä¼šæ¥çš„è¿æ¥ã€‚æ‰€ä»¥drivenç¨‹åºå¿…é¡»ç½‘ç»œå¯è¾¾å¯¹äºworkerèŠ‚ç‚¹ã€‚  </li>
<li>ç”±äºdriver åœ¨é›†ç¾¤ä¸­è°ƒåº¦taskï¼Œå®ƒåº”è¯¥åœ¨æ¥è¿‘workerèŠ‚ç‚¹çš„åœ°æ–¹è¿è¡Œï¼Œåå‘äºåœ¨åŒä¸€ä¸ªç½‘ç»œã€‚å¦‚æœä½ æƒ³è¦è¿œç¨‹å‘é€è¯·æ±‚ï¼Œé‚£ä¹ˆæœ€å¥½å¯¹driveræ‰“å¼€RPCå¹¶ä¸”ä»é™„è¿‘æäº¤æ“ä½œè€Œä¸æ˜¯è¿è¡Œä¸€ä¸ªå¾ˆé¥è¿œçš„driverã€‚  </li>
</ol>
<p><b>When running Spark on YARN, each Spark executor runs as a YARN container.<br>Where MapReduce schedules a container and starts a JVM for each task, Spark hosts multiple tasks within the same container.</b><br>æ‰€ä»¥executorå°±æ˜¯å¯¹åº”çš„containerï¼Œç„¶ååŸæ¥MapReduceæ˜¯ä¸€ä¸ªContainerè¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼ŒSparkå¯ä»¥åœ¨ä¸€ä¸ªContainerä¸­è¿è¡Œå¤šä»»åŠ¡ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.sevenpan.com/2018/04/02/sparkLearningNote/" data-id="cjnctr021000dtirrdle9ihl3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-LSTM" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/02/LSTM/" class="article-date">
  <time datetime="2018-04-02T06:05:05.000Z" itemprop="datePublished">2018-04-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/02/LSTM/">LSTM Walk Through ç¿»è¯‘</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="LSTM-Walk-Through"><a href="#LSTM-Walk-Through" class="headerlink" title="LSTM Walk Through"></a>LSTM Walk Through</h1><p>reference: <a href="http://colah.github.io/posts/2015-08-Understanding-LSTMs/" target="_blank" rel="noopener">http://colah.github.io/posts/2015-08-Understanding-LSTMs/</a></p>
<p>åœ¨ä¸‹é¢è¿™ä¸ªLSTMæ¨¡å‹ä¸­ï¼Œéœ€è¦å†³å®šçš„ç¬¬ä¸€ç‚¹å°±æ˜¯æˆ‘ä»¬å°†è¦ä¸¢æ‰ä»€ä¹ˆä»cell çŠ¶æ€ä¸­ã€‚<br>è¿™ä¸ªå†³å®šæ˜¯è¢«ä¸€ä¸ªç§°ä¸ºï¼šâ€œforget gate layerâ€ çš„sigmoid å±‚æ¥å†³å®šçš„ã€‚å®ƒå°† \( h_{t-1}\) å’Œ \(x_t\)ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä¸”è¾“å‡ºä¸€ä¸ªä»‹äº0åˆ°1ä¹‹é—´çš„å€¼åœ¨cell state \(C_{t-1}\). 1ä»£è¡¨å®Œå…¨çš„ä¿å­˜è€Œ0ä»£è¡¨å®Œå…¨ä¸¢æ‰ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹å›ä¹‹å‰çš„è¯­è¨€æ¨¡å‹ï¼Œè¯•å›¾æ ¹æ®å‰ä¸€ä¸ªå€¼æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªå€¼ã€‚åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œè¿™ä¸ªCell stateå¯èƒ½åŒ…æ‹¬åŒ…æ‹¬å½“å‰å®¢ä½“çš„æ€§åˆ«ï¼Œæ‰€ä»¥æ­£ç¡®çš„ä»£è¯æ‰ä¼šè¢«ä½¿ç”¨ã€‚å½“æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªæ–°çš„å®¢ä½“æ—¶ï¼Œæˆ‘ä»¬æƒ³è¦å¿˜æ‰è€çš„å®¢ä½“ã€‚<br><img src="http://colah.github.io/posts/2015-08-Understanding-LSTMs/img/LSTM3-focus-f.png" alt=""><br>ä¸‹ä¸€æ­¥æ˜¯å†³å®šå“ªäº›æ–°çš„ä¿¡æ¯æˆ‘ä»¬æƒ³è¦å­˜å‚¨åˆ°cell stateä¸­ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼š  </p>
<pre><code>1. ä¸€ä¸ªsigmoidå±‚ï¼Œç§°ä¸ºâ€œinput gate layerâ€ï¼Œå†³å®šå“ªäº›å€¼ï¼Œæˆ‘ä»¬å°†ä¼šæ›´æ–°ã€‚
2. ä¸€ä¸ªtanhå±‚ï¼Œåˆ›é€ ä¸€ä¸ªæ–°çš„å€™é€‰å€¼çš„å‘é‡ï¼Œ\\( C_t^~ \\),å°†ä¼šç”¨æ¥åŠ å…¥åˆ°çŠ¶æ€ä¸­ã€‚åœ¨ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†ä¼šç»„åˆè¿™ä¸¤ä¸ªç„¶åæ¥åœ¨çŠ¶æ€é‡Œåˆ›é€ ä¸€ä¸ªå‡çº§ã€‚
</code></pre><p>åœ¨æˆ‘ä»¬çš„è¯­è¨€æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦å¢åŠ æ–°å®¢ä½“çš„æ€§åˆ«åˆ°cell stateä¸­ï¼Œæ¥æ›¿æ¢æˆ‘ä»¬å¿˜æ‰çš„è€çš„ã€‚</p>
<p><img src="http://colah.github.io/posts/2015-08-Understanding-LSTMs/img/LSTM3-focus-i.png" alt=""><br>ç°åœ¨æ˜¯æ—¶å€™å‡çº§è€çš„cell stateï¼Œ\(C_{t-1} \)åˆ°æ–°çš„cell state \( C_t\).å‰ä¸€ä¸ªæ­¥éª¤å·²ç»å®é™…å†³å®šäº†æ€ä¹ˆåšï¼Œæˆ‘ä»¬åªéœ€è¦çœŸæ­£å®æ–½å°±å¥½ã€‚<br>æˆ‘ä»¬å¯¹è€çš„stateä¹˜ \( f_t\),æ¥å¿˜è®°æˆ‘ä»¬ä¹‹å‰å†³å®šå¿˜è®°çš„ã€‚ç„¶åæˆ‘ä»¬åŠ ä¸Š \( i_t * C_t^{~} \). è¿™æ˜¯æ–°çš„å€™é€‰å€¼ï¼Œé€šè¿‡æˆ‘ä»¬å†³å®šå‡çº§å¤šå°‘çš„çŠ¶æ€æ¥æ‰©å±•ã€‚<br>åœ¨è¿™ä¸ªè¯­è¨€æ¨¡å‹ä¸­ï¼Œè¿™æ˜¯æˆ‘ä»¬å®é™…ä¸¢æ‰è€å®¢ä½“çš„æ€§åˆ«å’Œæ·»åŠ å®ƒä»¬æ–°çš„ä¿¡æ¯çš„åœ°æ–¹ã€‚<br><img src="http://colah.github.io/posts/2015-08-Understanding-LSTMs/img/LSTM3-focus-C.png" alt=""></p>
<p>æœ€ç»ˆæˆ‘ä»¬éœ€è¦å†³å®šæˆ‘ä»¬æƒ³è¦è¾“å‡ºä»€ä¹ˆã€‚è¿™ä¸ªè¾“å‡ºå°†ä¼šåŸºäºæˆ‘ä»¬çš„cell stateï¼Œä½†æ˜¯å°†ä¼šæ˜¯ä¸€ä¸ªfiltered ç‰ˆæœ¬ã€‚é¦–å…ˆæˆ‘ä»¬è¿è¡Œä¸€ä¸ªsigmoid å±‚çº§ï¼Œæ¥å†³å®šcell stateå“ªä¸€éƒ¨åˆ†æˆ‘ä»¬å°†ä¼šè¾“å‡ºï¼Œç„¶åæˆ‘ä»¬å°†è¿™ä¸ªcell stateè¿›è¡Œtanhå¤„ç†ï¼ˆå°†è¿™ä¸ªå€¼è¾“å‡ºä¸º-1 åˆ° 1 ä¹‹é—´ï¼‰ç„¶åå’Œsigmoid gateçš„è¾“å‡ºç›¸ä¹˜ï¼Œè¿™æ ·æˆ‘ä»¬åªè¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„éƒ¨åˆ†ã€‚  </p>
<p>å¯¹äºè¯­è¨€æ¨¡å‹ä¾‹å­ï¼Œç”±äºå®ƒåªæ˜¯çœ‹åˆ°ä¸€ä¸ªå®¢ä½“ï¼Œä¹Ÿè®¸æƒ³è¦è¾“å‡ºä¿¡æ¯å’ŒåŠ¨è¯ç›¸å…³ã€‚æ¯”å¦‚å®ƒå¯èƒ½è¾“å‡ºæ˜¯å¦è¿™ä¸ªå®¢ä½“æ˜¯å•æ•°æˆ–è€…å¤æ•°ï¼Œè¿™æ ·æˆ‘ä»¬çŸ¥é“æ¥ä¸‹æ¥åº”è¯¥ä½¿ç”¨ä»€ä¹ˆå½¢å¼çš„åŠ¨è¯ã€‚<br><img src="http://colah.github.io/posts/2015-08-Understanding-LSTMs/img/LSTM3-focus-o.png" alt=""></p>
<h2 id="Variances-in-Code"><a href="#Variances-in-Code" class="headerlink" title="Variances in Code"></a>Variances in Code</h2><p><b>batch_size:</b>denotes the subset size of your training sample (e.g. 100 out of 1000) which is going to be used in order to train the network during its learning process. Each batch trains network in a successive order, taking into account the updated weights coming from the appliance of the previous batch.<br>åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­å°†ä¼šç”¨æ¥è®­ç»ƒä½ çš„æ¨¡å‹çš„æ•°é‡ã€‚æ¯ä¸€ä¸ªbatchè®­ç»ƒnetworkåœ¨ä¸€ä¸ªè¿ç»­çš„é¡ºåºï¼Œä¼šä¸æ–­çš„æ›´æ–°æƒé‡ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.sevenpan.com/2018/04/02/LSTM/" data-id="cjnctr01c0001tirrdwdud6n9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algotrading-pyalgotrade/">Algotrading, pyalgotrade</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deeplearning4j-spark/">deeplearning4j; spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo-git-nginx/">hexo,git,nginx</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Algotrading-pyalgotrade/" style="font-size: 10px;">Algotrading, pyalgotrade</a> <a href="/tags/deeplearning4j-spark/" style="font-size: 10px;">deeplearning4j; spark</a> <a href="/tags/hexo-git-nginx/" style="font-size: 10px;">hexo,git,nginx</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/10/17/Somethings About Pyalgotrade/">Somethings About Pyalgotrade  - the Optimizing</a>
          </li>
        
          <li>
            <a href="/2018/10/13/hexoWithGit/">Hexo With Git</a>
          </li>
        
          <li>
            <a href="/2018/04/23/Shuffle_ç¿»è¯‘è‡ªspark_programming_guideline/">Spark Programming--- Shuffle Operations ç¿»è¯‘</a>
          </li>
        
          <li>
            <a href="/2018/04/20/Distributed Training- Gradients Sharing/">Distributed Training_Gradients Sharing ç¿»è¯‘</a>
          </li>
        
          <li>
            <a href="/2018/04/15/Deep Learning on Apache Spark/">Deep Learning on Apache Spark ç¿»è¯‘</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Pan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>