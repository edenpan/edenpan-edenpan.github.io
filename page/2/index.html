<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222"/>


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"/>

<link rel="stylesheet" href="/css/main.css?v=7.0.1"/>


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="computer, finance, some recording">
<meta property="og:type" content="website">
<meta property="og:title" content="Eden">
<meta property="og:url" content="http://blog.sevenpan.com/page/2/index.html">
<meta property="og:site_name" content="Eden">
<meta property="og:description" content="computer, finance, some recording">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Eden">
<meta name="twitter:description" content="computer, finance, some recording">






  <link rel="canonical" href="http://blog.sevenpan.com/page/2/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Eden</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=[object Object]"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-135755004-1');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Eden</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br/>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2018/11/07/Algo/é…å¯¹äº¤æ˜“ç­–ç•¥RQ/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/07/Algo/é…å¯¹äº¤æ˜“ç­–ç•¥RQ/" class="post-title-link" itemprop="url">é…å¯¹äº¤æ˜“ç­–ç•¥</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-11-07 16:21:17" itemprop="dateCreated datePublished" datetime="2018-11-07T16:21:17+08:00">2018-11-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-06 17:58:50" itemprop="dateModified" datetime="2019-03-06T17:58:50+08:00">2019-03-06</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#é…å¯¹äº¤æ˜“ç­–ç•¥ - åˆ1</p>
<p>åˆåæ¬ç –ç­–ç•¥ï¼š<br><a href="https://uqer.io/v3/community/share/57b6a1b4228e5b79a375925c" target="_blank" rel="noopener">https://uqer.io/v3/community/share/57b6a1b4228e5b79a375925c</a>  </p>
<p>å‡ ä¸ªåŸºæœ¬çš„é—®é¢˜ï¼š</p>
<ol>
<li>å¦‚ä½•æ‰¾åˆ°è‚¡ç¥¨ç›¸å…³æ€§é«˜çš„è‚¡ç¥¨ï¼Ÿ</li>
<li>æ€ä¹ˆç¡®å®šè‚¡ç¥¨æ¯”è¾ƒä¹‹é—´çš„é•¿æœŸç¨³å®šå…³ç³»</li>
<li>æ€ä¹ˆä¾æ®é•¿æœŸç¨³å®šå…³ç³»æ¥å»ºç«‹ç­–ç•¥</li>
</ol>
<h2 id="å¦å¤–ä¸€ä¸ªpariTradingçš„ä»‹ç»"><a href="#å¦å¤–ä¸€ä¸ªpariTradingçš„ä»‹ç»" class="headerlink" title="å¦å¤–ä¸€ä¸ªpariTradingçš„ä»‹ç»"></a>å¦å¤–ä¸€ä¸ªpariTradingçš„ä»‹ç»</h2><p><a href="https://medium.com/auquan/pairs-trading-data-science-7dbedafcfe5a" target="_blank" rel="noopener">https://medium.com/auquan/pairs-trading-data-science-7dbedafcfe5a</a><br>å¤šé‡æ¯”è¾ƒåå·®ï¼šä¼šæœ‰å¢åŠ çš„é”™è¯¯ç”Ÿæˆä¸€ä¸ªæ˜æ˜¾çš„p-valueçš„å¯èƒ½æ€§å½“æœ‰å¤ªå¤šçš„æµ‹è¯•åœ¨è¿è¡Œçš„æ—¶å€™ã€‚ å¦‚æœ100ä¸ªæµ‹è¯•è¿è¡Œåœ¨éšæœºæ•°æ®ä¸Šï¼Œæˆ‘ä»¬åº”è¯¥æœŸæœ›çœ‹åˆ°5ä¸ªp-valueä½äº0.05.å¦‚æœä½ æ¯”è¾ƒnä¸ªè¯åˆ¸ï¼Œä½ å°†ä¼šæ‰§è¡Œn((n-1)/2æ¬¡æ¯”è¾ƒï¼Œä½ å°†ä¼šå¸Œæœ›çœ‹åˆ°å¾ˆå¤šä¸æ­£ç¡®çš„p-valus,ä»–ä»¬å°†ä¼šéšç€ä½ å¢åŠ æ¯”è¾ƒæ¬¡æ•°è€Œå¢åŠ ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä½ åº”è¯¥é€‰æ‹©å°æ•°é‡çš„å¯¹æ¥æµ‹è¯•å¯èƒ½åæ•´å¹¶ä¸”æµ‹è¯•å•ç‹¬æµ‹è¯•æ¯ä¸€ä¸ªã€‚<br><b>ï¼Ÿï¼Ÿï¼Ÿ ä¸ºå•¥æµ‹çš„å¤šäº†å¯èƒ½ä¼šäº§ç”Ÿè¿‡å¤šçš„é”™è¯¯çš„ç»“æœï¼Ÿè¿˜æ˜¯ä¸å¤ªæ‡‚ã€‚ç„¶åæ¯”è¾ƒå°çš„æ•°é‡ï¼Œè¿™ä¸ªæ•°é‡åº”è¯¥æ€ä¹ˆç¡®å®šäº†ï¼Ÿ</b><br>æ¥ä¸‹æ¥æ–‡ç« ä¸­ä»‹ç»çš„æ˜¯ä½¿ç”¨æ ‡æ™®500çš„è‚¡ç¥¨æ•°æ®æ¥äº§ç”Ÿäº¤æ˜“å¯¹ã€‚æ–‡ç« æåˆ°ï¼š<br><b>This method is prone to multiple comparison bias and in practice the securities should be subject to a second verification step.</b><br>è¿™é‡Œé¢çš„äºŒæ¬¡éªŒè¯æ˜¯æŒ‡ï¼Ÿ  </p>
<p>Z Score(Value) = (Value - Mean)/Standard Deviation<br>åœ¨å®é™…æ“ä½œä¸­ï¼Œå¸¸å¸¸è¯•å›¾å¯¹æ•°æ®åšä¸€å®šçš„æ‰©å±•ï¼Œä½†æ˜¯è¿™æ˜¯åœ¨å‡è®¾äº†ä¸€ä¸ªåº•éƒ¨çš„åˆ†å¸ƒæ—¶å€™ã€‚ é€šå¸¸æ˜¯æ­£å¤ªåˆ†å¸ƒã€‚ç„¶è€Œï¼Œå¾ˆå¤šé‡‘èæ•°æ®å¹¶ä¸æ˜¯æ­£å¤ªåˆ†å¸ƒçš„ï¼Œæˆ‘ä»¬å¿…é¡»å¾ˆå°å¿ƒï¼Œè€Œä¸æ˜¯ç®€å•çš„å‡è®¾ä¸ºæ­£å¤ªåˆ†å¸ƒæˆ–è€…ç‰¹å®šçš„åˆ†å¸ƒï¼Œå½“ç”Ÿæˆç»Ÿè®¡æ—¶ã€‚çœŸæ­£çš„æ¯”ç‡åˆ†å¸ƒå¯èƒ½ä¼šååˆ†çš„è‚¥å°¾ï¼Œå€¾å‘äºæç«¯çš„ä»·å€¼å¼„ä¹±äº†æˆ‘ä»¬çš„æ¨¡å‹ï¼Œå¹¶ä¸”äº§ç”Ÿå¾ˆå¤§çš„æŸå¤±ã€‚  </p>
<p><b>fat-tailed distribution</b><br>    <a href="https://en.wikipedia.org/wiki/Fat-tailed_distribution" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Fat-tailed_distribution</a></p>
<pre><code>A fat-tailed distribution is a probability distribution that exhibits a large skewness or kurtosis, relative to that of either a normal distribution or an exponential distribution.  
é•¿å°¾åˆ†å¸ƒæ˜¯ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒå±•ç¤ºäº†å¾ˆå¤§çš„åå·®æˆ–è€…å³°åº¦ç›¸å¯¹äºä¸€ä¸ªæ­£å¤ªåˆ†å¸ƒæˆ–è€…ä¸€ä¸ªé¢„æœŸå†…çš„åˆ†å¸ƒè€Œè¯´ã€‚  
</code></pre><p>äº§ç”Ÿä¸€ä¸ªäº¤æ˜“ä¿¡å·æœ‰ä»¥ä¸‹çš„å‡ ä¸ªæ­¥éª¤ï¼š  </p>
<ol>
<li>æ”¶é›†å¯é çš„æ•°æ®ï¼Œæ¸…ç†æ•°æ®</li>
<li>ä»æ•°æ®ä¸­åˆ›é€ ç‰¹å¾æ¥è¯†åˆ«ä¸€ä¸ªäº¤æ˜“ä¿¡å·æˆ–è€…é€»è¾‘</li>
<li>ç‰¹å¾å¯ä»¥æ˜¯Moving Average æˆ–è€…ä»·æ ¼æ•°æ®çš„æ¯”ä¾‹ï¼Œç›¸å…³æ€§æˆ–è€…æ›´å¤šå¤æ‚çš„ä¿¡å· â€” å°†å®ƒä»¬è”åˆèµ·æ¥åˆ›é€ æ›´å¤šçš„ç‰¹å¾ã€‚  </li>
<li>é€šè¿‡è¿™äº›ç‰¹å¾æ¥ç”Ÿæˆä¿¡å·ï¼Œæ¯”å¦‚äº¤æ˜“å“åº”è¯¥ä¹°ï¼Œä¹°æˆ–è€…ä¸­æ€§ã€‚  </li>
</ol>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œäº§ç”Ÿä¸€ä¸ªé…å¯¹äº¤æ˜“ç­–ç•¥çš„æ­¥éª¤å¯ä»¥å¦‚ä¸‹ï¼š</p>
<ol>
<li>æˆ‘ä»¬è¯•å›¾åˆ›é€ ä¸€ä¸ªä¿¡å·æ¥å‘Šè¯‰æˆ‘ä»¬æ˜¯å¦è¿™ä¸ªæ¯”ä¾‹åº”ä¹°æˆ–è€…å– åœ¨ä¸‹ä¸€ä¸ªæ—¶é—´é‡Œã€‚æ¯”å¦‚è¿™ä¸ªratioæ˜¯Y<br> Y(t) = Sign(Ratio(t+1) - Ratio(t))</li>
<li>è·å–æ•°æ®ï¼Œæ­¤å¤„å¹¿å‘Šçœç•¥äº†ã€‚</li>
<li>åˆ†å‰²æ•°æ®ï¼Œ70%ç”¨äºè®­ç»ƒï¼Œ30%ç”¨äºæµ‹è¯•ã€‚</li>
<li>ç‰¹å¾æ„å»º<br> ç›¸å…³ç‰¹å¾åº”è¯¥æ˜¯å“ªäº›ï¼Ÿæˆ‘ä»¬æƒ³è¦é¢„æµ‹ratioçš„ç§»åŠ¨æ–¹å‘ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°ä¸¤ä¸ªè¯åˆ¸æ˜¯åæ•´çš„ï¼Œæ‰€ä»¥è¿™ä¸ªratioå°†ä¼šåœ¨meanå€¼ä¹‹é—´ä¸Šä¸‹è¿åŠ¨ã€‚å½“å‰å€¼å’Œmeançš„å·®å°†ä¼šç”¨äºç”Ÿæˆäº¤æ˜“ä¿¡å·ã€‚<br> æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹çš„ç‰¹å¾ï¼š  <ol>
<li>60å¤©ç§»åŠ¨å¹³å‡çº¿ï¼šæ»šåŠ¨å¹³å‡å€¼çš„æµ‹é‡</li>
<li>5å¤©ç§»åŠ¨å¹³å‡çº¿ï¼š æµ‹é‡çš„å½“å‰å‡å€¼</li>
<li>60å¤©çš„æ ‡å‡†åå·®</li>
<li>z scoreï¼š (5d MAâ€Šâ€”â€Š60d MA) /60d SD</li>
</ol>
</li>
<li><p>æ¨¡å‹çš„é€‰æ‹©<br> ç ”ç©¶z-scoreçš„å›¾è¡¨å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ— è®ºè¿™ä¸ªå€¼å¤ªå¤§æˆ–è€…å¤ªå°å®ƒéƒ½å°†ä¼šå›å¤åˆ°å‡å€¼çš„æ°´å¹³ã€‚æˆ‘ä»¬ä½¿ç”¨+1/-1ä½œä¸ºé˜€å€¼æ¥ä»£è¡¨è¿‡é«˜æˆ–è€…å¤ªä½ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ¨¡å‹æ¥ç”Ÿæˆä¸€ä¸ªäº¤æ˜“ä¿¡å·ï¼š<br> Ratio æ˜¯buy(1)å½“z-scoreä½äº-1.0æ—¶ï¼Œå› ä¸ºæˆ‘ä»¬æœŸæœ›z scoreå°†ä¼šå›åˆ°0ï¼Œä¹Ÿå°±æ˜¯å¢åŠ .<br> Ratio æ˜¯sell(-1)å½“z-scoreé«˜äº1.0æ—¶ï¼Œå› ä¸ºæˆ‘ä»¬æœŸæœ›z scoreå°†ä¼šå›åˆ°0ï¼Œä¹Ÿå°±æ˜¯é™ä½.</p>
</li>
<li><p>è®­ç»ƒï¼Œæ ¡éªŒå’Œä¼˜åŒ–</p>
</li>
</ol>
<h3 id="é¿å…è¿‡åº¦æ‹Ÿåˆ"><a href="#é¿å…è¿‡åº¦æ‹Ÿåˆ" class="headerlink" title="é¿å…è¿‡åº¦æ‹Ÿåˆ"></a>é¿å…è¿‡åº¦æ‹Ÿåˆ</h3><p>åœ¨ä¸Šè¿°æ¨¡å‹ä¸­ï¼Œä½¿ç”¨äº†rollingå‚æ•°æ¥åˆ›å»ºè€Œä¸”ä¹Ÿè®¸å¸Œæœ›æ¥ä¼˜åŒ–çª—å£å¤§å°ã€‚æˆ‘ä»¬ä¹Ÿè®¸å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç®€å•çš„è¿­ä»£æ¥è®¡ç®—å…¨éƒ¨çš„å¯èƒ½çš„çª—å£å¤§å°ï¼Œç„¶åä½¿ç”¨æœ€å¥½çš„è¡¨ç°çš„çª—å£å¤§å°ã€‚ä½†æ˜¯å°±æ˜¯ä¼šæœ‰è¿‡åº¦æ‹Ÿåˆçš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªæ–‡ç« é‡Œæåˆ°çš„æ˜¯ä½¿ç”¨ç»æµå­¦çš„è§£é‡Šæˆ–è€…ä½¿ç”¨ç®—æ³•çš„ç‰¹æ€§æ¥é€‰æ‹©çª—å£é•¿åº¦ã€‚å½“ç„¶è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•ï¼š Kalman filterï¼Œè¿™ä¸ªæ®è¯´ä¸éœ€è¦åˆ¶å®šä¸€ä¸ªç‰¹å®šçš„é•¿åº¦ï¼Œæˆ‘å‡†å¤‡æ¥ä¸‹æ¥çœ‹ä¸‹è¿™ä¸ªã€‚  </p>
<h3 id="æ›´å¤šä¿¡æ¯"><a href="#æ›´å¤šä¿¡æ¯" class="headerlink" title="æ›´å¤šä¿¡æ¯"></a>æ›´å¤šä¿¡æ¯</h3><p>ä¸Šè¿°åªæ˜¯ä¸€ä¸ªç®€å•çš„å¼€å‘pairtradingç­–ç•¥çš„è¿‡ç¨‹ï¼Œåœ¨ç°å®ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨æ›´å¤æ‚çš„ç»Ÿè®¡å­¦æ–¹å¼ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code>1. Hurst Exponent
2. Half-life of mean reversion inferred from an Ornstein-Uhlenbeck process
3. Kalman filters
</code></pre>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2018/10/17/Algo/Somethings About Pyalgotrade/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/17/Algo/Somethings About Pyalgotrade/" class="post-title-link" itemprop="url">Somethings About Pyalgotrade  - the Optimizing</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-17 13:27:39" itemprop="dateCreated datePublished" datetime="2018-10-17T13:27:39+08:00">2018-10-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-06 17:39:34" itemprop="dateModified" datetime="2019-03-06T17:39:34+08:00">2019-03-06</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://gbeced.github.io/pyalgotrade/docs/v0.20/html/tutorial.html#optimizing" target="_blank" rel="noopener">http://gbeced.github.io/pyalgotrade/docs/v0.20/html/tutorial.html#optimizing</a></p>
<h2 id="The-optimizing"><a href="#The-optimizing" class="headerlink" title="The optimizing"></a>The optimizing</h2><p>ä¼˜åŒ–ï¼ŒğŸ’¡å¾ˆç®€å•ï¼š</p>
<pre><code>ä¸€å°serverç”¨äºï¼š
    1. æä¾›barsç”¨æ¥è¿è¡Œç­–ç•¥
    2. æä¾›å‚æ•°ç”¨æ¥è¿è¡Œç­–ç•¥
    3. è®°å½•æ¯ä¸€ä¸ªworkerçš„è¿è¡Œç­–ç•¥çš„ç»“æœ
å¾ˆå¤šworkerç”¨æ¥ï¼š
    ä½¿ç”¨serveræä¾›çš„å‚æ•°å’Œæ•°æ®æ¥è¿è¡Œç­–ç•¥
</code></pre><p>ä¸ºäº†å±•ç¤ºè¿™ä¸ªï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨ä¸€ä¸ªç§°ä¸ºRSI2çš„ç­–ç•¥ï¼Œè¯¥ç­–ç•¥éœ€è¦ä»¥ä¸‹çš„å‚æ•°ï¼š</p>
<pre><code>ä¸€ä¸ªSMAæ—¶é—´æ®µç”¨äºåŒºåˆ†è¶‹åŠ¿ã€‚æˆ‘ä»¬å°†ä¼šå°†è¿™ä¸ªå‚æ•°ç§°ä¸ºentrySMAï¼Œå¹¶ä¸”èŒƒå›´é€‰å–åœ¨150å’Œ250ä¹‹é—´ã€‚  
ä¸€ä¸ªå°ä¸€äº›çš„SMAæ—¶é—´æ®µç”¨äºé€€å‡ºå‚æ•°ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºexitSMAï¼ŒèŒƒå›´åœ¨5åˆ°15ä¹‹é—´ã€‚  
ä¸€ä¸ªRSIæ—¶é—´æ®µç”¨äºè¿›å…¥ä¹°æˆ–è€…å–ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºrsiPeriodï¼ŒèŒƒå›´åœ¨2åˆ°10ä¹‹é—´ã€‚  
ä¸€ä¸ªRSIè¶…å–é˜€å€¼ç”¨äºè¿›å…¥ä¹°å…¥ç‚¹ä½ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºoverSoldThresholdï¼Œå¹¶ä¸”èŒƒå›´åœ¨5å’Œ25ä¹‹é—´ã€‚  
ä¸€ä¸ªRSIè¶…ä¹°é˜€å€¼ç”¨äºè¿›å…¥å–å‡ºç‚¹ä½ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºoverBoughtThresholdï¼ŒèŒƒå›´å°†åœ¨75å’Œ95ä¹‹é—´ã€‚
</code></pre><p><b>æ‰€ä»¥è¿™é‡Œä¸€å…±æœ‰ï¼š101 <em> 11 </em> 9 <em> 21 </em> 21 = 4409559</b><br>å¦‚æœä¸€ä¸ªç­–ç•¥éœ€è¦è¿è¡Œ0.16ç§’ï¼Œé‚£ä¹ˆä¸€å…±éœ€è¦8.5å¤©æ‰èƒ½ç®—å‡ºæ‰€æœ‰çš„ç­–ç•¥ã€‚(4409559 <em> 0.16/3600/24 ï½ 8.16 Days)<br>å¦‚æœæ˜¯åˆ©ç”¨ä¸Šäº†10å°å…«æ ¸çš„æœºå™¨ï¼Œæ—¶é—´å°†ä¼šç¼©çŸ­åˆ°2.5ä¸ªå°æ—¶ã€‚ï¼ˆ4409559 </em> 0.16/3600/24/8/10 * 24(h) ~ 2.44 h) æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¹¶å‘ã€‚  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyalgotrade <span class="keyword">import</span> strategy</span><br><span class="line"><span class="keyword">from</span> pyalgotrade.technical <span class="keyword">import</span> ma</span><br><span class="line"><span class="keyword">from</span> pyalgotrade.technical <span class="keyword">import</span> rsi</span><br><span class="line"><span class="keyword">from</span> pyalgotrade.technical <span class="keyword">import</span> cross</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RSI2</span><span class="params">(strategy.BacktestingStrategy)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, feed, instrument, entrySMA, exitSMA, rsiPeriod, overBoughtThreshold, overSoldThreshold)</span>:</span></span><br><span class="line">        super(RSI2, self).__init__(feed)</span><br><span class="line">        self.__instrument = instrument</span><br><span class="line">        <span class="comment"># We'll use adjusted close values, if available, instead of regular close values.</span></span><br><span class="line">        <span class="keyword">if</span> feed.barsHaveAdjClose():</span><br><span class="line">            self.setUseAdjustedValues(<span class="keyword">True</span>)</span><br><span class="line">        self.__priceDS = feed[instrument].getPriceDataSeries()</span><br><span class="line">        self.__entrySMA = ma.SMA(self.__priceDS, entrySMA)</span><br><span class="line">        self.__exitSMA = ma.SMA(self.__priceDS, exitSMA)</span><br><span class="line">        self.__rsi = rsi.RSI(self.__priceDS, rsiPeriod)</span><br><span class="line">        self.__overBoughtThreshold = overBoughtThreshold</span><br><span class="line">        self.__overSoldThreshold = overSoldThreshold</span><br><span class="line">        self.__longPos = <span class="keyword">None</span></span><br><span class="line">        self.__shortPos = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getEntrySMA</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__entrySMA</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getExitSMA</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__exitSMA</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getRSI</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__rsi</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">onEnterCanceled</span><span class="params">(self, position)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.__longPos == position:</span><br><span class="line">            self.__longPos = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">elif</span> self.__shortPos == position:</span><br><span class="line">            self.__shortPos = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">assert</span>(<span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">onExitOk</span><span class="params">(self, position)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.__longPos == position:</span><br><span class="line">            self.__longPos = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">elif</span> self.__shortPos == position:</span><br><span class="line">            self.__shortPos = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">assert</span>(<span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">onExitCanceled</span><span class="params">(self, position)</span>:</span></span><br><span class="line">        <span class="comment"># If the exit was canceled, re-submit it.</span></span><br><span class="line">        position.exitMarket()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">onBars</span><span class="params">(self, bars)</span>:</span></span><br><span class="line">        <span class="comment"># Wait for enough bars to be available to calculate SMA and RSI.</span></span><br><span class="line">        <span class="keyword">if</span> self.__exitSMA[<span class="number">-1</span>] <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> self.__entrySMA[<span class="number">-1</span>] <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> self.__rsi[<span class="number">-1</span>] <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        bar = bars[self.__instrument]</span><br><span class="line">        <span class="keyword">if</span> self.__longPos <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">if</span> self.exitLongSignal():</span><br><span class="line">                self.__longPos.exitMarket()</span><br><span class="line">        <span class="keyword">elif</span> self.__shortPos <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">if</span> self.exitShortSignal():</span><br><span class="line">                self.__shortPos.exitMarket()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> self.enterLongSignal(bar):</span><br><span class="line">                shares = int(self.getBroker().getCash() * <span class="number">0.9</span> / bars[self.__instrument].getPrice())</span><br><span class="line">                self.__longPos = self.enterLong(self.__instrument, shares, <span class="keyword">True</span>)</span><br><span class="line">            <span class="keyword">elif</span> self.enterShortSignal(bar):</span><br><span class="line">                shares = int(self.getBroker().getCash() * <span class="number">0.9</span> / bars[self.__instrument].getPrice())</span><br><span class="line">                self.__shortPos = self.enterShort(self.__instrument, shares, <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enterLongSignal</span><span class="params">(self, bar)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bar.getPrice() &gt; self.__entrySMA[<span class="number">-1</span>] <span class="keyword">and</span> self.__rsi[<span class="number">-1</span>] &lt;= self.__overSoldThreshold</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exitLongSignal</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cross.cross_above(self.__priceDS, self.__exitSMA) <span class="keyword">and</span> <span class="keyword">not</span> self.__longPos.exitActive()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enterShortSignal</span><span class="params">(self, bar)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bar.getPrice() &lt; self.__entrySMA[<span class="number">-1</span>] <span class="keyword">and</span> self.__rsi[<span class="number">-1</span>] &gt;= self.__overBoughtThreshold</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exitShortSignal</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cross.cross_below(self.__priceDS, self.__exitSMA) <span class="keyword">and</span> <span class="keyword">not</span> self.__shortPos.exitActive()</span><br></pre></td></tr></table></figure>
<p>æœ‰ä»¥ä¸‹çš„å‡½æ•°è¢«å®šä¹‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è·å–è¿›å…¥SMAçš„å€¼ï¼Œrangeä»150åˆ°250</span></span><br><span class="line">getEntrySMA(self)</span><br><span class="line"><span class="comment">#è·å–é€€å‡ºSMAçš„å€¼ï¼Œrangeä»5åˆ°16</span></span><br><span class="line">getExitSMA(self)</span><br><span class="line"><span class="comment">#è·å–rsi æ—¶æ®µçš„å€¼ï¼Œrangeä»2åˆ°10</span></span><br><span class="line">getRSI(self)</span><br><span class="line"><span class="comment">#å–æ¶ˆå»ºä»“é€»è¾‘ --- è¿™é‡Œä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆè¦å¢åŠ </span></span><br><span class="line">onEnterCanceled(self, position)</span><br><span class="line"><span class="comment">#å¹³ä»“é€»è¾‘ --- è¿™é‡Œä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆè¦å¢åŠ 	</span></span><br><span class="line">onExitOk(self, position)</span><br><span class="line"><span class="comment">#å¹³ä»“å–æ¶ˆé€»è¾‘ --- è¿™é‡Œä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆè¦å¢åŠ 	</span></span><br><span class="line">onExitCanceled(self, position)</span><br><span class="line"><span class="comment">#ç­–ç•¥æ‰§è¡Œé€»è¾‘</span></span><br><span class="line">onBars(self, bars)</span><br><span class="line"><span class="comment">#åšå¤šä¿¡å·</span></span><br><span class="line">enterLongSignal(self, bar)</span><br><span class="line"><span class="comment">#é€€å‡ºåšå¤šä¿¡å·</span></span><br><span class="line">exitLongSignal(self)</span><br><span class="line"><span class="comment">#åšç©ºä¿¡å·</span></span><br><span class="line">enterShortSignal(self, bar)</span><br><span class="line"><span class="comment">#é€€å‡ºåšç©ºä¿¡å·</span></span><br><span class="line">exitShortSignal(self)</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼ŒonBars(self, bars)å‡½æ•°ç”¨äºæ‰§è¡Œç­–ç•¥é€»è¾‘ï¼Œåœ¨onBarsä¸­ï¼Œå¦‚æœç›®å‰æœ‰ä»“ä½ï¼Œè°ƒç”¨äº†exitLongSignal() å’Œ exitShortSignal ç”¨äºåˆ¤æ–­æ˜¯éè¦æ‰§è¡Œå¹³ä»“æ“ä½œã€‚å¦‚æœç›®å‰ç©ºä»“ï¼Œåˆ™è°ƒç”¨äº†enterLongSignal()å’ŒenterShortSignal()æ¥å†³å®šæ˜¯å¦å»ºä»“ã€‚å…¶ä¸­ï¼ŒgetBroker().getCash()å¯ä»¥è·å–å½“å‰çš„ç°é‡‘ï¼Œ0.9åº”è¯¥æ˜¯ä¼°ç®—äº†äº¤æ˜“è´¹ç”¨ã€‚è€Œå…¶ä¸­çš„enterShort()å’ŒenterLong()å‡½æ•°åº”è¯¥æ˜¯BacktestingStrategyç±»æ‰€å«æœ‰çš„å‡½æ•°ã€‚  </p>
<p>ä»ä¸Šé¢ä¸€æ®µå‡½æ•°åŸºæœ¬é€»è¾‘å¯ä»¥åˆ†æå‡ºï¼ŒPyalgotrade æœ‰ä¸¤ä¸ªåŸºæœ¬çš„ç±»ï¼Œæˆ‘éœ€è¦å…³æ³¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyalgotrade <span class="keyword">import</span> strategy</span><br><span class="line">strategy.BacktestingStrategy</span><br><span class="line">position</span><br><span class="line">pyalgotrade.technical</span><br><span class="line">```   </span><br><span class="line"></span><br><span class="line">ç„¶åè¿˜æœ‰æ—æä½†æ˜¯ä¸ç”¨å¤ªè¿‡å…³å¿ƒçš„ç±»ï¼š</span><br><span class="line">	</span><br><span class="line">	feed</span><br><span class="line">	<span class="keyword">from</span> pyalgotrade.barfeed <span class="keyword">import</span> quandlfeed</span><br><span class="line">	feed = quandlfeed.Feed()</span><br><span class="line">å›åˆ°ä¼˜åŒ–è¿™ä¸ªä¸»é¢˜ä¸Šæ¥ï¼Œserverçš„ä»£ç å¦‚ä¸‹ï¼š</span><br></pre></td></tr></table></figure>
<p>import itertools<br>from pyalgotrade.optimizer import server<br>from pyalgotrade.barfeed import quandlfeed</p>
<p>def parameters_generator():<br>    instrument = [â€œibmâ€]<br>    entrySMA = range(150, 251)<br>    exitSMA = range(5, 16)<br>    rsiPeriod = range(2, 11)<br>    overBoughtThreshold = range(75, 96)<br>    overSoldThreshold = range(5, 26)<br>    return itertools.product(instrument, entrySMA, exitSMA, rsiPeriod, overBoughtThreshold, overSoldThreshold)</p>
<h1 id="The-if-name-â€˜mainâ€˜-part-is-necessary-if-running-on-Windows"><a href="#The-if-name-â€˜mainâ€˜-part-is-necessary-if-running-on-Windows" class="headerlink" title="The if name == â€˜mainâ€˜ part is necessary if running on Windows."></a>The if <strong>name</strong> == â€˜<strong>main</strong>â€˜ part is necessary if running on Windows.</h1><p>if <strong>name</strong> == â€˜<strong>main</strong>â€˜:</p>
<pre><code># Load the bar feed from the CSV files.
feed = quandlfeed.Feed()
feed.addBarsFromCSV(&quot;ibm&quot;, &quot;WIKI-IBM-2009-quandl.csv&quot;)
feed.addBarsFromCSV(&quot;ibm&quot;, &quot;WIKI-IBM-2010-quandl.csv&quot;)
feed.addBarsFromCSV(&quot;ibm&quot;, &quot;WIKI-IBM-2011-quandl.csv&quot;)

# Run the server.
server.serve(feed, parameters_generator(), &quot;localhost&quot;, 5000)
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">è¿™ä¸ªä»£ç å¤„ç†äº†ä¸‰ä¸ªäº‹æƒ…ï¼š</span><br><span class="line"></span><br><span class="line">1. å£°æ˜äº†ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°æ ¹æ®èŒƒå›´äº§ç”Ÿä¸åŒçš„å‚æ•°ã€‚</span><br><span class="line">2. åŠ è½½csvæ–‡ä»¶åˆ°feedä¸­ã€‚</span><br><span class="line">3. è¿è¡Œserverç›‘å¬5000ç«¯å£æ¥è·å–åˆ°æ¥çš„é“¾æ¥ã€‚</span><br><span class="line"></span><br><span class="line">worker è„šæœ¬ä½¿ç”¨äº† `pyalgotrade.optimizer.worker` æ¨¡å—æ¥å¹¶è¡Œè¿è¡Œç­–ç•¥ï¼Œå¹¶ä¸”ä½¿ç”¨äº†serveræä¾›çš„æ•°æ®ã€‚</span><br></pre></td></tr></table></figure>
<p>from pyalgotrade.optimizer import worker<br>import rsi2</p>
<h1 id="The-if-name-â€˜mainâ€˜-part-is-necessary-if-running-on-Windows-1"><a href="#The-if-name-â€˜mainâ€˜-part-is-necessary-if-running-on-Windows-1" class="headerlink" title="The if name == â€˜mainâ€˜ part is necessary if running on Windows."></a>The if <strong>name</strong> == â€˜<strong>main</strong>â€˜ part is necessary if running on Windows.</h1><p>if <strong>name</strong> == â€˜<strong>main</strong>â€˜:<br>    worker.run(rsi2.RSI2, â€œlocalhostâ€, 5000, workerName=â€localworkerâ€)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;b&gt;æ³¨æ„ä½ åº”è¯¥åœ¨ä¸€å°serverå’Œå¤§äºç­‰äºä¸€ä¸ªworkerçš„æƒ…å†µä¸‹è¿è¡Œ&lt;/b&gt;</span><br><span class="line">å¦‚æœä½ åªæ˜¯æƒ³è¦åœ¨ä½ çš„å°å¼æœºä¸Šå¹¶å‘è¿è¡Œç­–ç•¥ï¼Œé‚£ä¹ˆå¯ä»¥åˆ©ç”¨`pyalgotrade.optimizer.local `æ¨¡å—æ¥å¤„ç†å¦‚ä¸‹ï¼š  </span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">import itertools</span><br><span class="line">from pyalgotrade.optimizer import local</span><br><span class="line">from pyalgotrade.barfeed import quandlfeed</span><br><span class="line">import rsi2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def parameters_generator():</span><br><span class="line">    instrument = [&quot;ibm&quot;]</span><br><span class="line">    entrySMA = range(150, 251)</span><br><span class="line">    exitSMA = range(5, 16)</span><br><span class="line">    rsiPeriod = range(2, 11)</span><br><span class="line">    overBoughtThreshold = range(75, 96)</span><br><span class="line">    overSoldThreshold = range(5, 26)</span><br><span class="line">    return itertools.product(instrument, entrySMA, exitSMA, rsiPeriod, overBoughtThreshold, overSoldThreshold)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># The if __name__ == &apos;__main__&apos; part is necessary if running on Windows.</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    # Load the bar feed from the CSV files.</span><br><span class="line">    feed = quandlfeed.Feed()</span><br><span class="line">    feed.addBarsFromCSV(&quot;ibm&quot;, &quot;WIKI-IBM-2009-quandl.csv&quot;)</span><br><span class="line">    feed.addBarsFromCSV(&quot;ibm&quot;, &quot;WIKI-IBM-2010-quandl.csv&quot;)</span><br><span class="line">    feed.addBarsFromCSV(&quot;ibm&quot;, &quot;WIKI-IBM-2011-quandl.csv&quot;)</span><br><span class="line"></span><br><span class="line">    local.run(rsi2.RSI2, feed, parameters_generator())</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ®µä»£ç åšäº†3ä»¶äº‹æƒ…ï¼š</p>
<ol>
<li>å£°æ˜äº†ä¸€ä¸ªç”Ÿæˆå‡½æ•°ç”¨æ¥äº§å‡ºä¸åŒçš„å‚æ•°ç»„åˆ</li>
<li>ä»csvä¸­åŠ è½½åˆ°feedä¸­</li>
<li>ä½¿ç”¨<code>pyalgotrade.optimizer.local</code>æ¥å¹¶å‘è¿è¡Œç­–ç•¥ï¼Œå¹¶ä¸”æ‰¾åˆ°æœ€å¥½çš„ç»„åˆã€‚  </li>
</ol>
<p>ä¸Šé¢ä¸€æ®µå¹¶å‘çš„æ¼”ç¤ºè¯´æ˜å¦‚æœæˆ‘æƒ³è¦å¹¶å‘è¿è¡Œï¼Œä¹Ÿè®¸æˆ‘éœ€è¦çœ‹çœ‹ï¼š  </p>
<pre><code>#å•æœºæœ¬åœ°å¹¶å‘ä»£ç 
from pyalgotrade.optimizer import local
local.run(rsi2.RSI2, feed, parameters_generator())
#å¤šå°æœºå™¨å¹¶å‘çš„ä»£ç 
from pyalgotrade.optimizer import worker
worker.run(rsi2.RSI2, &quot;localhost&quot;, 5000, workerName=&quot;localworker&quot;)
</code></pre><p><b>ä»¥åŠè¯´æ˜pyalgotradeçš„ä¼˜åŒ–éƒ¨åˆ†åº”è¯¥æ˜¯åˆ©ç”¨äº†å¹¶å‘æ¥åŠ é€Ÿã€‚</b><br>å¯¹äºæˆ‘è‡ªå·±çš„å¤„ç†ï¼Œå¯ä»¥è€ƒè™‘åŠ å…¥PSO ä¼˜åŒ–ç”¨äºå¤„ç†ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2018/10/13/åŸºç¡€å»ºè®¾å’Œæ‚é¡¹æ¯”è¾ƒ/hexoWithGit/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/13/åŸºç¡€å»ºè®¾å’Œæ‚é¡¹æ¯”è¾ƒ/hexoWithGit/" class="post-title-link" itemprop="url">Hexo With Git</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-13 22:18:38" itemprop="dateCreated datePublished" datetime="2018-10-13T22:18:38+08:00">2018-10-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-06 18:05:07" itemprop="dateModified" datetime="2019-03-06T18:05:07+08:00">2019-03-06</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="server"><a href="#server" class="headerlink" title="server"></a>server</h2><p>ç¯å¢ƒï¼š  </p>
<pre><code>ubuntu 16.01LTS
</code></pre><p><b>nginx:</b><br>å®‰è£… nginxï¼š</p>
<pre><code>sudo apt-get update
sudo apt-get install nginx
</code></pre><p>é…ç½®ï¼š  </p>
<pre><code>/etc/nginx/nginx.conf
....
server {
          listen       80 default_server;
          listen       [::]:80 default_server;
          server_name  blog.example.com; # å¡«å†™ä¸ªäººåŸŸå
          root         /home/where/your/blog/hexo;
  }    
  .....
</code></pre><p>/etc/nginx/sites-enabled ä¸­æœ‰ä¸€ä¸ªdefaultæ–‡ä»¶ï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥åˆ é™¤ï¼Œå¦åˆ™å¯åŠ¨nginxçš„æ—¶å€™ä¼šæŠ¥ç«¯å£å†²çªã€‚<br>å¯åŠ¨nginxï¼š</p>
<pre><code>sudo nginx -t
sudo systemctl reload nginx.service
</code></pre><p><b>git:</b><br>    æœ¬éƒ¨åˆ†ä¸€å¤§æ®µæ¥è‡ªï¼š<a href="https://www.jianshu.com/p/e03e363713f9" target="_blank" rel="noopener">https://www.jianshu.com/p/e03e363713f9</a><br>    å®‰è£… gitï¼š</p>
<pre><code>sudo apt-get install git-core
mkdir -p /home/git/blog/hexo.git #Gitä»“åº“ï¼Œä¸å­˜å‚¨ç½‘ç«™æ–‡ä»¶
mkdir /home/git/blog/hexo #å®é™…å­˜å‚¨ç½‘ç«™æ–‡ä»¶ç›®å½•
</code></pre><p>åˆå§‹åŒ–ç©ºçš„Gitä»“åº“ï¼š</p>
<pre><code>git init --bare /home/git/blog/hexo.git
</code></pre><p>è¿›å…¥è¯¥ä»“åº“ï¼Œé…ç½®post-update hooksï¼ˆæœ‰çš„å¯èƒ½æ˜¯post-receiveï¼‰ï¼š</p>
<pre><code>cd /home/git/blog/hexo.git/hooks
sudo nano /home/git/blog/hexo.git/hooks/post-update.sample        
git --work-tree=/home/git/blog/hexo --git-dir=/home/git/blog/hexo.git checkout -f
chmod +x post-update
</code></pre><h2 id="local"><a href="#local" class="headerlink" title="local"></a>local</h2><p>æœ¬æœºè®¾ç½®<br>å®‰è£…hexoç›¸å…³ï¼š</p>
<pre><code>npm install hexo-cli hexo-server hexo-deployer-git -g
</code></pre><p>å®‰è£…å®Œæˆåï¼Œåˆå§‹åŒ–ï¼š</p>
<pre><code>hexo init ~/myBlog
</code></pre><p>ä¿®æ”¹hexoçš„é…ç½®å¯ä»¥å‚è€ƒï¼š<a href="https://hexo.io/docs/configuration" target="_blank" rel="noopener">https://hexo.io/docs/configuration</a><br>å…¶ä¸­ deployéƒ¨åˆ†éœ€è¦ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<pre><code>deploy:     //å‘å¸ƒå¯¹åº”çš„githubè´¦å·
type: git
repo: user@remoteServer:/home/git/blog/hexo  //ç”¨æˆ·å@åŸŸåæˆ– IP åœ°å€:/home/git/blog/hexo
branch: master
</code></pre><p>ç„¶åè¿˜æœ‰ä¸€ç‚¹ï¼Œéœ€è¦ssh-copy-key å°†è‡ªå·±çš„å…¬é’¥æ‹·è´åˆ°è¿œç¨‹æœºå™¨ä¸Šï¼Œè¿™æ ·å¯ä»¥æ— éœ€å¯†ç è®¿é—®ï¼Œå…·ä½“è¯·è‡ªè¡Œæœç´¢ä¸‹ã€‚</p>
<p>å®Œæˆä»¥ä¸Šä¹‹åï¼Œéƒ¨ç½²ä¸‰æ¡å‘½ä»¤ï¼š</p>
<pre><code>hexo clean
hexo generate
hexo deploy
</code></pre><h2 id="åŸŸåè½¬æ¢"><a href="#åŸŸåè½¬æ¢" class="headerlink" title="åŸŸåè½¬æ¢"></a>åŸŸåè½¬æ¢</h2><p>å¦‚æœæœ‰è‡ªå·±çš„åŸŸåï¼Œå¯ä»¥åœ¨è‡ªå·±çš„åŸŸåæœåŠ¡å•†ä¸Šè¿›è¡Œè®¾ç½®ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥è®¿é—®åŸŸåäº†ã€‚<br>æ¯”å¦‚æˆ‘è¿™ä¸ªæ˜¯åœ¨name    ä¸Šï¼Œè¿›å…¥<a href="https://www.name.com/zh-cn/account/domain/details/sevenpan.com#dns" target="_blank" rel="noopener">DNS</a>è®¾ç½®è‡ªå·±çš„ipå°±å¯ä»¥è¿›è¡Œè½¬å‘äº†ã€‚</p>
<h2 id="Reference-Link"><a href="#Reference-Link" class="headerlink" title="Reference Link"></a>Reference Link</h2><p>Hexo: <a href="https://hexo.io/docs/" target="_blank" rel="noopener">https://hexo.io/docs/</a><br>nginx install :    <a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-16-04" target="_blank" rel="noopener">https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-16-04</a><br><a href="https://websiteforstudents.com/migrate-nginx-root-directory-on-ubuntu-17-04-17-10/" target="_blank" rel="noopener">https://websiteforstudents.com/migrate-nginx-root-directory-on-ubuntu-17-04-17-10/</a><br>name.com åŸŸåè§£æï¼š<a href="http://www.webgou.info/content/netusage/453/" target="_blank" rel="noopener">http://www.webgou.info/content/netusage/453/</a><br>ä¸»è¦å‚è€ƒçš„ä¸¤ä¸ªç½‘é¡µï¼š<br><a href="https://segmentfault.com/a/1190000010680022" target="_blank" rel="noopener">https://segmentfault.com/a/1190000010680022</a><br><a href="https://www.jianshu.com/p/e03e363713f9" target="_blank" rel="noopener">https://www.jianshu.com/p/e03e363713f9</a>  </p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2018/09/21/Algo/å•å› å­è¯´æ˜ä»¥åŠè®¡ç®—ç»“æœ/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/21/Algo/å•å› å­è¯´æ˜ä»¥åŠè®¡ç®—ç»“æœ/" class="post-title-link" itemprop="url">å•å› å­è¯´æ˜ä»¥åŠè®¡ç®—ç»“æœ</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-09-21 21:02:03" itemprop="dateCreated datePublished" datetime="2018-09-21T21:02:03+08:00">2018-09-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-06 17:56:41" itemprop="dateModified" datetime="2019-03-06T17:56:41+08:00">2019-03-06</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å•å› å­è¯´æ˜ä»¥åŠè®¡ç®—ç»“æœ"><a href="#å•å› å­è¯´æ˜ä»¥åŠè®¡ç®—ç»“æœ" class="headerlink" title="å•å› å­è¯´æ˜ä»¥åŠè®¡ç®—ç»“æœ"></a>å•å› å­è¯´æ˜ä»¥åŠè®¡ç®—ç»“æœ</h1><p><em>æœ¬ç¬”è®°æ˜¯å‚è€ƒäº†æŠ¥å‘Šï¼š<a href="https://cloud.tencent.com/developer/article/1174165" target="_blank" rel="noopener">æ–°å…´å¸‚åœºç¬¬äºŒå­£åº¦å› å­æ”¶ç›ŠæŠ¥å‘Š</a> ä»¥åŠ</em><br><a href="https://www.ricequant.com/doc/rqdata-institutional#research-API-get_fundamentals" target="_blank" rel="noopener">å¢åŠ RiceQuantè·å–åŸºæœ¬é¢æ•°æ®çš„æ–¹æ³•</a></p>
<p><strong>åˆå§‹åŒ–ä½¿ç”¨ riceQuantçš„æ–¹å¼å¦‚ä¸‹ï¼š</strong>  </p>
<ol>
<li>è¿›å…¥ä¹‹å‰ç³»ç»Ÿé¢„è£…çš„rq pythonè™šæ‹Ÿæœºä¸­</li>
<li>è¿è¡Œå¦‚ä¸‹çš„å‘½ä»¤ï¼š</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rqdatac <span class="keyword">as</span> rq</span><br><span class="line"><span class="keyword">from</span> rqdatac <span class="keyword">import</span> *</span><br><span class="line">rq.init()</span><br></pre></td></tr></table></figure>
<h2 id="è®¡ç®—æ–¹å¼"><a href="#è®¡ç®—æ–¹å¼" class="headerlink" title="è®¡ç®—æ–¹å¼"></a>è®¡ç®—æ–¹å¼</h2><p>æŠ¥å‘Šä¸­ä¸€å…±åŒ…å«23ä¸­å•ç‹¬çš„å› å­ã€‚æ¯ä¸€ä¸ªå°èŠ‚åŒ…æ‹¬äº†ä¸€ä¸ªå®šä¹‰çš„æ—¶é—´æ®µå†…æ¯ä¸ªå› å­çš„è¡¨ç°ã€‚</p>
<p>ä¸ºäº†è®¡ç®—æ¯ä¸€ä¸ªå•ç‹¬å› å­çš„å¯¹åº”å›æŠ¥ç‡ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ªå•å› å­æŠ•èµ„ç»„åˆã€‚ä¸ºäº†åˆ›é€ è¿™ä¸ªå•å› å­æŠ•èµ„ç»„åˆï¼Œåœ¨é€‰æ‹©çš„åŒºåŸŸä¸­çš„å®ä½“è¯åˆ¸æ ¹æ®ä¸€ä¸ªå•ç‹¬çš„å®ä½“å› å­è¢«é™åºæ’åˆ—ã€‚ </p>
<p>åœ¨ä¸€ä¸ªæ—¥å†æœˆæœ€å¼€å§‹æ—¶ï¼Œæˆ‘ä»¬ä»è¿™ä¸ªæ’åºçš„åˆ—è¡¨ä¸­é€‰æ‹©è¯åˆ¸å¹¶ä¸”ä¸æ–­ç´¯ç§¯ç›´åˆ°ç§¯ç´¯çš„å¸‚åœºä»½é¢è¾¾åˆ°å…¨éƒ¨çš„åœ°åŒºçš„å¸‚åœºä»½é¢çš„50%æ¥ä½œä¸ºæˆ‘ä»¬çš„å•å› å­æŠ•èµ„ç»„åˆã€‚ç„¶åæˆ‘ä»¬å°†ä¼šæŒæœ‰è¿™äº›è¯åˆ¸ç›´åˆ°è¿™ä¸ªæ—¥å†æœˆæœ€åã€‚è¿™ä¸€ä¸ªæœˆçš„å•å› å­æŠ•èµ„ç»„åˆç„¶åä¼šè¢«ç”¨æ¥å’Œæ•´ä¸ªå¸‚åœºè¿›è¡Œæ¯”è¾ƒã€‚  </p>
<p>åŒæ ·çš„æ„å»ºè¿‡ç¨‹åœ¨æ¯ä¸ªæœˆéƒ½ä¼šè¿›è¡Œï¼Œå¹¶ä¸”è¿™ä¸ªè¿ç»­ä¸æ–­çš„æ¯æœˆå›æŠ¥ç‡ä¼šè¢«è”ç³»åˆ°ä¸€èµ·æ¥æä¾›ä¸€ä¸ªç§¯ç´¯å› å­è¡¨ç°æ¥è¡¡é‡ä¸åŒçš„æ—¶é—´å¸§ã€‚<br>è¿™ä¸ªè¿‡ç¨‹è¢«ä¸æ–­çš„é‡å¤åªæ˜¯ä½¿ç”¨ä¸åŒçš„å› å­å¹¶ä¸”è¿™äº›ç»“æœè¢«èšåˆåœ¨ä¸€èµ·ã€‚åº”ç”¨è¿™ä¸ªä¸€è‡´çš„è¿‡ç¨‹å¯ä»¥æ¥æ¯”è¾ƒå› å­é—´çš„è¶…é¢è¡¨ç°æ´»underperformanceåœ¨åŒä¸€ä¸ªåŒºåŸŸé—´ã€‚  </p>
<p><strong>å…³äºè°ƒæ•´ï¼ˆAdjustmentsï¼‰</strong></p>
<p>ä¸€ä¸ªåŒºåŸŸè¡¨ç¤ºä¸€ä¸ªå›½å®¶æ¯”å¦‚ç¾å›½ï¼Œåœ¨äº§ä¸šè¯åˆ¸çº§åˆ«å¸‚åœºå’ŒåŸºç¡€æ•°æ®è¢«ä½¿ç”¨äº† sector-average ç›¸å…³æ•°æ®è°ƒæ•´äº†ã€‚<br>å¯¹äºåŒºåŸŸä»£è¡¨å¤šä¸ªå›½å®¶çš„ï¼Œæ¯”å¦‚Asia Pacificï¼Œå¸‚åœºå’ŒåŸºç¡€æ•°æ®ä¹Ÿè¢«è°ƒæ•´äº†é€šè¿‡è¡Œä¸šå’Œå›½å®¶æ¥è°ƒæ•´ï¼ˆCountry and Sector Adjustedï¼‰ã€‚  </p>
<h2 id="å› å­å®šä¹‰"><a href="#å› å­å®šä¹‰" class="headerlink" title="å› å­å®šä¹‰"></a>å› å­å®šä¹‰</h2><table>
<thead>
<tr>
<th>ä»·å€¼å› å­</th>
<th>æ”¶ç›Šç‡å› å­</th>
<th>å¢é•¿å› å­</th>
<th>è´¨é‡å› å­</th>
<th>å¤§å°å› å­</th>
<th>æ³¢åŠ¨å› å­</th>
<th>åŠ¨é‡å› å­</th>
</tr>
</thead>
<tbody>
<tr>
<td> Book to Price(å¸‚å‡€ç‡)</td>
<td>Dividend Yield(è‚¡æ¯æ”¶ç›Šç‡)</td>
<td>Earnings Growth 5Y(äº”å¹´ç›ˆåˆ©å¢é•¿)</td>
<td>Return on Equity(è‚¡ä¸œæƒç›Šå›æŠ¥ç‡)</td>
<td>Market Cap (å¸‚å€¼)</td>
<td>Market Beta(å¸‚åœºBetaå€¼)</td>
<td>Momentum ST()</td>
</tr>
<tr>
<td> Earning Yield(æ”¶ç›Šç‡)</td>
<td>Shareholder Yield(è‚¡ä¸œæ”¶ç›Šç‡)</td>
<td>Sales Growth 5Y(äº”å¹´é”€å”®å¢é•¿)</td>
<td>Net Profit Margin(å‡€åˆ©æ¶¦ç‡)</td>
<td></td>
<td>Daily Volatility 1Y(1å¹´æ—¥å‡æ³¢åŠ¨ç‡)</td>
<td>Momentum 12-1()</td>
</tr>
<tr>
<td> Cash Flow Yield(ç°é‡‘æµé‡æ”¶ç›Šç‡)</td>
<td></td>
<td>Forecast Growth 12M(12æœˆé¢„æµ‹å¢é•¿ç‡)</td>
<td>Low Gearing (ä½èµ„æœ¬è´Ÿå€ºæ¯”ç‡)</td>
<td></td>
<td>Volatility 3Y(3å¹´æ³¢åŠ¨ç‡)</td>
<td>Forecast 12M Revisions(é¢„æµ‹12æœˆçš„åè½¬)</td>
</tr>
<tr>
<td> Sales to Price(å¸‚é”€ç‡)</td>
<td></td>
<td>Dividend Growth 5Y(5å¹´è‚¡æ¯å¢é•¿)</td>
<td>Earnings Growth Stability(æ”¶ç›Šå¢é•¿ç¨³å®šæ€§)</td>
<td></td>
</tr>
<tr>
<td> EBITA to EV(ä¼ä¸šå€æ•°ä¼°å€¼)</td>
<td></td>
<td></td>
<td>Sales Growth Stability(é”€å”®å¢é•¿ç¨³å®šæ€§)</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="ä»·å€¼å› å­"><a href="#ä»·å€¼å› å­" class="headerlink" title="ä»·å€¼å› å­"></a>ä»·å€¼å› å­</h2><h3 id="Book-to-Price-å¸‚å‡€ç‡"><a href="#Book-to-Price-å¸‚å‡€ç‡" class="headerlink" title="Book to Price(å¸‚å‡€ç‡)"></a>Book to Price(å¸‚å‡€ç‡)</h3><blockquote>
<p>The ratio of the companyâ€™s book value (the sum of shareholdersâ€™ equity plus accumulated retained earnings from the P &amp; L Account) to its share price.<br>This factor has been one of the most successful measures of the intrinsic value of company shares. </p>
</blockquote>
<p>å¸‚å‡€ç‡ç­‰äºè¿™ä¸ªå…¬å¸çš„è´¦æœ¬ä»·å€¼(è‚¡ä¸œæƒç›Šä¸ä¿è¯é‡‘è´¦æˆ·ç´¯è®¡ç•™å­˜æ”¶ç›Šä¹‹å’Œ)ï¼è‚¡ç¥¨ä»·æ ¼  </p>
<blockquote>
<p><em>è¿™ä¸ªå› å­æ˜¯æœ€æœ‰æ•ˆçš„è¡¡é‡è¿™ä¸ªå…¬å¸è‚¡ç¥¨çš„åŸå§‹ä»·å€¼çš„æ–¹æ³•ã€‚</em></p>
</blockquote>
<h4 id="RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•"><a href="#RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•" class="headerlink" title="RiceQuant å­—æ®µåŠè·å–æ–¹æ³•"></a>RiceQuant å­—æ®µåŠè·å–æ–¹æ³•</h4><p><strong>å­—æ®µï¼špe_ratio</strong> </p>
<p>ä»£ç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">dp = get_fundamentals(query(fundamentals.eod_derivative_indicator.pe_ratio).filter(fundamentals.stockcode == <span class="string">'000001.XSHE'</span>), <span class="string">'2018-08-01'</span>,<span class="string">'4q'</span> ,report_quarter = <span class="keyword">True</span>)</span><br><span class="line">dp.minor_xs(<span class="string">'000001.XSHE'</span>)</span><br><span class="line"></span><br><span class="line">report_quarter pe_ratio</span><br><span class="line"><span class="number">2018</span><span class="number">-08</span><span class="number">-01</span>         <span class="number">2018</span>q1   <span class="number">6.5443</span></span><br><span class="line"><span class="number">2018</span><span class="number">-04</span><span class="number">-27</span>         <span class="number">2018</span>q1   <span class="number">7.9041</span></span><br><span class="line"><span class="number">2018</span><span class="number">-01</span><span class="number">-26</span>         <span class="number">2017</span>q3  <span class="number">10.4034</span></span><br><span class="line"><span class="number">2017</span><span class="number">-10</span><span class="number">-26</span>         <span class="number">2017</span>q3   <span class="number">8.3344</span></span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line"><span class="comment">### Earning Yield(æ”¶ç›Šç‡)</span></span><br><span class="line"></span><br><span class="line">&gt;Annual earnings (adjusted <span class="keyword">for</span> amortizations of intangibles, extraordinary charges <span class="keyword">and</span> credits) per share divided by the share price.  </span><br><span class="line">&gt;This factor measures the worth of a companyâ€™s shares according to the companyâ€™s ability to support each share <span class="keyword">with</span> after tax earnings.</span><br><span class="line"></span><br><span class="line">æ¯ä¸€è‚¡å¹´æ”¶ç›Šé™¤ä»¥æ¯ä¸€è‚¡çš„ä»·æ ¼ã€‚  </span><br><span class="line">&gt;*è¿™ä¸ªå› å­ç”¨äºè¡¡é‡ä¸€ä¸ªå…¬å¸çš„è‚¡ç¥¨é€šè¿‡å…¬å¸ç¨åæ¯ä¸€è‚¡å¯ä»¥èµšå¤šå°‘*</span><br><span class="line"></span><br><span class="line"><span class="comment">#### RiceQuant å­—æ®µåŠè·å–æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">**å­—æ®µï¼š`earnings_per_share`**  </span><br><span class="line"></span><br><span class="line">è¯´æ˜ï¼š åŸºæœ¬æ¯è‚¡æ”¶ç›Š  </span><br><span class="line">æŒ‡ä¼ä¸šåº”å½“æŒ‰ç…§å±äºæ™®é€šè‚¡è‚¡ä¸œçš„å½“æœŸå‡€åˆ©æ¶¦  </span><br><span class="line">é™¤ä»¥å‘è¡Œåœ¨å¤–æ™®é€šè‚¡çš„åŠ æƒå¹³å‡æ•°ä»è€Œè®¡ç®—å‡ºçš„æ¯è‚¡æ”¶ç›Š  </span><br><span class="line"></span><br><span class="line">```python </span><br><span class="line">dp = get_fundamentals(query(fundamentals.financial_indicator.earnings_per_share).filter(fundamentals.stockcode == <span class="string">'000001.XSHE'</span>), <span class="string">'2018-08-01'</span>,<span class="string">'4q'</span> ,report_quarter = <span class="keyword">True</span>)</span><br><span class="line">dp.minor_xs(<span class="string">'000001.XSHE'</span>)</span><br><span class="line"></span><br><span class="line">report_quarter earnings_per_share</span><br><span class="line"><span class="number">2018</span><span class="number">-08</span><span class="number">-01</span>         <span class="number">2018</span>q1               <span class="number">0.33</span></span><br><span class="line"><span class="number">2018</span><span class="number">-04</span><span class="number">-27</span>         <span class="number">2018</span>q1               <span class="number">0.33</span></span><br><span class="line"><span class="number">2018</span><span class="number">-01</span><span class="number">-26</span>         <span class="number">2017</span>q3               <span class="number">1.06</span></span><br><span class="line"><span class="number">2017</span><span class="number">-10</span><span class="number">-26</span>         <span class="number">2017</span>q3               <span class="number">1.06</span></span><br><span class="line">```	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="comment">### Cash Flow Yield(ç°é‡‘æµé‡æ”¶ç›Šç‡)</span></span><br><span class="line"></span><br><span class="line">&gt;Annual cash flow per share divided by the share price.  </span><br><span class="line">&gt;This factor <span class="keyword">is</span> related to earnings <span class="keyword">yield</span> but also includes other items, specifically: depreciation, amortizations, <span class="keyword">and</span> provisions <span class="keyword">for</span> deferred liabilities. It <span class="keyword">is</span> intended to capture the cash availability of the company <span class="keyword">as</span> a multiple of the share price, <span class="keyword">and</span> offers a value criteria based on the stream of accessible cash earnings</span><br><span class="line"></span><br><span class="line">æ¯ä¸€è‚¡çš„å¹´ç°é‡‘æµé™¤ä»¥æ¯ä¸€è‚¡çš„ä»·æ ¼  </span><br><span class="line"></span><br><span class="line">&gt;è¿™ä¸ªå› å­å’Œå›æŠ¥æ”¶ç›Šç‡æœ‰å…³åŒæ—¶ä¹ŸåŒ…å«äº†å…¶ä»–çš„ä¸œè¥¿ï¼Œæ˜ç¡®çš„ï¼šè´§å¸è´¬å€¼ï¼Œ æ‘Šé”€ ä»¥åŠå»¶æœŸå€ºåŠ¡çš„è§„å®šã€‚è¿™ä¸ªå› å­è¯•å›¾æŠ“å–å…¬å¸çš„ç°é‡‘å¯ç”¨æ€§ä½œä¸ºè‚¡ç¥¨çš„å€æ•°ï¼ŒåŒæ—¶æä¾›ä¸€ä¸ªåŸºäºå¯ä»¥è·å¾—çš„ç°é‡‘æ”¶å…¥æµä»·å€¼æ ‡å‡†</span><br><span class="line"></span><br><span class="line"><span class="comment">#### RiceQuant å­—æ®µåŠè·å–æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">**å­—æ®µï¼š`<span class="number">1</span>/pcf_ratio`**  </span><br><span class="line"></span><br><span class="line">è¯´æ˜ï¼š å¸‚ç°ç‡ï¼š å¸‚ç°ç‡æ˜¯è‚¡ç¥¨ä»·æ ¼ä¸æ¯è‚¡ç°é‡‘æµé‡çš„æ¯”ç‡ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘éœ€è¦è·å–çš„æ˜¯è¿™ä¸ªpcf_ratioçš„å€’æ•°æ‰æ˜¯å¹´ç°é‡‘æµé™¤ä»¥æ¯ä¸€è‚¡çš„ä»·æ ¼ã€‚   </span><br><span class="line">æ€»å¸‚å€¼/å»å¹´ç»è¥ç°é‡‘æµé‡å‡€é¢</span><br><span class="line"></span><br><span class="line">```python	</span><br><span class="line">	dp = get_fundamentals(query(fundamentals.eod_derivative_indicator.pcf_ratio).filter(fundamentals.stockcode == <span class="string">'000001.XSHE'</span>), <span class="string">'2018-08-01'</span>,<span class="string">'4q'</span> ,report_quarter = <span class="keyword">True</span>)</span><br><span class="line">	</span><br><span class="line">	dp.minor_xs(<span class="string">'000001.XSHE'</span>)</span><br><span class="line">	</span><br><span class="line">	report_quarter pcf_ratio</span><br><span class="line">	<span class="number">2018</span><span class="number">-08</span><span class="number">-01</span>         <span class="number">2018</span>q1   <span class="number">-1.3227</span></span><br><span class="line">	<span class="number">2018</span><span class="number">-04</span><span class="number">-27</span>         <span class="number">2018</span>q1   <span class="number">-1.5684</span></span><br><span class="line">	<span class="number">2018</span><span class="number">-01</span><span class="number">-26</span>         <span class="number">2017</span>q3    <span class="number">-2.031</span></span><br><span class="line">	<span class="number">2017</span><span class="number">-10</span><span class="number">-26</span>         <span class="number">2017</span>q3   <span class="number">17.4689</span></span><br></pre></td></tr></table></figure>
<h3 id="Sales-to-Price-å¸‚é”€ç‡"><a href="#Sales-to-Price-å¸‚é”€ç‡" class="headerlink" title="Sales to Price(å¸‚é”€ç‡)"></a>Sales to Price(å¸‚é”€ç‡)</h3><blockquote>
<p>Net sales per share divided by the share price.<br>This factor measures the worth of a companyâ€™s shares according to the annual sales volume supporting the company business. The item is considered by many analysts to be less susceptible to manipulation than other valuation criteria; it is however, a less comprehensive measure of a companyâ€™s range of activities.</p>
</blockquote>
<p>æ¯ä¸€è‚¡çš„å‡€é”€å”®é¢é™¤ä»¥æ¯ä¸€è‚¡çš„ä»·æ ¼  </p>
<p><em>è¿™ä¸ªå› å­é€šè¿‡å¹´é”€å”®é‡æ¥è¡¡é‡è¿™ä¸ªå…¬å¸çš„ä»·å€¼ã€‚è¿™ä¸ªå› å­è¢«å¾ˆå¤šçš„åˆ†æå¸ˆè®¤ä¸ºæ›´åŠ ä¸å®¹æ˜“æ“çºµæ¯”èµ·å…¶ä»–çš„å› å­ï¼›æ— è®ºå¦‚ä½•è¿™æ˜¯ä¸€ä¸ªä¸å¾ˆå¤æ‚çš„è¡¡é‡ä¸€ä¸ªå…¬å¸æ´»åŠ¨èŒƒå›´çš„æ–¹å¼ã€‚</em></p>
<h4 id="RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-1"><a href="#RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-1" class="headerlink" title="RiceQuant å­—æ®µåŠè·å–æ–¹æ³•"></a>RiceQuant å­—æ®µåŠè·å–æ–¹æ³•</h4><p><strong>å­—æ®µï¼š<code>1/ps_ratio</code></strong>  </p>
<blockquote>
<p>è¯´æ˜ï¼š å¸‚é”€ç‡ï¼š å¸‚é”€ç‡ä¸ºè‚¡ç¥¨ä»·æ ¼ä¸æ¯è‚¡é”€å”®æ”¶å…¥ä¹‹æ¯”ï¼Œå¸‚é”€ç‡è¶Šå°ï¼Œé€šå¸¸è¢«è®¤ä¸ºæŠ•èµ„ä»·å€¼è¶Šé«˜ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘éœ€è¦è·å–çš„æ˜¯è¿™ä¸ªps_ratioçš„å€’æ•°æ‰æ˜¯æ¯ä¸€è‚¡çš„å‡€é”€å”®é¢é™¤ä»¥æ¯ä¸€è‚¡çš„ä»·æ ¼ã€‚   </p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dp = get_fundamentals(query(fundamentals.eod_derivative_indicator.ps_ratio).filter(fundamentals.stockcode == <span class="string">'000001.XSHE'</span>), <span class="string">'2017-12-31'</span>,<span class="string">'4q'</span> ,report_quarter = <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">dp.minor_xs(<span class="string">'000001.XSHE'</span>)</span><br><span class="line">report_quarter ps_ratio</span><br><span class="line"><span class="number">2017</span><span class="number">-12</span><span class="number">-29</span>         <span class="number">2017</span>q3   <span class="number">2.1629</span></span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-29</span>         <span class="number">2017</span>q2   <span class="number">1.7825</span></span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-29</span>         <span class="number">2017</span>q1   <span class="number">1.5004</span></span><br><span class="line"><span class="number">2017</span><span class="number">-03</span><span class="number">-29</span>         <span class="number">2016</span>q4   <span class="number">1.4521</span></span><br></pre></td></tr></table></figure>
<h3 id="EBITA-to-EV-ä¼ä¸šå€æ•°ä¼°å€¼"><a href="#EBITA-to-EV-ä¼ä¸šå€æ•°ä¼°å€¼" class="headerlink" title="EBITA to EV(ä¼ä¸šå€æ•°ä¼°å€¼)"></a>EBITA to EV(ä¼ä¸šå€æ•°ä¼°å€¼)</h3><blockquote>
<p>The ratio of the companyâ€™s EBITDA to Enterprise Value. EBITDA is Earnings before interest, taxes and depreciation and is calculated by taking the pretax income and adding back interest expense on debt and depreciation, depletion and amortization and subtracting interest capitalized.<br>Enterprise Value is defined as â€œmarket capitalization + total debt + preferred stock - cash and cash equivalentsâ€.</p>
</blockquote>
<p>è¿™æ˜¯EBITDAå¯¹ä¼ä¸šä»·å€¼çš„æ¯”ç‡ã€‚EBITDA æ˜¯åœ¨åˆ©æ¯ï¼Œç¨ä»¥åŠè´§å¸è´¬å€¼ä¹‹å‰çš„æ”¶ç›Šï¼Œé€šè¿‡è€ƒè™‘ç¨å‰æ”¶å…¥å’Œå¢åŠ å€ºåŠ¡å’ŒæŠ˜æ—§ï¼Œæ¶ˆè€—å’Œæ‘Šé”€ä»¥åŠå‡å»åˆ©æ¯èµ„æœ¬åŒ–çš„åˆ©æ¯è´¹ç”¨åŠ å›æ¥è®¡ç®—å‡ºæ¥çš„ã€‚<br>ä¼ä¸šä»·å€¼è¢«å®šä¹‰ä¸ºâ€œå¸‚åœºä»·å€¼ + å…¨éƒ¨å€ºåŠ¡ + ä¼˜å…ˆè‚¡-ç°é‡‘å’Œç°é‡‘ç­‰ä»·ç‰©â€  </p>
<h4 id="RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-2"><a href="#RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-2" class="headerlink" title="RiceQuant å­—æ®µåŠè·å–æ–¹æ³•"></a>RiceQuant å­—æ®µåŠè·å–æ–¹æ³•</h4><p><strong>å­—æ®µï¼š<code>1/ev_to_ebitda</code></strong>  </p>
<blockquote>
<p>è¯´æ˜ï¼š ä¼ä¸šå€æ•°ï¼š è¯„ä¼°å…¬å¸ä»·å€¼çš„æŒ‡æ ‡ï¼Œçœ‹çš„å‡ºæ¥ï¼Œè¿™é‡Œä¹Ÿæ˜¯åˆšå¥½æ˜¯å¯¼æ•°æ‰èƒ½å’Œä¸Šä¸€è‡´ã€‚</p>
</blockquote>
<p><em>æˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒEVæ˜¯æ€ä¹ˆè®¡ç®—å‡ºæ¥çš„ã€‚</em>  </p>
<p><strong>è¿™ä¸ªå­—æ®µæ— æ³•æŸ¥å‡ºï¼Œevæ˜¯æœ‰å€¼çš„è€Œebitdaä¸ºNAï¼Œæš‚æ—¶æ— æ³•ç¡®å®šæ˜¯å¦å…¶ä»–çš„è‚¡ç¥¨ä¹Ÿæ²¡æœ‰å€¼</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dp = get_fundamentals(query(fundamentals.financial_indicator.ev_to_ebitda).filter(fundamentals.stockcode == <span class="string">'000001.XSHE'</span>), <span class="string">'2017-12-31'</span>,<span class="string">'4q'</span> ,report_quarter = <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">dp.minor_xs(<span class="string">'000001.XSHE'</span>)</span><br><span class="line">report_quarter ev_to_ebitda</span><br><span class="line"><span class="number">2017</span><span class="number">-12</span><span class="number">-29</span>         <span class="number">2017</span>q3          NaN</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-29</span>         <span class="number">2017</span>q2          NaN</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-29</span>         <span class="number">2017</span>q1          NaN</span><br><span class="line"><span class="number">2017</span><span class="number">-03</span><span class="number">-29</span>         <span class="number">2016</span>q4          NaN</span><br></pre></td></tr></table></figure>
<h2 id="æ”¶ç›Šç‡å› å­"><a href="#æ”¶ç›Šç‡å› å­" class="headerlink" title="æ”¶ç›Šç‡å› å­"></a>æ”¶ç›Šç‡å› å­</h2><h3 id="Dividend-Yield-è‚¡æ¯æ”¶ç›Šç‡"><a href="#Dividend-Yield-è‚¡æ¯æ”¶ç›Šç‡" class="headerlink" title="Dividend Yield(è‚¡æ¯æ”¶ç›Šç‡)"></a>Dividend Yield(è‚¡æ¯æ”¶ç›Šç‡)</h3><blockquote>
<p>The annual dividend paid per share divided by the share price.<br>This factor measures the value of company shares according to the stream of dividend income resulting from share ownership.  </p>
</blockquote>
<p>ä¸€å¹´æ¯ä¸€è‚¡çš„è‚¡æ¯é™¤ä»¥æ¯è‚¡çš„ä»·æ ¼ </p>
<h4 id="RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-3"><a href="#RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-3" class="headerlink" title="RiceQuant å­—æ®µåŠè·å–æ–¹æ³•"></a>RiceQuant å­—æ®µåŠè·å–æ–¹æ³•</h4><p><em>è¿™ä¸ªå› å­é€šè¿‡è‚¡æƒæ‰€å¾—çš„è‚¡æ¯æ”¶å…¥æµè¡¡é‡äº†å…¬å¸è‚¡ç¥¨ä»·æ ¼</em></p>
<p><strong>å­—æ®µï¼š<code>dividend_yield</code></strong>  </p>
<p>è¯´æ˜ï¼š è‚¡æ¯ç‡ï¼š è‚¡æ¯ç‡æ˜¯è‚¡æ¯ä¸è‚¡ç¥¨ä»·æ ¼ä¹‹é—´çš„æ¯”ç‡<br>è‚¡æ¯ç‡ï¼âˆ‘æ¯è‚¡è‚¡åˆ©(ç¨å‰) / æ¯è‚¡å¸‚ä»·</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dp = get_fundamentals(query(fundamentals.eod_derivative_indicator.dividend_yield).filter(fundamentals.stockcode == <span class="string">'000001.XSHE'</span>), <span class="string">'2017-12-31'</span>,<span class="string">'4q'</span> ,report_quarter = <span class="keyword">True</span>)</span><br><span class="line">dp.minor_xs(<span class="string">'000001.XSHE'</span>)</span><br><span class="line">report_quarter dividend_yield</span><br><span class="line"><span class="number">2017</span><span class="number">-12</span><span class="number">-29</span>         <span class="number">2017</span>q3          <span class="number">1.188</span></span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-29</span>         <span class="number">2017</span>q2         <span class="number">1.4221</span></span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-29</span>         <span class="number">2017</span>q1            NaN</span><br><span class="line"><span class="number">2017</span><span class="number">-03</span><span class="number">-29</span>         <span class="number">2016</span>q4         <span class="number">1.3996</span></span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line"><span class="comment">### Shareholder Yield(è‚¡ä¸œæ”¶ç›Šç‡)</span></span><br><span class="line"></span><br><span class="line">&gt;The sum of Net Buyback Yield, Dividend Yield <span class="keyword">and</span> Net Debt Paydown Yield.  </span><br><span class="line">&gt;This factor measures the proportion of a company<span class="string">'s value distributed to shareholders through dividend payments, share repurchases and debt reduction.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å‡€å›è´­æ”¶ç›Šç‡çš„æ€»å’Œé™¤ä»¥æ”¶ç›Šç‡å’Œå‡€å€ºåŠ¡éƒ¨åˆ†è¿˜æ¬¾æ”¶ç›Šç‡  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*è¿™ä¸ªå› å­è¡¡é‡äº†å…¬å¸é€šè¿‡è‚¡æ¯åˆ†çº¢ï¼Œè‚¡ç¥¨å†å›è´­å’Œå€ºåŠ¡å‡å°‘åˆ†é…ç»™è‚¡ä¸œå…¬å¸ä»·å€¼çš„æ¯”ç‡*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## å¢é•¿å› å­</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Earnings Growth 5Y(äº”å¹´ç›ˆåˆ©å¢é•¿)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;The average annual growth rate of earnings (adjusted for amortizations of intangibles, extraordinary charges and credits) over a trailing five years.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;Earnings Growth is, perhaps, the clearest of the growth criteria. However, it is subject to the distortions of reporting conventions and manipulation and, particularly in some markets, only known after a considerable lag.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¿‡å»äº”å¹´çš„å¹³å‡å¹´æ”¶å…¥å¢é•¿ç‡ï¼ˆæ ¹æ®æ— å½¢èµ„äº§æ‘Šé”€ï¼Œç‰¹æ®Šè´¹ç”¨å’Œä¿¡è´·è°ƒæ•´ã€‚  </span></span><br><span class="line"><span class="string">ç›ˆåˆ©å¢é•¿å¯èƒ½æ˜¯æœ€æ¸…æ™°çš„å¢é•¿æ ‡å‡†ã€‚ç„¶è€Œä»–ä¼šæ”¶åˆ°æŠ¥å‘Šæƒ¯ä¾‹å¤±çœŸå’Œæ“æ§ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸€äº›å¸‚åœºä¸Šï¼Œåªæœ‰åœ¨ä¸€æ®µæ—¶é—´åæ‰èƒ½çœ‹å‡ºæ¥ã€‚  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### RiceQuant å­—æ®µåŠè·å–æ–¹æ³•</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**å­—æ®µï¼š`profit_from_operation `**  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;è¯´æ˜ï¼š å¯ä»¥è·å–æ¯å¹´çš„è¥ä¸šåˆ©æ¶¦ï¼Œç„¶åè®¡ç®—äº”å¹´çš„å¹³å‡å¢é•¿æƒ…å†µ  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¥ä¸šåˆ©æ¶¦ï¼š ä¼ä¸šåœ¨å…¶å…¨éƒ¨é”€å”®ä¸šåŠ¡ä¸­å®ç°çš„åˆ©æ¶¦ï¼Œåˆç§°è¥ä¸šåˆ©æ¶¦ã€ç»è¥åˆ©æ¶¦ï¼Œå®ƒåŒ…å«ä¸»è¥ä¸šåŠ¡åˆ©æ¶¦</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;	å¹´å¢é•¿ç‡æ˜¯å½“å¹´åˆ©æ¶¦çš„è¾ƒå‰ä¸€å¹´çš„å¢é•¿é‡é™¤ä»¥å‰ä¸€å¹´åˆ©æ¶¦çš„ç™¾åˆ†æ¯”.  </span></span><br><span class="line"><span class="string">&gt;	å¹³å‡å¢é•¿ç‡çš„è®¡ç®—ï¼š  </span></span><br><span class="line"><span class="string">&gt;	å‡å®š  </span></span><br><span class="line"><span class="string">&gt;	1ã€å¹³å‡å¢é•¿ç‡ä¸ºX  </span></span><br><span class="line"><span class="string">&gt;	2ã€æ¯å¹´çš„å¢é•¿ç‡åˆ†åˆ«ä¸ºR1ã€R2ã€R3,...,Rn  </span></span><br><span class="line"><span class="string">&gt;	åˆ™ï¼š  </span></span><br><span class="line"><span class="string">&gt;	Xï¼&#123;[ï¼ˆ1ï¼‹R1ï¼‰ï¼Šï¼ˆ1ï¼‹R2ï¼‰ï¼Šï¼ˆ1ï¼‹R3ï¼‰ï¼Š...*(1+Rn)]^1/n&#125; - 1  </span></span><br><span class="line"><span class="string">&gt;	æ³¨ï¼š^1/nè¡¨ç¤ºå¼€næ¬¡æ–¹  </span></span><br><span class="line"><span class="string">[https://www.zybang.com/question/cc63fc27473ec333c407161c3e2089d6.html](https://www.zybang.com/question/cc63fc27473ec333c407161c3e2089d6.html)	</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">```python</span></span><br><span class="line"><span class="string">import math</span></span><br><span class="line"><span class="string">dp = get_fundamentals(query(fundamentals.income_statement. profit_from_operation).filter(fundamentals.stockcode == '</span><span class="number">000001.</span>XSHE<span class="string">'), '</span><span class="number">2018</span><span class="number">-01</span><span class="number">-10</span><span class="string">', '</span><span class="number">5</span>y<span class="string">')</span></span><br><span class="line"><span class="string">dp2 = get_fundamentals(query(fundamentals.income_statement. profit_from_operation).filter(fundamentals.stockcode == '</span><span class="number">000001.</span>XSHE<span class="string">'), '</span><span class="number">2017</span><span class="number">-01</span><span class="number">-10</span><span class="string">', '</span><span class="number">5</span>y<span class="string">')</span></span><br><span class="line"><span class="string">upPercent = dp.minor_xs('</span><span class="number">000001.</span>XSHE<span class="string">')['</span>profit_from_operation<span class="string">'].values/dp2.minor_xs('</span><span class="number">000001.</span>XSHE<span class="string">')['</span>profit_from_operation<span class="string">'].values</span></span><br><span class="line"><span class="string">i = 1</span></span><br><span class="line"><span class="string">for i in range(len(upPercent)):</span></span><br><span class="line"><span class="string">	i = i*(upPercent[i] + 1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">earning_growth_5y = math.pow(i, 1/5.0) - 1</span></span><br></pre></td></tr></table></figure>
<h3 id="Sales-Growth-5Y-äº”å¹´é”€å”®å¢é•¿"><a href="#Sales-Growth-5Y-äº”å¹´é”€å”®å¢é•¿" class="headerlink" title="Sales Growth 5Y(äº”å¹´é”€å”®å¢é•¿)"></a>Sales Growth 5Y(äº”å¹´é”€å”®å¢é•¿)</h3><blockquote>
<p>The average annual growth rate of net sales per share over a trailing five years.<br>Although growth in sales per share might be only a narrow measure of a companyâ€™s business growth, and may be subject to a number of distortions, it is less subject to differences in reporting conventions or manipulation than many other balance sheet or profit and loss items.</p>
</blockquote>
<p>è¿‡å»äº”å¹´çš„æ¯è‚¡å‡€é”€å”®é‡å¹³å‡å¹´å¢é•¿ç‡ã€‚<br>å°½ç®¡æ¯è‚¡å¢é•¿ç‡ä¹Ÿè®¸åªæ˜¯è¡¡é‡å…¬å¸ä¸šåŠ¡å¢é•¿çš„ä¸€ä¸ªå°èŒƒå›´ï¼Œå¹¶ä¸”å¯èƒ½æœ‰ä¸€äº›æ‰­æ›²ï¼Œä¸è®¸å¤šå…¶ä»–èµ„äº§è´Ÿå€ºè¡¨æˆ–æŸç›Šé¡¹ç›®ç›¸æ¯”ï¼Œå®ƒåœ¨æŠ¥å‘Šæƒ¯ä¾‹æˆ–æ“çºµæ–¹é¢çš„å·®å¼‚è¾ƒå°ã€‚</p>
<h4 id="RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-4"><a href="#RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-4" class="headerlink" title="RiceQuant å­—æ®µåŠè·å–æ–¹æ³•"></a>RiceQuant å­—æ®µåŠè·å–æ–¹æ³•</h4><p><strong>å­—æ®µï¼š<code>revenue</code></strong>  </p>
<p>è¯´æ˜ï¼š å¯ä»¥è·å–æ¯å¹´çš„æ”¶å…¥ï¼Œç„¶åè®¡ç®—äº”å¹´çš„ç›ˆåˆ©å¢é•¿æƒ…å†µ</p>
<pre><code>å¹´å¢é•¿ç‡æ˜¯å½“å¹´åˆ©æ¶¦çš„è¾ƒå‰ä¸€å¹´çš„å¢é•¿é‡é™¤ä»¥å‰ä¸€å¹´åˆ©æ¶¦çš„ç™¾åˆ†æ¯”.
å¹³å‡å¢é•¿ç‡çš„è®¡ç®—ï¼š
å‡å®š
1ã€å¹³å‡å¢é•¿ç‡ä¸ºX
2ã€æ¯å¹´çš„å¢é•¿ç‡åˆ†åˆ«ä¸ºR1ã€R2ã€R3,...,Rn
åˆ™ï¼š
Xï¼{[ï¼ˆ1ï¼‹R1ï¼‰ï¼Šï¼ˆ1ï¼‹R2ï¼‰ï¼Šï¼ˆ1ï¼‹R3ï¼‰ï¼Š...*(1+Rn)]^1/n} - 1
æ³¨ï¼š^1/nè¡¨ç¤ºå¼€næ¬¡æ–¹
</code></pre><p><a href="https://www.zybang.com/question/cc63fc27473ec333c407161c3e2089d6.html" target="_blank" rel="noopener">https://www.zybang.com/question/cc63fc27473ec333c407161c3e2089d6.html</a>    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">import</span> math</span><br><span class="line">	dp = get_fundamentals(query(fundamentals.income_statement.revenue).filter(fundamentals.stockcode == <span class="string">'000001.XSHE'</span>), <span class="string">'2018-01-10'</span>, <span class="string">'5y'</span>)</span><br><span class="line">	dp2 = get_fundamentals(query(fundamentals.income_statement.revenue).filter(fundamentals.stockcode == <span class="string">'000001.XSHE'</span>), <span class="string">'2017-01-10'</span>, <span class="string">'5y'</span>)</span><br><span class="line">	upPercent = dp.minor_xs(<span class="string">'000001.XSHE'</span>)[<span class="string">'revenue'</span>].values/dp2.minor_xs(<span class="string">'000001.XSHE'</span>)[<span class="string">'revenue'</span>].values</span><br><span class="line">	i = <span class="number">1</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(upPercent)):</span><br><span class="line">		i = i*(upPercent[i] + <span class="number">1</span>)</span><br><span class="line">	</span><br><span class="line">	revenue_growth_5y = math.pow(i, <span class="number">1</span>/<span class="number">5.0</span>) - <span class="number">1</span></span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line"><span class="comment">### Forecast Growth 12M(12æœˆé¢„æµ‹å¢é•¿ç‡)</span></span><br><span class="line"></span><br><span class="line">	Consensus forecast growth of earnings over the next <span class="number">12</span> months. The <span class="number">12</span> month growth <span class="keyword">is</span> calculated on a pro-rata basis <span class="keyword">from</span> the forecasts <span class="keyword">for</span> each of the company<span class="string">'s next 2 annual reporting periods.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å¸‚åœºæ™®éé¢„æµ‹æœªæ¥12ä¸ªæœˆçš„ç›ˆåˆ©å¢é•¿ã€‚ 12ä¸ªæœˆçš„å¢é•¿æ˜¯æ ¹æ®å…¬å¸æœªæ¥2ä¸ªå¹´åº¦æŠ¥å‘ŠæœŸçš„é¢„æµ‹æŒ‰æ¯”ä¾‹è®¡ç®—çš„ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Dividend Growth 5Y(5å¹´è‚¡æ¯å¢é•¿)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	The average annual growth rate of dividends over a trailing five years.</span></span><br><span class="line"><span class="string">è¿‡å»äº”å¹´å¹³å‡è‚¡æ¯å¹´å¢é•¿ç‡</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### RiceQuant å­—æ®µåŠè·å–æ–¹æ³•</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**å­—æ®µï¼š`dividend_yield `**  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¯´æ˜ï¼šè‚¡æ¯ç‡æ˜¯è‚¡æ¯ä¸è‚¡ç¥¨ä»·æ ¼ä¹‹é—´çš„æ¯”ç‡ï¼›è‚¡æ¯ç‡ï¼âˆ‘æ¯è‚¡è‚¡åˆ©(ç¨å‰) / æ¯è‚¡å¸‚ä»·    </span></span><br><span class="line"><span class="string">ç”±äºè‚¡æ¯ä¸æ˜¯æ¯å¹´éƒ½ä¼šåˆ†é…çš„ï¼Œå¾ˆå¤šè‚¡ç¥¨ä¸æ˜¯æ¯å¹´éƒ½æœ‰è‚¡æ¯çš„ã€‚æ‰€ä»¥ç›®å‰åªæ˜¯ç®€å•çš„å†™å‡ºæ€ä¹ˆè·å–ä¸€å¹´çš„è‚¡æ¯ç‡ã€‚ä½†æ˜¯æ€ä¹ˆè®¡ç®—è¿™ä¸ªå› å­è¿˜æœªå®Œæˆã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">```python</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	## è·å–è‚¡æ¯ç‡</span></span><br><span class="line"><span class="string">	fundamental_df = get_fundamentals(query(fundamentals.eod_derivative_indicator.dividend_yield).order_by(fundamentals.eod_derivative_indicator.dividend_yield.desc()).limit(50), '</span><span class="number">2018</span><span class="number">-01</span><span class="number">-10</span><span class="string">', '</span><span class="number">1</span>y<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	for key in fundamental_df.minor_axis:</span></span><br><span class="line"><span class="string">		print key</span></span><br><span class="line"><span class="string">		print fundamental_df.minor_xs(key)</span></span><br></pre></td></tr></table></figure>
<h2 id="è´¨é‡å› å­"><a href="#è´¨é‡å› å­" class="headerlink" title="è´¨é‡å› å­"></a>è´¨é‡å› å­</h2><h3 id="Return-on-Equity-è‚¡ä¸œæƒç›Šå›æŠ¥ç‡"><a href="#Return-on-Equity-è‚¡ä¸œæƒç›Šå›æŠ¥ç‡" class="headerlink" title="Return on Equity(è‚¡ä¸œæƒç›Šå›æŠ¥ç‡)"></a>Return on Equity(è‚¡ä¸œæƒç›Šå›æŠ¥ç‡)</h3><pre><code>Net Income after preferred dividends divided by the book value of shareholdersâ€™ common equity.
RoE measures the profitability of the operations of the company as a proportion of the total amount of equity in the company. Since RoE multiplied by the reinvestment rate (the proportion of earnings not paid as dividends but reinvested in the company) gives the warranted growth rate of a company, RoE is a traditional measure of a company&apos;s growth potential.
</code></pre><p>ä¼˜å…ˆè‚¡è‚¡æ¯åçš„å‡€æ”¶å…¥é™¤ä»¥è‚¡ä¸œæ™®é€šè‚¡æƒçš„è´¦é¢ä»·å€¼<br>RoEè¡¡é‡äº†è¿™ä¸ªå…¬å¸çš„æ“ä½œçš„åˆ©æ¶¦ç‡ä½œä¸ºè¿™ä¸ªå…¬å¸å…¨éƒ¨æ•°é‡äº§æƒçš„ä¸€éƒ¨åˆ†ã€‚ç”±äºRoEä¹˜äº†å†æŠ•èµ„ç‡ï¼ˆç›ˆåˆ©æ²¡æœ‰ç”¨æ¥ä½œä¸ºè‚¡æ¯æ”¯ä»˜è€Œæ˜¯å†æ¬¡æŠ•å‘å…¬å¸ï¼‰ç»™å‡ºäº†å…¬å¸çš„ä¿è¯å¢é•¿ç‡ï¼ŒRoEæ˜¯ä¸€ä¸ªä¼ ç»Ÿçš„ç”¨æ¥è¡¡é‡å…¬å¸å¢é•¿æ½œåŠ›çš„å› å­ã€‚</p>
<h4 id="RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-5"><a href="#RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-5" class="headerlink" title="RiceQuant å­—æ®µåŠè·å–æ–¹æ³•"></a>RiceQuant å­—æ®µåŠè·å–æ–¹æ³•</h4><p><strong>å­—æ®µï¼š<code>roe</code></strong>  </p>
<p>è¯´æ˜ï¼šå‡€èµ„äº§æ”¶ç›Šç‡(æ‘Šè–„)(%)  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[https://www.ricequant.com/api/research/chn<span class="comment">#research-API-current_performance](https://www.ricequant.com/api/research/chn#research-API-current_performance)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## è·å–è‚¡æ¯ç‡  </span></span><br><span class="line">current_performance(<span class="string">'000004.XSHE'</span>,quarter=<span class="string">'2017q2'</span>,fields=<span class="string">'roe'</span>,interval=<span class="string">'6q'</span>)</span><br><span class="line">	end_date  info_date        roe</span><br><span class="line"><span class="number">0</span> <span class="number">2015</span><span class="number">-12</span><span class="number">-31</span> <span class="number">2016</span><span class="number">-04</span><span class="number">-15</span>   <span class="number">1.529771</span></span><br><span class="line"><span class="number">1</span> <span class="number">2014</span><span class="number">-12</span><span class="number">-31</span> <span class="number">2015</span><span class="number">-04</span><span class="number">-16</span>   <span class="number">4.735392</span></span><br><span class="line"><span class="number">2</span> <span class="number">2013</span><span class="number">-12</span><span class="number">-31</span> <span class="number">2014</span><span class="number">-04</span><span class="number">-15</span>  <span class="number">-1.642598</span></span><br><span class="line"><span class="number">3</span> <span class="number">2012</span><span class="number">-12</span><span class="number">-31</span> <span class="number">2013</span><span class="number">-04</span><span class="number">-13</span>   <span class="number">2.588968</span></span><br><span class="line"><span class="number">4</span> <span class="number">2007</span><span class="number">-12</span><span class="number">-31</span> <span class="number">2008</span><span class="number">-04</span><span class="number">-15</span> <span class="number">-13.200000</span></span><br></pre></td></tr></table></figure>
<h3 id="Net-Profit-Margin-å‡€åˆ©æ¶¦ç‡"><a href="#Net-Profit-Margin-å‡€åˆ©æ¶¦ç‡" class="headerlink" title="Net Profit Margin(å‡€åˆ©æ¶¦ç‡)"></a>Net Profit Margin(å‡€åˆ©æ¶¦ç‡)</h3><pre><code>The &quot;net margin&quot;, annual net income before preferred dividends (plus policyholders&apos; surplus for insurance companies), divided by annual net sales.
This measure attempts to assess the company&apos;s potential for profitable, sustained expansion or growth.
</code></pre><p>â€œå‡€åˆ©æ¶¦ç‡â€ï¼Œä¼˜å…ˆè‚¡è‚¡æ¯ä¹‹å‰çš„å¹´åº¦å‡€æ”¶å…¥ï¼ˆåŠ ä¸Šä¿é™©å…¬å¸çš„ä¿å•æŒæœ‰äººç›ˆä½™ï¼‰é™¤ä»¥å¹´åº¦å‡€é”€å”®é¢ã€‚<br>è¿™ä¸ªå› å­è¯•å›¾è¯„ä¼°è¿™ä¸ªå…¬å¸åˆ©æ¶¦æ½œåŠ›ï¼ŒæŒç»­æ‰©å¼ æˆ–è€…å¢é•¿ã€‚</p>
<h4 id="RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-6"><a href="#RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-6" class="headerlink" title="RiceQuant å­—æ®µåŠè·å–æ–¹æ³•"></a>RiceQuant å­—æ®µåŠè·å–æ–¹æ³•</h4><p><strong>å­—æ®µï¼š<code>net_profit_to_total_operating_revenueTTM</code></strong>  </p>
<p>è¯´æ˜ï¼šå‡€åˆ©æ¶¦ç‡;å«å°‘æ•°è‚¡ä¸œæŸç›Šçš„å‡€åˆ©æ¶¦ï¼ˆTTMï¼‰/è¥ä¸šæ”¶å…¥ï¼ˆTTMï¼‰*100%  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">dp = get_fundamentals(query(fundamentals.financial_indicator_TTM.net_profit_to_total_operating_revenueTTM).filter(fundamentals.stockcode == <span class="string">'000001.XSHE'</span>), <span class="string">'2018-01-10'</span>, <span class="string">'5y'</span>)</span><br><span class="line">dp.minor_xs(<span class="string">'000001.XSHE'</span>)</span><br><span class="line">	 					net_profit_to_total_operating_revenueTTM</span><br><span class="line"><span class="number">2018</span><span class="number">-01</span><span class="number">-10</span>                                  <span class="number">21.8157</span></span><br><span class="line"><span class="number">2017</span><span class="number">-01</span><span class="number">-10</span>                                  <span class="number">21.3537</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-08</span>                                  <span class="number">24.3004</span></span><br><span class="line"><span class="number">2015</span><span class="number">-01</span><span class="number">-08</span>                                  <span class="number">27.6696</span></span><br><span class="line"><span class="number">2014</span><span class="number">-01</span><span class="number">-08</span>                                   <span class="number">31.247</span></span><br><span class="line">dp.minor_xs(<span class="string">'000001.XSHE'</span>)* (<span class="number">-1</span>)</span><br><span class="line">				 debt_to_asset_ratio</span><br><span class="line"><span class="number">2018</span><span class="number">-01</span><span class="number">-10</span>            <span class="number">-93.0482</span></span><br><span class="line"><span class="number">2017</span><span class="number">-01</span><span class="number">-10</span>            <span class="number">-92.8982</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-08</span>            <span class="number">-93.9541</span></span><br><span class="line"><span class="number">2015</span><span class="number">-01</span><span class="number">-08</span>            <span class="number">-94.0898</span></span><br><span class="line"><span class="number">2014</span><span class="number">-01</span><span class="number">-08</span>            <span class="number">-94.8851</span></span><br></pre></td></tr></table></figure>
<h3 id="Low-Gearing-ä½èµ„æœ¬è´Ÿå€ºæ¯”ç‡"><a href="#Low-Gearing-ä½èµ„æœ¬è´Ÿå€ºæ¯”ç‡" class="headerlink" title="Low Gearing (ä½èµ„æœ¬è´Ÿå€ºæ¯”ç‡)"></a>Low Gearing (ä½èµ„æœ¬è´Ÿå€ºæ¯”ç‡)</h3><pre><code>The negative of debt to equity. Low geared companies can regarded as being of higher &quot;quality&quot; as they are less burdened by debt repayment costs.
</code></pre><p>å€ºåŠ¡å¯¹è‚¡æƒçš„è´Ÿé¢å½±å“ã€‚ä½èµ„æœ¬è´Ÿè½½ç‡æ¯”çš„å…¬å¸å¯ä»¥è¢«è®¤ä¸ºæ˜¯é«˜â€œè´¨é‡â€çš„å› ä¸ºå®ƒä»¬çš„å€ºåŠ¡å¿è¿˜æˆæœ¬è´Ÿæ‹…æ›´å°ã€‚  </p>
<h4 id="RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-7"><a href="#RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-7" class="headerlink" title="RiceQuant å­—æ®µåŠè·å–æ–¹æ³•"></a>RiceQuant å­—æ®µåŠè·å–æ–¹æ³•</h4><p><strong>å­—æ®µï¼š<code>debt_to_asset_ratio</code></strong> </p>
<p>è¯´æ˜ï¼šèµ„äº§è´Ÿå€ºç‡ï¼š èµ„äº§è´Ÿå€ºç‡æ˜¯ä¼ä¸šè´Ÿå€ºæ€»é¢å ä¼ä¸šèµ„äº§æ€»é¢çš„ç™¾åˆ†æ¯” </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">dp = get_fundamentals(query(fundamentals.financial_indicator_TTM.net_profit_to_total_operating_revenueTTM).filter(fundamentals.stockcode == <span class="string">'000001.XSHE'</span>), <span class="string">'2018-01-10'</span>, <span class="string">'5y'</span>)</span><br><span class="line"></span><br><span class="line">dp.minor_xs(<span class="string">'000001.XSHE'</span>) </span><br><span class="line">	           debt_to_asset_ratio</span><br><span class="line"><span class="number">2018</span><span class="number">-01</span><span class="number">-10</span>             <span class="number">93.0482</span></span><br><span class="line"><span class="number">2017</span><span class="number">-01</span><span class="number">-10</span>             <span class="number">92.8982</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-08</span>             <span class="number">93.9541</span></span><br><span class="line"><span class="number">2015</span><span class="number">-01</span><span class="number">-08</span>             <span class="number">94.0898</span></span><br><span class="line"><span class="number">2014</span><span class="number">-01</span><span class="number">-08</span>             <span class="number">94.8851</span></span><br><span class="line"></span><br><span class="line">dp.minor_xs(<span class="string">'000001.XSHE'</span>)*(<span class="number">-1</span>)</span><br><span class="line">			debt_to_asset_ratio</span><br><span class="line"><span class="number">2018</span><span class="number">-01</span><span class="number">-10</span>            <span class="number">-93.0482</span></span><br><span class="line"><span class="number">2017</span><span class="number">-01</span><span class="number">-10</span>            <span class="number">-92.8982</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-08</span>            <span class="number">-93.9541</span></span><br><span class="line"><span class="number">2015</span><span class="number">-01</span><span class="number">-08</span>            <span class="number">-94.0898</span></span><br><span class="line"><span class="number">2014</span><span class="number">-01</span><span class="number">-08</span>            <span class="number">-94.8851</span></span><br></pre></td></tr></table></figure>
<h3 id="Earnings-Growth-Stability-æ”¶ç›Šå¢é•¿ç¨³å®šæ€§"><a href="#Earnings-Growth-Stability-æ”¶ç›Šå¢é•¿ç¨³å®šæ€§" class="headerlink" title="Earnings Growth Stability(æ”¶ç›Šå¢é•¿ç¨³å®šæ€§)"></a>Earnings Growth Stability(æ”¶ç›Šå¢é•¿ç¨³å®šæ€§)</h3><pre><code>This &apos;quality&apos; factor is calculated as the negative of the standard deviation of earnings growth over the most recent 3 years of growth data.
</code></pre><p>è¿™ä¸ªâ€œè´¨é‡â€å› ç´ è®¡ç®—ä¸ºæœ€è¿‘3å¹´å¢é•¿æ•°æ®ä¸­æ”¶ç›Šå¢é•¿æ ‡å‡†å·®çš„è´Ÿå€¼ã€‚</p>
<h4 id="RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-8"><a href="#RiceQuant-å­—æ®µåŠè·å–æ–¹æ³•-8" class="headerlink" title="RiceQuant å­—æ®µåŠè·å–æ–¹æ³•"></a>RiceQuant å­—æ®µåŠè·å–æ–¹æ³•</h4><p><strong>å­—æ®µï¼š<code>inc_gross_profit</code></strong>  </p>
<p>è¯´æ˜ï¼šè¥ä¸šåˆ©æ¶¦(åŒæ¯”å¢é•¿ç‡)    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dp = get_fundamentals(query(fundamentals.financial_indicator.inc_gross_profit).filter(fundamentals.stockcode == <span class="string">'000001.XSHE'</span>), <span class="string">'2018-01-10'</span>, <span class="string">'3y'</span>)</span><br><span class="line"></span><br><span class="line">-dp.minor_xs(<span class="string">'000001.XSHE'</span>).std()</span><br><span class="line">inc_gross_profit   <span class="number">-5.265935</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<h3 id="Sales-Growth-Stability-é”€å”®å¢é•¿ç¨³å®šæ€§"><a href="#Sales-Growth-Stability-é”€å”®å¢é•¿ç¨³å®šæ€§" class="headerlink" title="Sales Growth Stability(é”€å”®å¢é•¿ç¨³å®šæ€§)"></a>Sales Growth Stability(é”€å”®å¢é•¿ç¨³å®šæ€§)</h3><pre><code>This &apos;Quality&apos; factor is calculated as the negative of the standard deviation of Sales Growth over the most recent 3 years of growth data.
</code></pre><p>æ­¤â€œè´¨é‡â€å› å­è®¡ç®—ä¸ºé”€å”®å¢é•¿æ ‡å‡†å·®ä¸æœ€è¿‘3å¹´å¢é•¿æ•°æ®çš„è´Ÿå€¼ã€‚</p>
<h4 id="RiceQuant-ç›¸å…³å­—æ®µåŠè·å–æ–¹æ³•"><a href="#RiceQuant-ç›¸å…³å­—æ®µåŠè·å–æ–¹æ³•" class="headerlink" title="RiceQuant ç›¸å…³å­—æ®µåŠè·å–æ–¹æ³•"></a>RiceQuant ç›¸å…³å­—æ®µåŠè·å–æ–¹æ³•</h4><p><strong>å­—æ®µï¼š<code>inc_revenue</code></strong>  </p>
<p>è¯´æ˜ï¼šè¥ä¸šæ€»æ”¶å…¥(åŒæ¯”å¢é•¿ç‡)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">	dp = get_fundamentals(query(fundamentals.financial_indicator. inc_revenue).filter(fundamentals.stockcode == <span class="string">'000001.XSHE'</span>), <span class="string">'2018-01-10'</span>, <span class="string">'3y'</span>)</span><br><span class="line">	</span><br><span class="line">	dp.minor_xs(<span class="string">'000001.XSHE'</span>)</span><br><span class="line">					inc_revenue</span><br><span class="line">	<span class="number">2018</span><span class="number">-01</span><span class="number">-10</span>     <span class="number">-2.6047</span></span><br><span class="line">	<span class="number">2017</span><span class="number">-01</span><span class="number">-10</span>     <span class="number">15.2013</span></span><br><span class="line">	<span class="number">2016</span><span class="number">-01</span><span class="number">-08</span>     <span class="number">30.1934</span></span><br><span class="line">	</span><br><span class="line">	-dp.minor_xs(<span class="string">'000001.XSHE'</span>).std()</span><br><span class="line">	inc_revenue   <span class="number">-16.419156</span></span><br><span class="line">	dtype: float64</span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line"><span class="comment">## å¤§å°å› å­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### å¸‚åœºä»·å€¼</span></span><br><span class="line"></span><br><span class="line">	The market capitalization of the stock.</span><br><span class="line">	The average size statistic of a portfolio <span class="keyword">is</span> the weighted (by holding value) average size of the securities held. The average size statistic of a benchmark (<span class="keyword">or</span> total market) <span class="keyword">is</span> the weighted (by holding value) average size of the securities within the benchmark (<span class="keyword">or</span> total market)</span><br><span class="line"></span><br><span class="line">è‚¡ç¥¨çš„å¸‚åœºä»·å€¼  </span><br><span class="line">ä¸€ä¸ªæŠ•èµ„ç»„åˆçš„å¹³å‡è§„æ¨¡ç»Ÿè®¡æ˜¯æŒæœ‰çš„è¯åˆ¸çš„å¹³å‡è§„æ¨¡åŠ æƒï¼ˆé€šè¿‡æŒæœ‰çš„ä»·å€¼ï¼‰ã€‚è¿™ä¸ªåŸºå‡†ï¼ˆæˆ–è€…æ€»å¸‚åœºï¼‰çš„å¹³å‡è§„æ¨¡ç»Ÿè®¡æ˜¯åŸºå‡†ä¸­è‚¡ç¥¨å¹³å‡è§„æ¨¡åŠ æƒï¼ˆé€šè¿‡æŒæœ‰ä»·å€¼ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">## æ³¢åŠ¨ç‡å› å­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Market Beta(å¸‚åœºBetaå€¼)</span></span><br><span class="line"></span><br><span class="line">	The <span class="string">"slope coefficient"</span>, (Î²), <span class="keyword">from</span> the simple regression:</span><br><span class="line">	Security monthly <span class="keyword">return</span> = Î± + Î² * market monthly <span class="keyword">return</span> + random error.</span><br><span class="line">	The regression <span class="keyword">is</span> carried out over <span class="number">36</span> month periods. Where sufficient information <span class="keyword">is</span> <span class="keyword">not</span> available, Î²=<span class="number">1</span> <span class="keyword">is</span> assumed.</span><br><span class="line"></span><br><span class="line">æ–œç‡å› å­ï¼ˆÎ²ï¼‰æ˜¯ä»ä¸€ä¸ªç®€å•çš„å›å½’ï¼š  </span><br><span class="line">è‚¡ç¥¨æœˆçš„å›å½’ç‡ = Î± + Î² * å¸‚åœºæœˆå›å½’ç‡ + éšæœºè¯¯å·®  </span><br><span class="line">å›å½’ä¼šè¿›è¡Œè¿‡å»<span class="number">36</span>ä¸ªæœˆã€‚å½“æ²¡æœ‰æ˜æ˜¾çš„ä¿¡æ¯çš„æ—¶å€™ï¼Œæ˜¯å‡è®¾Î²=<span class="number">1</span>ã€‚  </span><br><span class="line"></span><br><span class="line"><span class="comment">#### RiceQuant ç›¸å…³å­—æ®µåŠè·å–æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">**å­—æ®µï¼š`inc_revenue`**  </span><br><span class="line">è¯´æ˜ï¼šè¥ä¸šæ€»æ”¶å…¥(åŒæ¯”å¢é•¿ç‡)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">	dp = get_fundamentals(query(fundamentals.financial_indicator. inc_revenue).filter(fundamentals.stockcode == <span class="string">'000001.XSHE'</span>), <span class="string">'2018-01-10'</span>, <span class="string">'3y'</span>)</span><br><span class="line">	</span><br><span class="line">	dp.minor_xs(<span class="string">'000001.XSHE'</span>)</span><br><span class="line">					inc_revenue</span><br><span class="line">	<span class="number">2018</span><span class="number">-01</span><span class="number">-10</span>     <span class="number">-2.6047</span></span><br><span class="line">	<span class="number">2017</span><span class="number">-01</span><span class="number">-10</span>     <span class="number">15.2013</span></span><br><span class="line">	<span class="number">2016</span><span class="number">-01</span><span class="number">-08</span>     <span class="number">30.1934</span></span><br><span class="line">	</span><br><span class="line">	-dp.minor_xs(<span class="string">'000001.XSHE'</span>).std()</span><br><span class="line">	inc_revenue   <span class="number">-16.419156</span></span><br><span class="line">	dtype: float64</span><br></pre></td></tr></table></figure>
<h3 id="Daily-Volatility-1Y-1å¹´æ—¥å‡æ³¢åŠ¨ç‡"><a href="#Daily-Volatility-1Y-1å¹´æ—¥å‡æ³¢åŠ¨ç‡" class="headerlink" title="Daily Volatility 1Y(1å¹´æ—¥å‡æ³¢åŠ¨ç‡)"></a>Daily Volatility 1Y(1å¹´æ—¥å‡æ³¢åŠ¨ç‡)</h3><pre><code>The standard deviation of the last year of daily total returns, expressed as an annualized percentage.
</code></pre><p>æ¯æ—¥æ€»å›æŠ¥çš„å»å¹´çš„æ ‡å‡†å·®ï¼Œä»¥å¹´åŒ–ç™¾åˆ†æ¯”è¡¨ç¤ºã€‚</p>
<h3 id="Volatility-3Y-3å¹´æ³¢åŠ¨ç‡"><a href="#Volatility-3Y-3å¹´æ³¢åŠ¨ç‡" class="headerlink" title="Volatility 3Y(3å¹´æ³¢åŠ¨ç‡)"></a>Volatility 3Y(3å¹´æ³¢åŠ¨ç‡)</h3><pre><code>The standard deviation of the last 36 months of total returns, expressed as an annualized percentage.
</code></pre><p>è¿‡å»36ä¸ªæœˆçš„æ€»å›æŠ¥ç‡çš„æ ‡å‡†å·®ï¼Œä»¥å¹´åŒ–ç™¾åˆ†æ¯”è¡¨ç¤ºã€‚</p>
<h2 id="åŠ¨é‡å› å­"><a href="#åŠ¨é‡å› å­" class="headerlink" title="åŠ¨é‡å› å­"></a>åŠ¨é‡å› å­</h2><h3 id="Momentum-ST"><a href="#Momentum-ST" class="headerlink" title="Momentum ST"></a>Momentum ST</h3><pre><code>Calculated using a 6 month &quot;memory&quot; of monthly total returns. The past period returns are weighted using a &quot;decay ratio&quot; of 2/3, per month. This weighted historic return factor measures the degree of performance trend following. It is useful in recognizing trading character of specific markets and in noticing occasional changing patterns through the market cycle.
</code></pre><p>ä½¿ç”¨æ¯æœˆæ€»å›æŠ¥çš„6ä¸ªæœˆâ€œè®°å¿†â€è®¡ç®—ã€‚ è¿‡å»çš„æœŸé—´å›æŠ¥ä½¿ç”¨æ¯æœˆ2/3çš„â€œè¡°å‡ç‡â€åŠ æƒã€‚ è¯¥åŠ æƒå†å²å›æŠ¥å› å­è¡¡é‡äº†è¿½éšçš„ä¸šç»©è¶‹åŠ¿ç¨‹åº¦ã€‚ å®ƒæœ‰åŠ©äºè¯†åˆ«ç‰¹å®šå¸‚åœºçš„äº¤æ˜“ç‰¹å¾ï¼Œå¹¶æ³¨æ„åˆ°å¸‚åœºå‘¨æœŸä¸­å¶å°”ä¼šå‡ºç°çš„å˜åŒ–æ¨¡å¼ã€‚</p>
<h3 id="Momentum-12-1"><a href="#Momentum-12-1" class="headerlink" title="Momentum 12-1"></a>Momentum 12-1</h3><pre><code>The total return of the stock over the last 12 months, excluding the total return over the most recent month since reversal effects are often associated with one-month returns.
</code></pre><p>è¿‡å»12ä¸ªæœˆçš„è‚¡ç¥¨æ€»å›æŠ¥ï¼Œä¸åŒ…æ‹¬è‡ªé€†è½¬å½±å“ä»¥æ¥æœ€è¿‘ä¸€ä¸ªæœˆçš„æ€»å›æŠ¥ï¼Œé€šå¸¸ä¸ä¸€ä¸ªæœˆçš„å›æŠ¥ç›¸å…³ã€‚</p>
<h3 id="Forecast-12M-Revisions"><a href="#Forecast-12M-Revisions" class="headerlink" title="Forecast 12M Revisions"></a>Forecast 12M Revisions</h3><pre><code>IBES balance of Earnings forecast revisions for the over the next 12 months.
Calculated as the difference between the number of upwards revisions minus the number of downwards revisions (as sampled over the past 1M period), expressed as a percentage of the number of estimates.
</code></pre><p>IBESæœªæ¥12ä¸ªæœˆçš„ç›ˆåˆ©é¢„æµ‹ä¿®æ­£ä½™é¢ã€‚<br>è®¡ç®—ä¸ºå‘ä¸Šä¿®è®¢æ•°é‡å‡å»å‘ä¸‹ä¿®è®¢æ•°é‡ï¼ˆåœ¨è¿‡å»1MæœŸé—´é‡‡æ ·ï¼‰ä¹‹é—´çš„å·®å¼‚ï¼Œè¡¨ç¤ºä¸ºä¼°è®¡æ•°é‡çš„ç™¾åˆ†æ¯”ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2018/09/04/Algo/è·Ÿè¸ªèªæ˜é’±/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/04/Algo/è·Ÿè¸ªèªæ˜é’±/" class="post-title-link" itemprop="url">è·Ÿè¸ªèªæ˜é’±</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-09-04 20:16:20" itemprop="dateCreated datePublished" datetime="2018-09-04T20:16:20+08:00">2018-09-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-06 17:57:40" itemprop="dateModified" datetime="2019-03-06T17:57:40+08:00">2019-03-06</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="è·Ÿè¸ªèªæ˜é’±"><a href="#è·Ÿè¸ªèªæ˜é’±" class="headerlink" title="è·Ÿè¸ªèªæ˜é’±"></a>è·Ÿè¸ªèªæ˜é’±</h1><p>##ç ”ç©¶ç›®æ ‡</p>
<p>åˆ†é’Ÿè¡Œæƒ…æ•°æ®è¿›è¡Œç ”ç©¶  </p>
<p>##èªæ˜åº¦æŒ‡æ ‡S</p>
<p>èªæ˜é’±æƒ…ç»ªå› å­Qï¼Œå› å­Qè¶Šé«˜ï¼Œè¡¨é¢èªæ˜é’±çš„äº¤æ˜“å€¾å‘äºå‡ºç°åœ¨ä»·æ ¼è¾ƒé«˜å¤„ï¼Œé€¢é«˜å‡ºè´§çš„è¡¨ç°ï¼Œè¡¨æ˜äº†æ‚²è§‚æ€åº¦ï¼›å› å­Qå€¼è¶Šå°ï¼Œè¡¨æ˜èªæ˜é’±äº¤æ˜“å‡ºç°åœ¨ä»·æ ¼è¾ƒä½å¤„ï¼Œé€¢ä½å¸ç­¹çš„è¡¨ç°ï¼Œååº”äº†ä¹è§‚æƒ…ç»ªã€‚<br>Q å€¼å°è§†ä¸ºèªæ˜é’±é€¢ä½ä¹°å…¥çš„è¡¨ç°ï¼Œå› æ­¤å¯é€‰å–äº”åˆ†ç»„ä¸­Qå€¼æœ€å°çš„ç¬¬ä¸€ç»„ï¼Œä½œä¸ºè·Ÿè¸ªèªæ˜é’±åŠ¨å‘çš„ SMART ç»„åˆ</p>
<p>##ä»åˆ†é’Ÿè¡Œæƒ…æ•°æ®ä¸­çœ‹èªæ˜é’±</p>
<p>è‚¡ç¥¨çš„åˆ†é’Ÿè¡Œæƒ…æ•°æ®ï¼ŒåŒ…å«å¼€ç›˜ä»·ï¼Œæœ€é«˜ä»·ï¼Œæœ€ä½ä»·ï¼Œæ”¶ç›˜ä»·å’Œæˆäº¤é‡ç­‰ã€‚<br>æ‰¾èªæ˜é’±çš„ç‰¹å¾è®¾ç½®ä¸ºï¼šâ€œå•ç¬”è®¢å•æ•°é‡æ›´å¤§ï¼Œè®¢å•æŠ¥ä»·æ›´ä¸ºæ¿€è¿›â€ã€‚<br>ä½¿ç”¨å¦‚ä¸‹çš„æŒ‡æ ‡æ¥è¡¡é‡æ¯ä¸€åˆ†é’Ÿäº¤æ˜“èªæ˜ç¨‹åº¦ï¼š</p>
<p>$$ S_t = |R_t|/V_t^{0.5}$$</p>
<p>å…¶ä¸­\(R_t\) æ˜¯ç¬¬tåˆ†é’Ÿçš„æ¶¨è·Œå¹…ï¼Œ\(V_t\)æ˜¯ç¬¬tåˆ†é’Ÿçš„æˆäº¤é‡ã€‚æŒ‡æ ‡\(S_t\)çš„å€¼è¶Šå¤§ï¼Œåˆ™è¯¥åˆ†é’Ÿçš„äº¤æ˜“è¶Šèªæ˜ã€‚<br>å¯¹äºç‰¹å®šçš„æ—¶æ®µï¼Œç‰¹å®šè‚¡ç¥¨çš„æ‰€æœ‰åˆ†é’Ÿè¡Œæƒ…æ•°æ®ï¼Œ å°†å…¶æŒ‰æŒ‡æ ‡Sä»å¤§åˆ°å°æ’åºï¼Œæˆäº¤é‡ç´¯ç§¯å æ¯”å‰20%çš„è§†ä¸ºèªæ˜é’±äº¤æ˜“ã€‚ â€”- è¿™é‡Œæˆ‘æœ‰ç‚¹ä¸æ‡‚æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ<br>æ‡‚äº†ï¼Œå°±æ˜¯å¯¹æ¯ä¸€åˆ†é’Ÿçš„Så€¼è¿›è¡Œæ’åºï¼Œç„¶ååªå–æˆäº¤å€¼ä¸º20%çš„æ—¶é—´åšä¸ºèªæ˜é’±çš„äº¤æ˜“ã€‚  </p>
<p><strong>èªæ˜é’±æƒ…ç»ªå› å­Q</strong></p>
<p>$$ Q = VWAP_{smart}/VWAP_{all}$$<br>\( VWAP_{smart}\) æ˜¯èªæ˜é’±çš„æˆäº¤é‡åŠ æƒå¹³å‡ä»·<br>\( VWAP_{all}\) æ˜¯æ‰€æœ‰äº¤æ˜“çš„æˆäº¤é‡åŠ æƒå¹³å‡ä»·<br>Qååº”äº†è¿™ä¸ªæ—¶é—´æ®µ<strong>æˆ‘çš„é—®é¢˜æ˜¯è¿™ä¸ªæ—¶é—´æ®µæ€ä¹ˆå®šä¹‰çš„ï¼Ÿ</strong>ä¸­èªæ˜é’±å‚ä¸äº¤æ˜“çš„ç›¸å¯¹ä»·ä½ã€‚<br>Qè¶Šé«˜ï¼Œå€¼è¶Šå¤§ï¼Œèªæ˜é’±çš„äº¤æ˜“è¶Šå€¾å‘äºå‡ºç°åœ¨ä»·æ ¼é«˜ç‚¹ï¼Œé€¢é«˜å‡ºè´§ã€‚<br>Qè¶Šä½ï¼Œå€¼è¶Šå°ï¼Œèªæ˜é’±çš„äº¤æ˜“è¶Šå€¾å‘äºå‡ºç°åœ¨ä»·æ ¼ä½ç‚¹ï¼Œé€¢ä½å¸ç­¹ã€‚  </p>
<h2 id="æƒ…ç»ªå› å­Qçš„é€‰è‚¡èƒ½åŠ›"><a href="#æƒ…ç»ªå› å­Qçš„é€‰è‚¡èƒ½åŠ›" class="headerlink" title="æƒ…ç»ªå› å­Qçš„é€‰è‚¡èƒ½åŠ›"></a>æƒ…ç»ªå› å­Qçš„é€‰è‚¡èƒ½åŠ›</h2><p>æ¯ä¸ªæœˆçš„æœ€åä¸€ä¸ªäº¤æ˜“æ—¥ï¼Œè®¡ç®—æ‰€æœ‰è‚¡ç¥¨æœ€è¿‘10ä¸ªäº¤æ˜“æ—¥çš„åˆ†é’Ÿè¡Œæƒ…æ•°æ®ï¼Œè®¡ç®—æ¯ä¸ªè‚¡ç¥¨çš„æƒ…ç»ªå› å­Qã€‚<br>ç„¶åè€ƒè™‘äº†æ¯ä¸ªæœˆå› å­å€¼å’Œæ¬¡æœˆæ”¶ç›Šçš„ç§©ç›¸å…³ç³»æ•°ï¼ˆRankICï¼‰<br>è¿™ä¸ªç›¸å…³ç³»æ•°è¦æ€ä¹ˆè®¡ç®—ï¼Ÿ æ¬¡æœˆæ”¶ç›Šæ˜¯æ€ä¹ˆå¾—å‡ºæ¥çš„ï¼Ÿï¼Ÿ<br>è®¡ç®—ç§©ç›¸å…³ç³»æ•°åˆæ˜¯æ€ä¹ˆè®¡ç®—çš„ï¼Ÿ  </p>
<p>æŠ•èµ„çš„æ–¹æ³•å€’æ˜¯çœ‹å‡ºæ¥äº†ï¼šå°†å¸‚åœºä¸Šçš„è‚¡ç¥¨æŒ‰ç…§Qä»å°åˆ°å¤§æ’åºï¼Œç­‰åˆ†ä¸ºäº”ç»„ã€‚ç¬¬ä¸€ç»„ä¸ºæœ€å°ï¼Œç¬¬äº”ç»„æœ€å¤§ã€‚ç„¶åå¯ä»¥æœ€å¤§å’Œæœ€å°ä¹‹é—´è¿›è¡Œå¯¹å†²<strong>ä¸ºå•¥æˆ‘è§‰å¾—è¿™ä¹ˆå¤„ç†æ¯«æ— é€»è¾‘</strong></p>
<p>##æƒ…ç»ªå› å­çš„é£é™©ç‰¹å¾</p>
<p>é‡ç‚¹å…³æ³¨æƒ…ç»ªå› å­Qçš„å¸‚å€¼ï¼ŒåŠ¨é‡ç­‰å› å­çš„å…³è”æ€§ã€‚<br>ä½¿ç”¨æ¨ªæˆªé¢å›å½’å–æ®‹å·®çš„æ–¹å¼ï¼Œå¯¹å¸‚å€¼ï¼ŒåŠ¨é‡ï¼Œè¡Œä¸šç­‰å› å­è¿›è¡Œå‰”é™¤ã€‚æ¨ªæˆªé¢å›å½’æ¨¡å‹å¦‚ä¸‹ï¼š<br>$$ Q_i = \beta_1LogMktVal + \beta_2Ret20d_i + \sum_{j=1}^{N} \beta_{3j}Ind_{ji} + \epsilon$$<br>å…¶ä¸­ï¼ŒQä¸ºæƒ…ç»ªå› å­<br>LogMktVal ä¸ºè‚¡ç¥¨å¯¹æ•°æµé€šå¸‚å€¼<br>Ret20d ä¸ºå‰20ä¸ªäº¤æ˜“æ—¥çš„æ¶¨è·Œå€¼<br>Indç”³ä¸‡ä¸€çº§è¡Œä¸šå“‘å˜é‡<br>\( \epsilon\) æ˜¯æ®‹å·®å› å­  </p>
<p>##è·Ÿè¸ªèªæ˜é’±çš„SMARTç»„åˆ</p>
<p>ç”±äºæˆ‘ä»¬å¯ä»¥è§†Qå€¼å°ä¸ºèªæ˜é’±é€¢ä½ä¹°å…¥çš„è¡¨ç°ã€‚å› æ­¤é€‰å–äº”åˆ†ç»„ä¸­Qæœ€å°çš„ç¬¬ä¸€ç»„ï¼Œç”¨äºè·Ÿè¸ªèªæ˜é’±åŠ¨å‘çš„SMARTç»„åˆã€‚</p>
<p>##é™¤äº†ä¸Šé¢æè¿°çš„å¯¹å†²è®¡ç®—æ”¶ç›Šç‡çš„æ–¹å¼æˆ‘è¿˜æ„Ÿå…´è¶£çš„åœ°æ–¹</p>
<pre><code>1. æ˜¯å¦å¯ä»¥åˆ—å‡ºæ¯æ¬¡çš„èªæ˜é’±å› å­å¯¹åº”çš„è‚¡ç¥¨ï¼Œåšä¸€ä¸ªè‚¡ç¥¨é›†ã€‚
2. è¿˜æ˜¯æ²¡æœ‰çœ‹å‡ºæ¥è¿™é‡Œé¢æ˜¯æ€ä¹ˆæ ¹æ®qæ¥è¿›è¡ŒæŠ•èµ„ç»„åˆçš„ã€‚
3. åé¢çš„æ¨ªæˆªé¢å›å½’æ¨¡å‹æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ

å®ç°å®Œäº†ä¼˜çŸ¿ä¸Šçš„ä»£ç å†æ¥å›ç­”è¿™äº›é—®é¢˜ã€‚
</code></pre>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2018/04/23/SparkAndDeepLearning/Shuffle_ç¿»è¯‘è‡ªspark_programming_guideline/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/23/SparkAndDeepLearning/Shuffle_ç¿»è¯‘è‡ªspark_programming_guideline/" class="post-title-link" itemprop="url">Spark Programming--- Shuffle Operations ç¿»è¯‘</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-23 18:17:04" itemprop="dateCreated datePublished" datetime="2018-04-23T18:17:04+08:00">2018-04-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-06 18:04:25" itemprop="dateModified" datetime="2019-03-06T18:04:25+08:00">2019-03-06</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spark-Programmingâ€”-Shuffle-operations"><a href="#Spark-Programmingâ€”-Shuffle-operations" class="headerlink" title="Spark Programmingâ€” Shuffle operations"></a>Spark Programmingâ€” Shuffle operations</h1><p>original: <a href="http://spark.apache.org/docs/latest/rdd-programming-guide.html#shuffle-operations" target="_blank" rel="noopener">http://spark.apache.org/docs/latest/rdd-programming-guide.html#shuffle-operations</a></p>
<p>ä¸€äº›sparkçš„ç‰¹å®šæ“ä½œå°†ä¼šè§¦å‘è¢«ç§°ä¸ºshuffleçš„äº‹ä»¶ã€‚Shuffleæ˜¯Sparkç”¨äºé‡æ–°åˆ†å¸ƒæ•°æ®çš„æœºåˆ¶ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸åŒçš„åˆ†åŒºæ¥åˆ†ç»„ã€‚è¿™é€šå¸¸æ¶‰åŠåˆ°åœ¨executorå’Œæœºå™¨ä¹‹é—´è¿›è¡Œæ‹·è´æ•°æ®ï¼Œæ‰€ä»¥shuffleæ˜¯ä¸€ä¸ªå¾ˆå¤æ‚å¹¶ä¸”æ¶ˆè€—é«˜çš„æ“ä½œã€‚  </p>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¸ºäº†äº†è§£shuffleæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘reduceByKeyæ“ä½œä½œä¸ºä¾‹å­ã€‚reduceByKeyæ“ä½œç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„RDDé€šè¿‡æ‰€æœ‰çš„å•ä¸ªé”®å€¼ç»„åˆä¸ºä¸€ä¸ªå…ƒç»„-å…³é”®å­—å’Œé’ˆå¯¹ä¸è¯¥å…³é”®å­—ç›¸å…³çš„æ‰€æœ‰å€¼æ‰§è¡Œreduceå‡½æ•°çš„ç»“æœã€‚è¿™é‡Œçš„æŒ‘æˆ˜ä¸æ˜¯æ‰€æœ‰çš„å€¼å¯¹ä¸€ä¸ªå•ç‹¬çš„é”®éƒ½åœ¨åŒä¸€ä¸ªåˆ†åŒºä¸Šæˆ–è€…ç”šè‡³è¯´åœ¨ä¸€å°æœºå™¨ä¸Šï¼Œè€Œæ˜¯å®ƒä»¬å¿…é¡»è¢«é‡æ–°åˆ†å¸ƒæ¥è®¡ç®—ç»“æœã€‚<br>åœ¨Sparkï¼Œæ•°æ®é€šå¸¸ä¸ä¼šè·¨åˆ†åŒºåˆ†å¸ƒåˆ°ç‰¹å®šæ“ä½œçš„å¿…è¦ä½ç½®ã€‚åœ¨è®¡ç®—ä¸­ï¼Œä¸€ä¸ªå•ç‹¬çš„ä»»åŠ¡å°†ä¼šåœ¨ä¸€ä¸ªå•ç‹¬çš„åˆ†åŒºä¸Šæ“ä½œ-ç„¶è€Œä¸ºäº†ç»„ç»‡æ‰€æœ‰çš„æ•°æ®æ¥è¢«ä¸€ä¸ªçš„å•ç‹¬reduceByKey çš„reduceä»»åŠ¡æ¥æ‰§è¡Œï¼ŒSparkéœ€è¦æ¥æ‰§è¡Œä¸€ä¸ªall-to-allæ“ä½œã€‚å®ƒå¿…é¡»è¯»å–æ‰€æœ‰åˆ†åŒºæ¥æ‰¾åˆ°æ‰€æœ‰é”®çš„å€¼ï¼Œç„¶åå°†å®ƒä»¬å¸¦åˆ°ä¸€èµ·è·¨åˆ†åŒºæ¥ä¸ºæ¯ä¸€ä¸ªé”®è®¡ç®—æœ€ç»ˆçš„ç»“æœâ€”è¿™ä¸ªè¢«ç§°ä¸ºshuffleã€‚<br>å°½ç®¡åœ¨æ¯ä¸€ä¸ªåˆ†åŒºä¸­çš„æ–°çš„shuffledæ•°æ®çš„å…ƒç´ é›†æ˜¯å¾ˆé‡è¦çš„ï¼ŒåŒæ ·åˆ†åŒºè‡ªå·±çš„é¡ºåºä¹Ÿå¾ˆé‡è¦ï¼Œè€Œå…ƒç´ ä¹‹é—´çš„é¡ºåºå°±ä¸æ˜¯äº†ã€‚å¦‚æœä¸€ä¸ªæƒ³è¦é¢„æµ‹shuffleä¸­çš„é¡ºåºæ•°æ®é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ï¼š  </p>
<ol>
<li>mapPartitions æ¥æ’åºæ¯ä¸€ä¸ªåˆ†åŒºï¼Œæ¯”å¦‚ï¼Œ.sorted</li>
<li>repartitionAndSortWithinPartitions æ¥æœ‰æ•ˆåˆ†åŒºåŒæ—¶åŒæ­¥é‡æ–°åˆ†åŒºã€‚  </li>
<li>sortBy åˆ›é€ ä¸€ä¸ªå…¨å±€çš„æ’åºçš„RDD</li>
</ol>
<p>å¯ä»¥å¼•èµ·ä¸€ä¸ªshuffle çš„æ“ä½œåŒ…æ‹¬ï¼šrepartition å’Œ coalesce,ByKeyçš„æ“ä½œï¼Œé™¤äº†countingä¹‹å¤–çš„æ¯”å¦‚ï¼šgroupByKey å’ŒreduceByKey,ä»¥åŠjoinæ“ä½œæ¯”å¦‚cogroup å’Œ joinã€‚</p>
<h2 id="æ€§èƒ½å½±å“"><a href="#æ€§èƒ½å½±å“" class="headerlink" title="æ€§èƒ½å½±å“"></a>æ€§èƒ½å½±å“</h2><p>Shuffleæ˜¯ä¸€ä¸ªæ˜‚è´µçš„æ“ä½œå› ä¸ºå®ƒæ¶‰åŠåˆ°ç£ç›˜I/Oï¼Œæ•°æ®åºåˆ—åŒ–å’Œç½‘ç»œI/Oã€‚ä¸ºäº†ç»™shuffleç»„ç»‡æ•°æ®ï¼Œsparkç”Ÿæˆä¸€ç³»åˆ—ä»»åŠ¡-mapsç”¨äºç»„ç»‡æ•°æ®ï¼Œä»¥åŠä¸€ç³»åˆ—reduceä»»åŠ¡æ¥èšé›†å®ƒã€‚è¿™ä¸ªå‘½åç³»ç»Ÿæ¥è‡ªäºMapReduceè€Œä¸”å¹¶ä¸ç›´æ¥å’ŒSparKçš„mapï¼Œreduceæ“ä½œæœ‰å…³ã€‚<br>åœ¨å†…éƒ¨ï¼Œå•ç‹¬çš„mapä»»åŠ¡çš„ç»“æœä¼šè¢«ä¿å­˜åœ¨å†…å­˜ä¸­ç›´åˆ°å®ƒä»¬ä¸é€‚ç”¨ã€‚ç„¶åè¿™äº›ç»“æœä¼šè¢«æ ¹æ®ç›®æ ‡åˆ†åŒºæ’åºå¹¶ä¸”å†™å‘å•ä¸€çš„æ–‡ä»¶ã€‚åœ¨reduceæ–¹é¢ï¼Œä»»åŠ¡è¯»å–ç›¸å…³çš„æ’åºå—ã€‚<br>ä¸€å®šçš„shuffleæ“ä½œä¼šæ¶ˆè€—æ˜æ˜¾çš„æ•°é‡çš„å †å†…å­˜å› ä¸ºå®ƒä»¬ä½¿ç”¨çš„æ˜¯åœ¨å†…å­˜ä¸­çš„æ•°æ®ç»“æ„æ¥ç»„ç»‡è®°å½•åœ¨ä¼ è¾“ä¹‹å‰æˆ–è€…ä¹‹åã€‚æ˜æ˜¾çš„ï¼ŒreduceByKeyå’ŒAggregateByKeyåˆ›é€ äº†è¿™äº›ç»“æ„åœ¨mapé˜¶æ®µï¼Œä»¥åŠ â€˜Bykeyçš„æ“ä½œç”Ÿæˆäº†å®ƒä»¬åœ¨reduceé˜¶æ®µã€‚å½“æ•°æ®ä¸èƒ½æ”¾è¿›å†…å­˜ä¸­æ—¶ï¼ŒSparkå°†ä¼šå°†è¿™äº›è¡¨æ•£è½åˆ°ç¡¬ç›˜ä¸­ï¼Œä¼šå¼•èµ·è€Œå¤–çš„ç£ç›˜I/Oå’Œå¢åŠ åƒåœ¾å›æ”¶æ¬¡æ•°ã€‚<br>ShuffleåŒæ ·ä¼šç”Ÿæˆå¤§é‡çš„ä¸­é—´æ–‡ä»¶åœ¨ç£ç›˜ä¸­ã€‚ä»Spark1.3å¼€å§‹ï¼Œè¿™äº›æ–‡ä»¶è¢«ä¿å­˜ç›´åˆ°å¯¹åº”çš„RDDsä¸å†è¢«ä½¿ç”¨ä»¥åŠå·²ç»è¢«åƒåœ¾å›æ”¶äº†ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†shuffleæ–‡ä»¶ä¸éœ€è¦è¢«é‡æ–°åˆ›é€ å¦‚æœlineageè¢«é‡æ–°è®¡ç®—æ—¶ã€‚åƒåœ¾å›æ”¶ä¹Ÿè®¸ä¼šå‘ç”Ÿåªæœ‰åœ¨ä¸€æ®µå¾ˆé•¿æ—¶é—´ï¼Œå¦‚æœè¿™ä¸ªåº”ç”¨ä¿ç•™äº†å¯¹RDDçš„å¼•ç”¨æˆ–è€…å¦‚æœGCæ²¡æœ‰é¢‘ç¹çš„å‘ç”Ÿã€‚è¿™æ„å‘³ç€é•¿æœŸè¿è¡Œçš„sparkä»»åŠ¡ä¹Ÿè®¸ä¼šæ¶ˆè€—å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚è¿™ä¸ªé›¶æ—¶çš„ç£ç›˜ç›®å½•ä¼šè¢«spark.local.dirå‚æ•°æ‰€æŒ‡å®šã€‚<br>Shuffleè¡Œä¸ºå¯ä»¥è¢«è°ƒæ•´é€šè¿‡ä¸€ç³»åˆ—çš„å‚æ•°ã€‚å¯ä»¥å‚è€ƒ<a href="http://spark.apache.org/docs/latest/configuration.html#shuffle-behavior" target="_blank" rel="noopener"> Spark Configuration Guide.</a>â€˜Shuffle Behaviorâ€™ç« èŠ‚ã€‚</p>
<h2 id="Shuffle-Behavior"><a href="#Shuffle-Behavior" class="headerlink" title="Shuffle Behavior"></a>Shuffle Behavior</h2><table>
<thead>
<tr>
<th>å±æ€§åç§°Property Name</th>
<th>é»˜è®¤å€¼Default</th>
<th>å«ä¹‰Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>spark.reducer.maxSizeInFlight</td>
<td>48m</td>
<td>ä»æ¯ä¸€ä¸ªreduceä»»åŠ¡ä¸­åŒæ­¥è·å–çš„mapè¾“å‡ºçš„æœ€å¤§å€¼ã€‚ç”±äºæ¯ä¸€ä¸ªè¾“å‡ºéœ€è¦æˆ‘ä»¬åˆ›é€ ä¸€ä¸ªç¼“å­˜æ¥æ¥å—å®ƒï¼Œè¿™ä¸ªä»£è¡¨äº†æ¯ä¸ªä»»åŠ¡çš„å›ºå®šçš„å†…å­˜å¼€é”€ï¼Œæ‰€ä»¥å°½é‡ä¿è¯å®ƒè¾ƒå°é™¤éä½ æœ‰å¾ˆå¤šå†…å­˜ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.reducer.maxReqsInFlight</td>
<td>Int.MaxValue</td>
<td>è¿™ä¸ªé…ç½®é™åˆ¶äº†ä»»æ„ç»™å®šç‚¹è¿œç¨‹è¯·æ±‚è·å–å—æ•°ã€‚å½“é›†ç¾¤ä¸­çš„ä¸»æœºæ•°é‡å¢åŠ çš„æ—¶å€™ï¼Œå®ƒä¹Ÿè®¸ä¼šå¯¼è‡´ä¸€ä¸ªéå¸¸å¤§æ•°é‡çš„å†…éƒ¨è¿æ¥åˆ°ä¸€åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œå¼•èµ·workeråœ¨è´Ÿè½½ä¸‹å¤±è´¥ã€‚é€šè¿‡å…è®¸å®ƒæ¥é™åˆ¶è·å–è¯·æ±‚çš„æ•°é‡ï¼Œè¿™ä¸ªæƒ…å†µä¹Ÿè®¸ä¼šç¼“è§£</td>
<td></td>
</tr>
<tr>
<td>spark.reducer.maxBlocksInFlightPerAddress</td>
<td>Int.MaxValue</td>
<td>è¿™ä¸ªé…ç½®é™åˆ¶äº†æ¯ä¸€ä¸ªä»ç»™å®šç«¯å£é‡Œçš„çš„reduceä»»åŠ¡å¯ä»¥è·å–çš„è¿œç¨‹ç«¯å£æ•°é‡ã€‚å½“ä¸€ä¸ªå¤§é‡çš„blockè¢«ä¸€ä¸ªç»™å®šçš„åœ°å€åœ¨ä¸€æ¬¡å•ç‹¬è·å–æˆ–è€…åŒæ­¥è·å–æ‰€è¯·æ±‚æ—¶ï¼Œå¯èƒ½ä¼šå†²å®æœåŠ¡çš„executoræˆ–è€…Node Managerã€‚è¿™ä¸ªé…ç½®å¯¹äºå‡å°‘Node Managerçš„è´Ÿè½½å°¤ä¸ºæœ‰ç”¨å½“å¤–éƒ¨çš„shuffleæ˜¯è¢«å…è®¸çš„ã€‚ä½ å¯ä»¥é€šè¿‡è®¾å®šä¸€ä¸ªè¾ƒä½å€¼æ¥å‡è½»è¿™ä¸ªæƒ…å†µã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.maxRemoteBlockSizeFetchToMem</td>
<td>Long.MaxValue</td>
<td>è¿œç¨‹çš„å—å°†ä¼šè¢«è·å–åˆ°ç£ç›˜ä¸­ï¼Œå½“è¿™ä¸ªå—çš„å¤§å°è¶…è¿‡äº†è¿™ä¸ªé…ç½®çš„å€¼åœ¨byteå•ä½ä¸Šã€‚è¿™ä¸ªç”¨äºé¿å…ä¸€ä¸ªå·¨å¤§çš„è¯·æ±‚å æ®äº†å¤ªå¤šçš„å†…å­˜ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªé…ç½®ä¸ºä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼ˆæ¯”å¦‚ï¼Œ200Mï¼‰ã€‚æ³¨æ„åˆ°è¿™ä¸ªé…ç½®å°†ä¼šå½±å“åˆ°shuffleçš„è·å–ä»¥åŠè¿œç¨‹å—è·å–çš„å—ç®¡ç†ã€‚å¯¹äºå…è®¸äº†å¤–éƒ¨shuffleæœåŠ¡çš„ç”¨æˆ·ï¼Œè¿™ä¸ªç‰¹æ€§åªä¼šåœ¨å¤–éƒ¨shuffleæœåŠ¡ç‰ˆæœ¬é«˜äºSpark2ã€‚2æ—¶æœ‰æ•ˆã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.compress</td>
<td>true</td>
<td>æ˜¯å¦å‹ç¼©mapçš„è¾“å‡ºæ–‡ä»¶ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå¥½æƒ³æ³•ã€‚å‹ç¼©å°†ä¼šä½¿ç”¨spark.io.compression.codec.</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.file.buffer</td>
<td>32k</td>
<td>å¯¹æ¯ä¸€ä¸ªshuffleæ–‡ä»¶è¾“å‡ºæµçš„åœ¨å†…å­˜ä¸­çš„ç¼“å­˜å¤§å°ï¼Œå•ä½æ˜¯KiBé™¤éæœ‰å…¶ä»–çš„ç‰¹åˆ«æŒ‡å®šã€‚è¿™äº›ç¼“å­˜å‡å°‘äº†ç¡¬ç›˜æŸ¥æ‰¾å’Œç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸­é—´shuffleæ–‡ä»¶çš„è¿‡ç¨‹ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.io.maxRetries</td>
<td>3</td>
<td>(Netty only)æœ€å¤§è‡ªåŠ¨é‡å¤å°è¯•çš„æ¬¡æ•°å¦‚æœè¿™ä¸ªå€¼æ²¡æœ‰è¢«è®¾ç½®ä¸º0.è¿™ä¸ªé‡è¯•é€»è¾‘æœ‰åŠ©äºç¨³å®šå¤§å‹çš„shuffleåœ¨é•¿æ—¶é—´çš„GCæš‚åœæˆ–è€…æš‚æ—¶çš„ç½‘ç»œè¿æ¥é—®é¢˜ä¸Šã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.io.numConnectionsPerPeer</td>
<td>1</td>
<td>(Netty only) èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥çš„é‡å¤ä½¿ç”¨ä¸ºäº†å‡å°‘å¤§å‹é›†ç¾¤ä¸­é‡å¤å»ºç«‹è¿æ¥çš„æƒ…å†µã€‚å¯¹äºæœ‰å¾ˆå¤šç¡¬ç›˜å’Œå¾ˆå°‘ä¸»æœºçš„é›†ç¾¤ï¼Œè¿™ä¸ªå°†ä¼šå¯¼è‡´å¹¶å‘è¡Œä¸è¶³ä»¥é¥±å’Œæ‰€æœ‰ç¡¬ç›˜ï¼Œå› æ­¤ç”¨æˆ·å¯èƒ½ä¼šè€ƒè™‘å¢åŠ è¿™ä¸ªå€¼ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.io.preferDirectBufs</td>
<td>true</td>
<td>(Netty only) å †å¤–ç¼“å†²åŒºåœ¨shuffleå’Œç¼“å­˜å—è½¬ç§»æœŸé—´è¢«ç”¨äºå‡å°‘åƒåœ¾å›æ”¶ã€‚å¯¹äºå¯¹å¤–ç¼“å­˜å†…å­˜æ•°é‡æœ‰é™çš„ç¯å¢ƒï¼Œç”¨æˆ·ä¹Ÿè®¸æƒ³è¦å…³æ‰è¿™ä¸ªæ¥å¼ºè¿«æ‰€æœ‰çš„æ¥è‡ªäºNettyçš„åˆ†é…éƒ½æ˜¯åœ¨å †ä¸Šã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.io.retryWait</td>
<td>5s</td>
<td>(Netty only) åœ¨æ¯ä¸€æ¬¡é‡è¯•ç›´æ¥éœ€è¦ç­‰å¾…å¤šä¹…ã€‚æœ€å¤§çš„å»¶è¿Ÿæ—¶é—´é»˜è®¤æ˜¯15ç§’ï¼ŒmaxRetries * retryWait.</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.service.enabled</td>
<td>false</td>
<td>å…è®¸å¤–éƒ¨shuffleæœåŠ¡ã€‚è¿™ä¸ªæœåŠ¡ä¿å­˜äº†é€šè¿‡executoræ‰€å†™çš„shuffleæ–‡ä»¶ï¼Œè¿™æ ·è¿™ä¸ªexecutorå¯ä»¥å®‰å…¨çš„è¢«ç§»é™¤ã€‚è¿™ä¸ªé…ç½®å¿…é¡»è¢«å…è®¸å¦‚æœspark.dynamicAllocation.enabledæ˜¯â€œtrueâ€ã€‚è¿™ä¸ªå¤–éƒ¨çš„shuffleæœåŠ¡å¿…é¡»è¢«å¯åŠ¨ã€‚æŸ¥çœ‹<a href="http://spark.apache.org/docs/latest/job-scheduling.html#configuration-and-setup" target="_blank" rel="noopener">dynamic allocation configuration and setup documentation </a>æ¥è·å¾—æ›´å¤šä¿¡æ¯ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.service.port</td>
<td>7337</td>
<td>å¤–éƒ¨shuffleæœåŠ¡å°†ä¼šè¿è¡Œçš„ç«¯å£ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.service.index.cache.size</td>
<td>100m</td>
<td>ç¼“å­˜æ¡ç›®é™åˆ¶åœ¨æŒ‡å®šçš„å†…å­˜å ç”¨ç©ºé—´ä¸­ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.maxChunksBeingTransferred</td>
<td>Long.MAX_VALUE</td>
<td>åœ¨shuffleæœåŠ¡ä¸­åŒä¸€æ—¶é—´æœ€å¤§å…è®¸ä¼ è¾“çš„å—æ•°é‡ã€‚æ³¨æ„åˆ°æ–°æ¥çš„è¿æ¥å°†ä¼šè¢«å…³é—­å¦‚æœè¾¾åˆ°äº†æœ€å¤§æ•°é‡ã€‚è¿™ä¸ªå®¢æˆ·ç«¯å°†ä¼šå°è¯•é‡æ–°è¿æ¥æ ¹æ®shuffleçš„é‡è¯•é…ç½®ï¼ˆsee spark.shuffle.io.maxRetries and spark.shuffle.io.retryWaitï¼‰ï¼Œå¦‚æœè¿™ä¸ªé™åˆ¶ä¹Ÿè¢«è¾¾åˆ°äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡å°†ä¼šå¤±è´¥ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.sort.bypassMergeThreshold</td>
<td>200</td>
<td>(Advanced)åœ¨åŸºäºæ’åºçš„shuffleç®¡ç†ä¸­ï¼Œé¿å…åˆå¹¶æ’åºæ•°æ®å¦‚æœè¿™é‡Œæ²¡æœ‰map-sideçš„èšåˆå’Œè¿™é‡Œæœ€å¤šæœ‰é…ç½®çš„è¿™ä¹ˆå¤šçš„reduceåˆ†åŒºã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.spill.compress</td>
<td>true</td>
<td>æ˜¯å¦å‹ç¼©æº¢å‡ºçš„æ•°æ®åœ¨shuffleæœŸé—´</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.accurateBlockThreshold</td>
<td>100 <em> 1024 </em> 1024</td>
<td>é˜€å€¼æ˜¯ä»¥bytesä¸ºå•ä½ï¼Œé«˜äºæ­¤å€¼å°†å‡†ç¡®è®°å½•HighlyCompressedMapStatusä¸­çš„shuffleå—çš„å¤§å°ã€‚è¿™ä¸ªç”¨äºå¸®åŠ©é˜»æ­¢OOMé€šè¿‡é¿å…é”™è¯¯ä¼°è®¡äº†shuffleå—å¤§å°å½“è·å–äº†shuffleå—æ—¶ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.registration.timeout</td>
<td>5000</td>
<td>æ³¨å†Œå¤–éƒ¨shuffleæœåŠ¡çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</td>
<td></td>
</tr>
<tr>
<td>spark.shuffle.registration.maxAttempts</td>
<td>3</td>
<td>å½“æ³¨å†Œå¤–éƒ¨shuffleæœåŠ¡å¤±è´¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šé‡å¤å°è¯•çš„æœ€å¤§æ¬¡æ•°</td>
<td></td>
</tr>
<tr>
<td>spark.io.encryption.enabled</td>
<td>false</td>
<td>å…è®¸IOç¼–ç ã€‚ç›®å‰æ”¯æŒæ‰€æœ‰çš„æ¨¡å¼é™¤äº†Mesosã€‚å½“ä½¿ç”¨è¿™ä¸ªç‰¹æ€§çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ¨èRPCç¼–ç ã€‚</td>
<td></td>
</tr>
<tr>
<td>spark.io.encryption.keySizeBits</td>
<td>128</td>
<td>IOç¼–ç çš„å€¼å¤§å°å•ä½ä¸ºbitã€‚æ”¯æŒçš„å€¼æœ‰128ï¼Œ192å’Œ256.</td>
<td></td>
</tr>
<tr>
<td>spark.io.encryption.keygen.algorithm</td>
<td>HmacSHA1</td>
<td>å½“ç”Ÿæˆä¸€ä¸ªIOç¼–ç é”®å€¼æ—¶ä½¿ç”¨çš„ç®—æ³•ã€‚è¢«æ”¯æŒçš„ç®—æ³•åœ¨Java Cryptography Architecture Standard Algorithm Name æ–‡æ¡£çš„KeyGeneratorç« èŠ‚ä¸­è¢«æè¿°ã€‚</td>
<td></td>
</tr>
</tbody>
</table>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2018/04/20/SparkAndDeepLearning/Distributed Training- Gradients Sharing/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/20/SparkAndDeepLearning/Distributed Training- Gradients Sharing/" class="post-title-link" itemprop="url">Distributed Training_Gradients Sharing ç¿»è¯‘</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-20 14:30:54" itemprop="dateCreated datePublished" datetime="2018-04-20T14:30:54+08:00">2018-04-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-13 23:07:23" itemprop="dateModified" datetime="2018-10-13T23:07:23+08:00">2018-10-13</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Distributed-Training-Gradients-Sharing"><a href="#Distributed-Training-Gradients-Sharing" class="headerlink" title="Distributed Training: Gradients Sharing"></a>Distributed Training: Gradients Sharing</h1><p>from:<a href="https://deeplearning4j.org/distributed" target="_blank" rel="noopener">https://deeplearning4j.org/distributed</a></p>
<p>ä»0.9.1å¼€å§‹ï¼ŒDeeplearning4jæ”¯æŒåœ¨Apache Sparkç¯å¢ƒä¸­çš„åˆ†å¸ƒå¼è®­ç»ƒï¼Œä»¥åŠAeronä½œä¸ºsparkä¹‹å¤–çš„é«˜æ€§èƒ½å†…éƒ¨èŠ‚ç‚¹é€šè®¯ã€‚<br>è¿™ä¸ªæƒ³æ³•å¾ˆç®€å•ï¼šç‹¬ç«‹çš„workeråœ¨ä»–ä»¬çš„æ•°æ®é›†ä¸Šè®¡ç®—æ¢¯åº¦ã€‚<br>åœ¨æ¢¯åº¦è¢«ä½¿ç”¨åˆ°ç½‘ç»œæƒé‡ä¸Šçš„æ—¶å€™ï¼Œå®ƒä»¬åœ¨ä¸€ä¸ªä¸­é—´å­˜å‚¨æœºåˆ¶ä¸Šè¢«èšé›†ï¼ˆä¸€ä¸ªæœºå™¨ä¸€ä¸ªï¼‰ã€‚<br>åœ¨èšé›†ä¹‹åï¼Œåœ¨ä¸€äº›é…ç½®çš„é˜€å€¼åŸºç¡€ä¸Šæ›´æ–°å€¼å¹¶åœ¨ç½‘ç»œä¸Šä¼ æ’­ä½œä¸ºä¸€ä¸ªç¨€ç–äºŒè¿›åˆ¶æ•°ç»„ã€‚<br>åœ¨é˜€å€¼ä¸€ä¸‹çš„å€¼è¢«å­˜å‚¨å¹¶ä¸”æ·»åŠ å·²å¤‡æœªæ¥æ›´æ–°ï¼Œæ‰€ä»¥å®ƒä»¬æ²¡æœ‰ä¸¢å¤±ï¼Œä½†æ˜¯å¾ˆå°‘åœ¨é€šè®¯ä¸­å»¶è¿Ÿã€‚<br>è¿™ä¸ªé˜€å€¼çš„æ–¹æ³•å‡å°‘äº†ç½‘ç»œé€šè®¯éœ€æ±‚ç›¸æ¯”äºä¹‹å‰éœ€è¦å‘é€æ•´ä¸ªå¯†åº¦æ›´æ–°æˆ–è€…å‚æ•°å‘é‡çš„æ–¹æ³•ã€‚<br>è¯¦ç»†çš„å¯ä»¥å‚è€ƒï¼š<br><a href="http://nikkostrom.com/publications/interspeech2015/strom_interspeech2015.pdf" target="_blank" rel="noopener">Strom, 2015 - Scalable Distributed DNN Training using Commodity GPU Cloud Computing</a><br><a href="https://blog.skymind.ai/" target="_blank" rel="noopener"> Distributed Deep Learning, Part 1: An Introduction to Distributed Training of Neural Networks.</a><br>ç›¸æ¯”äºä¹‹å‰ Nikko Stromæåˆ°çš„ç®—æ³•è¿™é‡Œæœ‰å¾ˆä¸€äº›æ–°çš„ä¼˜ç‚¹è¢«æ·»åŠ äº†ï¼š  </p>
<ol>
<li>å˜é‡é˜€å€¼ï¼šå¦‚æœæ›´æ–°çš„æ•°é‡è¿­ä»£æ¬¡æ•°å¤ªä½ï¼Œè¿™ä¸ªé˜€å€¼ä¼šè‡ªåŠ¨çš„å‡å°‘é€šè¿‡ä¸€ä¸ªé…ç½®çš„step valueã€‚</li>
<li>å¯†åº¦ä½å›¾ç¼–ç ï¼šå¦‚æœè¿™ä¸ªæ•°å­—æ›´æ–°å¤ªé«˜ï¼Œå¦å¤–ä¸€ç§ç¼–ç ç­–ç•¥ä¼šè¢«ä½¿ç”¨ï¼Œå°†ä¼šæä¾›ä¿è¯â€œæœ€å¤§æ•°é‡å­—èŠ‚æ•°â€ä¼ è¾“ä»»ä½•æ›´æ–°ä¿¡æ¯ã€‚  </li>
<li>å‘¨æœŸæ€§çš„ï¼Œæˆ‘ä»¬å‘é€â€œæŠ–åŠ¨â€ä¿¡æ¯ï¼Œç¼–ç ä¸€ä¸ªæ˜æ˜¾æ›´å°çš„å‘å±•ï¼Œæ¥åˆ†äº«ç›®å‰é˜€å€¼æ— æ³•è¢«å…±äº«çš„å»¶è¿Ÿæƒé‡ã€‚  </li>
</ol>
<p><img src="https://deeplearning4j.org/img/distributed.png" alt=""><br>æ³¨æ„ä½¿ç”¨sparkéœ€è¦å¼€é”€ï¼Œä¸ºäº†ç¡®å®šsparkæ˜¯å¦ä¼šå¸®åŠ©ä½ ï¼Œè€ƒè™‘ä½¿ç”¨ Performance Listenerå¹¶ä¸”æŸ¥çœ‹è¿­ä»£æ¯«ç§’çº§çš„æ—¶é—´ã€‚å¦‚æœå°äºç­‰äº150Msï¼Œsparkä¹Ÿè®¸ä¸å€¼å¾—ä½¿ç”¨ã€‚  </p>
<h2 id="é…ç½®ä½ çš„é›†ç¾¤"><a href="#é…ç½®ä½ çš„é›†ç¾¤" class="headerlink" title="é…ç½®ä½ çš„é›†ç¾¤"></a>é…ç½®ä½ çš„é›†ç¾¤</h2><p>æ‰€æœ‰ä½ éœ€è¦åšçš„å°±æ˜¯ä¸€ä¸ªspark1.Xï¼2.Xçš„é›†ç¾¤ï¼Œå¹¶ä¸”æœ€å°‘ä¸€ä¸ªå¼€æ”¾çš„UDPç«¯å£ï¼ˆå†…éƒ¨ç»‘å®šå’Œå¤–éƒ¨ç»‘å®šéƒ½éœ€è¦ï¼‰  </p>
<h3 id="é›†ç¾¤è®¾ç½®"><a href="#é›†ç¾¤è®¾ç½®" class="headerlink" title="é›†ç¾¤è®¾ç½®"></a>é›†ç¾¤è®¾ç½®</h3><p>å¦‚åŒä¸Šé¢æåˆ°çš„ï¼ŒDeepLearning4jæ”¯æŒSpark1.xå’ŒSpark2.xé›†ç¾¤ã€‚åŒæ ·ä¹Ÿéœ€è¦java 8+æ¥è¿è¡Œã€‚</p>
<h3 id="ç½‘ç»œé…ç½®"><a href="#ç½‘ç»œé…ç½®" class="headerlink" title="ç½‘ç»œé…ç½®"></a>ç½‘ç»œé…ç½®</h3><p>Masterå’ŒslaveèŠ‚ç‚¹ä¹‹é—´çš„é€šè®¯åˆ†äº«Gradienté‡åº¦ä¾èµ–UDPåè®®ã€‚å¦‚æœæ˜¯è¿è¡Œåœ¨AWSæˆ–è€…Azureä¸Šï¼Œä½ éœ€è¦å…è®¸ä¸€ä¸ªUDPç«¯å£ç”¨æ¥ä½œä¸ºå†…éƒ¨å¤–éƒ¨çš„è¿æ¥ï¼Œç„¶åä½ éœ€è¦æŒ‡å®šå¯¹åº”çš„ç«¯å£åœ¨VoidConfiguration.unicastPort(int)ä»è€Œä¼ é€’åˆ°SharedTrainingMasteræ„é€ å™¨ä¸­ã€‚<br>å¦å¤–ä¸€ä¸ªéœ€è¦è®°ä½çš„æ˜¯ï¼šå¦‚æœä½ åœ¨ä½¿ç”¨YARNï¼Œä½ éœ€è¦æŒ‡å®šç½‘ç»œæ©ç ç”¨æ¥ä½œä¸ºUDPé€šè®¯ã€‚è¿™ä¸ªå¯ä»¥ç”¨æ¥å®Œæˆé€šè¿‡ä½¿ç”¨åƒï¼šVoidConfiguration.setNetworkMask(â€œ10.1.1.0/24â€)çš„è¯­å¥ã€‚<br>ä¸€ä¸ªå¯¹äºIPåœ°å€é€‰æ‹©çš„æ‹›æ•°æ˜¯DL4J_VOID_IPç¯å¢ƒå˜é‡ã€‚åœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹è®¾ç½®è¿™ä¸ªå˜é‡ï¼ŒåŒæ—¶ä½¿ç”¨ä¸€ä¸ªæœ¬åœ°åœ°å€ç”¨äºé€šè®¯ã€‚  </p>
<h3 id="ç½‘ç»œæ©ç "><a href="#ç½‘ç»œæ©ç " class="headerlink" title="ç½‘ç»œæ©ç "></a>ç½‘ç»œæ©ç </h3><p>ç½‘ç»œæ©ç æ˜¯ä¸€ä¸ªCIDRæ¦‚å¿µï¼Œåªæ˜¯ç”¨æ¥å‘Šè¯‰è½¯ä»¶å“ªä¸€ä¸ªç½‘ç»œæ¥å£éœ€è¦ç”¨æ¥é€šè®¯ã€‚æ¯”å¦‚å¦‚æœä½ çš„é›†ç¾¤æœ‰ä¸‰ä¸ªIPåœ°å€ï¼š192.168.1.23, 192.168.1.78, 192.168.2.133ï¼Œå®ƒä»¬ç›¸åŒçš„éƒ¨åˆ†æ˜¯192.168.*ï¼Œæ‰€ä»¥ç½‘ç»œæ©ç æ˜¯ï¼š192.168.0.0/16ã€‚ä½ å¯ä»¥ä»ï¼š<a href="https://en.wikipedia.org/wiki/Subnetwork" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Subnetwork</a>è·å¾—è¯¦ç»†ä¿¡æ¯ã€‚<br>æˆ‘ä»¬åœ¨sparkè¿è¡Œåœ¨Hadoopä¸Šæ—¶ä½¿ç”¨æˆ–è€…å…¶ä»–æ²¡æœ‰å‡è®¾Spark IPåœ°å€è¢«é€šçŸ¥çš„ç¯å¢ƒã€‚åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œåˆæ³•çš„ç½‘ç»œæ©ç åº”è¯¥åœ¨VoidConfigurationä¸­æä¾›ï¼ŒåŒæ—¶è¢«ç”¨æ¥é€‰æ‹©æ¥å£ä½œä¸ºSparkå¤–é¢çš„é€šè®¯ã€‚  </p>
<h3 id="Effective-Scalability"><a href="#Effective-Scalability" class="headerlink" title="Effective Scalability"></a>Effective Scalability</h3><p>The longer the original iteration time, the less relative impact will come from sharing, and the better hypothetical scalability you will get.</p>
<p>åŸå§‹è¿­ä»£æ—¶é—´è¶Šé•¿ï¼Œå…±äº«äº§ç”Ÿçš„ç›¸å¯¹å½±å“å°±è¶Šå°ï¼Œå¹¶ä¸”æ‚¨å°†è·å¾—æ›´å¥½çš„å‡è®¾å¯ä¼¸ç¼©æ€§ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2018/04/15/SparkAndDeepLearning/Deep Learning on Apache Spark/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/15/SparkAndDeepLearning/Deep Learning on Apache Spark/" class="post-title-link" itemprop="url">Deep Learning on Apache Spark ç¿»è¯‘</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-15 12:41:12" itemprop="dateCreated datePublished" datetime="2018-04-15T12:41:12+08:00">2018-04-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-06 17:30:27" itemprop="dateModified" datetime="2019-03-06T17:30:27+08:00">2019-03-06</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Deep-Learning-on-Apache-Spark"><a href="#Deep-Learning-on-Apache-Spark" class="headerlink" title="Deep Learning on Apache Spark"></a>Deep Learning on Apache Spark</h1><p>ç¿»è¯‘è‡ªï¼š<a href="https://deeplearning4j.org/spark#locality" target="_blank" rel="noopener">https://deeplearning4j.org/spark#locality</a><br>Deep learning æ˜¯è®¡ç®—å¯†é›†çš„ï¼Œæ‰€ä»¥æœ‰éå¸¸å¤§çš„æ•°æ®ï¼Œè®¡ç®—é€Ÿåº¦ã€‚ä½ å¯ä»¥å¤„ç†è¿™ä¸ªé—®é¢˜ä½¿ç”¨å¾ˆå¿«çš„ç¡¬ä»¶ï¼Œé€šå¸¸æ˜¯GPU,ä¼˜åŒ–ä»£ç å’Œä¸€äº›å½¢å¼çš„å¹¶è¡Œã€‚<br>æ•°æ®å¹¶è¡Œæ€§ä½¿å¤§å‹æ•°æ®é›†ç§°ä¸ºç¢ç‰‡å¹¶æŠŠè¿™äº›ç¢ç‰‡äº¤ç»™ç¥ç»ç½‘ç»œåˆ†ç¦»ï¼Œæ¯”å¦‚æ¯ä¸ªç¥ç»ç½‘ç»œéƒ½åœ¨è‡ªå·±çš„æ ¸å¿ƒä¸Šã€‚Deeplearning4jä¾é sparkæ¥å¤„ç†è¿™äº›ï¼Œå¹¶å‘è®­ç»ƒæ¨¡å‹å¹¶ä¸”è¿­ä»£å¹³å‡å®ƒä»¬åœ¨ä¸­å¿ƒæ¨¡å‹æ‰€äº§ç”Ÿçš„å‚æ•°ã€‚ï¼ˆæ¨¡å‹å¹¶å‘ï¼Œåœ¨<a href="https://static.googleusercontent.com/media/research.google.com/en//archive/large_deep_networks_nips2012.pdf" target="_blank" rel="noopener">here</a>è¢«è®¨è®ºäº†ï¼Œå…è®¸ä½¿ç”¨æ¨¡å‹åœ¨ä¸åŒçš„å¤§æ•°æ®é›†ä¸Šä½¿ç”¨è€Œæ— éœ€è¢«å¹³å‡ï¼‰<br>æ³¨æ„å¦‚æœä½ éœ€è¦ä¸€ä¸ªå‚æ•°æœåŠ¡å™¨åŸºç¡€çš„æ–¹æ³•ï¼ˆéœ€è¦æ›´å¤šçš„æ­¥éª¤ï¼‰ï¼Œå¯ä»¥æŸ¥çœ‹<a href="https://deeplearning4j.org/distributed" target="_blank" rel="noopener">åˆ†å‘é¡µé¢</a>.</p>
<h2 id="Overview-æ¦‚è¿°"><a href="#Overview-æ¦‚è¿°" class="headerlink" title="Overview æ¦‚è¿°"></a>Overview æ¦‚è¿°</h2><p>Deeplearning4jæ”¯æŒåœ¨Sparké›†ç¾¤ä¸Šè®­ç»ƒç¥ç»ç½‘ç»œï¼Œä¸ºäº†åŠ é€Ÿç½‘ç»œè®­ç»ƒã€‚<br>å’ŒDL4Jçš„MultiLayerNetworkå’ŒComputationGraphç±»ç›¸åŒï¼ŒDL4Jå®šä¹‰äº†ä¸¤ä¸ªç±»ç”¨äºåœ¨Sparkä¸Šè®­ç»ƒç¥ç»ç½‘ç»œã€‚  </p>
<ol>
<li>SparkDl4jMultiLayer ä¸€ä¸ªå›´ç»•MultiLayerNetworkçš„åŒ…è£…ç±»</li>
<li>SparkComputationGraph ä¸€ä¸ªå›´ç»•ComputationGraphçš„åŒ…è£…ç±»</li>
</ol>
<p>ç”±äºè¿™ä¸¤ä¸ªç±»æ—¶å›´ç»•æ ‡å‡†çš„å•æœºç±»åŒ…è£…çš„ï¼Œè¿™ä¸ªç½‘ç»œé…ç½®è¿‡ç¨‹å¯¹äºæ ‡å‡†çš„å’Œåˆ†å¸ƒå¼çš„è®­ç»ƒéƒ½æ˜¯ç›¸åŒçš„ã€‚åœ¨Sparkä¸Šåˆ†å¸ƒå¼è®­ç»ƒå’Œæœ¬åœ°è®­ç»ƒæœ‰ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹ï¼Œ1.æ•°æ®æ˜¯å¦‚ä½•åŠ è½½çš„ï¼Œå’Œè®­ç»ƒæ˜¯å¦‚ä½•å¯åŠ¨çš„ï¼ˆéœ€è¦ä¸€äº›é¢å¤–çš„é›†ç¾¤é…ç½®ï¼‰ã€‚<br>ä¸€ä¸ªæ ‡å‡†çš„åœ¨Sparké›†ç¾¤ä¸Šè®­ç»ƒç½‘ç»œçš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š  </p>
<ol>
<li><p>åˆ›é€ ä½ è‡ªå·±çš„ç¥ç»ç½‘ç»œè®­ç»ƒç±»ã€‚é€šå¸¸æ¥è¯´ï¼ŒåŒ…å«ä¸ºä»¥ä¸‹å·¥ä½œæ‰€åšçš„ä»£ç ï¼š<br> æŒ‡å®šä½ è‡ªå·±çš„ç¥ç»ç½‘ç»œé…ç½®ï¼ˆMultiLayerConfigurationæˆ–è€…ComputationGraphConfigurationï¼‰ï¼Œå’Œä½ ä¸ºå•æœºè®­ç»ƒæ‰€é…ç½®çš„é‚£æ ·ã€‚<br> åˆ›é€ ä¸€ä¸ªTrainingMasterçš„å®ä¾‹ï¼šè¿™ä¸ªæŒ‡å®šäº†åˆ†å¸ƒå¼è®­ç»ƒä¼šå¦‚ä½•åœ¨å®é™…ä¸­è¿›è¡Œã€‚<br> åŠ è½½ä½ è‡ªå·±çš„è®­ç»ƒæ•°æ®ã€‚è¿™é‡Œæœ‰å¾ˆå¤šæ–¹æ³•æ¥åŠ è½½æ•°æ®ï¼Œæœ‰ä¸åŒçš„æƒè¡¡ï¼›æ›´å¤šçš„ç»†èŠ‚å°†ä¼šåœ¨ä¹‹åçš„æ–‡æ¡£ä¸­è®¨è®ºã€‚<br> è°ƒç”¨åˆé€‚çš„fitæ–¹æ³•åœ¨SparkDl4jMultiLayeræˆ–è€…SparkComputationGraphå®ä¾‹ä¸­ã€‚<br> ä¿å­˜æˆ–è€…ä½¿ç”¨è®­ç»ƒçš„ç½‘ç»œï¼ˆè¿™ä¸ªè®­ç»ƒçš„MultiLayerNetworkæˆ–è€…ComputationGraphå®ä¾‹ï¼‰  </p>
</li>
<li><p>å°†ä½ çš„jaræ‰“åŒ…ç­‰å€™sparkæäº¤ã€‚<br> å¦‚æœä½¿ç”¨mavenï¼Œè¿è¡Œâ€œmvn package -DskipTestsâ€æ˜¯ä¸€ä¸ªæ–¹æ³•</p>
</li>
<li><p>è°ƒç”¨Sparkæäº¤ï¼Œå¹¶ä¸”å¯åŠ¨ä½ é›†ç¾¤ä½¿ç”¨åˆé€‚çš„é…ç½®ã€‚</p>
</li>
</ol>
<p>æ³¨æ„å¯¹ä¸€ä¸ªå•ç‹¬æœºå™¨çš„è®­ç»ƒï¼ŒSpark locakå¯ä»¥åœ¨DL4Jä¸Šä½¿ç”¨ï¼Œå°½ç®¡è¿™ä¸æ¨èï¼ˆå› ä¸ºåŒæ­¥åŒ–å’Œåºåˆ—åŒ–åœ¨sparkä¸Šçš„è¿‡åº¦ä½¿ç”¨ï¼‰ã€‚æ›¿ä»£çš„ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä»¥ä¸‹ï¼š  </p>
<ol>
<li>å¯¹äºä¸€ä¸ªå•æœºCPU/GPUç³»ç»Ÿï¼Œä½¿ç”¨æ ‡å‡†çš„MultiLayerNetworkæˆ–è€…ComputationGraphè®­ç»ƒã€‚  </li>
<li>å¯¹äºå¤šä¸ªCPUï¼GPUç³»ç»Ÿï¼Œä½¿ç”¨ParallelWrapper. è¿™ä¸ªåŠŸèƒ½ä¸Šç­‰äºè¿è¡Œsparkåœ¨æœ¬åœ°æ¨¡å¼ï¼Œå°½ç®¡æœ‰æ›´ä½çš„å¼€é”€ï¼ˆä»è€Œæœ‰æ›´å¥½çš„è®­ç»ƒè¡¨ç°ï¼‰ã€‚</li>
</ol>
<h2 id="How-Distributed-Network-Training-Occurs-with-DL4J-on-Spark"><a href="#How-Distributed-Network-Training-Occurs-with-DL4J-on-Spark" class="headerlink" title="How Distributed Network Training Occurs with DL4J on Spark"></a>How Distributed Network Training Occurs with DL4J on Spark</h2><p>åˆ†å¸ƒå¼ç¥ç»ç½‘ç»œæ˜¯å¦‚ä½•åœ¨DL4Jä¸Šè®­ç»ƒçš„<br>å½“å‰çš„DL4Jç‰ˆæœ¬ä½¿ç”¨çš„å‚æ•°å¹³å‡çš„è¿‡ç¨‹åœ¨è®­ç»ƒä¸€ä¸ªç½‘ç»œçš„æ—¶å€™ã€‚æœªæ¥çš„ç‰ˆæœ¬å¯èƒ½ä¼šåŠ å…¥å…¶ä»–åˆ†å¸ƒå¼ç½‘ç»œè®­ç»ƒæ–¹æ³•ã€‚<br>The process of training a network using parameter averaging is conceptually quite simple:<br>è®­ç»ƒä¸€ä¸ªç½‘ç»œä½¿ç”¨å‚æ•°å¹³å‡çš„è¿‡ç¨‹åœ¨æ¦‚å¿µä¸Šå¾ˆç®€å•ï¼š </p>
<ol>
<li>Masterï¼ˆspark drivenï¼‰å¼€å§‹ä¸€ä¸ªåˆå§‹åŒ–çš„ç½‘ç»œé…ç½®å’Œå‚æ•°</li>
<li>æ•°æ®è¢«åˆ‡åˆ†ä¸ºå¾ˆå¤šå­é›†ï¼ŒåŸºäºTrainingMasterçš„é…ç½®</li>
<li>åœ¨è¿™äº›æ•°æ®åˆ‡ç‰‡ä¸Šè¿­ä»£ã€‚å¯¹æ¯ä¸€ä¸ªè®­ç»ƒæ•°æ®çš„åˆ‡ç‰‡ï¼š<br> å°†å‚æ•°ï¼Œé…ç½®ï¼ˆå¦‚æœé€‚å½“çš„ï¼Œå¯¹äºmomentum/rmsprop/adagradçš„ç½‘ç»œæ›´æ–°çŠ¶æ€ï¼‰ä»masterç»™åˆ°æ¯ä¸€ä¸ªworkerä¸­ã€‚<br> åœ¨æ¯ä¸€ä¸ªåˆ‡ç‰‡çš„ä¸€éƒ¨åˆ†é€‚é…æ¯ä¸€ä¸ªworker<br> å¹³å‡å‚æ•°ï¼ˆå¦‚æœå¯èƒ½ï¼Œæ›´æ–°çŠ¶æ€ï¼‰å¹¶ä¸”è¿”å›è¯„ä»·ç»“æœåˆ°materä¸­ã€‚</li>
<li>è®­ç»ƒç»“æŸï¼Œmasteræœ‰ä¸€ä¸ªå·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹ç½‘ç»œã€‚  </li>
</ol>
<p>æ¯”å¦‚ï¼Œä¸‹å›¾å±•ç¤ºäº†5ä¸ªworkerå‚æ•°å¹³å‡çš„è¿‡ç¨‹ä¸€ä¸ªæ¯ä¸€ä¸ªå‚æ•°å‡è¡¡é¢‘ç‡æ˜¯1.å°±åƒä¸€ä¸ªç¦»çº¿çš„è®­ç»ƒï¼Œä¸€ä¸ªè®­ç»ƒæ•°æ®é›†è¢«åˆ‡å‰²ä¸ºä¸€ç³»åˆ—çš„æ•°æ®å­é›†ï¼ˆé€šå¸¸è¢«è®¤ä¸ºæ˜¯minibatchï¼Œåœ¨éåˆ†å¸ƒå¼è®¾ç½®ä¸­ï¼‰ï¼›åœ¨æ¯ä¸€ä¸ªsplitä¸­è®­ç»ƒè¿‡ç¨‹ï¼Œæ¯ä¸€ä¸ªworkerè·å¾—è¿™ä¸ªåˆ‡ç‰‡çš„ä¸€ä¸ªå­é›†ã€‚åœ¨å®é™…ä¸­ï¼Œè¿™ä¸ªåˆ‡ç‰‡çš„ä¸ªæ•°æ˜¯è¢«è‡ªåŠ¨å†³å®šçš„ï¼ŒåŸºäºè®­ç»ƒé…ç½®ï¼ˆåŸºäºworkerçš„æ•°é‡ï¼Œå¹³å‡çš„é¢‘ç‡å’Œworker minibatch Sizeï¼‰ã€‚<br><a href="https://deeplearning4j.org/img/parameter_averaging.png" target="_blank" rel="noopener"></a></p>
<h2 id="A-Minimal-Example"><a href="#A-Minimal-Example" class="headerlink" title="A Minimal Example"></a>A Minimal Example</h2><p>æœ¬èŠ‚å±•ç¤ºäº†ä½ éœ€è¦åœ¨sparkä¸Šè®­ç»ƒçš„è¦ç´ çš„æœ€å°éƒ¨åˆ†ã€‚å…³äºåŠ è½½æ•°æ®çš„å„ç§æ–¹æ³•éšåå°±æ¥ã€‚  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">JavaSparkContext sc = ...;</span><br><span class="line">JavaRDD&lt;DataSet&gt; trainingData = ...;</span><br><span class="line">MultiLayerConfiguration networkConfig = ...;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create the TrainingMaster instance</span></span><br><span class="line"><span class="keyword">int</span> examplesPerDataSetObject = <span class="number">1</span>;</span><br><span class="line">TrainingMaster trainingMaster = <span class="keyword">new</span> ParameterAveragingTrainingMaster.Builder(examplesPerDataSetObject)</span><br><span class="line">        .(other configuration options)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create the SparkDl4jMultiLayer instance</span></span><br><span class="line">SparkDl4jMultiLayer sparkNetwork = <span class="keyword">new</span> SparkDl4jMultiLayer(sc, networkConfig, trainingMaster);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Fit the network using the training data:</span></span><br><span class="line">sparkNetwork.fit(trainingData);</span><br></pre></td></tr></table></figure>
<h3 id="Using-the-output-from-SparkDl4jMultiLayer-ComputationGraph"><a href="#Using-the-output-from-SparkDl4jMultiLayer-ComputationGraph" class="headerlink" title="Using the output from SparkDl4jMultiLayer/ComputationGraph"></a>Using the output from SparkDl4jMultiLayer/ComputationGraph</h3><p>ç”±äºsparkç½‘ç»œä½œä¸ºä¸€ä¸ªwrapperå›´ç»•multi layer ç½‘ç»œå’Œcomputation graph apisï¼Œä½ éœ€è¦æœ€ç»ˆéœ€è¦ä»sparkç¥ç»ç½‘ç»œä¸­è·å–networkåœ¨è®­ç»ƒç»“æŸä¹‹åã€‚å…¶åŸå› æ˜¯ç”±äºæ•°æ®å¹³è¡Œè®­ç»ƒå®é™…ä¸Šæ˜¯åœ¨è®­ç»ƒæœŸé—´ä¸€æ¬¡å¯¹å¤šä¸ªç½‘ç»œè¿›è¡Œå¹³å‡ã€‚è¿™æ„å‘³ç€è¿™é‡Œæ²¡æœ‰ä¸€ä¸ªç½‘ç»œç›´åˆ°ä½ è·å¾—äº†æœ€åçš„å¹³å‡å‚æ•°åœ¨å¤šä¸ªworkerä¸Šç§¯ç´¯çš„é›†åˆçš„è¾“å‡ºã€‚<br>äº†è§£äº†è¿™äº›ï¼Œæˆ‘ä»¬åº”è¯¥è·å–åº•å±‚çš„å¼•ç”¨ä¸è®ºåœ¨SparkComputationGraphå’ŒSparkDl4jMultiLayerä¸Šéƒ½ä½¿ç”¨getNetworkæ–¹æ³•ã€‚<br>ä½ å°†ä¼šæ³¨æ„åˆ°åˆé€‚çš„è¾“å‡ºå°†ä¼šç›´æ¥è¿”å›ç›¸åŒçš„åº•å±‚çš„ç½‘ç»œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">JavaSparkContext sc = ...;</span><br><span class="line">JavaRDD&lt;DataSet&gt; trainingData = ...;</span><br><span class="line">MultiLayerConfiguration networkConfig = ...;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create the TrainingMaster instance</span></span><br><span class="line"><span class="keyword">int</span> examplesPerDataSetObject = <span class="number">1</span>;</span><br><span class="line">TrainingMaster trainingMaster = <span class="keyword">new</span> ParameterAveragingTrainingMaster.Builder(examplesPerDataSetObject)</span><br><span class="line">        .(other configuration options)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create the SparkDl4jMultiLayer instance</span></span><br><span class="line">SparkDl4jMultiLayer sparkNetwork = <span class="keyword">new</span> SparkDl4jMultiLayer(sc, networkConfig, trainingMaster);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Fit the network using the training data:</span></span><br><span class="line">MultiLayerNetwork outputNetwork = sparkNetwork.fit(trainingData);</span><br></pre></td></tr></table></figure>
<h2 id="Configuring-the-TrainingMaster"><a href="#Configuring-the-TrainingMaster" class="headerlink" title="Configuring the TrainingMaster"></a>Configuring the TrainingMaster</h2><p>ä¸€ä¸ªåœ¨DL4Jä¸­çš„TrainingMasteræ˜¯ä¸€ä¸ªæ¥å£å…è®¸å¤šä¸ªä¸åŒçš„è®­ç»ƒå®ç°åœ¨SparkDl4jMultiLayerå’ŒSparkComputationGraphä½¿ç”¨ã€‚<br>ç›®å‰DL4Jæœ‰ä¸€ä¸ªå®ç°ï¼ŒParameterAveragingTrainingMasterã€‚è¿™ä¸ªå‚æ•°å¹³å‡çš„è¿‡ç¨‹åœ¨ä¸Šé¢å›¾ç‰‡ä¸­å±•ç¤ºäº†ã€‚ä¸ºäº†åˆ›é€ ä¸€ä¸ªï¼Œä½¿ç”¨ä»¥ä¸‹çš„æ„å»ºæ¨¡å¼ï¼š  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TrainingMaster tm = <span class="keyword">new</span> ParameterAveragingTrainingMaster.Builder(<span class="keyword">int</span> dataSetObjectSize)</span><br><span class="line">            ... (your configuration here)</span><br><span class="line">            .build();</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªParameterAveragingTrainingMasterå®šä¹‰äº†å¾ˆå¤šçš„å‚æ•°é€‰é¡¹ç”¨äºæ§åˆ¶è®­ç»ƒçš„æ‰§è¡Œï¼š  </p>
<p><em>dataSetObjectSizeï¼š</em>å¿…é¡»å€¼ã€‚è¿™ä¸ªåœ¨buildæ„é€ å‡½æ•°ä¸­çŸ¥åã€‚è¿™ä¸ªå€¼æŒ‡æ˜äº†æœ‰å¤šå°‘çš„åˆ—å­åœ¨æ¯ä¸€ä¸ªæ•°æ®é›†å¯¹è±¡ä¸­ã€‚ä½œä¸ºä¸€ä¸ªé€šç”¨çš„è§„åˆ™ï¼š<br>    å¦‚æœä½ åœ¨è®­ç»ƒä¸€ä¸ªé¢„å¤„ç†è¿‡çš„æ•°æ®é›†å¯¹è±¡ï¼Œè¿™ä¸ªå°†ä¼šæ˜¯è¿™ä¸ªé¢„å¤„ç†çš„æ•°æ®é›†çš„å¤§å°<br>    å¦‚æœä½ æ˜¯ç›´æ¥ä»stringä¸­è¿›è¡Œè®­ç»ƒï¼Œæ¯”å¦‚CSVæ•°æ®ç»è¿‡ä¸€å®šçš„æ­¥éª¤ååˆ°ä¸€ä¸ªRDD<dataset>é‚£ä¹ˆè¿™ä¸ªå°†ä¼šæ˜¯1.<br><em>batchSizePerWorkerï¼š</em>è¿™ä¸ªæ§åˆ¶äº†æ¯ä¸€ä¸ªworkerçš„minibatch å¤§å°ã€‚è¿™ä¸ªå’Œæ·¡å­£è®­ç»ƒçš„æ—¶å€™ä½¿ç”¨minibatch sizeæœ‰äº›ç±»å‹ã€‚æ¢ä¸€ç§æ–¹å¼æ¥è¯´ï¼šè¿™ä¸ªæ˜¯å¯¹æ¯ä¸€ä¸ªå‚æ•°è¿›è¡Œæ›´æ–°æ‰€éœ€è¦çš„ä¾‹å­æ•°é‡åœ¨æ¯ä¸€ä¸ªworkerä¸­ã€‚<br><em>averagingFrequencyï¼š</em>è¿™ä¸ªæ§åˆ¶äº†å‚æ•°å¹³å‡å’Œé‡æ–°åˆ†å‘çš„é¢‘ç‡ï¼Œæ ¹æ®å¤§å°ä¸ºbatchSizePerWorkerçš„minibatchesæ•°é‡è®¡ç®—ï¼Œé€šå¸¸ï¼š<br>    ä½å¹³å‡å‘¨æœŸï¼ˆæ¯”å¦‚ï¼ŒaveragingFrequency = 1ï¼‰ä¹Ÿè®¸ä¸å¤ªæœ‰æ•ˆç‡ï¼ˆå¤ªå¤šçš„ç½‘ç»œé€šä¿¡å’Œåˆå§‹åŒ–å¼€é”€ï¼Œç›¸å¯¹äºè®¡ç®—æ¥è¯´ã€‚ï¼‰<br>    å¤§å¹³å‡å‘¨æœŸï¼ˆæ¯”å¦‚ï¼ŒaveragingFrequency = 200ï¼‰å¯èƒ½ä¼šå¯¼è‡´ä½æ€§èƒ½ï¼ˆä¸åŒçš„workerå®ä¾‹ä¸­çš„å‚æ•°ä¹Ÿè®¸ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼‰<br>    Averaging periods åœ¨5-10ä¸ªminibatchesä¹Ÿè®¸æ˜¯ä¸€ä¸ªå®‰å…¨çš„é€‰æ‹©ã€‚</dataset></p>
<p><em>workerPrefetchNumBatchesï¼š</em>Spark workerå¯ä»¥å¼‚æ­¥è·å–ä¸€å®šæ•°ç›®çš„minibatchesï¼Œä¸ºäº†é¿å…ç­‰å¾…æ•°æ®çš„åŠ è½½ã€‚<br>    è®¾å®šè¿™ä¸ªå€¼ä¸º0æ¥å…³æ‰æå‰è·å–ã€‚<br>    å€¼è®¾å®šä¸º2é€šå¸¸æ˜¯ä¸€ä¸ªä¸é”™çš„é»˜è®¤å€¼ã€‚å¤ªå¤§çš„å€¼åœ¨å¾ˆå¤šæƒ…å†µä¸‹å¹¶æ²¡æœ‰å¸®åŠ©ï¼ˆä½†æ˜¯ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ï¼‰ã€‚<br><em>rddTrainingApproachï¼š</em>ä»ç‰ˆæœ¬0.60å¼€å§‹ï¼ŒDL4Jæä¾›ä¸¤ç§æ–¹æ³•æ¥è®­ç»ƒä»RDD<dataset>æˆ–è€…RDD<multidataset>.åˆ†åˆ«æ˜¯ï¼šRDDTrainingApproach.Exportå’ŒRDDTrainingApproach.Directæ–¹æ³•ã€‚<br>        Export:ï¼ˆDefaultï¼‰è¿™ä¸ªé¦–å…ˆä¿å­˜RDD<dataset>åˆ°ç£ç›˜ä¸­ï¼Œä½¿ç”¨æ‰¹é‡å’Œåºåˆ—åŒ–çš„å½¢å¼ã€‚è¿™ä¸ªexecutorç„¶åå¼‚æ­¥åŠ è½½DataSetå¯¹è±¡ï¼ŒæŒ‰ç…§éœ€æ±‚ã€‚è¿™ä¸ªæ–¹æ³•å¯¹äºå¤§æ•°æ®é›†å’Œå¤šä¸ªepochsæ¥è¯´æ¯”Directæ–¹æ³•è¡¨ç°è¦å¥½ä¸€äº›ã€‚å®ƒé¿å…äº†Directæ–¹æ³•é‡Œé¢åˆ‡åˆ†å’Œé‡æ–°åˆ†åŒºçš„å¼€é”€ï¼ŒåŒæ ·åªéœ€è¦æ›´å°‘çš„å†…å­˜ã€‚ä¸´æ—¶æ–‡ä»¶ä¼šè¢«åˆ é™¤ä½¿ç”¨TrainingMaster.deleteTempFiles()ã€‚<br>        Directï¼šè¿™æ˜¯DL4Jæ—©æœŸä½¿ç”¨çš„ç‰ˆæœ¬ã€‚å®ƒæä¾›äº†æ›´å¥½çš„æ€§èƒ½å¯¹äºå°æ•°æ®é›†æ¥è¯´å› ä¸ºå°†ä¼šå…¨éƒ¨æ”¾è¿›å†…å­˜ä¸­ã€‚<br><em>exportDirectory</em>ï¼šåªè¢« Export training approach ä½¿ç”¨ã€‚è¿™ä¸ªæ§åˆ¶äº†ä¸´æ—¶æ–‡ä»¶åº”è¯¥è¢«ä¿å­˜åœ¨å“ªã€‚é»˜è®¤æ˜¯ä½¿ç”¨ï¼š{hadoop.tmp.dir}/dl4j/ç›®å½•ï¼Œè€Œ{hadoop.tmp.dir}æ˜¯Hadoopä¸´æ—¶ç›®å½•æ€§è´¨çš„å€¼ã€‚<br><em>storageLevelStreams</em>ï¼šåªæœ‰åœ¨ä½¿ç”¨fitPaths(RDD<string>)æ–¹æ³•çš„æ—¶å€™ä½¿ç”¨ã€‚è¿™æ˜¯DL4Jå°†ä¼šç”¨æ¥ä¿å­˜RDD<string>çš„å­˜å‚¨çº§åˆ«ã€‚<br>é»˜è®¤ï¼šStorageLevel.MEMORY_ONLY.è¿™ä¸ªé»˜è®¤å€¼ç›®å‰å‡ ä¹åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½å¯ä»¥ã€‚<br><em>repartitionï¼š</em>é…ç½®ä½•æ—¶æ•°æ®åº”è¯¥è¢«é‡æ–°åˆ†åŒºã€‚ParameterAveragingTrainingMasterå°†ä¼šè¿›è¡Œä¸€ä¸ªmapParititonsçš„æ“ä½œï¼›ç›¸åº”çš„ï¼Œåˆ†åŒºçš„æ•°é‡ï¼ˆä»¥åŠæ¯ä¸€ä¸ªåˆ†åŒºçš„å€¼ï¼‰å’Œåˆ†åŒºçš„åˆ©ç”¨æœ‰å¾ˆå¤§çš„å…³ç³»ã€‚ç„¶è€Œï¼Œé‡æ–°åˆ†åŒºä¸æ˜¯ä¸€ä¸ªè‡ªç”±çš„æ“ä½œï¼Œæœ‰äº›æ•°æ®å¿…é¡»é€šè¿‡ç½‘ç»œè¿›è¡Œå¤åˆ¶ï¼Œä»¥ä¸‹çš„æ“ä½œæ˜¯å¯ä»¥çš„ï¼š<br>    Alwaysï¼šé»˜è®¤æ“ä½œï¼Œé‡æ–°åˆ†åŒºæ•°æ®æ¥ä¿è¯åˆ†åŒºçš„æ­£ç¡®æ•°é‡ã€‚æ¨èçš„ï¼Œç‰¹åˆ«ä½¿ç”¨RDDTrainingApproach.Exportï¼ˆé»˜è®¤æ˜¯0.6ï¼‰æˆ–è€…fitPaths(RDD<string>)ã€‚<br>    Neverï¼šä»ä¸é‡æ–°åˆ†åŒºæ•°æ®ï¼Œæ— è®ºè¿™ä¸ªåˆ†åŒºæœ‰å¤šä¸å¹³è¡¡ã€‚<br>    NumPartitionsWorkersDiffersï¼šåªæœ‰å½“åˆ†åŒºçš„æ•°é‡å’Œworkerçš„æ•°é‡ä¸ä¸€è‡´çš„æ—¶å€™æ‰åˆ†åŒºã€‚æ³¨æ„åˆ°å³ä½¿åˆ†åŒºçš„æ•°é‡å’Œæ€»å…±å†…æ ¸çš„æ•°é‡ç›¸åŒï¼Œè¿™ä¹Ÿä¸ä¿è¯æ­£ç¡®çš„æ•°æ®é›†å¯¹è±¡çš„å°±åœ¨æ¯ä¸€ä¸ªåˆ†åŒºï¼šæœ‰çš„åˆ†åŒºä¹Ÿè®¸æœ‰å¤šçš„æ•°æ®æœ‰çš„æ˜¯å°‘çš„æ•°æ®ã€‚<br><em>repartitionStrategy:</em>å“ªä¸€ä¸ªé‡æ–°åˆ†é…çš„ç­–ç•¥åº”è¯¥è¢«å®Œæˆã€‚<br>    Balancedï¼šï¼ˆé»˜è®¤ï¼‰è¿™ä¸ªæ˜¯DL4Jé»˜è®¤çš„é‡æ–°åˆ†åŒºçš„ç­–ç•¥ã€‚å®ƒè¯•å›¾ç¡®ä¿æ¯ä¸€ä¸ªåˆ†åŒºéƒ½æ˜¯å‡è¡¡çš„å¯¹æ¯”SparkDefaulté€‰é¡¹æ¥è¯´ã€‚ç„¶è€Œï¼Œåœ¨å®é™…ä¸­ï¼Œè¿™ä¸ªéœ€è¦é¢å¤–çš„count æ“ä½œæ¥æ‰§è¡Œï¼›åœ¨æœ‰äº›æƒ…å†µï¼ˆä¸»è¦æ˜¯åœ¨å°å‹çš„ç½‘ç»œé‡Œï¼Œæˆ–è€…é‚£äº›å°æ•°é‡çš„è®¡ç®—åœ¨æ¯ä¸€ä¸ªminibatchï¼‰ï¼Œè¿™ä¸ªå¥½å¤„ä¹Ÿè®¸æ¯”ä¸ä¸Šé¢å¤–çš„æ‰§è¡Œå¼€é”€ã€‚æ¨èçš„ï¼Œç‰¹åˆ«åœ¨ä½¿ç”¨RDDTrainingApproach.Export æˆ–è€…fitPathsï¼ˆRDD<string>ï¼‰<br>    SparkDefault:    è¿™ä¸ªæ˜¯Sparkçš„æ ‡å‡†åˆ†åŒºç­–ç•¥ã€‚æœ¬è´¨ä¸Šï¼Œæ¯ä¸€ä¸ªåœ¨åˆå§‹åŒ–RDDä¸­çš„å¯¹è±¡è¢«éšæœºæ˜ å°„åˆ°Nä¸ªä¸­RDDä¸­çš„ä¸€ä¸ªã€‚å› æ­¤ï¼Œè¿™ä¸ªåˆ†åŒºä¹Ÿè®¸ä¸æ˜¯æœ€å¥½çš„å¹³è¡¡ï¼Œåœ¨å°å‹çš„RDDçš„æ—¶å€™ç‰¹åˆ«ä¼šæœ‰é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å½“å®ƒä»¬ä½¿ç”¨é¢„å¤„ç†æ•°æ®é›†å¯¹è±¡å¹¶ä¸”é¢‘ç¹å‡è¡¡æ—¶æœŸï¼ˆç®€å•å› ä¸ºéšæœºé‡‡æ ·å˜åŒ–ï¼‰ã€‚</string></string></string></string></dataset></multidataset></dataset></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2018/04/04/SparkAndDeepLearning/RDDSpark/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/04/SparkAndDeepLearning/RDDSpark/" class="post-title-link" itemprop="url">RDD Programming Guide ç¿»è¯‘</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-04 14:31:10" itemprop="dateCreated datePublished" datetime="2018-04-04T14:31:10+08:00">2018-04-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-06 18:04:05" itemprop="dateModified" datetime="2019-03-06T18:04:05+08:00">2019-03-06</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="RDD-Programming-Guide"><a href="#RDD-Programming-Guide" class="headerlink" title="RDD Programming Guide"></a>RDD Programming Guide</h1><p>from <a href="http://spark.apache.org/docs/latest/rdd-programming-guide.html" target="_blank" rel="noopener">http://spark.apache.org/docs/latest/rdd-programming-guide.html</a></p>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>åœ¨ä¸€ä¸ªè¾ƒé«˜çš„å±‚çº§ï¼Œæ¯ä¸€ä¸ªSpark åº”ç”¨åŒ…å«äº†ä¸€ä¸ªdrivenç¨‹åºè¿è¡Œç”¨æˆ·çš„mainå‡½æ•°ä»¥åŠè¿è¡Œä¸åŒçš„å¹¶è¡Œæ“ä½œåœ¨ä¸€ä¸ªé›†ç¾¤ä¸Šã€‚<br>Sparkä¸»è¦æä¾›çš„æŠ½è±¡æ˜¯ä¸€ä¸ªå¼¹æ€§åˆ†å¸ƒè¯•æ•°æ®é›†ï¼ˆRDDï¼‰ï¼Œæ˜¯ä¸€ä¸ªå…ƒç´ é›†åˆ†å¸ƒåœ¨ä¸åŒçš„é›†ç¾¤èŠ‚ç‚¹å¯ä»¥è¢«å¹¶è¡Œæ“ä½œçš„ã€‚RDDsåœ¨Hadoopæ–‡ä»¶ç³»ç»Ÿä¸­ç”±ä¸€ä¸ªæ–‡ä»¶å¼€å§‹åˆ›é€ çš„ã€‚æˆ–è€…ä¸€ä¸ªåœ¨é©±åŠ¨ç¨‹åºä¸­å­˜åœ¨çš„Scalaé›†åˆå¹¶ä¸”æ”¹å˜å®ƒã€‚ç”¨æˆ·ä¹Ÿè®¸ä¼šè¯·æ±‚Sparkæ¥æ°¸ä¹…å­˜å‚¨ä¸€ä¸ªRDDåœ¨å†…å­˜ä¸­ï¼Œç„¶åå¯ä»¥æœ‰æ•ˆçš„åœ¨å¹¶è¡Œæ“ä½œä¸­å†æ¬¡è®¿é—®ã€‚æœ€ç»ˆï¼ŒRDDsè‡ªåŠ¨ä»èŠ‚ç‚¹å¤±è´¥ä¸­æ¢å¤ã€‚<br>Sparkæä¾›çš„ç¬¬äºŒä¸ªæŠ½è±¡æ˜¯å…±äº«å˜é‡ï¼Œå¯ä»¥åœ¨å¹¶è¡Œæ“ä½œä¸­ä½¿ç”¨ã€‚é»˜è®¤çš„ï¼Œå½“Sparkå¹¶è¡Œè¿è¡Œä¸€ä¸ªå‡½æ•°ä½œä¸ºä¸€ç³»åˆ—çš„ä»»åŠ¡åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸­ï¼Œå®ƒå°†æ¯ä¸€ä¸ªå‡½æ•°ä¸­çš„å˜é‡ä¼ è¾“åˆ°æ¯ä¸€ä¸ªèŠ‚ç‚¹ç„¶åç»™åˆ°æ¯ä¸€ä¸ªä»»åŠ¡ã€‚æœ‰æ—¶ï¼Œä¸€ä¸ªå˜é‡éœ€è¦åœ¨ä¸åŒçš„ä»»åŠ¡ç›´æ¥å…±äº«æˆ–è€…éœ€è¦åœ¨ä»»åŠ¡å’Œdriven ç¨‹åºç›´æ¥å…±äº«ã€‚Sparkæä¾›ä¸¤ç§ç±»å‹çš„å…±äº«å˜é‡ï¼š<b>broadcast</b> å˜é‡ï¼Œå¯ä»¥ç”¨æ¥ç¼“å­˜å€¼åœ¨æ‰€æœ‰çš„èŠ‚ç‚¹ä¸­ã€‚ <b> accumulators</b>,å˜é‡åªæ˜¯ç”¨äºâ€œaddedâ€ï¼Œæ¯”å¦‚counterå’Œsumsã€‚  </p>
<h2 id="Initializing-Sparkï¼ˆJavaï¼‰"><a href="#Initializing-Sparkï¼ˆJavaï¼‰" class="headerlink" title="Initializing Sparkï¼ˆJavaï¼‰"></a>Initializing Sparkï¼ˆJavaï¼‰</h2><p>sparkç¨‹åºé¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªJavaSparkContextå¯¹è±¡ï¼Œå‘Šè¯‰Sparkå¦‚ä½•è®¿é—®ä¸€ä¸ªé›†ç¾¤ã€‚ä¸ºäº†åˆ›å»ºä¸€ä¸ªSparkContextä½ é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªSparkConfå¯¹è±¡ï¼ŒåŒ…å«ä½ åº”ç”¨çš„ä¿¡æ¯ã€‚  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SparkConf conf = <span class="keyword">new</span> SparkConf().setAppName(appName).setMaster(master);</span><br><span class="line">JavaSparkContext sc = <span class="keyword">new</span> JavaSparkContext(conf);</span><br></pre></td></tr></table></figure>
<p>appName å‚æ•°æ˜¯ä½ çš„åº”ç”¨åå­—å°†ä¼šå±•ç¤ºåœ¨é›†ç¾¤UIä¸Šã€‚ masterå¯èƒ½æ˜¯ä¸€ä¸ªsparkï¼ŒMesosæˆ–è€…YARNé›†ç¾¤URLï¼Œæˆ–è€…ä¸€ä¸ªç‰¹æ®Šçš„â€œlocalâ€œ æ¥æœ¬åœ°è¿è¡Œã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå½“åœ¨é›†ç¾¤ä¸­è¿è¡Œæ—¶ï¼Œä½ ä¸ä¼šæƒ³è¦hardcode masteråœ¨ç¨‹åºä¸­ï¼Œè€Œæ˜¯å¯åŠ¨åº”ç”¨ä½¿ç”¨ spark-submit å¹¶ä¸”æ¥å—å®ƒã€‚åœ¨æœ¬åœ°æµ‹è¯•å’Œå•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œä½ å¯ä»¥ä¼ é€’â€localâ€œå¹¶ä¸”è¿è¡Œspark  </p>
<h2 id="Resilient-Distributed-Datasetsï¼ˆRDDsï¼‰å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†"><a href="#Resilient-Distributed-Datasetsï¼ˆRDDsï¼‰å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†" class="headerlink" title="Resilient Distributed Datasetsï¼ˆRDDsï¼‰å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†"></a>Resilient Distributed Datasetsï¼ˆRDDsï¼‰å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†</h2><p>Sparkæ˜¯ä»¥RDDè§‚å¿µä¸ºä¸­å¿ƒçš„ï¼Œæ˜¯ä¸€ä¸ªå®¹é”™çš„å…ƒç´ é›†å¯ä»¥å¹¶è¡Œè¿›è¡Œæ“ä½œã€‚è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼æ¥åˆ›é€ RDDsï¼šåœ¨driverç¨‹åºä¸­å¹¶è¡ŒåŒ–ä¸€ä¸ªå·²å­˜åœ¨çš„é›†åˆï¼Œæˆ–è€…å¼•ç”¨ä¸€ä¸ªæ•°æ®é›†åœ¨ä¸€ä¸ªå¤–éƒ¨å­˜å‚¨ç³»ç»Ÿï¼Œæ¯”å¦‚ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ŒHDFSï¼ŒHBaseæˆ–è€…ä»»ä½•å…¶ä»–çš„æä¾›ä¸€ä¸ªHadoopè¾“å…¥æ ¼å¼çš„æ•°æ®æºã€‚  </p>
<h3 id="å¹¶è¡ŒåŒ–é›†åˆ"><a href="#å¹¶è¡ŒåŒ–é›†åˆ" class="headerlink" title="å¹¶è¡ŒåŒ–é›†åˆ"></a>å¹¶è¡ŒåŒ–é›†åˆ</h3><p>å¹¶è¡ŒåŒ–é›†åˆæ˜¯è°ƒç”¨JavaSparkContextçš„parallelizeæ–¹æ³•æ¥åˆ›é€ çš„ã€‚è¿™ä¸ªå…ƒç´ çš„é›†åˆä¼šè¢«å¤åˆ¶ç§°ä¸ºä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®é›†ï¼Œç„¶åå¯ä»¥ç”¨æ¥å¹¶è¡ŒåŒ–æ“ä½œã€‚æ¯”å¦‚ï¼Œè¿™æ˜¯å¦‚ä½•åˆ›é€ ä¸€ä¸ªå¹¶è¡ŒåŒ–é›†åˆæ¥å­˜å‚¨æ•°å­—1åˆ°5:  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; data = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">JavaRDD&lt;Integer&gt; distData = sc.parallelize(data);</span><br></pre></td></tr></table></figure>
<p>ä¸€æ—¦åˆ›é€ äº†ï¼Œè¿™ä¸ªåˆ†å¸ƒå¼æ•°æ®é›†ï¼ˆdistDataï¼‰å¯ä»¥è¢«ç”¨æ¥å¹¶è¡Œæ“ä½œã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ä¹Ÿè®¸ä¼šè°ƒç”¨distData.reduce((a,b) -&gt; a + b) æ¥è®¡ç®—å…ƒç´ çš„åˆ—è¡¨çš„å’Œã€‚<br>ä¸€ä¸ªé‡è¦çš„å‚æ•°æ¥å¹¶è¡ŒåŒ–å‡ ä¸ªæ˜¯å°†è¿™ä¸ªæ•°æ®é›†æ‹†åˆ†ä¸ºå‡ ä¸ªpartitionsçš„ä¸ªæ•°ã€‚Sparkå°†ä¼šåœ¨æ¯ä¸€ä¸ªé›†ç¾¤çš„partitionè¿è¡Œä¸€ä¸ªä»»åŠ¡ã€‚ä¸€èˆ¬çš„ä½ æƒ³è¦ä¸€ä¸ªCPUæœ‰2-4ä¸ªpartitionåœ¨ä½ çš„é›†ç¾¤ä¸­ã€‚é€šå¸¸ï¼ŒSparkå°è¯•è‡ªåŠ¨è®¾ç½®partitionsåŸºäºä½ çš„é›†ç¾¤ã€‚åŒæ—¶ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨çš„è®¾ç½®é€šè¿‡ä¼ é€’ä¸€ä¸ªç§’å‚æ•°åˆ°parallelizeï¼ˆæ¯”å¦‚ï¼šsc.parallelize(data,10)ï¼‰.</p>
<h2 id="RDD-æ“ä½œ"><a href="#RDD-æ“ä½œ" class="headerlink" title="RDD æ“ä½œ"></a>RDD æ“ä½œ</h2><p>RDDsæ”¯æŒä¸¤ç§ç±»å‹çš„æ“ä½œï¼šå˜åŒ–ï¼Œä»å·²çŸ¥çš„æ•°æ®é›†ä¸­åˆ›é€ ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œå¹¶ä¸”actionsï¼ˆæ‰§è¡Œï¼‰ï¼Œå°†ä¼šè¿”å›ä¸€ä¸ªå€¼ç»™driver programåœ¨datasetè¿è¡Œäº†è®¡ç®—ä»¥åã€‚æ¯”å¦‚ï¼Œmapæ˜¯ä¸€ä¸ªå˜åŒ–ï¼Œå°†æ•°æ®é›†ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½è¿è¡Œä¸€éå‡½æ•°ï¼Œç„¶åè¿”å›æ–°çš„RDDæ¥ä»£è¡¨ç»“æœã€‚åœ¨å¦ä¸€æ–¹é¢ï¼Œreduceä¹Ÿæ˜¯ä¸€ä¸ªactionèšåˆæ‰€æœ‰çš„RDDå…ƒç´ ä½¿ç”¨æŸä¸ªå‡½æ•°ç„¶åè¿”å›æœ€ç»ˆçš„ç»“æœåˆ°driver programï¼ˆå°½ç®¡è¿™ä»ç„¶æœ‰ä¸€ä¸ªå¹¶è¡Œçš„ reduceByKeyè¿”å›ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®é›†ï¼‰ã€‚<br>Sparkä¸­æ‰€æœ‰çš„å˜åŒ–éƒ½æ˜¯lazyçš„ï¼Œå®ƒä»¬ä¸ä¼šç«‹åˆ»çš„è®¡ç®—ç»“æœã€‚åè€Œï¼Œå®ƒä»¬åªæ˜¯è®°ä½äº†æœ‰äº›åŸºæœ¬çš„æ•°æ®é›†éœ€è¦æ‰§è¡Œä¸€äº›transformationsã€‚è¿™äº›transformationsåªä¼šåœ¨æœ€åéœ€è¦ä¸€ä¸ªç»“æœè¿”å›ç»™driver programæ—¶æ‰ä¼šæ‰§è¡Œã€‚è¿™ä¸ªè®¾è®¡ä¿è¯äº†Sparkå¯ä»¥æœ‰æ•ˆç‡çš„è¿è¡Œã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è®¤è¯†åˆ°ä¸€ä¸ªåˆ›é€ äº†mapçš„æ•°æ®é›†å°†ä¼šåœ¨reduceä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”åªè¿”å›reduceçš„ç»“æœåˆ°driverä¸­ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåºå¤§çš„mappedæ•°æ®é›†ã€‚<br>é»˜è®¤çš„ï¼Œè¿™æ ·çš„å˜åŒ–çš„RDDæ¯æ¬¡ä½ è¿è¡Œä¸€ä¸ªactionåœ¨ä¸Šé¢çš„æ—¶å€™éƒ½ä¼šéœ€è¦é‡æ–°è®¡ç®—ã€‚ä½ ä¹Ÿå¯ä»¥æŒä¹…åŒ–ä¸€ä¸ªRDDåœ¨å†…å­˜ä¸­ä½¿ç”¨persistæˆ–è€…cacheæ–¹æ³•ï¼ŒSparkå°†ä¼šä¿å­˜å…ƒç´ åœ¨é›†ç¾¤ä¸­ä»¥ä¾¿å¿«é€Ÿè®¿é—®ã€‚å®ƒä¹Ÿæ”¯æŒæŒä¹…åŒ–RDDsåˆ°ç¡¬ç›˜ä¸­ï¼Œæˆ–è€…åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œå¤åˆ¶ã€‚  </p>
<h3 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h3><p>å±•ç¤ºRDDçš„åŸºç¡€ï¼Œè€ƒè™‘ä»¥ä¸‹è¿™ä¸ªç®€å•çš„ç¨‹åºï¼š  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JavaRDD&lt;String&gt; lines = sc.textFile(<span class="string">"data.txt"</span>);</span><br><span class="line">JavaRDD&lt;Integer&gt; lineLengths = lines.map(s -&gt; s.length());</span><br><span class="line"><span class="keyword">int</span> totalLength = lineLengths.reduce((a, b) -&gt; a + b);</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€è¡Œå®šä¹‰äº†ä¸€ä¸ªåŸºç¡€çš„RDDä»å¤–éƒ¨æ–‡ä»¶ä¸­è·å–çš„ã€‚è¿™ä¸ªæ•°æ®é›†æ²¡æœ‰åŠ è½½åˆ°å†…å­˜ä¸­æˆ–è€…é‡‡å–äº†è¡ŒåŠ¨ï¼šlinesåªæ˜¯ä¸€ä¸ªæŒ‡å‘æ–‡ä»¶çš„æŒ‡é’ˆã€‚ç¬¬äºŒè¡Œå®šä¹‰äº†lineLengthsä½œä¸ºä¸€ä¸ªmapå˜åŒ–çš„ç»“æœã€‚åŒæ ·lineLengthsä¹Ÿä¸èƒ½ç«‹å³çš„è®¡ç®—ï¼Œåº”ä¸ºlazinessã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬è¿è¡Œreduceï¼Œæ˜¯ä¸€ä¸ªactionã€‚åœ¨è¿™ä¸ªç‚¹ï¼Œsparkå°†è®¡ç®—åˆ†ä¸ºå¤šä¸ªä»»åŠ¡å¹¶ä¸”åœ¨ä¸åŒçš„ç‹¬ç«‹æœºå™¨ä¸­è¿è¡Œï¼Œæ¯ä¸€ä¸ªè¿è¡Œè‡ªå·±éƒ¨åˆ†çš„mapå’Œä¸€ä¸ªæœ¬åœ°çš„reductionï¼Œç„¶åè¿™ä¸ªç»“æœåˆ°driver programã€‚<br>å¦‚æœæˆ‘ä»¬ä»ç„¶æƒ³è¦ä½¿ç”¨lineLengthsï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lineLengths.persist(StorageLevel.MEMORY_ONLY());</span><br></pre></td></tr></table></figure>
<h3 id="ä¼ é€’å‚æ•°åˆ°Spark"><a href="#ä¼ é€’å‚æ•°åˆ°Spark" class="headerlink" title="ä¼ é€’å‚æ•°åˆ°Spark"></a>ä¼ é€’å‚æ•°åˆ°Spark</h3><p>Sparkçš„APIä¸¥é‡ä¾èµ–åœ¨driver programä¸­ä¼ é€’å‡½æ•°æ¥è¿è¡Œé›†ç¾¤ã€‚åœ¨Javaï¼Œfunctionsè¢«å®ç°äº†org.apache.spark.api.java.function packageä¸­çš„æ¥å£çš„classæ‰€ä»£è¡¨ã€‚è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼æ¥åˆ›é€ å‡½æ•°ï¼š  </p>
<ol>
<li>åœ¨ä½ è‡ªå·±çš„ç±»ä¸­å®ç°å‡½æ•°æ¥å£ï¼Œä¸ç®¡æ˜¯åŒ¿åç±»æˆ–è€…æœ‰åå­—çš„ï¼Œå¹¶ä¸”ä¼ é€’ä¸€ä¸ªå®ä¾‹åˆ°sparkã€‚</li>
<li>ä½¿ç”¨lambda expressionæ¥ç®€æ´çš„å®šä¹‰ä¸€ä¸ªå®ç°ã€‚  </li>
</ol>
<p>æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å®šä¹‰å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">JavaRDD&lt;String&gt; lines = sc.textFile(<span class="string">"data.txt"</span>);</span><br><span class="line">JavaRDD&lt;Integer&gt; lineLengths = lines.map(<span class="keyword">new</span> Function&lt;String, Integer&gt;() &#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">(String s)</span> </span>&#123; <span class="keyword">return</span> s.length(); &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">int</span> totalLength = lineLengths.reduce(<span class="keyword">new</span> Function2&lt;Integer, Integer, Integer&gt;() &#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">(Integer a, Integer b)</span> </span>&#123; <span class="keyword">return</span> a + b; &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…å†™å‡½æ•°æ˜¯ç¬¨é‡çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GetLength</span> <span class="keyword">implements</span> <span class="title">Function</span>&lt;<span class="title">String</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">(String s)</span> </span>&#123; <span class="keyword">return</span> s.length(); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sum</span> <span class="keyword">implements</span> <span class="title">Function2</span>&lt;<span class="title">Integer</span>, <span class="title">Integer</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">(Integer a, Integer b)</span> </span>&#123; <span class="keyword">return</span> a + b; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">JavaRDD&lt;String&gt; lines = sc.textFile(<span class="string">"data.txt"</span>);</span><br><span class="line">JavaRDD&lt;Integer&gt; lineLengths = lines.map(<span class="keyword">new</span> GetLength());</span><br><span class="line"><span class="keyword">int</span> totalLength = lineLengths.reduce(<span class="keyword">new</span> Sum());</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°javaçš„åŒ¿åå‡½æ•°åŒæ ·ä¹Ÿå¯ä»¥è®¿é—®å˜é‡åœ¨enclosingèŒƒå›´å†…ï¼Œåªè¦å®ƒä»¬è¢«æ ‡è®°ä¸ºfinalã€‚Sparkå°†ä¼šä¼ è¾“è¿™äº›å˜é‡åˆ°å·¥ä½œèŠ‚ç‚¹å°±åƒå®ƒä¼šç»™å…¶ä»–çš„è¯­è¨€æ‰€åšçš„é‚£æ ·ã€‚  </p>
<h3 id="äº†è§£closures"><a href="#äº†è§£closures" class="headerlink" title="äº†è§£closures"></a>äº†è§£closures</h3><p>Sparkè¾ƒä¸ºå›°éš¾çš„ä¸€ä»¶äº‹æƒ…æ˜¯ç†è§£èŒƒå›´å’Œå˜é‡å’Œæ–¹æ³•çš„ç”Ÿå‘½å‘¨æœŸå½“ä»£ç åœ¨é›†ç¾¤ä¸­è¿è¡Œçš„æ—¶å€™ã€‚RDDæ“ä½œæ”¹å˜äº†å˜é‡çš„å¤–éƒ¨èŒƒå›´å¸¸å¸¸å®¹æ˜“è®©äººå›°æƒ‘ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä½¿ç”¨foreach()æ¥å¢åŠ ä¸€ä¸ªcounterï¼Œä½†æ˜¯åŒæ ·çš„é—®é¢˜ä¹Ÿä¼šåœ¨å…¶ä»–çš„æ“ä½œä¸­å‘ç”Ÿã€‚  </p>
<h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><p>è€ƒè™‘åŸç”Ÿçš„RDDå…ƒç´ å’Œï¼Œå°†ä¼šæ ¹æ®æ˜¯å¦åœ¨ç›¸åŒçš„JVMä¸Šè¿è¡Œä¼šæœ‰ä¸åŒçš„ç»“æœã€‚ä¸€ä¸ªæ™®é€šçš„ä¾‹å­æ˜¯æ‰§è¡Œsparkåœ¨localæ¨¡å¼ï¼ˆâ€“master = local[n]ï¼‰å¯¹æ¯”éƒ¨ç½²ä¸€ä¸ªsparkåˆ°ä¸€ä¸ªé›†ç¾¤ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> counter = <span class="number">0</span>;</span><br><span class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(data);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Wrong: Don't do this!!</span></span><br><span class="line">rdd.foreach(x -&gt; counter += x);</span><br><span class="line"></span><br><span class="line">println(<span class="string">"Counter value: "</span> + counter);</span><br></pre></td></tr></table></figure>
<h4 id="Local-VS-cluster-modes"><a href="#Local-VS-cluster-modes" class="headerlink" title="Local VS. cluster modes"></a>Local VS. cluster modes</h4><p>ä¸Šé¢çš„ä»£ç çš„è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ï¼Œè€Œä¸”å¯èƒ½è¿è¡Œå¹¶ä¸åƒæ‰€é¢„æœŸçš„ã€‚ä¸ºäº†æ‰§è¡Œjobï¼Œsparkå°†RDDæ“ä½œåˆ‡æˆå¤šä¸ªä»»åŠ¡ï¼Œæ¯ä¸€ä¸ªåœ¨ä¸€ä¸ªexecutorä¸­æ‰§è¡Œã€‚åœ¨æ‰§è¡Œä¹‹å‰ï¼ŒSparkä¼šè®¡ç®—è¿™ä¸ªä»»åŠ¡çš„closureã€‚Closureæ˜¯å“ªäº›å˜é‡å’Œæ–¹æ³•å¿…é¡»å¯¹è¿™ä¸ªexecutorå¯è§æ¥æ‰§è¡Œå¯¹RDDçš„è®¡ç®—ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­foreach()ï¼‰ã€‚è¿™ä¸ªclosureæ˜¯åºåˆ—åŒ–çš„å¹¶ä¸”è¢«å‘ç»™æ¯ä¸€ä¸ªexecutorã€‚<br>è¢«å‘ç»™æ¯ä¸€ä¸ªexecutorçš„è¿™ä¸ªclosureçš„å˜é‡ä¼šè¢«å¤åˆ¶å¹¶ä¸”ç„¶åå½“counteråœ¨è¿™ä¸ªforeachå‡½æ•°ä¸­è¢«å¼•ç”¨æ—¶ï¼Œå®ƒä¸å†æ˜¯åœ¨driverèŠ‚ç‚¹ä¸Šçš„counterã€‚è¿™é‡Œä»ç„¶æœ‰ä¸€ä¸ªcounteråœ¨driverèŠ‚ç‚¹çš„å†…å­˜ä¸­ï¼Œä½†æ˜¯ä¸åœ¨å¯¹executorå¯è§äº†ã€‚executorsåªèƒ½çœ‹åˆ°åºåˆ—åŒ–çš„closureçš„å‰¯æœ¬ã€‚è¿™æ ·æœ€ç»ˆçš„counterä»ç„¶å°†ä¼šæ˜¯0å› ä¸ºæ‰€æœ‰åœ¨counteræ“ä½œéƒ½æ˜¯å¯¹åºåˆ—åŒ–closureä¸Šçš„å€¼çš„æ“ä½œã€‚<br>åœ¨æœ¬åœ°æ¨¡å¼ï¼Œæœ‰æ—¶ï¼Œforeachå‡½æ•°å°†ä¼šå®é™…åœ¨å’Œdriveä¸Šçš„åŒä¸€ä¸ªjvmä¸­æ‰§è¡Œï¼ŒåŒæ—¶ä¼šå¼•ç”¨åŸæ¥çš„counterï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šæ›´æ–°å®ƒã€‚<br>ä¸ºäº†ä¿è¯è¿™ç§æƒ…å†µçš„å¯æ§æ€§ï¼Œåº”è¯¥ä½¿ç”¨ä¸€ä¸ª Accumulatorã€‚Accumulatorsåœ¨sparkä¸­é€šå¸¸ç”¨æ¥æä¾›ä¸€ä¸ªæœºåˆ¶æ¥å®‰å…¨çš„æ›´æ–°ä¸€ä¸ªå˜é‡ï¼Œå½“æ‰§è¡Œè¢«åˆ‡åˆ†åˆ°ä¸åŒçš„workerèŠ‚ç‚¹ä¸­æ—¶ã€‚è¿™ä¸ªAccumulatorsåœ¨åç»­è¿˜ä¼šè¢«è®¨è®ºã€‚<br>é€šå¸¸è¯´æ¥ï¼Œ closures - constructså–œæ¬¢å¾ªç¯æ´»ç€æœ¬åœ°å®šä¹‰æ–¹æ³•ï¼Œä¸åº”è¯¥è¢«ç”¨æ¥æ”¹å˜ä¸€äº›å…¨å±€çš„çŠ¶æ€ã€‚Sparkä¸èƒ½å®šä¹‰æˆ–è€…ä¿è¯å¯¹å¯¹è±¡çš„æ”¹å˜ã€‚ä¸€äº›ä»£ç ä¹Ÿè®¸ä¼šåœ¨æœ¬åœ°æ¨¡å¼å…¶æ•ˆæœï¼Œä½†æ˜¯ä¹Ÿåªæ˜¯å¶ç„¶ï¼ŒåŒæ—¶åœ¨åˆ†å¸ƒå¼æ¨¡å¼ä¹Ÿä¸èƒ½å’ŒæœŸæœ›ä¸€æ ·è¿è¡Œã€‚ä½¿ç”¨ä¸€ä¸ªAccumulatorsæ¥å–ä»£ä¸€äº›å…¨å±€å˜é‡çš„èšåˆæ˜¯å¿…è¦çš„ã€‚  </p>
<h4 id="æ‰“å°ä¸€ä¸ªRDDçš„å…ƒç´ "><a href="#æ‰“å°ä¸€ä¸ªRDDçš„å…ƒç´ " class="headerlink" title="æ‰“å°ä¸€ä¸ªRDDçš„å…ƒç´ "></a>æ‰“å°ä¸€ä¸ªRDDçš„å…ƒç´ </h4><p>å¦å¤–ä¸€ä¸ªå¸¸è§çš„è¡Œä¸ºæ˜¯è¯•å›¾ä½¿ç”¨rdd.foreach(println)æˆ–rdd.map(println)æ‰“å°ä¸€ä¸ªRDDå…ƒç´ ã€‚åœ¨å•æœºæƒ…å†µä¸‹ï¼Œè¿™ä¸ªå°†ä¼šè¾“å‡ºæœŸæœ›å¹¶ä¸”æ‰“å‡ºæ‰€æœ‰çš„RDDå…ƒç´ ã€‚ç„¶è€Œåœ¨é›†ç¾¤çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªstdoutçš„è¾“å‡ºåªä¼šè¢«executoræ‰€è°ƒç”¨å¹¶ä¸”å†™åˆ°executorçš„stdoutä¸­ï¼Œè€Œä¸æ˜¯åœ¨driver nodeä¸Šï¼Œæ‰€ä»¥driverä¸Šå¹¶ä¸ä¼šè¾“å‡ºè¿™äº›å†…å®¹ã€‚ä¸ºäº†æ‰“å‡ºæ‰€æœ‰åœ¨driverä¸Šçš„å…ƒç´ ï¼Œä¸€ä¸ªå¯ä»¥ä½¿ç”¨collect()æ–¹æ³•æ¥å°†RDDæ”¾åˆ°driverä¸Šï¼šrdd.collect().foreach(println)ã€‚è¿™ä¸ªä¼šå¼•èµ·driverå†…å­˜æº¢å‡ºï¼Œå› ä¸ºcollect()å°†å…¨éƒ¨çš„RDDæ”¾åˆ°ä¸€å°æœºå™¨ä¸Šï¼Œå¦‚æœä½ åªéœ€è¦æ‰“å‡ºRDDä¸­çš„éƒ¨åˆ†å…ƒç´ ï¼Œä¸€ä¸ªå®‰å…¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨take():<br>rdd.take(100).foreach(println).  </p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.sevenpan.com/2018/04/02/SparkAndDeepLearning/sparkLearningNote/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pan"/>
      <meta itemprop="description" content="computer, finance, some recording"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/02/SparkAndDeepLearning/sparkLearningNote/" class="post-title-link" itemprop="url">Sparks çš„ä¸€äº›åè¯</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-02 21:57:35" itemprop="dateCreated datePublished" datetime="2018-04-02T21:57:35+08:00">2018-04-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-06 18:04:58" itemprop="dateModified" datetime="2019-03-06T18:04:58+08:00">2019-03-06</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article"></span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time"></span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Some-terms-with-Spark"><a href="#Some-terms-with-Spark" class="headerlink" title="Some terms with Spark"></a>Some terms with Spark</h1><p><a href="https://spark.apache.org/docs/latest/cluster-overview.html" target="_blank" rel="noopener">https://spark.apache.org/docs/latest/cluster-overview.html</a></p>
<h3 id="excutor"><a href="#excutor" class="headerlink" title="excutor"></a>excutor</h3><p>A process launched for an application on a worker node, that runs tasks and keeps data in memory or disk storage across them. Each application has its own executors.<br>åœ¨ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹è¿è¡Œçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œç”¨æ¥è¿è¡Œä»»åŠ¡ï¼Œä¿å­˜æ•°æ®åœ¨å†…å­˜æˆ–è€…ç¡¬ç›˜ä¸­ã€‚æ¯ä¸€ä¸ªåº”ç”¨æœ‰è‡ªå·±çš„executorsã€‚</p>
<h3 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h3><p>User program built on Spark. Consists of a driver program and executors on the cluster.<br>åœ¨Sparkä¸Šçš„ç”¨æˆ·ç¨‹åºã€‚æœ‰ä¸€ä¸ªé©±åŠ¨ç¨‹åºå’Œexecutoråœ¨é›†ç¾¤ä¸­ç»„æˆã€‚  </p>
<h3 id="Application-jar"><a href="#Application-jar" class="headerlink" title="Application jar"></a>Application jar</h3><p>A jar containing the userâ€™s Spark application. In some cases users will want to create an â€œuber jarâ€ containing their application along with its dependencies. The userâ€™s jar should never include Hadoop or Spark libraries, however, these will be added at runtime.  </p>
<p><b>ä¸€ä¸ªåŒ…å«äº†ç”¨æˆ·sparkåº”ç”¨çš„ç¨‹åºã€‚åœ¨æœ‰çš„åœ°æ–¹ç”¨æˆ·å°†ä¼šåˆ›é€ ä¸€ä¸ªâ€œæ··åˆjarâ€å°†å¥¹ä»¬çš„åº”ç”¨å’Œä¾èµ–ä¸€èµ·åŒ…å«ã€‚è¿™ä¸ªç”¨æˆ·çš„jarä¸åº”è¯¥åŒ…å«hadoopæˆ–è€…sparkçš„åŒ…ï¼Œå®ƒä»¬å°†ä¼šåœ¨è¿è¡Œæ—¶è¢«æ·»åŠ ã€‚ ï¼Ÿï¼Ÿï¼Ÿ è¿™æ®µæ²¡çœ‹æ‡‚</b></p>
<h3 id="Driver-program"><a href="#Driver-program" class="headerlink" title="Driver program"></a>Driver program</h3><p>The process running the main() function of the application and creating the SparkContext<br>åˆ›é€ åº”ç”¨çš„main()å‡½æ•°å¹¶ä¸”åˆ›é€ SparkContext</p>
<h3 id="Cluster-manager"><a href="#Cluster-manager" class="headerlink" title="Cluster manager"></a>Cluster manager</h3><p>An external service for acquiring resources on the cluster (e.g. standalone manager, Mesos, YARN)<br>ä¸€ä¸ªå¤–éƒ¨çš„æœåŠ¡ç”¨äºè·å–é›†ç¾¤çš„èµ„æºã€‚ï¼ˆæ¯”å¦‚standalone managerï¼ŒMesosï¼Œ YARNï¼‰</p>
<h3 id="Deploy-mode"><a href="#Deploy-mode" class="headerlink" title="Deploy mode"></a>Deploy mode</h3><p>Distinguishes where the driver process runs. In â€œclusterâ€ mode, the framework launches the driver inside of the cluster. In â€œclientâ€ mode, the submitter launches the driver outside of the cluster.<br>åŒºåˆ†é©±åŠ¨è¿›ç¨‹åœ¨å“ªè¿è¡Œã€‚åœ¨â€œclusterâ€æ¨¡å¼ä¸‹ï¼Œè¿™ä¸ªæ¡†æ¶å¯åŠ¨é©±åŠ¨åœ¨é›†ç¾¤å†…éƒ¨ã€‚åœ¨â€œclientâ€æ¨¡å¼ä¸‹ï¼Œsubmitteråœ¨é›†ç¾¤å¤–å¯åŠ¨è¿›ç¨‹ã€‚  </p>
<h3 id="Worker-node"><a href="#Worker-node" class="headerlink" title="Worker node"></a>Worker node</h3><p>Any node that can run application code in the cluster<br>åœ¨é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹å¯ä»¥è¿è¡Œåº”ç”¨ä»£ç ã€‚</p>
<h3 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h3><p>A unit of work that will be sent to one executor<br>ä¸€ç»„ä¼šè¢«å‘é€åˆ°ä¸€ä¸ªexecutorçš„å·¥ä½œã€‚</p>
<h3 id="Job"><a href="#Job" class="headerlink" title="Job"></a>Job</h3><p>A parallel computation consisting of multiple tasks that gets spawned in response to a Spark action (e.g. save, collect); youâ€™ll see this term used in the driverâ€™s logs.<br>ä¸€ä¸ªåŒ…å«äº†å¤šä¸ªä»»åŠ¡çš„å¹¶è¡Œè®¡ç®—ç”¨æ¥å“åº”ä¸€ä¸ªSpark actionã€‚</p>
<h3 id="Stage"><a href="#Stage" class="headerlink" title="Stage"></a>Stage</h3><p>Each job gets divided into smaller sets of tasks called stages that depend on each other (similar to the map and reduce stages in MapReduce); youâ€™ll see this term used in the driverâ€™s logs.<br>æ¯ä¸€ä¸ªå·¥ä½œè¢«åˆ†ä¸ºå¾ˆå°çš„ä»»åŠ¡é›†è¢«ç§°ä¸ºstagesï¼›ä½ å¯ä»¥åœ¨driverçš„æ—¥å¿—ä¸­çœ‹åˆ°å®ƒä»¬ã€‚</p>
<h2 id="ç»„æˆéƒ¨åˆ†"><a href="#ç»„æˆéƒ¨åˆ†" class="headerlink" title="ç»„æˆéƒ¨åˆ†"></a>ç»„æˆéƒ¨åˆ†</h2><p>Spark applicationæ˜¯ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹é›†åˆåœ¨é›†ç¾¤ä¸Šè¿è¡Œï¼Œé€šè¿‡ä½ çš„ä¸»ç¨‹åºï¼ˆç§°ä¸ºdriver programï¼‰ä¸­çš„SparkContextæ¥åè°ƒå·¥ä½œã€‚<br>ç‰¹åˆ«çš„ï¼Œåœ¨é›†ç¾¤ä¸Šè¿è¡Œï¼ŒSparkContextå¯ä»¥é“¾æ¥ä¸åŒçš„é›†ç¾¤ç®¡ç†ï¼ˆeither Sparkâ€™s own standalone cluster manager, Mesos or YARNï¼‰ï¼Œç”¨æ¥åœ¨åº”ç”¨ä¸­åˆ†é…èµ„æºã€‚ä¸€æ—¦è¿æ¥ï¼ŒSparkè·å–é›†ç¾¤ä¸­èŠ‚ç‚¹ä¸Šçš„executorsï¼Œæ˜¯ä½ åº”ç”¨ä¸­çš„è¿›ç¨‹ç”¨äºè®¡ç®—å’Œå­˜å‚¨æ•°æ®ã€‚ä¸‹ä¸€æ­¥å®ƒä¼šå‘é€ä½ çš„åº”ç”¨ç¨‹åºï¼ˆé€šè¿‡JARæˆ–è€…Pythonæ–‡ä»¶å®šä¹‰çš„ä¼ é€’ç»™SparkContextï¼‰åˆ°executorsã€‚æœ€ç»ˆï¼ŒSparkContextå‘é€ä»»åŠ¡åˆ°exexutoræ¥è¿è¡Œã€‚<br>åœ¨è¿™ä¸ªæ¶æ„ä¸­æœ‰ä»¥ä¸‹ä¸€äº›äº‹æƒ…éœ€è¦æ³¨æ„ï¼š  </p>
<ol>
<li>æ¯ä¸€ä¸ªåº”ç”¨è·å–å®ƒè‡ªå·±çš„executorè¿›ç¨‹ï¼Œé‚£äº›è¿›ç¨‹ä¼šåœ¨æ•´ä¸ªåº”ç”¨ä¸­å¯åŠ¨ï¼Œå¹¶ä¸”è¿è¡Œä»»åŠ¡åœ¨å¤šä¸ªçº¿ç¨‹é‡Œã€‚<br> è¿™æœ‰åˆ©äºå¯¹æ¯ä¸€ä¸ªåº”ç”¨è¿›è¡Œéš”ç¦»ï¼Œåœ¨è°ƒåº¦æ–¹é¢ï¼ˆæ¯ä¸€ä¸ªé©±åŠ¨è°ƒåº¦è‡ªå·±çš„ä»»åŠ¡ï¼‰å’Œæ‰§è¡Œæ–¹é¢ï¼ˆä¸åŒçš„åº”ç”¨åœ¨ä¸åŒçš„JVMä¸­è¿è¡Œï¼‰ã€‚è¿™ä¹Ÿæ„å‘³ç€æ•°æ®ä¸èƒ½åœ¨ä¸åŒçš„Spart åº”ç”¨ä¸­å…±äº«ï¼ˆSparkContextçš„å®ä¾‹ï¼‰é™¤éå°†å®ƒä»¬å†™åˆ°ä¸€ä¸ªå¦å¤–çš„å­˜å‚¨ç³»ç»Ÿä¸­ã€‚</li>
<li>Sparkå¯¹äºåº•å±‚çš„é›†ç¾¤ç®¡ç†æ˜¯ä¸å¯çŸ¥çš„ã€‚åªè¦å®ƒå¯ä»¥è·å–åˆ°å¤„ç†å™¨çš„è¿›ç¨‹ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„é€šè®¯ï¼Œå®ƒå¯ä»¥å¾ˆå®¹æ˜“çš„åœ¨æ”¯æŒå…¶ä»–çš„åº”ç”¨çš„é›†ç¾¤ç®¡ç†å™¨ä¸Šè¿è¡Œã€‚  </li>
<li>Driverç¨‹åºåœ¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»ç›‘å¬å¹¶ä¸”ä»å®ƒçš„executorä¸­æ¥å—ä¼šæ¥çš„è¿æ¥ã€‚æ‰€ä»¥drivenç¨‹åºå¿…é¡»ç½‘ç»œå¯è¾¾å¯¹äºworkerèŠ‚ç‚¹ã€‚  </li>
<li>ç”±äºdriver åœ¨é›†ç¾¤ä¸­è°ƒåº¦taskï¼Œå®ƒåº”è¯¥åœ¨æ¥è¿‘workerèŠ‚ç‚¹çš„åœ°æ–¹è¿è¡Œï¼Œåå‘äºåœ¨åŒä¸€ä¸ªç½‘ç»œã€‚å¦‚æœä½ æƒ³è¦è¿œç¨‹å‘é€è¯·æ±‚ï¼Œé‚£ä¹ˆæœ€å¥½å¯¹driveræ‰“å¼€RPCå¹¶ä¸”ä»é™„è¿‘æäº¤æ“ä½œè€Œä¸æ˜¯è¿è¡Œä¸€ä¸ªå¾ˆé¥è¿œçš„driverã€‚  </li>
</ol>
<p><b>When running Spark on YARN, each Spark executor runs as a YARN container.<br>Where MapReduce schedules a container and starts a JVM for each task, Spark hosts multiple tasks within the same container.</b><br>æ‰€ä»¥executorå°±æ˜¯å¯¹åº”çš„containerï¼Œç„¶ååŸæ¥MapReduceæ˜¯ä¸€ä¸ªContainerè¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼ŒSparkå¯ä»¥åœ¨ä¸€ä¸ªContainerä¸­è¿è¡Œå¤šä»»åŠ¡ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Pan</p>
              <div class="site-description motion-element" itemprop="description">computer, finance, some recording</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Pan</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="Symbols count total"></span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="Reading time total"></span>
  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme â€“ <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.0.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.1"></script>



  

  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
